import{j as e,R as B,T as w,a6 as H,k as K,h as L,a as R,P,al as F,i as z,K as Y,M,aX as J,H as D,e as Q}from"./ui-vendor-DEBjJ4HS.js";import{d as W,u as Z,r as i,L as V}from"./react-vendor-Cy458wKG.js";import{S as ee}from"./StarRating-wHilpPP8.js";import{f as g}from"./seller-chunk-CL4v7LiS.js";import{u as se}from"./chat-chunk-dxmpBB-S.js";import{c as h,A as _}from"./admin-chunk-C7Ad4l4I.js";import"./utils-vendor-DeGC_a19.js";const de=async()=>{const{id:p}=W(),E=Z(),{isAdmin:n,isSeller:C}=se(),[s,O]=i.useState(null),[G,S]=i.useState(!0),[A,d]=i.useState(null),[t,c]=i.useState(!1),[k,u]=i.useState(!1),[o,j]=i.useState(""),[$,f]=i.useState(!1),[m,N]=i.useState("");i.useEffect(()=>{p&&x(parseInt(p))},[p]);const x=async a=>{S(!0),d(null);try{let r="";await n()===!0?r=`/admin/ratings/${a}`:await C()===!0?r=`/ratings/${a}`:r=`/ratings/${a}`,console.log("üîç Obteniendo detalles de valoraci√≥n desde:",r);const l=await h.get(r);if(console.log("üì¶ Respuesta del servidor:",l),l.status==="success"&&l.data)O(l.data);else throw new Error(l.message||"Error al obtener detalles de la valoraci√≥n")}catch(r){console.error("‚ùå Error fetching rating details:",r),r instanceof Error&&r.message.includes("403")?d("No tienes permiso para ver esta valoraci√≥n"):r instanceof Error&&r.message.includes("404")?d("La valoraci√≥n no fue encontrada"):d(r instanceof Error?r.message:"Error al cargar los detalles de la valoraci√≥n")}finally{S(!1)}},U=async()=>{if(!(!s||!o.trim())){c(!0);try{await h.post(_.RATINGS.REPLY,{rating_id:s.id,reply_text:o.trim()}),await x(s.id),u(!1),j("")}catch(a){console.error("Error replying to rating:",a),alert("Error al enviar la respuesta")}finally{c(!1)}}},X=async()=>{if(!(!s||!m.trim())){c(!0);try{await h.post(_.RATINGS.REPORT,{rating_id:s.id,reason:m.trim()}),await x(s.id),f(!1),N(""),alert("Reporte enviado correctamente")}catch(a){console.error("Error reporting rating:",a),alert("Error al enviar el reporte")}finally{c(!1)}}},b=async(a,r)=>{if(s){c(!0);try{const l=`${_.ADMIN.RATINGS.LIST}/${s.id}/${a}`;await h.post(l,r?{note:r}:{}),await x(s.id)}catch(l){console.error(`Error ${a}ing rating:`,l),alert(`Error al ${a==="approve"?"aprobar":a==="reject"?"rechazar":"marcar"} la valoraci√≥n`)}finally{c(!1)}}},q=a=>{const r={pending:{icon:Q,color:"text-yellow-600 bg-yellow-100",label:"Pendiente"},approved:{icon:R,color:"text-green-600 bg-green-100",label:"Aprobada"},rejected:{icon:D,color:"text-red-600 bg-red-100",label:"Rechazada"},flagged:{icon:w,color:"text-orange-600 bg-orange-100",label:"Marcada"}};return r[a]||r.pending},T=await C()===!0&&s?.type==="user_to_seller"&&!s?.seller_response,I=await n()!==!0&&s,y=await n()===!0&&s;if(G)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"h-8 w-8 animate-spin text-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando detalles de la valoraci√≥n..."})]})});if(A||!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto",children:[e.jsx(w,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error al cargar la valoraci√≥n"}),e.jsx("p",{className:"text-gray-600 mb-4",children:A||"No se pudo encontrar la valoraci√≥n solicitada"}),e.jsx("button",{onClick:()=>E(-1),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:"Volver atr√°s"})]})});const v=q(s.status);return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:()=>E(-1),className:"flex items-center text-gray-600 hover:text-gray-900",children:[e.jsx(H,{className:"h-5 w-5 mr-2"}),"Volver atr√°s"]}),await n()===!0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-600",children:"Vista Administrador"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Valoraci√≥n #",s.id]}),e.jsxs("div",{className:"flex items-center mt-2 space-x-4",children:[e.jsx(ee,{value:s.rating,readOnly:!0,size:"medium"}),e.jsxs("span",{className:"text-lg font-semibold",children:[s.rating,"/5"]})]})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${v.color}`,children:[e.jsx(v.icon,{className:"h-4 w-4 mr-2"}),v.label]})})]}),s.title&&e.jsx("h2",{className:"text-lg font-medium text-gray-900 mt-4",children:s.title})]}),e.jsxs("div",{className:"px-6 py-4",children:[s.comment&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Comentario"}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsx("p",{className:"text-gray-800 whitespace-pre-wrap",children:s.comment})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Usuario"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[s.user?.avatar?e.jsx("img",{src:s.user.avatar,alt:s.user.name,className:"w-10 h-10 rounded-full object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx(L,{className:"h-6 w-6 text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.user?.name||`Usuario #${s.user_id}`}),s.is_verified_purchase&&e.jsxs("p",{className:"text-sm text-green-600 flex items-center",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),"Compra verificada"]}),await n()===!0&&s.user_details?.email&&e.jsx("p",{className:"text-sm text-gray-500",children:s.user_details.email})]})]})]}),e.jsxs("div",{children:[s.product&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Producto"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[s.product.image?e.jsx("img",{src:s.product.image,alt:s.product.name,className:"w-10 h-10 rounded object-cover"}):e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded flex items-center justify-center",children:e.jsx(P,{className:"h-6 w-6 text-gray-500"})}),e.jsxs("div",{children:[e.jsxs(V,{to:`/products/${s.product.id}`,className:"font-medium text-primary-600 hover:text-primary-800 flex items-center",children:[s.product.name,e.jsx(F,{className:"h-4 w-4 ml-1"})]}),await n()===!0&&s.product_details?.price&&e.jsxs("p",{className:"text-sm text-gray-500",children:["$",s.product_details.price]})]})]})]}),s.seller&&e.jsxs(e.Fragment,{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center mt-4",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Vendedor"]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded flex items-center justify-center",children:e.jsx(z,{className:"h-6 w-6 text-gray-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.seller.store_name}),await n()===!0&&s.seller_details?.status&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Estado: ",s.seller_details.status]})]})]})]})]})]}),s.order_details&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Orden"]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"N√∫mero:"}),e.jsxs("p",{className:"font-medium",children:["#",s.order_details.order_number]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Estado:"}),e.jsx("p",{className:"font-medium",children:s.order_details.status})]}),s.order_details.total&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Total:"}),e.jsxs("p",{className:"font-medium",children:["$",s.order_details.total]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Fecha:"}),e.jsx("p",{className:"font-medium",children:g(s.order_details.created_at)})]})]}),e.jsxs(V,{to:`/orders/${s.order_id}`,className:"inline-flex items-center mt-3 text-primary-600 hover:text-primary-800",children:["Ver orden completa",e.jsx(F,{className:"h-4 w-4 ml-1"})]})]})]}),s.seller_response&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-3 flex items-center",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Respuesta del vendedor"]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-lg",children:[e.jsx("p",{className:"text-gray-800 mb-2",children:s.seller_response.text}),e.jsx("p",{className:"text-sm text-gray-500",children:g(s.seller_response.created_at)})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Informaci√≥n temporal"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Creada:"}),e.jsx("p",{className:"font-medium",children:g(s.created_at)})]}),s.updated_at!==s.created_at&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Actualizada:"}),e.jsx("p",{className:"font-medium",children:g(s.updated_at)})]})]})]})]}),(T||I||y)&&e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-4",children:"Acciones disponibles"}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[T&&e.jsxs("button",{onClick:()=>u(!k),className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Responder"]}),I&&e.jsxs("button",{onClick:()=>f(!$),className:"flex items-center px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Reportar"]}),y&&s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>b("approve"),disabled:t,className:"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Aprobar"]}),e.jsxs("button",{onClick:()=>{const a=prompt("Raz√≥n del rechazo (obligatorio):");a&&b("reject",a)},disabled:t,className:"flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Rechazar"]})]}),y&&e.jsxs("button",{onClick:()=>{const a=prompt("Raz√≥n para marcar:");a&&b("flag",a)},disabled:t,className:"flex items-center px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 disabled:opacity-50",children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Marcar"]})]})]})]}),k&&e.jsxs("div",{className:"mt-6 bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Responder a la valoraci√≥n"}),e.jsx("textarea",{value:o,onChange:a=>j(a.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",rows:4,placeholder:"Escribe tu respuesta..."}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx("button",{onClick:()=>{u(!1),j("")},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300",disabled:t,children:"Cancelar"}),e.jsx("button",{onClick:U,disabled:!o.trim()||t,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50",children:t?"Enviando...":"Enviar respuesta"})]})]}),$&&e.jsxs("div",{className:"mt-6 bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Reportar valoraci√≥n"}),e.jsx("textarea",{value:m,onChange:a=>N(a.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",rows:4,placeholder:"Describe el motivo del reporte..."}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[e.jsx("button",{onClick:()=>{f(!1),N("")},className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300",disabled:t,children:"Cancelar"}),e.jsx("button",{onClick:X,disabled:!m.trim()||t,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50",children:t?"Enviando...":"Enviar reporte"})]})]})]})})};export{de as default};
//# sourceMappingURL=RatingDetailPage-DQAMmf8t.js.map
