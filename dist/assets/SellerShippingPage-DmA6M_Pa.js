import{c as X,r as a,j as r,M as Z,L as O}from"./index-DmNDOrWy.js";import{T as ee}from"./Table-BdEePeKQ.js";import{f as re}from"./formatCurrency-CXuiUHwQ.js";import{S as te}from"./SellerStatCardList-DE6BvjV9.js";import{S as se}from"./ShippingServiceAdapter-DX6ZR1a2.js";import{S as ae}from"./ShippingFormModal-AmDqHyY-.js";import{R as ne}from"./refresh-cw-BOPCg90x.js";import{S as oe}from"./search-CbEKe7UQ.js";import{F as ie}from"./funnel-CAFb7hhq.js";import{P as E}from"./package-CIRlwNqy.js";import{T as R}from"./truck-DP84WB3Y.js";import{P as U,a as le}from"./printer-C9AKBDpF.js";import{T as A}from"./triangle-alert-B75WTV0P.js";import{C as de}from"./chart-no-axes-column-C4ngQd1-.js";import{E as ce}from"./external-link-Bij3ydGU.js";import"./chevron-left-Dl3DF2OO.js";import"./arrow-up-DQySjn32.js";/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],pe=X("clipboard-list",ue),Te=()=>{const y=new se,[i,b]=a.useState([]),[$,j]=a.useState(!0),[P,C]=a.useState(null),[g,D]=a.useState("all"),[h,T]=a.useState("all"),[d,I]=a.useState("all"),[m,_]=a.useState(""),[c,F]=a.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),[n,N]=a.useState({from:"",to:""}),[M,l]=a.useState(null),[L,p]=a.useState(""),[u,x]=a.useState(!1),[H,S]=a.useState(!1),[f,q]=a.useState(null);a.useEffect(()=>{v()},[g,h,m,c.currentPage,d,n]);const v=async()=>{j(!0),C(null);try{const e={page:c.currentPage,limit:c.itemsPerPage};if(g!=="all"&&(e.status=g),h!=="all"&&(e.carrier=h),m&&(e.search=m),d==="today"){const s=new Date().toISOString().split("T")[0];e.dateFrom=s,e.dateTo=s}else if(d==="week"){const s=new Date,o=new Date(s.setDate(s.getDate()-s.getDay()));e.dateFrom=o.toISOString().split("T")[0],e.dateTo=new Date().toISOString().split("T")[0]}else if(d==="month"){const s=new Date,o=new Date(s.getFullYear(),s.getMonth(),1);e.dateFrom=o.toISOString().split("T")[0],e.dateTo=new Date().toISOString().split("T")[0]}else d==="custom"&&n.from&&n.to&&(e.dateFrom=n.from,e.dateTo=n.to);const t=await y.getShippingsList(e);console.log("Datos de envío obtenidos:",t),b(t.items),F(t.pagination)}catch(e){console.error("Error al cargar envíos:",e),C("No se pudieron cargar los datos de envíos. Intenta de nuevo más tarde.")}finally{j(!1)}},V=e=>{q(e),S(!0)},W=async e=>{if(f){x(!0),l(null),p("");try{if(await y.markAsShipped(f,e))l(!0),p("Envío procesado correctamente"),b(s=>s.map(o=>o.id===f?{...o,status:"shipped",trackingNumber:e.tracking_number,carrier:e.shipping_company,estimatedDelivery:e.estimated_delivery,lastUpdate:new Date().toISOString()}:o)),S(!1),setTimeout(()=>{v(),l(null)},3e3);else throw new Error("No se pudo procesar el envío")}catch(t){console.error("Error al procesar envío:",t),l(!1),p("Error al procesar el envío. Intenta de nuevo.")}finally{x(!1)}}},k=async(e,t)=>{x(!0),l(null),p("");try{if(await y.updateShippingStatus(e,t))l(!0),p(`Estado actualizado a ${z(t)}`),b(o=>o.map(w=>w.id===e?{...w,status:t,lastUpdate:new Date().toISOString()}:w)),setTimeout(()=>{v(),l(null)},3e3);else throw new Error("No se pudo actualizar el estado")}catch(s){console.error(`Error al actualizar estado a ${t}:`,s),l(!1),p("Error al actualizar estado. Intenta de nuevo.")}finally{x(!1)}},B=async e=>{V(e)},G=e=>{F(t=>({...t,currentPage:e}))},Y=()=>{j(!0),v()},z=e=>{switch(e){case"pending":return"Pendiente";case"ready_to_ship":return"Listo para enviar";case"in_transit":case"shipped":return"En tránsito";case"delivered":return"Entregado";case"failed":return"Fallido";case"returned":return"Devuelto";default:return"Desconocido"}},J=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"ready_to_ship":return"bg-blue-100 text-blue-800";case"in_transit":case"shipped":return"bg-indigo-100 text-indigo-800";case"delivered":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"returned":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},K=[{key:"orderNumber",header:"Nº Pedido",sortable:!0,render:e=>r.jsx(O,{to:`/seller/orders/${e.orderId}`,className:"font-medium text-primary-600 hover:underline",children:e.orderNumber})},{key:"trackingNumber",header:"Nº Seguimiento",sortable:!0,render:e=>r.jsx("div",{children:e.trackingNumber?r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"font-mono text-sm",children:e.trackingNumber}),e.carrier&&r.jsx("a",{href:"#",className:"ml-2 text-blue-600 hover:text-blue-800",title:`Rastrear con ${e.carrier}`,onClick:t=>{t.preventDefault(),alert(`Redirigiendo al sitio de ${e.carrier} para rastrear ${e.trackingNumber}`)},children:r.jsx(ce,{size:14})})]}):r.jsx("span",{className:"text-gray-500 text-sm",children:"No asignado"})})},{key:"date",header:"Fecha de Pedido",sortable:!0,render:e=>{const t=new Date(e.date);return r.jsx("span",{className:"text-sm",children:t.toLocaleDateString("es-ES")})}},{key:"customer",header:"Cliente",sortable:!0,render:e=>r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-sm",children:e.customer.name}),r.jsx("div",{className:"text-xs text-gray-500 truncate max-w-[150px]",children:e.shippingAddress})]})},{key:"status",header:"Estado",sortable:!0,render:e=>r.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${J(e.status)}`,children:z(e.status)})},{key:"carrier",header:"Transportista",sortable:!0,render:e=>r.jsx("span",{children:e.carrier||"No asignado"})},{key:"estimatedDelivery",header:"Entrega Estimada",sortable:!0,render:e=>r.jsx("span",{children:e.estimatedDelivery?new Date(e.estimatedDelivery).toLocaleDateString("es-ES"):"No disponible"})},{key:"actions",header:"Acciones",render:e=>r.jsxs("div",{className:"flex justify-end space-x-2",children:[r.jsx(O,{to:`/seller/shipping/${e.id}`,className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Ver detalles",children:r.jsx(pe,{size:18})}),(e.status==="pending"||e.status==="ready_to_ship")&&!e.trackingNumber&&r.jsx("button",{onClick:()=>B(e.id),className:"p-1 text-green-600 hover:bg-green-100 rounded-md",title:"Asignar número de seguimiento",disabled:u,children:r.jsx(E,{size:18})}),(e.status==="ready_to_ship"||e.status==="pending")&&e.trackingNumber&&r.jsx("button",{onClick:()=>k(e.id,"shipped"),className:"p-1 text-indigo-600 hover:bg-indigo-100 rounded-md",title:"Marcar como enviado",disabled:u,children:r.jsx(R,{size:18})}),e.trackingNumber&&(e.status==="shipped"||e.status==="in_transit")&&r.jsx("button",{onClick:()=>alert(`Imprimiendo etiqueta para ${e.trackingNumber}`),className:"p-1 text-gray-600 hover:bg-gray-100 rounded-md",title:"Imprimir etiqueta",disabled:u,children:r.jsx(le,{size:18})}),(e.status==="in_transit"||e.status==="shipped")&&r.jsx("button",{onClick:()=>k(e.id,"delivered"),className:"p-1 text-green-600 hover:bg-green-100 rounded-md",title:"Marcar como entregado",disabled:u,children:r.jsx(U,{size:18})}),(e.status==="ready_to_ship"||e.status==="in_transit"||e.status==="shipped"||e.status==="pending")&&r.jsx("button",{onClick:()=>k(e.id,"failed"),className:"p-1 text-red-600 hover:bg-red-100 rounded-md",title:"Marcar como fallido",disabled:u,children:r.jsx(A,{size:18})})]})}],Q=()=>{const e={pending:i.filter(t=>t.status==="pending").length,readyToShip:i.filter(t=>t.status==="ready_to_ship").length,inTransit:i.filter(t=>t.status==="in_transit"||t.status==="shipped").length,delivered:i.filter(t=>t.status==="delivered").length,failed:i.filter(t=>t.status==="failed").length,returned:i.filter(t=>t.status==="returned").length,totalShippingCost:i.reduce((t,s)=>t+(s.shippingCost||0),0)};return[{label:"Pendientes",value:e.pending,icon:r.jsx(E,{className:"h-5 w-5 text-yellow-600"}),color:"yellow"},{label:"Listos",value:e.readyToShip,icon:r.jsx(E,{className:"h-5 w-5 text-blue-600"}),color:"blue"},{label:"En Tránsito",value:e.inTransit,icon:r.jsx(R,{className:"h-5 w-5 text-indigo-600"}),color:"indigo"},{label:"Entregados",value:e.delivered,icon:r.jsx(U,{className:"h-5 w-5 text-green-600"}),color:"green"},{label:"Fallidos",value:e.failed,icon:r.jsx(A,{className:"h-5 w-5 text-red-600"}),color:"red"},{label:"Devueltos",value:e.returned,icon:r.jsx(Z,{className:"h-5 w-5 text-orange-600"}),color:"orange"},{label:"Coste Envíos",value:re(e.totalShippingCost),icon:r.jsx(de,{className:"h-5 w-5 text-primary-600"}),color:"primary"}]};return r.jsxs("div",{className:"space-y-6",children:[r.jsx(ae,{orderId:f||"",isOpen:H,onClose:()=>S(!1),onSubmit:W,isLoading:u}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Envíos"}),r.jsx("div",{className:"flex space-x-2",children:r.jsxs("button",{onClick:Y,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",disabled:u,children:[r.jsx(ne,{size:18,className:"inline mr-2"}),"Actualizar"]})})]}),M===!0&&r.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative",role:"alert",children:r.jsx("span",{className:"block sm:inline",children:L})}),M===!1&&r.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:r.jsx("span",{className:"block sm:inline",children:L})}),P&&r.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:r.jsx("span",{className:"block sm:inline",children:P})}),r.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:r.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[r.jsxs("div",{className:"relative flex-grow",children:[r.jsx("input",{type:"text",placeholder:"Buscar por número de pedido, seguimiento, cliente...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",value:m,onChange:e=>_(e.target.value)}),r.jsx(oe,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(ie,{className:"h-5 w-5 text-gray-500"}),r.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:g,onChange:e=>D(e.target.value),children:[r.jsx("option",{value:"all",children:"Todos los estados"}),r.jsx("option",{value:"pending",children:"Pendientes"}),r.jsx("option",{value:"ready_to_ship",children:"Listos para enviar"}),r.jsx("option",{value:"shipped",children:"En tránsito"}),r.jsx("option",{value:"delivered",children:"Entregados"}),r.jsx("option",{value:"failed",children:"Fallidos"}),r.jsx("option",{value:"returned",children:"Devueltos"})]})]}),r.jsx("div",{className:"flex items-center space-x-2",children:r.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:h,onChange:e=>T(e.target.value),children:[r.jsx("option",{value:"all",children:"Todos los transportistas"}),r.jsx("option",{value:"Correos Express",children:"Correos Express"}),r.jsx("option",{value:"SEUR",children:"SEUR"}),r.jsx("option",{value:"MRW",children:"MRW"}),r.jsx("option",{value:"DHL",children:"DHL"}),r.jsx("option",{value:"FedEx",children:"FedEx"}),r.jsx("option",{value:"UPS",children:"UPS"})]})}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:d,onChange:e=>I(e.target.value),children:[r.jsx("option",{value:"all",children:"Todas las fechas"}),r.jsx("option",{value:"today",children:"Hoy"}),r.jsx("option",{value:"week",children:"Esta semana"}),r.jsx("option",{value:"month",children:"Este mes"}),r.jsx("option",{value:"custom",children:"Personalizado"})]}),d==="custom"&&r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:n.from,onChange:e=>N({...n,from:e.target.value})}),r.jsx("span",{className:"text-gray-500",children:"a"}),r.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:n.to,onChange:e=>N({...n,to:e.target.value})})]})]}),r.jsx("button",{onClick:()=>{D("all"),T("all"),I("all"),_(""),N({from:"",to:""})},className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Limpiar filtros"})]})}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-7 gap-4",children:r.jsx(te,{items:Q()})}),r.jsx(ee,{data:i,columns:K,searchFields:["orderNumber","trackingNumber","customer","shippingAddress"],loading:$,emptyMessage:"No se encontraron envíos",pagination:{currentPage:c.currentPage,totalPages:c.totalPages,totalItems:c.totalItems,itemsPerPage:c.itemsPerPage,onPageChange:G}})]})};export{Te as default};
//# sourceMappingURL=SellerShippingPage-DmA6M_Pa.js.map
