{"version":3,"file":"ResetPasswordPage-Gt2ISPHV.js","sources":["../../src/presentation/pages/ResetPasswordPage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useNavigate, useLocation, Link } from 'react-router-dom';\r\nimport axiosInstance from '../../infrastructure/api/axiosConfig';\r\nimport { API_ENDPOINTS } from '../../constants/apiEndpoints';\r\nimport { useAuth } from '../hooks/useAuth';\r\n\r\n/**\r\n * Página de restablecimiento de contraseña\r\n * Se accede después de validar el token de recuperación o hacer clic en el enlace del correo\r\n */\r\nconst ResetPasswordPage: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { login } = useAuth();\r\n  \r\n  // Obtener parámetros de la URL y el estado\r\n  const queryParams = new URLSearchParams(location.search);\r\n  const tokenFromQuery = queryParams.get('token');\r\n  const emailFromQuery = queryParams.get('email');\r\n  \r\n  // Obtener datos del estado de navegación (desde ForgotPasswordPage)\r\n  const tokenFromState = location.state?.token;\r\n  const emailFromState = location.state?.email;\r\n  \r\n  // Establecer los valores iniciales\r\n  const [token, setToken] = useState(tokenFromQuery || tokenFromState || '');\r\n  const [email, setEmail] = useState(emailFromQuery || emailFromState || '');\r\n  const [password, setPassword] = useState('');\r\n  const [confirmPassword, setConfirmPassword] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [success, setSuccess] = useState<string | null>(null);\r\n  \r\n  // Validar si hay token y email al cargar\r\n  useEffect(() => {\r\n    if (!token) {\r\n      setError('No se proporcionó un token válido para restablecer la contraseña');\r\n    }\r\n    \r\n    if (!email) {\r\n      setError('Es necesario proporcionar un correo electrónico para restablecer la contraseña');\r\n    }\r\n  }, [token, email]);\r\n  \r\n  // Manejar el envío del formulario\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    // Validaciones básicas\r\n    if (password.length < 8) {\r\n      setError('La contraseña debe tener al menos 8 caracteres');\r\n      return;\r\n    }\r\n    \r\n    if (password !== confirmPassword) {\r\n      setError('Las contraseñas no coinciden');\r\n      return;\r\n    }\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      // Enviar solicitud para restablecer la contraseña\r\n      const response = await axiosInstance.post(API_ENDPOINTS.AUTH.RESET_PASSWORD, {\r\n        token,\r\n        email,\r\n        password,\r\n        password_confirmation: confirmPassword\r\n      });\r\n      \r\n      // Verificar si la solicitud fue exitosa\r\n      if (response.data?.success || response.status === 200) {\r\n        setSuccess('Contraseña actualizada correctamente. Serás redirigido para iniciar sesión.');\r\n        \r\n        // Si la API devuelve un token de autenticación, iniciar sesión automáticamente\r\n        if (response.data?.token || response.data?.auth_token) {\r\n          // Iniciar sesión automáticamente si es posible\r\n          const credentials = { email, password };\r\n          const loginResult = await login(credentials);\r\n          \r\n          if (loginResult) {\r\n            // Si el login fue exitoso, redirigir a la página principal\r\n            setTimeout(() => {\r\n              navigate('/');\r\n            }, 1500);\r\n          } else {\r\n            // Si el login falló, redirigir a la página de login\r\n            setTimeout(() => {\r\n              navigate('/login');\r\n            }, 2000);\r\n          }\r\n        } else {\r\n          // Si no hay token, redirigir a la página de login\r\n          setTimeout(() => {\r\n            navigate('/login');\r\n          }, 2000);\r\n        }\r\n      } else {\r\n        setError('No se pudo restablecer la contraseña. Inténtalo de nuevo.');\r\n      }\r\n    } catch (err: any) {\r\n      console.error('Error al restablecer la contraseña:', err);\r\n      \r\n      if (err.response?.status === 422) {\r\n        // Error de validación\r\n        const validationErrors = err.response.data?.errors;\r\n        if (validationErrors) {\r\n          // Si hay errores de validación, mostrar el primero\r\n          const firstError = Object.values(validationErrors)[0];\r\n          setError(Array.isArray(firstError) ? firstError[0] : firstError);\r\n        } else {\r\n          setError('Los datos proporcionados no son válidos');\r\n        }\r\n      } else if (err.response?.data?.message) {\r\n        setError(err.response.data.message);\r\n      } else {\r\n        setError('Error al procesar la solicitud. Inténtalo de nuevo más tarde.');\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <div className=\"min-h-[80vh] flex items-center justify-center py-12 px-4\">\r\n      <div className=\"max-w-md w-full space-y-8 bg-white p-8 rounded-lg shadow-lg\">\r\n        <div className=\"text-center\">\r\n          <h2 className=\"text-3xl font-extrabold text-gray-900\">\r\n            Crea tu nueva contraseña\r\n          </h2>\r\n          <p className=\"mt-2 text-sm text-gray-600\">\r\n            Por favor, ingresa y confirma tu nueva contraseña\r\n          </p>\r\n        </div>\r\n        \r\n        {/* Mostrar mensajes de error/éxito */}\r\n        {error && (\r\n          <div className=\"bg-red-50 text-red-700 p-3 rounded-md text-sm\">\r\n            {error}\r\n          </div>\r\n        )}\r\n        \r\n        {success && (\r\n          <div className=\"bg-green-50 text-green-700 p-3 rounded-md text-sm\">\r\n            {success}\r\n          </div>\r\n        )}\r\n        \r\n        {/* Formulario de restablecimiento de contraseña */}\r\n        <form className=\"mt-8 space-y-6\" onSubmit={handleSubmit}>\r\n          {/* Campo de email (si no está presente) */}\r\n          {!email && (\r\n            <div>\r\n              <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">\r\n                Correo electrónico\r\n              </label>\r\n              <input\r\n                id=\"email\"\r\n                name=\"email\"\r\n                type=\"email\"\r\n                autoComplete=\"email\"\r\n                required\r\n                className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500\"\r\n                value={email}\r\n                onChange={(e) => setEmail(e.target.value)}\r\n                placeholder=\"tu@email.com\"\r\n              />\r\n            </div>\r\n          )}\r\n          \r\n          {/* Campo de token (si no está presente) */}\r\n          {!token && (\r\n            <div>\r\n              <label htmlFor=\"token\" className=\"block text-sm font-medium text-gray-700\">\r\n                Token de recuperación\r\n              </label>\r\n              <input\r\n                id=\"token\"\r\n                name=\"token\"\r\n                type=\"text\"\r\n                autoComplete=\"off\"\r\n                required\r\n                className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500\"\r\n                value={token}\r\n                onChange={(e) => setToken(e.target.value)}\r\n                placeholder=\"Ingresa el token de recuperación\"\r\n              />\r\n            </div>\r\n          )}\r\n          \r\n          {/* Campo de nueva contraseña */}\r\n          <div>\r\n            <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700\">\r\n              Nueva contraseña\r\n            </label>\r\n            <input\r\n              id=\"password\"\r\n              name=\"password\"\r\n              type=\"password\"\r\n              autoComplete=\"new-password\"\r\n              required\r\n              className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500\"\r\n              value={password}\r\n              onChange={(e) => setPassword(e.target.value)}\r\n            />\r\n            <p className=\"mt-1 text-xs text-gray-500\">\r\n              La contraseña debe tener al menos 8 caracteres\r\n            </p>\r\n          </div>\r\n          \r\n          {/* Campo de confirmación de contraseña */}\r\n          <div>\r\n            <label htmlFor=\"confirmPassword\" className=\"block text-sm font-medium text-gray-700\">\r\n              Confirmar contraseña\r\n            </label>\r\n            <input\r\n              id=\"confirmPassword\"\r\n              name=\"confirmPassword\"\r\n              type=\"password\"\r\n              autoComplete=\"new-password\"\r\n              required\r\n              className=\"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-3 focus:outline-none focus:ring-primary-500 focus:border-primary-500\"\r\n              value={confirmPassword}\r\n              onChange={(e) => setConfirmPassword(e.target.value)}\r\n            />\r\n          </div>\r\n          \r\n          <div className=\"flex justify-between\">\r\n            <Link\r\n              to=\"/login\"\r\n              className=\"text-sm font-medium text-primary-600 hover:text-primary-500\"\r\n            >\r\n              Volver al inicio de sesión\r\n            </Link>\r\n            \r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading || !token || !email}\r\n              className=\"inline-flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n            >\r\n              {loading ? (\r\n                <span className=\"flex items-center\">\r\n                  <svg className=\"animate-spin -ml-1 mr-2 h-4 w-4 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                    <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                    <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                  </svg>\r\n                  Actualizando...\r\n                </span>\r\n              ) : 'Actualizar contraseña'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ResetPasswordPage;"],"names":["ResetPasswordPage","navigate","useNavigate","location","useLocation","login","useAuth","queryParams","tokenFromQuery","emailFromQuery","tokenFromState","emailFromState","token","setToken","useState","email","setEmail","password","setPassword","confirmPassword","setConfirmPassword","loading","setLoading","error","setError","success","setSuccess","useEffect","handleSubmit","e","response","axiosInstance","API_ENDPOINTS","err","validationErrors","firstError","jsxs","jsx","Link"],"mappings":"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"}