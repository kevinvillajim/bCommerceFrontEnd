import{l as R,t as C,r as i,q as W,p as E,j as e,L as N}from"./index-DmNDOrWy.js";import{T as se}from"./Table-BdEePeKQ.js";import{S as oe}from"./StatCardList-BKb18NhN.js";import{e as D}from"./errorHandler-ugMJT1nb.js";import{S as K}from"./star-DFFyFcok.js";import{C as S}from"./circle-x-BwsT4AZ5.js";import{C as le}from"./chart-no-axes-column-C4ngQd1-.js";import{R as ne}from"./refresh-cw-BOPCg90x.js";import{F as ie}from"./funnel-CAFb7hhq.js";import{C as ce}from"./calendar-COADRkv0.js";import{U as J}from"./user-nLts-VnI.js";import{P as M}from"./package-CIRlwNqy.js";import{S as X}from"./store-BV-a-_hn.js";import{E as de}from"./eye-CldZNoIz.js";import{F as me}from"./flag-DaneOi1U.js";import{T as H}from"./triangle-alert-B75WTV0P.js";import"./chevron-left-Dl3DF2OO.js";import"./search-CbEKe7UQ.js";import"./arrow-up-DQySjn32.js";class ue{async getRatings(o={}){try{return await R.get(C.ADMIN.RATINGS.LIST,o)}catch(c){throw console.error("Error al obtener valoraciones:",c),c}}async approveRating(o,c){try{return await R.post(C.ADMIN.RATINGS.APPROVE(o),{note:c})}catch(n){throw console.error(`Error al aprobar valoración ${o}:`,n),n}}async rejectRating(o,c){try{return await R.post(C.ADMIN.RATINGS.REJECT(o),{note:c})}catch(n){throw console.error(`Error al rechazar valoración ${o}:`,n),n}}async flagRating(o,c){try{return await R.post(C.ADMIN.RATINGS.FLAG(o),{reason:c})}catch(n){throw console.error(`Error al marcar/desmarcar valoración ${o}:`,n),n}}async getRatingStats(){try{return await R.get(C.ADMIN.RATINGS.STATS)}catch(o){throw console.error("Error al obtener estadísticas de valoraciones:",o),o}}}const xe=()=>{const[P,o]=i.useState([]),[c,n]=i.useState(!0),[$,p]=i.useState(null),[A,f]=i.useState(!0),[m,s]=i.useState("all"),[v,V]=i.useState("all"),[y,L]=i.useState(null),[g,F]=i.useState({from:"",to:""}),[j,T]=i.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),[U,_]=i.useState({total:0,pending:0,approved:0,rejected:0}),[I,w]=i.useState(null),[G,k]=i.useState(!1),[u,b]=i.useState(""),[z,O]=i.useState(!1),r=new ue,l=i.useCallback(async()=>{n(!0),p(null);try{const a={page:j.currentPage,per_page:j.itemsPerPage};m!=="all"&&(a.status=m),v!=="all"&&(a.type=v),y!==null&&(a.rating=y),g.from&&(a.from_date=g.from),g.to&&(a.to_date=g.to);const t=await r.getRatings(a);if(t.status==="success"&&t.data)o(t.data),T({currentPage:t.meta.current_page,totalPages:t.meta.last_page,totalItems:t.meta.total,itemsPerPage:t.meta.per_page});else throw new Error(t.message||"Error al obtener las valoraciones")}catch(a){console.error("Error al obtener valoraciones:",a);const t=D(a,"Error al cargar las valoraciones");p(t)}finally{n(!1)}},[r,j.currentPage,j.itemsPerPage,m,v,y,g]),h=i.useCallback(async()=>{f(!0);try{const a=await r.getRatingStats();a.status==="success"&&a.data&&_({total:a.data.total||0,pending:a.data.pending||0,approved:a.data.approved||0,rejected:a.data.rejected||0})}catch(a){console.error("Error al obtener estadísticas:",a)}finally{f(!1)}},[r]);i.useEffect(()=>{(async()=>{try{await new Promise(t=>setTimeout(t,500)),O(!0)}catch(t){console.error("Error al verificar la sesión:",t)}})()},[]),i.useEffect(()=>{z&&(l(),h())},[z]);const Y=a=>{s(a),setTimeout(()=>l(),0)},Z=a=>{V(a),setTimeout(()=>l(),0)},ee=a=>{L(a),setTimeout(()=>l(),0)},re=a=>{F(a),setTimeout(()=>l(),0)},ae=a=>{T(t=>({...t,currentPage:a})),setTimeout(()=>l(),0)},te=a=>{w(a),b(""),k(!0)},q=()=>{w(null),k(!1),b("")};return{ratings:P,loading:c,error:$,statsLoading:A,stats:U,statusFilter:m,typeFilter:v,ratingFilter:y,dateRangeFilter:g,pagination:j,selectedRating:I,showRatingModal:G,moderationNote:u,setStatusFilter:Y,setTypeFilter:Z,setRatingFilter:ee,setDateRangeFilter:re,handlePageChange:ae,openRatingModal:te,closeRatingModal:q,setModerationNote:b,approveRating:async a=>{try{const t=await r.approveRating(a,u);if(t.status==="success")return o(d=>d.map(x=>x.id===a?{...x,status:"approved"}:x)),h(),q(),!0;throw new Error(t.message||"Error al aprobar la valoración")}catch(t){return console.error(`Error al aprobar valoración ${a}:`,t),p(D(t,"Error al aprobar la valoración")),!1}},rejectRating:async a=>{if(!u)return p("Es necesario proporcionar una nota de moderación para rechazar una valoración"),!1;try{const t=await r.rejectRating(a,u);if(t.status==="success")return o(d=>d.map(x=>x.id===a?{...x,status:"rejected"}:x)),h(),q(),!0;throw new Error(t.message||"Error al rechazar la valoración")}catch(t){return console.error(`Error al rechazar valoración ${a}:`,t),p(D(t,"Error al rechazar la valoración")),!1}},flagRating:async(a,t)=>{try{const d=await r.flagRating(a,t);if(d.status==="success")return d.data&&d.data.newStatus&&o(x=>x.map(B=>B.id===a?{...B,status:d.data.newStatus}:B)),h(),!0;throw new Error(d.message||"Error al modificar el estado de la valoración")}catch(d){return console.error(`Error al modificar estado de valoración ${a}:`,d),p(D(d,"Error al modificar estado de valoración")),!1}},refreshData:()=>{l(),h()}}},Q={pending:{label:"Pendiente",color:"bg-yellow-100 text-yellow-800",icon:e.jsx(W,{className:"w-3 h-3 mr-1"})},approved:{label:"Aprobada",color:"bg-green-100 text-green-800",icon:e.jsx(E,{className:"w-3 h-3 mr-1"})},rejected:{label:"Rechazada",color:"bg-red-100 text-red-800",icon:e.jsx(S,{className:"w-3 h-3 mr-1"})}},pe={product:{label:"Producto",color:"bg-blue-100 text-blue-800",icon:e.jsx(M,{className:"w-3 h-3 mr-1"})},seller:{label:"Vendedor",color:"bg-purple-100 text-purple-800",icon:e.jsx(X,{className:"w-3 h-3 mr-1"})},user:{label:"Usuario",color:"bg-orange-100 text-orange-800",icon:e.jsx(J,{className:"w-3 h-3 mr-1"})}},Ve=()=>{const{ratings:P,loading:o,error:c,stats:n,statusFilter:$,typeFilter:p,ratingFilter:A,dateRangeFilter:f,pagination:m,selectedRating:s,showRatingModal:v,moderationNote:V,setStatusFilter:y,setTypeFilter:L,setRatingFilter:g,setDateRangeFilter:F,handlePageChange:j,openRatingModal:T,closeRatingModal:U,setModerationNote:_,approveRating:I,rejectRating:w,flagRating:G,refreshData:k}=xe(),u=r=>{if(!r)return"N/A";const l=new Date(r);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(l)},b=r=>e.jsxs("div",{className:"flex items-center",children:[[...Array(5)].map((l,h)=>e.jsx(K,{className:`w-4 h-4 ${h<r?"text-yellow-500 fill-current":"text-gray-300"}`},h)),e.jsx("span",{className:"ml-1 text-sm font-medium",children:r})]}),z=[{key:"user",header:"Usuario",sortable:!0,render:r=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:r.user?.avatar?e.jsx("img",{src:`/images/avatars/${r.user.avatar}`,alt:r.user?.name,className:"h-8 w-8 object-cover",onError:l=>{l.target.src="https://via.placeholder.com/40?text=User"}}):e.jsx(J,{className:"h-4 w-4 text-gray-500"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.user?.name||`Usuario #${r.userId}`}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",r.userId,r.isVerifiedPurchase&&e.jsx("span",{className:"ml-2 text-green-600",children:"✓ Compra verificada"})]})]})]})},{key:"ratingScore",header:"Valoración",sortable:!0,render:r=>b(r.rating)},{key:"item",header:"Elemento",sortable:!0,render:r=>r.type==="product"&&r.productId?e.jsxs(N,{to:`/admin/products/${r.productId}`,className:"flex items-center text-primary-600 hover:text-primary-800",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Producto #",r.productId]}):r.type==="seller"&&r.sellerId?e.jsxs(N,{to:`/admin/sellers/${r.sellerId}`,className:"flex items-center text-primary-600 hover:text-primary-800",children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),"Vendedor #",r.sellerId]}):e.jsx("span",{className:"text-gray-500",children:"No especificado"})},{key:"type",header:"Tipo",sortable:!0,render:r=>{const l=pe[r.type]||{label:r.type,color:"bg-gray-100 text-gray-800",icon:e.jsx(H,{className:"w-3 h-3 mr-1"})};return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.color}`,children:[l.icon,l.label]})}},{key:"title",header:"Título",sortable:!0,render:r=>e.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:r.title||"Sin título"})},{key:"date",header:"Fecha",sortable:!0,render:r=>e.jsxs("div",{className:"text-xs text-gray-500",children:["Creado: ",u(r.createdAt),r.updatedAt!==r.createdAt&&e.jsxs("div",{children:["Actualizado: ",u(r.updatedAt)]})]})},{key:"status",header:"Estado",sortable:!0,render:r=>{const l=Q[r.status]||{label:r.status,color:"bg-gray-100 text-gray-800",icon:e.jsx(H,{className:"w-3 h-3 mr-1"})};return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l.color}`,children:[l.icon,l.label]})}},{key:"actions",header:"Acciones",render:r=>e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>T(r),className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Ver detalles",children:e.jsx(de,{size:18})}),r.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>I(r.id||0),className:"p-1 text-green-600 hover:bg-green-100 rounded-md",title:"Aprobar valoración",children:e.jsx(E,{size:18})}),e.jsx("button",{onClick:()=>w(r.id||0),className:"p-1 text-red-600 hover:bg-red-100 rounded-md",title:"Rechazar valoración",children:e.jsx(S,{size:18})})]}),e.jsx("button",{onClick:()=>G(r.id||0,r.status==="flagged"?"Desmarcada por administrador":"Marcada para revisión por administrador"),className:`p-1 ${r.status==="flagged"?"text-green-600 hover:bg-green-100":"text-orange-600 hover:bg-orange-100"} rounded-md`,title:r.status==="flagged"?"Desmarcar valoración":"Reportar valoración",children:r.status==="flagged"?e.jsx(E,{size:18}):e.jsx(me,{size:18})})]})}],O=[{title:"Total",value:n.total,description:"Valoraciones y reseñas",icon:K,bgColor:"bg-blue-50/20",textColor:"text-blue-800",valueColor:"text-blue-900 ",descriptionColor:"text-blue-700",iconColor:"text-blue-600"},{title:"Pendientes",value:n.pending,description:"Esperando moderación",icon:W,bgColor:"bg-yellow-50/20",textColor:"text-yellow-800",valueColor:"text-yellow-900",descriptionColor:"text-yellow-700",iconColor:"text-yellow-6000"},{title:"Aprobadas",value:n.approved,description:"Publicadas",icon:E,bgColor:"bg-green-50/20",textColor:"text-green-800",valueColor:"text-green-900",descriptionColor:"text-green-700",iconColor:"text-green-600"},{title:"Rechazadas",value:n.rejected,description:"Ocultadas del público",icon:S,bgColor:"bg-red-50/20",textColor:"text-red-800",valueColor:"text-red-900",descriptionColor:"text-red-700",iconColor:"text-red-600"}];return e.jsxs("div",{className:"space-y-6",children:[c&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:e.jsx("span",{className:"block sm:inline",children:c})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Valoraciones y Reseñas"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(N,{to:"/admin/ratings/dashboard",className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(le,{size:18,className:"inline mr-2"}),"Estadísticas"]}),e.jsxs("button",{onClick:k,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(ne,{size:18,className:`inline mr-2 ${o?"animate-spin":""}`}),"Actualizar"]})]})]}),e.jsx(oe,{items:O}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{className:"h-5 w-5 text-gray-500"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:$,onChange:r=>y(r.target.value),children:[e.jsx("option",{value:"all",children:"Todos los Estados"}),e.jsx("option",{value:"pending",children:"Pendientes"}),e.jsx("option",{value:"approved",children:"Aprobados"}),e.jsx("option",{value:"rejected",children:"Rechazados"})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:p,onChange:r=>L(r.target.value),children:[e.jsx("option",{value:"all",children:"Todos los Tipos"}),e.jsx("option",{value:"product",children:"Producto"}),e.jsx("option",{value:"seller",children:"Vendedor"}),e.jsx("option",{value:"user",children:"Usuario"})]})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:A!==null?A.toString():"all",onChange:r=>g(r.target.value==="all"?null:parseInt(r.target.value)),children:[e.jsx("option",{value:"all",children:"Todas las Puntuaciones"}),e.jsx("option",{value:"5",children:"5 Estrellas"}),e.jsx("option",{value:"4",children:"4 Estrellas"}),e.jsx("option",{value:"3",children:"3 Estrellas"}),e.jsx("option",{value:"2",children:"2 Estrellas"}),e.jsx("option",{value:"1",children:"1 Estrella"})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"h-5 w-5 text-gray-500"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:f.from,onChange:r=>F({...f,from:r.target.value}),placeholder:"Desde"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:f.to,onChange:r=>F({...f,to:r.target.value}),placeholder:"Hasta"})]})]})}),e.jsx(se,{data:P,columns:z,searchFields:["title","comment"],loading:o,emptyMessage:"No se encontraron valoraciones",pagination:{currentPage:m.currentPage,totalPages:m.totalPages,totalItems:m.totalItems,itemsPerPage:m.itemsPerPage,onPageChange:j}}),v&&s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Detalles de Valoración"}),e.jsx("button",{onClick:U,className:"text-gray-400 hover:text-gray-500",children:e.jsx(S,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Usuario"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:s.user?.avatar?e.jsx("img",{src:`/images/avatars/${s.user.avatar}`,alt:s.user?.name,className:"h-10 w-10 object-cover",onError:r=>{r.target.src="https://via.placeholder.com/40?text=User"}}):e.jsx(J,{className:"h-6 w-6 text-gray-500"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.user?.name||`Usuario #${s.userId}`}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",s.userId,s.isVerifiedPurchase&&e.jsx("span",{className:"ml-2 text-green-600",children:"✓ Compra verificada"})]})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Valoración"}),e.jsx("div",{className:"flex items-center mb-2",children:b(s.rating)}),e.jsxs("div",{className:"text-gray-900 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Título:"})," ",s.title]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg text-gray-800 mb-2 whitespace-pre-wrap",children:s.comment}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("div",{children:["Creado: ",u(s.createdAt)]}),s.updatedAt!==s.createdAt&&e.jsxs("div",{children:["Actualizado: ",u(s.updatedAt)]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Estado Actual"}),e.jsx("div",{className:"flex items-center",children:(()=>{const r=Q[s.status]||{label:s.status,color:"bg-gray-100 text-gray-800",icon:e.jsx(H,{className:"w-4 h-4 mr-1"})};return e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${r.color}`,children:[r.icon,r.label]})})()})]}),s.status==="pending"&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Moderación"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"moderationNote",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nota de Moderación (obligatoria para rechazar)"}),e.jsx("textarea",{id:"moderationNote",rows:3,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Razón del rechazo o notas adicionales...",value:V,onChange:r=>_(r.target.value)})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>I(s.id||0),className:"flex items-center justify-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(E,{size:18,className:"mr-2"}),"Aprobar"]}),e.jsxs("button",{onClick:()=>w(s.id||0),className:"flex items-center justify-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx(S,{size:18,className:"mr-2"}),"Rechazar"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Enlaces Rápidos"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.productId&&e.jsxs(N,{to:`/admin/products/${s.productId}`,className:"inline-flex items-center px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Ver Producto"]}),s.sellerId&&e.jsxs(N,{to:`/admin/sellers/${s.sellerId}`,className:"inline-flex items-center px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm",children:[e.jsx(X,{className:"w-4 h-4 mr-1"}),"Ver Vendedor"]}),s.orderId&&e.jsxs(N,{to:`/admin/orders/${s.orderId}`,className:"inline-flex items-center px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),"Ver Orden"]})]})]})]})]})})]})};export{Ve as default};
//# sourceMappingURL=AdminRatingsPage-DLqiRB-8.js.map
