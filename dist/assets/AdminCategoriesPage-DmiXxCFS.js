import{c as v,r as s,j as a,L as p}from"./index-DmNDOrWy.js";import{T as Q}from"./Table-BdEePeKQ.js";import{u as U}from"./useAdminCategories-D_zTNu7p.js";import{R as I}from"./refresh-cw-BOPCg90x.js";import{S as J}from"./search-CbEKe7UQ.js";import{F as K}from"./funnel-CAFb7hhq.js";import{F as W}from"./folder-Df2fqr5L.js";import{S as F}from"./star-DFFyFcok.js";import{E as $}from"./eye-CldZNoIz.js";import{E as M}from"./eye-off-Dpcq62U7.js";import{S as X}from"./square-pen-CTS0gMbb.js";import{P as Y}from"./plus--kIPDPVf.js";import{T as ee}from"./trash-2-DifnXJFx.js";import"./chevron-left-Dl3DF2OO.js";import"./arrow-up-DQySjn32.js";/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],se=v("arrow-up-right",ae);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]],te=v("folder-plus",re);/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"hod4my"}],["path",{d:"M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z",key:"w4yl2u"}],["path",{d:"M3 5a2 2 0 0 0 2 2h3",key:"f2jnh7"}],["path",{d:"M3 3v13a2 2 0 0 0 2 2h3",key:"k8epm1"}]],ie=v("folder-tree",le),we=()=>{const{loading:f,error:j,categories:m,mainCategories:x,fetchAllCategories:N,fetchMainCategories:y,deleteCategory:w,toggleActive:C,toggleFeatured:k,clearCategoryCache:E}=U(),[n,S]=s.useState(null),[d,T]=s.useState("all"),[i,z]=s.useState(""),[b,_]=s.useState("all"),[P,D]=s.useState(1),[u]=s.useState(15),[o,c]=s.useState(null);s.useEffect(()=>{r()},[]),s.useEffect(()=>{r()},[n,d,i]);const r=s.useCallback(async()=>{try{const e={};n!==null&&(e.parent_id=n),d!=="all"&&(e.is_active=d==="active"),i&&(e.term=i),await N(e),x.length===0&&await y(!0)}catch(e){console.error("Error al cargar categorías:",e)}},[N,y,n,d,i,x.length]),h=m.filter(e=>!(i&&!e.name.toLowerCase().includes(i.toLowerCase()))),L=s.useCallback(async(e,l)=>{c(e);try{await k(e,!l)?await r():alert("Error al cambiar estado destacado de la categoría")}catch(t){console.error("Error al cambiar estado destacado:",t),alert("Error al cambiar estado destacado de la categoría")}finally{c(null)}},[k,r]),V=s.useCallback(async(e,l)=>{c(e);try{await C(e,!l)?await r():alert("Error al cambiar estado activo de la categoría")}catch(t){console.error("Error al cambiar estado activo:",t),alert("Error al cambiar estado activo de la categoría")}finally{c(null)}},[C,r]),R=s.useCallback(async(e,l)=>{if(m.some(g=>g.parent_id===e)){alert("Esta categoría tiene subcategorías. Debes eliminar primero las subcategorías.");return}if(window.confirm(`¿Estás seguro de que deseas eliminar la categoría "${l}"?`)){c(e);try{await w(e)?r():alert("Error al eliminar la categoría")}catch(g){console.error("Error al eliminar categoría:",g),alert("Error al eliminar la categoría")}finally{c(null)}}},[w,m,r]),q=s.useCallback(()=>{E(),r()},[E,r]),Z=s.useCallback(e=>{D(e)},[]),H=e=>{if(!e)return"Sin categoría padre";const l=m.find(t=>t.id===e)||x.find(t=>t.id===e);return l?l.name:"Categoría padre desconocida"},O=[{key:"category",header:"Categoría",sortable:!0,render:e=>a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-md bg-blue-100 flex items-center justify-center",children:a.jsx(W,{className:"h-6 w-6 text-blue-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsxs("div",{className:"text-sm font-medium text-gray-900 flex items-center",children:[e.name,e.featured&&a.jsx("span",{className:"ml-2",children:a.jsx(F,{className:"h-4 w-4 text-yellow-500 inline"})})]}),a.jsxs("div",{className:"text-xs text-gray-500 flex items-center",children:["ID: ",e.id,e.parent_id&&a.jsxs("span",{className:"ml-2",children:["Padre: ",H(e.parent_id)]})]})]})]})},{key:"slug",header:"Slug",sortable:!0,render:e=>a.jsx("div",{className:"text-sm text-gray-500 font-mono",children:e.slug})},{key:"description",header:"Descripción",render:e=>a.jsx("div",{className:"text-sm text-gray-600 max-w-xs truncate",children:e.description||"Sin descripción"})},{key:"products",header:"Productos",sortable:!0,render:e=>a.jsx("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800",children:e.product_count||0})},{key:"status",header:"Estado",sortable:!0,render:e=>a.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e.is_active?a.jsxs(a.Fragment,{children:[a.jsx($,{className:"w-3 h-3 mr-1"}),"Activa"]}):a.jsxs(a.Fragment,{children:[a.jsx(M,{className:"w-3 h-3 mr-1"}),"Inactiva"]})})},{key:"children",header:"Subcategorías",render:e=>a.jsx("div",{children:e.has_children?a.jsxs("button",{onClick:()=>S(e.id||null),className:"text-primary-600 hover:text-primary-800 underline flex items-center",children:[a.jsx(ie,{className:"h-4 w-4 mr-1"}),"Ver subcategorías"]}):a.jsx("span",{className:"text-gray-500 text-sm",children:"Sin subcategorías"})})},{key:"order",header:"Orden",sortable:!0,render:e=>a.jsx("div",{className:"text-center",children:e.order||"-"})},{key:"actions",header:"Acciones",render:e=>a.jsxs("div",{className:"flex justify-end space-x-1",children:[a.jsx(p,{to:`/categories/${e.slug}`,target:"_blank",className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Ver en tienda",children:a.jsx(se,{size:16})}),a.jsx(p,{to:`/admin/categories/edit/${e.id}`,className:"p-1 text-yellow-600 hover:bg-yellow-100 rounded-md",title:"Editar categoría",children:a.jsx(X,{size:16})}),a.jsx("button",{onClick:()=>L(e.id,e.featured),disabled:o===e.id,className:`p-1 rounded-md transition-colors ${e.featured?"text-yellow-600 hover:bg-yellow-100":"text-gray-600 hover:bg-gray-100"} ${o===e.id?"opacity-50 cursor-not-allowed":""}`,title:e.featured?"Quitar destacado":"Destacar categoría",children:a.jsx(F,{size:16})}),a.jsx("button",{onClick:()=>V(e.id,e.is_active),disabled:o===e.id,className:`p-1 rounded-md transition-colors ${e.is_active?"text-green-600 hover:bg-green-100":"text-red-600 hover:bg-red-100"} ${o===e.id?"opacity-50 cursor-not-allowed":""}`,title:e.is_active?"Desactivar":"Activar",children:e.is_active?a.jsx($,{size:16}):a.jsx(M,{size:16})}),a.jsx(p,{to:`/admin/categories/create?parent=${e.id}`,className:"p-1 text-green-600 hover:bg-green-100 rounded-md",title:"Añadir subcategoría",children:a.jsx(Y,{size:16})}),a.jsx("button",{onClick:()=>R(e.id,e.name),disabled:o===e.id,className:`p-1 text-red-600 hover:bg-red-100 rounded-md transition-colors ${o===e.id?"opacity-50 cursor-not-allowed":""}`,title:"Eliminar categoría",children:a.jsx(ee,{size:16})})]})}],B=Math.ceil(h.length/u),A=(P-1)*u,G=h.slice(A,A+u);return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Categorías"}),a.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[h.length," categorías encontradas"]})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs(p,{to:"/admin/categories/create",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[a.jsx(te,{className:"w-4 h-4 mr-2"}),"Nueva Categoría"]}),a.jsxs("button",{onClick:q,disabled:f,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center disabled:opacity-50",children:[a.jsx(I,{size:16,className:`mr-2 ${f?"animate-spin":""}`}),"Actualizar"]})]})]}),j&&a.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:["Error: ",j]}),a.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(J,{className:"h-5 w-5 text-gray-500"}),a.jsx("input",{type:"text",placeholder:"Buscar categorías...",value:i,onChange:e=>z(e.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(K,{className:"h-5 w-5 text-gray-500"}),a.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1",value:n===null?"null":n,onChange:e=>S(e.target.value==="null"?null:Number(e.target.value)),children:[a.jsx("option",{value:"null",children:"Todas las categorías"}),a.jsx("option",{value:0,children:"Categorías principales"}),x.map(e=>a.jsxs("option",{value:e.id,children:["Subcategorías de ",e.name]},e.id))]})]}),a.jsx("div",{className:"flex items-center space-x-2",children:a.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1",value:d,onChange:e=>T(e.target.value),children:[a.jsx("option",{value:"all",children:"Todos los Estados"}),a.jsx("option",{value:"active",children:"Activas"}),a.jsx("option",{value:"inactive",children:"Inactivas"})]})}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{className:"text-sm text-gray-600 whitespace-nowrap",children:"Vista:"}),a.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[a.jsx("button",{className:`px-3 py-1 text-sm ${b==="all"?"bg-primary-600 text-white":"bg-white text-gray-700"}`,onClick:()=>_("all"),children:"Tabla"}),a.jsx("button",{className:`px-3 py-1 text-sm ${b==="tree"?"bg-primary-600 text-white":"bg-white text-gray-700"}`,onClick:()=>_("tree"),children:"Árbol"})]})]})]})}),b==="tree"?a.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[a.jsx("h3",{className:"text-lg font-medium mb-4",children:"Vista de árbol de categorías"}),a.jsx("p",{className:"text-gray-500",children:"Esta vista está en desarrollo. Por favor, utilice la vista de tabla."})]}):a.jsx(Q,{data:G,columns:O,searchFields:[],loading:f,emptyMessage:"No se encontraron categorías",pagination:{currentPage:P,totalPages:B,totalItems:h.length,itemsPerPage:u,onPageChange:Z}})]})};export{we as default};
//# sourceMappingURL=AdminCategoriesPage-DmiXxCFS.js.map
