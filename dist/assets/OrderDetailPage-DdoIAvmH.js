import{h as U,d as q,r as n,j as e,X as C,L as b}from"./index-DmNDOrWy.js";import{f as p}from"./formatCurrency-CXuiUHwQ.js";import{f as E}from"./formatDate-DOKfBcN0.js";import{S as R}from"./SellerOrderServiceAdapter-BBCqUj0a.js";import{S as G}from"./ShippingServiceAdapter-DX6ZR1a2.js";import{S as K}from"./ShippingFormModal-AmDqHyY-.js";import{i as f,c as P}from"./Order-YtLC4nUV.js";import{A as X}from"./arrow-left-sVt-VeaA.js";import{P as B}from"./package-CIRlwNqy.js";import{T as _}from"./truck-DP84WB3Y.js";import{C as T}from"./check-CHNPnXXq.js";import{F as H}from"./file-text-DT6_O-Nw.js";const le=()=>{const{id:i}=U(),N=q(),[a,g]=n.useState(null),[z,v]=n.useState(!0),[x,d]=n.useState(null),[l,m]=n.useState(!1),[w,h]=n.useState(null),[M,u]=n.useState(!1),k=new R,A=new G;n.useEffect(()=>{j()},[i]);const j=async()=>{if(i){v(!0);try{const s=await k.getOrderDetails(i);g(s),d(null)}catch(s){d("No se pudo cargar el detalle de la orden"),console.error("Error al cargar detalles de orden:",s)}finally{v(!1)}}},c=async s=>{if(!(!i||!a)){if(!P(a.status,s)){d(`No se puede cambiar de "${a.status}" a "${s}"`);return}if(s==="shipped"){u(!0);return}m(!0),h(null),d(null);try{if(!f(s))throw new Error(`Estado inválido: ${s}`);if(await k.updateOrderStatus(i,s))g(r=>r?{...r,status:s}:null),h(`El estado del pedido ha sido actualizado a ${D(s)}`),(s==="completed"||s==="cancelled")&&setTimeout(()=>j(),2e3);else throw new Error("No se pudo actualizar el estado")}catch(t){d("Error al actualizar el estado del pedido"),console.error("Error al actualizar estado:",t)}finally{m(!1)}}},O=async s=>{if(!(!i||!a)){m(!0),h(null),d(null);try{if(await A.markAsShipped(i,s))u(!1),g(r=>{if(!r)return null;const V={address:r.shippingData?.address||"",city:r.shippingData?.city||"",state:r.shippingData?.state||"",country:r.shippingData?.country||"",postalCode:r.shippingData?.postalCode||"",tracking_number:s.tracking_number,shipping_company:s.shipping_company,estimated_delivery:s.estimated_delivery,notes:s.notes};return{...r,status:"shipped",shippingData:V}}),h("El pedido ha sido marcado como enviado y se ha registrado la información de envío"),setTimeout(()=>j(),2e3);else throw new Error("No se pudo procesar el envío")}catch(t){d("Error al procesar el envío. Por favor, inténtelo de nuevo."),console.error("Error al procesar envío:",t)}finally{m(!1)}}},$=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"paid":return"bg-cyan-100 text-cyan-800";case"shipped":return"bg-indigo-100 text-indigo-800";case"delivered":return"bg-purple-100 text-purple-800";case"completed":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";case"rejected":return"bg-red-200 text-red-900";default:return"bg-gray-100 text-gray-800"}},D=s=>{switch(s){case"pending":return"Pendiente";case"processing":return"En proceso";case"paid":return"Pagado";case"shipped":return"Enviado";case"delivered":return"Entregado";case"completed":return"Completado";case"cancelled":return"Cancelado";case"rejected":return"Rechazado";default:return"Desconocido"}},F=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"completed":case"paid":return"bg-green-100 text-green-800";case"failed":case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},I=s=>{switch(s){case"pending":return"Pendiente";case"completed":case"paid":return"Completado";case"failed":case"rejected":return"Fallido";default:return"Desconocido"}},o=(s,t)=>!f(s)||!f(t)?!1:P(s,t),y=()=>!a||!a.items||a.items.length===0?0:a.items.reduce((s,t)=>s+t.price*t.quantity,0),S=()=>y()*.15,L=()=>y()+S();return z?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"}),e.jsx("p",{className:"mt-4 text-gray-700",children:"Cargando detalles del pedido..."})]}):x||!a?e.jsx("div",{className:"bg-white rounded-lg shadow p-6 max-w-4xl mx-auto my-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-5xl mb-4",children:e.jsx(C,{className:"h-16 w-16 mx-auto"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Error al cargar el pedido"}),e.jsx("p",{className:"text-gray-600 mb-6",children:x||"No se pudo encontrar el pedido solicitado"}),e.jsx("button",{onClick:()=>N(-1),className:"bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Volver"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(K,{orderId:i||"",isOpen:M,onClose:()=>u(!1),onSubmit:O,isLoading:l}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>N(-1),className:"flex items-center text-gray-600 hover:text-primary-600 mb-2",children:[e.jsx(X,{size:16,className:"mr-1"}),e.jsx("span",{children:"Volver a pedidos"})]}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Pedido #",a.orderNumber]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[o(a.status,"processing")&&e.jsxs("button",{onClick:()=>c("processing"),disabled:l,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(B,{size:18}),e.jsx("span",{children:"Preparar pedido"})]}),o(a.status,"shipped")&&e.jsxs("button",{onClick:()=>c("shipped"),disabled:l,className:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(_,{size:18}),e.jsx("span",{children:"Marcar como enviado"})]}),o(a.status,"delivered")&&e.jsxs("button",{onClick:()=>c("delivered"),disabled:l,className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(T,{size:18}),e.jsx("span",{children:"Marcar como entregado"})]}),o(a.status,"completed")&&e.jsxs("button",{onClick:()=>c("completed"),disabled:l,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(T,{size:18}),e.jsx("span",{children:"Completar pedido"})]}),o(a.status,"cancelled")&&e.jsxs("button",{onClick:()=>c("cancelled"),disabled:l,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(C,{size:18}),e.jsx("span",{children:"Cancelar pedido"})]}),e.jsxs(b,{to:`/seller/invoices/generate/${a.id}`,className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(H,{size:18}),e.jsx("span",{children:"Generar factura"})]})]})]}),w&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:w})}),x&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:x})}),l&&e.jsx("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative",role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin mr-2 h-4 w-4 border-t-2 border-blue-500"}),e.jsx("span",{className:"block sm:inline",children:"Actualizando estado del pedido..."})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"col-span-3 md:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Estado del pedido"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Estado:"}),e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium ${$(a.status)}`,children:D(a.status)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Pago:"}),e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium ${F(a.paymentStatus)}`,children:I(a.paymentStatus)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Método de pago:"}),e.jsxs("span",{className:"text-gray-900",children:[a.paymentMethod==="credit_card"&&"Tarjeta de crédito",a.paymentMethod==="paypal"&&"PayPal",a.paymentMethod==="transfer"&&"Transferencia",a.paymentMethod==="other"&&"Otro",!a.paymentMethod&&"No especificado"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Fecha:"}),e.jsx("span",{className:"text-gray-900",children:a.createdAt?E(a.createdAt):"Sin fecha"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Cliente"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Nombre:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:a.user_name||"No disponible"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Email:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:a.user_email||"No disponible"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Dirección de envío:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:a.shippingData?e.jsxs("div",{children:[e.jsx("p",{children:a.shippingData.address}),e.jsxs("p",{children:[a.shippingData.city,", ",a.shippingData.state]}),e.jsxs("p",{children:[a.shippingData.country,","," ",a.shippingData.postalCode]}),(a.shippingData.phone||a.shippingData.phone)&&e.jsxs("p",{children:["Tel: ",a.shippingData.phone]})]}):e.jsx("p",{children:"No disponible"})})]})]})]})]}),e.jsxs("div",{className:"col-span-3 md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 p-6 pb-3",children:"Productos"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Producto"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"SKU"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cantidad"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Subtotal"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.items.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[(s.product?.image||s.product_image)&&e.jsx("div",{className:"flex-shrink-0 h-10 w-10 mr-3",children:e.jsx("img",{className:"h-10 w-10 rounded-md object-cover",src:s.product?.image||s.product_image,alt:s.product?.name||s.product_name||"Producto"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.product?.name||s.product_name||"Producto"}),s.product?.slug&&e.jsx(b,{to:`/products/${s.product.slug}`,className:"text-xs text-primary-600 hover:underline",children:"Ver producto"})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.product?.sku||s.product_sku||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:p(s.price)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:s.quantity}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-right",children:p(s.price*s.quantity)})]},s.id))})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Resumen"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center pb-2",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),e.jsx("span",{className:"text-gray-900",children:p(y())})]}),e.jsxs("div",{className:"flex justify-between items-center pb-2",children:[e.jsx("span",{className:"text-gray-600",children:"IVA (15%):"}),e.jsx("span",{className:"text-gray-900",children:p(S())})]}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-200 font-medium",children:[e.jsx("span",{className:"text-gray-900",children:"Total:"}),e.jsx("span",{className:"text-lg text-gray-900",children:p(L())})]})]})]}),a.shippingData?.tracking_number&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Información de envío"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Número de seguimiento:"}),e.jsx("span",{className:"text-primary-600 font-medium",children:a.shippingData.tracking_number})]}),a.shippingData.shipping_company&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Transportista:"}),e.jsx("span",{className:"text-gray-900",children:a.shippingData.shipping_company})]}),a.shippingData.estimated_delivery&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Entrega estimada:"}),e.jsx("span",{className:"text-gray-900",children:E(a.shippingData.estimated_delivery)})]}),e.jsx("div",{className:"mt-3",children:e.jsxs(b,{to:`/seller/shipping/${a.id}`,className:"bg-indigo-100 text-indigo-700 px-4 py-2 rounded-lg hover:bg-indigo-200 inline-flex items-center mt-2",children:[e.jsx(_,{size:16,className:"mr-2"}),e.jsx("span",{children:"Gestionar envío"})]})})]})]}),a.shippingData?.notes&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-2",children:"Notas"}),e.jsx("p",{className:"text-gray-600",children:a.shippingData.notes})]})]})]})]})};export{le as default};
//# sourceMappingURL=OrderDetailPage-DdoIAvmH.js.map
