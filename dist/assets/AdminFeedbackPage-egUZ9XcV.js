import{M as K,e as H,a as v,H as b,j as e,a5 as ae,R as re,F as le,K as ie,h as O,i as V,an as B,f as G,E as oe,T as j,s as ne}from"./ui-vendor-DEBjJ4HS.js";import{r as l,L as k}from"./react-vendor-Cy458wKG.js";import{c as E,A,T as de}from"./admin-chunk-C7Ad4l4I.js";import{S as ce}from"./StatCardList-BC4AxJgi.js";const L={pending:{label:"Pendiente",color:"bg-yellow-100 text-yellow-800",icon:e.jsx(H,{className:"w-3 h-3 mr-1"})},approved:{label:"Aprobado",color:"bg-green-100 text-green-800",icon:e.jsx(v,{className:"w-3 h-3 mr-1"})},rejected:{label:"Rechazado",color:"bg-red-100 text-red-800",icon:e.jsx(b,{className:"w-3 h-3 mr-1"})}},U={improvement:{label:"Mejora",color:"bg-blue-100 text-blue-800",icon:e.jsx(ne,{className:"w-3 h-3 mr-1"})},bug:{label:"Error/Bug",color:"bg-red-100 text-red-800",icon:e.jsx(j,{className:"w-3 h-3 mr-1"})},other:{label:"Otro",color:"bg-gray-100 text-gray-800",icon:e.jsx(K,{className:"w-3 h-3 mr-1"})}},he=()=>{const[m,y]=l.useState([]),[w,z]=l.useState(!0),[x,W]=l.useState("all"),[u,q]=l.useState("all"),[i,I]=l.useState({from:"",to:""}),[o,R]=l.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),[t,T]=l.useState(null),[X,M]=l.useState(!1),[n,_]=l.useState(""),[f,C]=l.useState(!0),[$,P]=l.useState(30),[d,g]=l.useState(!1);l.useEffect(()=>{N()},[o.currentPage,x,u,i]);const N=async()=>{try{z(!0);const s=new URLSearchParams({limit:o.itemsPerPage.toString(),offset:((o.currentPage-1)*o.itemsPerPage).toString()});x!=="all"&&s.append("status",x),u!=="all"&&s.append("type",u),i.from&&s.append("from_date",i.from),i.to&&s.append("to_date",i.to);const a=await E.get(`${A.ADMIN.PENDING_FEEDBACK}?${s.toString()}`);a.status==="success"&&(y(a.data||[]),R(r=>({...r,totalItems:a.meta?.total||0,totalPages:Math.ceil((a.meta?.total||0)/o.itemsPerPage)})))}catch(s){console.error("Error fetching feedback:",s),y([])}finally{z(!1)}},J=m,D=s=>{T(s),_(s.admin_notes||""),C(!0),P(30),M(!0)},F=()=>{T(null),M(!1),_(""),C(!0),P(30),g(!1)},Q=async s=>{if(!n.trim()){alert("Por favor, proporciona una nota de administrador para la aprobación.");return}try{g(!0);const a={status:"approved",admin_notes:n,generate_discount:f,validity_days:f?$:void 0},r=await E.post(`${A.ADMIN.REVIEW_FEEDBACK(s)}`,a);if(r.status==="success"){y(p=>p.map(S=>S.id===s?{...S,status:"approved",admin_notes:n,reviewed_at:new Date().toISOString(),updated_at:new Date().toISOString(),discount_code:r.data?.discount_code,seller_featured:r.data?.seller_featured}:S));let h=`Feedback #${s} aprobado correctamente.`;r.data?.discount_code&&!t?.seller_id&&(h+=` Se ha generado el código de descuento '${r.data.discount_code.code}' para el usuario.`),r.data?.seller_featured&&t?.seller_id&&(h+=" La tienda ha sido destacada por 15 días."),alert(h),F(),await N()}else alert(r.message||"Error al aprobar feedback")}catch(a){console.error("Error approving feedback:",a);const r=a.response?.data?.message||a.message||"Error al aprobar feedback";alert(r)}finally{g(!1)}},Y=async s=>{if(!n.trim()){alert("Por favor, proporciona una nota de administrador para el rechazo.");return}try{g(!0);const a={status:"rejected",admin_notes:n},r=await E.post(`${A.ADMIN.REVIEW_FEEDBACK(s)}`,a);r.status==="success"?(y(h=>h.map(p=>p.id===s?{...p,status:"rejected",admin_notes:n,reviewed_at:new Date().toISOString(),updated_at:new Date().toISOString()}:p)),alert(`Feedback #${s} rechazado.`),F(),await N()):alert(r.message||"Error al rechazar feedback")}catch(a){console.error("Error rejecting feedback:",a);const r=a.response?.data?.message||a.message||"Error al rechazar feedback";alert(r)}finally{g(!1)}},c=s=>{if(!s)return"N/A";const a=new Date(s);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(a)},Z=s=>{R(a=>({...a,currentPage:s}))},ee=async()=>{await N()},se=[{key:"user",header:"Usuario",sortable:!0,render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:e.jsx(O,{className:"h-4 w-4 text-gray-500"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.user?.name||`Usuario #${s.user_id}`}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",s.user_id]})]})]})},{key:"seller",header:"Vendedor",sortable:!0,render:s=>s.seller_id&&s.seller?e.jsxs(k,{to:`/admin/sellers/${s.seller_id}`,className:"flex items-center text-primary-600 hover:text-primary-800",children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),s.seller.store_name]}):e.jsx("span",{className:"text-gray-500",children:"N/A"})},{key:"type",header:"Tipo",sortable:!0,render:s=>{const a=U[s.type]||{label:s.type,color:"bg-gray-100 text-gray-800",icon:e.jsx(j,{className:"w-3 h-3 mr-1"})};return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${a.color}`,children:[a.icon,a.label]})}},{key:"title",header:"Título",sortable:!0,render:s=>e.jsx("div",{className:"text-sm font-medium text-gray-900 line-clamp-2",children:s.title})},{key:"date",header:"Fecha",sortable:!0,render:s=>e.jsxs("div",{className:"text-xs text-gray-500",children:[c(s.created_at),s.reviewed_at&&e.jsxs("div",{children:["Revisado: ",c(s.reviewed_at)]})]})},{key:"status",header:"Estado",sortable:!0,render:s=>{const a=L[s.status]||{label:s.status,color:"bg-gray-100 text-gray-800",icon:e.jsx(j,{className:"w-3 h-3 mr-1"})};return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${a.color}`,children:[a.icon,a.label]})}},{key:"actions",header:"Acciones",render:s=>e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>D(s),className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Ver detalles",children:e.jsx(oe,{size:18})}),s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>D(s),className:"p-1 text-green-600 hover:bg-green-100 rounded-md",title:"Revisar y aprobar",children:e.jsx(v,{size:18})}),e.jsx("button",{onClick:()=>D(s),className:"p-1 text-red-600 hover:bg-red-100 rounded-md",title:"Revisar y rechazar",children:e.jsx(b,{size:18})})]}),s.status==="approved"&&e.jsxs(e.Fragment,{children:[s.discount_code&&e.jsx("div",{className:"p-1 text-blue-600",title:"Cupón generado",children:e.jsx(B,{size:18})}),s.seller_featured&&e.jsx("div",{className:"p-1 text-yellow-600",title:"Tienda destacada",children:e.jsx(G,{size:18})})]})]})}],te=[{title:"Total",value:m.length,description:x!=="all"||u!=="all"||i.from||i.to?"En filtros aplicados":"Comentarios y sugerencias",icon:K,bgColor:"bg-blue-50/20",textColor:"text-blue-800",valueColor:"text-blue-900",descriptionColor:"text-blue-700",iconColor:"text-blue-600"},{title:"Pendientes",value:m.filter(s=>s.status==="pending").length,description:"Esperando revisión",icon:H,bgColor:"bg-yellow-50/20",textColor:"text-yellow-800",valueColor:"text-yellow-900",descriptionColor:"text-yellow-700",iconColor:"text-yellow-600"},{title:"Aprobados",value:m.filter(s=>s.status==="approved").length,description:"Implementados o en proceso",icon:v,bgColor:"bg-green-50/20",textColor:"text-green-800",valueColor:"text-green-900",descriptionColor:"text-green-700",iconColor:"text-green-600"},{title:"Rechazados",value:m.filter(s=>s.status==="rejected").length,description:"No considerados",icon:b,bgColor:"bg-red-50/20",textColor:"text-red-800",valueColor:"text-red-900",descriptionColor:"text-red-700",iconColor:"text-red-600"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Feedback y Comentarios"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(k,{to:"/admin/feedback/dashboard",className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors",children:[e.jsx(ae,{size:18,className:"inline mr-2"}),"Estadísticas"]}),e.jsxs("button",{onClick:ee,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",disabled:w,children:[e.jsx(re,{size:18,className:`inline mr-2 ${w?"animate-spin":""}`}),"Actualizar"]})]})]}),e.jsx(ce,{items:te}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(le,{className:"h-5 w-5 text-gray-500"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:x,onChange:s=>W(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos los Estados"}),e.jsx("option",{value:"pending",children:"Pendientes"}),e.jsx("option",{value:"approved",children:"Aprobados"}),e.jsx("option",{value:"rejected",children:"Rechazados"})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:u,onChange:s=>q(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos los Tipos"}),e.jsx("option",{value:"improvement",children:"Mejoras"}),e.jsx("option",{value:"bug",children:"Errores/Bugs"}),e.jsx("option",{value:"other",children:"Otros"})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{className:"h-5 w-5 text-gray-500"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:i.from,onChange:s=>I({...i,from:s.target.value}),placeholder:"Desde"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:i.to,onChange:s=>I({...i,to:s.target.value}),placeholder:"Hasta"})]})]})}),e.jsx(de,{data:J,columns:se,searchFields:["title","description"],loading:w,emptyMessage:"No se encontraron comentarios o sugerencias",pagination:{currentPage:o.currentPage,totalPages:o.totalPages,totalItems:o.totalItems,itemsPerPage:o.itemsPerPage,onPageChange:Z}}),X&&t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Detalles de Feedback #",t.id]}),e.jsx("button",{onClick:F,className:"text-gray-400 hover:text-gray-500",children:e.jsx(b,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Usuario"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:e.jsx(O,{className:"h-6 w-6 text-gray-500"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.user?.name||`Usuario #${t.user_id}`}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",t.user_id]})]})]})]}),t.seller_id&&t.seller&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Vendedor"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"h-5 w-5 text-gray-500 mr-2"}),e.jsx(k,{to:`/admin/sellers/${t.seller_id}`,className:"text-primary-600 hover:text-primary-800",children:t.seller.store_name})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500",children:"Detalles"}),e.jsx("div",{children:(()=>{const s=U[t.type]||{label:t.type,color:"bg-gray-100 text-gray-800",icon:e.jsx(j,{className:"w-4 h-4 mr-1"})};return e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${s.color}`,children:[s.icon,s.label]})})()})]}),e.jsx("div",{className:"text-lg font-medium text-gray-900 mb-2",children:t.title}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg text-gray-800 mb-2 whitespace-pre-wrap",children:t.description}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("div",{children:["Enviado: ",c(t.created_at)]}),t.updated_at!==t.created_at&&e.jsxs("div",{children:["Actualizado: ",c(t.updated_at)]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Estado Actual"}),e.jsx("div",{className:"flex items-center",children:(()=>{const s=L[t.status]||{label:t.status,color:"bg-gray-100 text-gray-800",icon:e.jsx(j,{className:"w-4 h-4 mr-1"})};return e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${s.color}`,children:[s.icon,s.label]})})()})]}),t.admin_notes&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Notas de Administración"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg text-gray-800 mb-2",children:t.admin_notes}),t.reviewed_at&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Revisado: ",c(t.reviewed_at)]})]}),t.status==="approved"&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Recompensas Otorgadas"}),t.discount_code&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(B,{className:"w-4 h-4 text-blue-600"}),e.jsx("h6",{className:"font-medium text-blue-900 text-sm",children:"Código de Descuento Generado"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Código:"}),e.jsx("p",{className:"font-bold text-blue-900",children:t.discount_code.code})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Descuento:"}),e.jsxs("p",{className:"font-bold text-blue-900",children:[t.discount_code.discount_percentage,"%"]})]})]})]}),t.seller_featured&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{className:"w-4 h-4 text-yellow-600"}),e.jsx("h6",{className:"font-medium text-yellow-900 text-sm",children:"Tienda Destacada Activada"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-yellow-700 font-medium",children:"Activada:"}),e.jsx("p",{className:"font-bold text-yellow-900",children:c(t.seller_featured.featured_at)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-yellow-700 font-medium",children:"Duración:"}),e.jsxs("p",{className:"font-bold text-yellow-900",children:[t.seller_featured.featured_days," días"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-yellow-700 font-medium",children:"Válido hasta:"}),e.jsx("p",{className:"text-yellow-900",children:c(t.seller_featured.featured_expires_at)})]})]}),t.seller_featured.is_active?e.jsx("p",{className:"text-yellow-600 text-xs mt-1 font-medium",children:"✨ Tienda actualmente destacada"}):e.jsx("p",{className:"text-gray-600 text-xs mt-1 font-medium",children:"⏰ Destacado expirado"})]})]}),t.status==="pending"&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Revisión de Administrador"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"adminNote",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nota de Administrador (obligatoria)"}),e.jsx("textarea",{id:"adminNote",rows:3,className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Notas adicionales o respuesta al usuario...",value:n,onChange:s=>_(s.target.value),disabled:d})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("input",{id:"generateDiscount",type:"checkbox",className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded",checked:f,onChange:s=>C(s.target.checked),disabled:d}),e.jsx("label",{htmlFor:"generateDiscount",className:"ml-2 block text-sm text-gray-700",children:t.seller_id?"Activar tienda destacada por 15 días":"Generar código de descuento para el usuario"})]}),f&&!t.seller_id&&e.jsxs("div",{className:"ml-6",children:[e.jsx("label",{htmlFor:"validityDays",className:"block text-sm font-medium text-gray-700 mb-1",children:"Días de validez del cupón"}),e.jsx("input",{type:"number",id:"validityDays",min:"1",max:"365",value:$,onChange:s=>P(parseInt(s.target.value)||30),className:"w-24 border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",disabled:d}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"días"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>Q(t.id||0),className:"flex items-center justify-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50",disabled:!n.trim()||d,children:[e.jsx(v,{size:18,className:"mr-2"}),d?"Procesando...":"Aprobar"]}),e.jsxs("button",{onClick:()=>Y(t.id||0),className:"flex items-center justify-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50",disabled:!n.trim()||d,children:[e.jsx(b,{size:18,className:"mr-2"}),d?"Procesando...":"Rechazar"]})]})]})]})]})})]})};export{he as default};
//# sourceMappingURL=AdminFeedbackPage-egUZ9XcV.js.map
