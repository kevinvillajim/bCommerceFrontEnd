import{r as m,u as E,l as N,t as w,d as H,j as e,L as F}from"./index-DmNDOrWy.js";import{u as q}from"./useCart-DylEmA2w.js";import{f as S}from"./formatCurrency-CXuiUHwQ.js";import{g as W}from"./imageUtils-B2iUz1H0.js";import{H as B}from"./heart-DBtNcst0.js";import{C as K}from"./check-CHNPnXXq.js";import{T as J}from"./triangle-alert-B75WTV0P.js";import{S as Q}from"./settings-Gi_H_p01.js";import{T as X}from"./trash-2-DifnXJFx.js";import{S as Y}from"./shopping-cart-Ck1So-LU.js";import{S as Z}from"./star-DFFyFcok.js";const I=()=>{const[x,l]=m.useState(!1),[h,c]=m.useState(null),{isAuthenticated:g}=E();return{loading:x,error:h,getUserFavorites:async(d=10,s=0)=>{try{if(l(!0),c(null),!g)throw new Error("User must be authenticated to get favorites");const i=await N.get(w.FAVORITES.LIST,{limit:d,offset:s}),v=(i?.data||[]).map((p,_)=>({favorite:{id:p.product?.id?p.product.id+1e3:_+1e3,userId:0,productId:p.product?.id||0,notifyPriceChange:!0,notifyPromotion:!0,notifyLowStock:!0},product:p.product}));return{favorites:v,meta:i?.meta||{total:v.length,limit:d,offset:s,has_more:!1}}}catch(i){const n=i instanceof Error?i.message:"Failed to fetch favorites";return c(n),{favorites:[],meta:{total:0,limit:d,offset:s,has_more:!1}}}finally{l(!1)}},toggleFavorite:async(d,s)=>{try{if(l(!0),c(null),!g)throw new Error("User must be authenticated to toggle favorites");const i={notify_price_change:s?.notify_price_change!==void 0?s.notify_price_change:!0,notify_promotion:s?.notify_promotion!==void 0?s.notify_promotion:!0,notify_low_stock:s?.notify_low_stock!==void 0?s.notify_low_stock:!0},n=await N.post(w.FAVORITES.TOGGLE,{product_id:d,notification_preferences:i});return{is_favorite:n?.data?.is_favorite||!1,favorite_id:n?.data?.favorite_id||null,message:n?.message||"Favorite status updated"}}catch(i){const n=i instanceof Error?i.message:"Failed to toggle favorite";throw c(n),new Error(n)}finally{l(!1)}},checkIsFavorite:async d=>{try{if(l(!0),c(null),!g)return{is_favorite:!1,favorite_id:null,notification_preferences:null};const s=await N.get(w.FAVORITES.CHECK(d));return{is_favorite:s?.data?.is_favorite||!1,favorite_id:s?.data?.favorite_id||null,notification_preferences:s?.data?.notification_preferences||null}}catch(s){const i=s instanceof Error?s.message:"Failed to check favorite status";return c(i),console.error(i),{is_favorite:!1,favorite_id:null,notification_preferences:null}}finally{l(!1)}},updateNotificationPreferences:async(d,s)=>{try{if(l(!0),c(null),!g)throw new Error("User must be authenticated to update notification preferences");const i=await N.put(w.FAVORITES.UPDATE_NOTIFICATIONS(d),s);return{success:!0,message:i?.message||"Notification preferences updated",favorite:i?.data}}catch(i){const n=i instanceof Error?i.message:"Failed to update notification preferences";throw c(n),new Error(n)}finally{l(!1)}}}},ee=({favoriteId:x,initialPreferences:l,onClose:h})=>{const[c,g]=m.useState({notify_price_change:l.notifyPriceChange,notify_promotion:l.notifyPromotion,notify_low_stock:l.notifyLowStock}),[b,y]=m.useState(!1),{updateNotificationPreferences:j}=I(),f=s=>{const{name:i,checked:n}=s.target;g(v=>({...v,[i]:n}))},d=async()=>{try{y(!0),await j(x,c),h()}catch(s){console.error("Error saving preferences:",s)}finally{y(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Preferencias de notificación"}),e.jsxs("button",{onClick:h,className:"text-gray-500 hover:text-gray-700",children:[e.jsx("span",{className:"sr-only",children:"Cerrar"}),e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"notify_price_change",name:"notify_price_change",checked:c.notify_price_change,onChange:f,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"notify_price_change",className:"ml-2 block text-sm text-gray-700",children:"Notificarme cambios de precio"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"notify_promotion",name:"notify_promotion",checked:c.notify_promotion,onChange:f,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"notify_promotion",className:"ml-2 block text-sm text-gray-700",children:"Notificarme promociones"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"notify_low_stock",name:"notify_low_stock",checked:c.notify_low_stock,onChange:f,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"notify_low_stock",className:"ml-2 block text-sm text-gray-700",children:"Notificarme cuando haya poco stock"})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:d,disabled:b,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50",children:b?"Guardando...":"Guardar"})]})]})})},fe=()=>{const[x,l]=m.useState([]),[h,c]=m.useState(!0),[g,b]=m.useState(!1),[y,j]=m.useState(null),[f,d]=m.useState(null),[s,i]=m.useState(1),[n,v]=m.useState(!1),[p,_]=m.useState(0),P=10,{getUserFavorites:A,toggleFavorite:T}=I(),{isAuthenticated:C}=E(),{addToCart:L}=q(),R=H();m.useEffect(()=>{if(!C){R("/login",{state:{from:"/favorites"}});return}k()},[C,s]);const k=async()=>{try{c(!0);const t=(s-1)*P,a=await A(P,t),r=a.favorites.map(o=>({favorite:{id:o.favorite.id||0,userId:o.favorite.userId,productId:o.favorite.productId,notifyPriceChange:o.favorite.notifyPriceChange||!1,notifyPromotion:o.favorite.notifyPromotion||!1,notifyLowStock:o.favorite.notifyLowStock||!1},product:o.product}));l(r),_(a.meta.total),v(a.meta.has_more),b(r.length===0&&s===1)}catch(t){console.error("Error fetching favorites:",t),j("No se pudieron cargar los favoritos. Por favor, inténtalo de nuevo.")}finally{c(!1)}},U=async t=>{try{await T(t),k()}catch(a){console.error("Error removing from favorites:",a)}},M=async t=>{try{if(!t.stock||t.stock<=0)return;await L({productId:t.id,quantity:1})}catch(a){console.error(`Error adding product ${t.id} to cart:`,a)}},O=t=>{console.log("🎨 FavoritePage - getProductImage:",t);let a="";if(t?.image)a=t.image;else if(t?.images&&Array.isArray(t.images)&&t.images.length>0){const o=t.images[0];typeof o=="string"?a=o:typeof o=="object"&&o!==null&&(a=o.original||o.medium||o.thumbnail||"")}console.log("🖼️ FavoritePage - Path extraído:",a);const r=W(a);return console.log("🔗 FavoritePage - URL final:",r),r},D=t=>{console.log("💰 FavoritePage - Datos del producto completo:",t);const a=parseFloat(t.price?.toString()||"0"),r=parseFloat((t.discount_percentage||t.discount)?.toString()||"0");console.log("💰 FavoritePage - Precio original (convertido):",a),console.log("💰 FavoritePage - Descuento % (convertido):",r);let o=a;return r>0&&(o=a-a*(r/100)),console.log("💰 FavoritePage - Precio con descuento:",o),{original:a,discounted:o,discount:r}},z=(t=0,a=0)=>{const r=parseFloat(t?.toString()||"0"),o=parseInt(a?.toString()||"0");return console.log("⭐ renderRatingStars:",{rating:t,safeRating:r,ratingCount:a,safeRatingCount:o}),e.jsxs("div",{className:"flex items-center",children:[[1,2,3,4,5].map(u=>e.jsx(Z,{size:14,className:`${u<=Math.round(r)?"text-yellow-400 fill-current":"text-gray-300"}`},u)),e.jsxs("span",{className:"ml-2 text-sm text-gray-600",children:[r.toFixed(1)," (",o,")"]})]})},$=t=>{t&&d(t)},G=()=>{d(null)},V=()=>{n&&i(t=>t+1)};return e.jsxs("div",{className:"container mx-auto px-10 lg:px-20 py-10",children:[e.jsxs("div",{className:"flex flex-wrap justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Mis Favoritos"}),!g&&!h&&e.jsxs("div",{className:"text-sm text-gray-500 mt-2 md:mt-0 px-3 py-1.5 bg-gray-100 rounded-full",children:[p," ",p===1?"producto":"productos"," en tu lista"]})]}),y&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6",children:[y,e.jsx("button",{className:"ml-2 underline",onClick:k,children:"Reintentar"})]}),h?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})}):g?e.jsxs("div",{className:"text-center py-20 bg-gradient-to-b from-gray-50 to-white rounded-xl shadow-md",children:[e.jsx(B,{className:"mx-auto h-16 w-16 text-red-100 mb-6"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-700 mb-3",children:"Tu lista de favoritos está vacía"}),e.jsx("p",{className:"text-gray-500 mb-8 max-w-md mx-auto",children:"Guarda los productos que te gusten para verlos más tarde."}),e.jsx(F,{to:"/products",className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-primary-600 hover:bg-primary-700 shadow-sm hover:shadow transition-all",children:"Explorar productos"})]}):e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[x.map((t,a)=>{const r=t.product;if(!r)return null;const o=r.is_in_stock!==void 0?r.is_in_stock:r.stock>0,u=D(r);return e.jsxs("div",{className:`flex flex-col sm:flex-row p-6 ${a!==x.length-1?"border-b border-gray-200":""} hover:bg-gray-50 transition-colors`,children:[e.jsxs("div",{className:"sm:w-40 sm:h-40 h-60 w-full flex-shrink-0 mx-auto sm:mx-0 relative",children:[e.jsx(F,{to:`/products/${r.id}`,children:e.jsx("img",{src:O(r),alt:r.name,className:"w-full h-full object-contain sm:object-cover rounded-lg shadow-sm"})}),e.jsxs("div",{className:"absolute top-2 left-2 flex flex-col space-y-1",children:[u.discount>0&&e.jsxs("span",{className:"bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-md shadow-sm",children:[u.discount,"% OFF"]}),r.isNew&&e.jsx("span",{className:"bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-md shadow-sm",children:"NUEVO"})]})]}),e.jsxs("div",{className:"flex-1 sm:ml-6 mt-4 sm:mt-0 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[r.category&&e.jsx("span",{className:"inline-block text-xs font-medium text-gray-500 bg-gray-100 px-2 py-1 rounded-md mb-2 uppercase tracking-wide",children:r.category}),e.jsx(F,{to:`/products/${r.id}`,className:"block",children:e.jsx("h3",{className:"text-xl font-medium text-gray-800 hover:text-primary-600 transition-colors mb-2",children:r.name})}),e.jsx("div",{className:"mb-2",children:z(r.rating||0,r.rating_count||0)}),e.jsx("div",{className:"mb-3",children:o?e.jsxs("span",{className:"inline-flex items-center text-sm text-green-600",children:[e.jsx(K,{size:14,className:"mr-1"}),"En stock"]}):e.jsxs("span",{className:"inline-flex items-center text-sm text-amber-600",children:[e.jsx(J,{size:14,className:"mr-1"}),"Agotado"]})})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>$(t.favorite.id),className:"cursor-pointer text-gray-400 hover:text-blue-500 transition-colors","aria-label":"Configurar notificaciones",children:e.jsx(Q,{size:20,className:"stroke-current"})}),e.jsx("button",{onClick:()=>U(r.id),className:"cursor-pointer text-gray-400 hover:text-red-500 transition-colors","aria-label":"Eliminar de favoritos",children:e.jsx(X,{size:20,className:"stroke-current"})})]})]}),e.jsxs("div",{className:"mt-auto pt-4 flex flex-wrap sm:flex-nowrap items-center justify-between",children:[e.jsx("div",{className:"flex items-center mb-3 sm:mb-0",children:u.discount>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-bold text-primary-600 text-xl",children:S(u.discounted)}),e.jsx("span",{className:"text-sm text-gray-500 line-through ml-2",children:S(u.original)}),e.jsxs("span",{className:"ml-3 px-2 py-1 text-xs font-semibold text-white bg-red-500 rounded",children:[u.discount,"% DESCUENTO"]})]}):e.jsx("span",{className:"font-bold text-primary-600 text-xl",children:S(u.original)})}),e.jsxs("button",{onClick:()=>M(r),disabled:!o,className:`cursor-pointer inline-flex items-center px-5 py-2.5 rounded-lg text-white font-medium transition-all ${o?"bg-primary-600 hover:bg-primary-700 shadow-sm hover:shadow":"bg-gray-400 cursor-not-allowed"}`,children:[e.jsx(Y,{size:18,className:"mr-2"}),o?"Añadir al carrito":"Agotado"]})]})]})]},t.favorite.id)}),n&&e.jsx("div",{className:"flex justify-center py-4",children:e.jsx("button",{onClick:V,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50",children:"Cargar más favoritos"})})]}),f!==null&&e.jsx(ee,{favoriteId:f,initialPreferences:{notifyPriceChange:x.find(t=>t.favorite.id===f)?.favorite.notifyPriceChange||!0,notifyPromotion:x.find(t=>t.favorite.id===f)?.favorite.notifyPromotion||!0,notifyLowStock:x.find(t=>t.favorite.id===f)?.favorite.notifyLowStock||!0},onClose:G})]})};export{fe as default};
//# sourceMappingURL=FavoritePage-aj0iqdy4.js.map
