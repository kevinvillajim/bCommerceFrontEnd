{"version":3,"file":"imageUtils-B2iUz1H0.js","sources":["../../src/utils/imageUtils.ts"],"sourcesContent":["// src/utils/unifiedImageUtils.ts - URLs de imagen corregidas\r\nimport environment from \"../config/environment\";\r\n\r\n/**\r\n * ✅ CONFIGURACIÓN CORREGIDA - Sin dependencias externas\r\n */\r\nconst IMAGE_CONFIG = {\r\n\t// ✅ PLACEHOLDER SVG EMBEBIDO - No requiere conexión externa\r\n\tplaceholder:\r\n\t\t\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDMwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIiBmaWxsPSIjZjNmNGY2Ii8+CjxwYXRoIGQ9Ik0xMjUgMTAwQzEyNSA5MS43MTU3IDEzMS43MTYgODUgMTQwIDg1SDE2MEMxNjguMjg0IDg1IDE3NSA5MS43MTU3IDE3NSAxMDBWMTIwQzE3NSAxMjguMjg0IDE2OC4yODQgMTM1IDE2MCAxMzVIMTQwQzEzMS43MTYgMTM1IDEyNSAxMjguMjg0IDEyNSAxMjBWMTAwWiIgZmlsbD0iIzllYTNhOCIvPgo8cGF0aCBkPSJNOTAgMTcwTDEzMCAxMzBMMTcwIDIwMEgyMTBMMjEwIDIzMEg5MFYxNzBaIiBmaWxsPSIjOWVhM2E4Ii8+Cjx0ZXh0IHg9IjE1MCIgeT0iMjYwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmaWxsPSIjNmI3MjgwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCI+UHJvZHVjdG88L3RleHQ+Cjwvc3ZnPgo=\",\r\n\tdefaultProduct: \"/images/default-product.jpg\",\r\n\tnoImage:\r\n\t\t\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjZjlmYWZiIiBzdHJva2U9IiNlNWU3ZWIiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWRhc2hhcnJheT0iNSA1Ii8+CjxjaXJjbGUgY3g9IjEwMCIgY3k9IjgwIiByPSIyMCIgZmlsbD0iI2Q5ZjNlYSIgc3Ryb2tlPSIjMTBiOTgxIiBzdHJva2Utd2lkdGg9IjIiLz4KPHBhdGggZD0iTTYwIDEzMEw4MCA5MEwxMjAgMTQwTDE0MCAyMEwxODAgMTQwVjE3MEg2MFYxMzBaIiBmaWxsPSIjMTBiOTgxIiBmaWxsLW9wYWNpdHk9IjAuMyIvPgo8dGV4dCB4PSIxMDAiIHk9IjE5MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iIzZiNzI4MCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiPk5vIGltYWdlbjwvdGV4dD4KPHN2Zz4K\",\r\n};\r\n\r\n/**\r\n * ✅ Obtiene la URL base de la API dinámicamente\r\n */\r\nfunction getApiBaseUrl(): string {\r\n\tif (typeof window === \"undefined\") {\r\n\t\treturn \"http://127.0.0.1:8000\"; // Fallback para SSR\r\n\t}\r\n\r\n\tconst {protocol, hostname} = window.location;\r\n\r\n\t// En desarrollo local, usar puerto 8000 para Laravel\r\n\tif (hostname === \"localhost\" || hostname === \"127.0.0.1\") {\r\n\t\treturn `${protocol}//${hostname}:8000`;\r\n\t}\r\n\r\n\t// En producción, asumir mismo dominio\r\n\treturn `${protocol}//${hostname}`;\r\n}\r\n\r\n/**\r\n * ✅ FUNCIÓN PRINCIPAL - Obtener URLs de imágenes sin dependencias externas\r\n */\r\nexport function getImageUrl(imagePath?: string | null): string {\r\n\t// Caso 1: Sin imagen - retornar placeholder embebido\r\n\tif (!imagePath || imagePath.trim() === \"\") {\r\n\t\treturn IMAGE_CONFIG.placeholder;\r\n\t}\r\n\r\n\tconst path = imagePath.trim();\r\n\r\n\t// Caso 2: URL completa (http/https) - retornar tal como está\r\n\tif (path.startsWith(\"http://\") || path.startsWith(\"https://\")) {\r\n\t\treturn path;\r\n\t}\r\n\r\n\t// Caso 3: Data URL - retornar directamente\r\n\tif (path.startsWith(\"data:\")) {\r\n\t\treturn path;\r\n\t}\r\n\r\n\t// Caso 4: Usar configuración de environment si está disponible\r\n\tif (environment?.imageBaseUrl) {\r\n\t\tlet normalizedPath = path;\r\n\t\tif (normalizedPath.startsWith(\"/storage/\")) {\r\n\t\t\tnormalizedPath = normalizedPath.substring(9);\r\n\t\t} else if (normalizedPath.startsWith(\"storage/\")) {\r\n\t\t\tnormalizedPath = normalizedPath.substring(8);\r\n\t\t}\r\n\r\n\t\treturn `${environment.imageBaseUrl}${normalizedPath}`;\r\n\t}\r\n\r\n\t// Caso 5: Fallback usando detección automática de API base\r\n\tconst apiBaseUrl = getApiBaseUrl();\r\n\r\n\tif (path.startsWith(\"products/\")) {\r\n\t\treturn `${apiBaseUrl}/storage/${path}`;\r\n\t}\r\n\r\n\tif (path.startsWith(\"storage/\")) {\r\n\t\treturn `${apiBaseUrl}/${path}`;\r\n\t}\r\n\r\n\treturn `${apiBaseUrl}/storage/${path}`;\r\n}\r\n\r\n/**\r\n * ✅ Obtiene la URL de imagen por defecto (placeholder embebido)\r\n */\r\nexport function getDefaultImageUrl(): string {\r\n\treturn IMAGE_CONFIG.placeholder;\r\n}\r\n\r\n/**\r\n * ✅ Obtiene URL de \"no imagen disponible\"\r\n */\r\nexport function getNoImageUrl(): string {\r\n\treturn IMAGE_CONFIG.noImage;\r\n}\r\n\r\n/**\r\n * ✅ Extrae la imagen principal de un producto con validación robusta\r\n */\r\nexport function getProductMainImage(product: any): string {\r\n\tif (!product) {\r\n\t\treturn getDefaultImageUrl();\r\n\t}\r\n\r\n\t// Prioridad 1: main_image desde la API\r\n\tif (product.main_image && typeof product.main_image === \"string\") {\r\n\t\treturn getImageUrl(product.main_image);\r\n\t}\r\n\r\n\t// Prioridad 2: image (singular) desde la API\r\n\tif (product.image && typeof product.image === \"string\") {\r\n\t\treturn getImageUrl(product.image);\r\n\t}\r\n\r\n\t// Prioridad 3: primer elemento del array images\r\n\tif (\r\n\t\tproduct.images &&\r\n\t\tArray.isArray(product.images) &&\r\n\t\tproduct.images.length > 0\r\n\t) {\r\n\t\tconst firstImage = product.images[0];\r\n\r\n\t\tif (typeof firstImage === \"string\" && firstImage.trim() !== \"\") {\r\n\t\t\treturn getImageUrl(firstImage);\r\n\t\t}\r\n\r\n\t\tif (typeof firstImage === \"object\" && firstImage !== null) {\r\n\t\t\tconst imageUrl =\r\n\t\t\t\tfirstImage.original ||\r\n\t\t\t\tfirstImage.large ||\r\n\t\t\t\tfirstImage.medium ||\r\n\t\t\t\tfirstImage.thumbnail ||\r\n\t\t\t\t\"\";\r\n\t\t\tif (imageUrl && typeof imageUrl === \"string\") {\r\n\t\t\t\treturn getImageUrl(imageUrl);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Fallback: imagen placeholder embebida\r\n\treturn getDefaultImageUrl();\r\n}\r\n\r\n/**\r\n * ✅ Obtiene todas las imágenes de un producto como array\r\n */\r\nexport function getProductImages(product: any): string[] {\r\n\tconst images: string[] = [];\r\n\r\n\tif (product?.images && Array.isArray(product.images)) {\r\n\t\tfor (const image of product.images) {\r\n\t\t\tif (typeof image === \"string\" && image.trim() !== \"\") {\r\n\t\t\t\timages.push(getImageUrl(image));\r\n\t\t\t} else if (typeof image === \"object\" && image !== null) {\r\n\t\t\t\tconst imageUrl =\r\n\t\t\t\t\timage.original ||\r\n\t\t\t\t\timage.large ||\r\n\t\t\t\t\timage.medium ||\r\n\t\t\t\t\timage.thumbnail ||\r\n\t\t\t\t\t\"\";\r\n\t\t\t\tif (imageUrl && typeof imageUrl === \"string\") {\r\n\t\t\t\t\timages.push(getImageUrl(imageUrl));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Si no hay imágenes válidas, agregar la imagen principal o placeholder\r\n\tif (images.length === 0) {\r\n\t\timages.push(getProductMainImage(product));\r\n\t}\r\n\r\n\treturn images;\r\n}\r\n\r\n/**\r\n * ✅ Valida si una URL de imagen es válida (puede cargarse)\r\n */\r\nexport function validateImageUrl(url: string): Promise<boolean> {\r\n\treturn new Promise((resolve) => {\r\n\t\t// Si es data URL, asumir que es válida\r\n\t\tif (url.startsWith(\"data:\")) {\r\n\t\t\tresolve(true);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst img = new Image();\r\n\t\tconst timeout = setTimeout(() => {\r\n\t\t\tresolve(false);\r\n\t\t}, 3000);\r\n\r\n\t\timg.onload = () => {\r\n\t\t\tclearTimeout(timeout);\r\n\t\t\tresolve(true);\r\n\t\t};\r\n\r\n\t\timg.onerror = () => {\r\n\t\t\tclearTimeout(timeout);\r\n\t\t\tresolve(false);\r\n\t\t};\r\n\r\n\t\timg.src = url;\r\n\t});\r\n}\r\n\r\n/**\r\n * ✅ Genera un placeholder SVG dinámico con texto personalizado\r\n */\r\nexport function generatePlaceholder(\r\n\twidth: number = 300,\r\n\theight: number = 300,\r\n\ttext: string = \"Imagen\"\r\n): string {\r\n\tconst svg = `\r\n    <svg width=\"${width}\" height=\"${height}\" viewBox=\"0 0 ${width} ${height}\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <rect width=\"${width}\" height=\"${height}\" fill=\"#f3f4f6\"/>\r\n      <circle cx=\"${width / 2}\" cy=\"${height / 3}\" r=\"${Math.min(width, height) / 12}\" fill=\"#d1d5db\"/>\r\n      <path d=\"M${width * 0.2} ${height * 0.6}L${width * 0.35} ${height * 0.45}L${width * 0.5} ${height * 0.7}L${width * 0.65} ${height * 0.35}L${width * 0.8} ${height * 0.7}V${height * 0.85}H${width * 0.2}V${height * 0.6}Z\" fill=\"#9ca3af\"/>\r\n      <text x=\"${width / 2}\" y=\"${height * 0.95}\" text-anchor=\"middle\" fill=\"#6b7280\" font-family=\"sans-serif\" font-size=\"${Math.max(12, width / 20)}\">${text}</text>\r\n    </svg>\r\n  `;\r\n\r\n\treturn `data:image/svg+xml;base64,${btoa(svg)}`;\r\n}\r\n\r\n/**\r\n * ✅ Hook de React para manejar carga de imágenes con estado\r\n */\r\nexport function useImageLoader(initialSrc: string) {\r\n\tif (typeof window === \"undefined\" || !(window as any).React) {\r\n\t\treturn {\r\n\t\t\tsrc: getImageUrl(initialSrc),\r\n\t\t\tisLoading: false,\r\n\t\t\thasError: false,\r\n\t\t\tloadImage: () => {},\r\n\t\t};\r\n\t}\r\n\r\n\tconst React = (window as any).React;\r\n\tconst [src, setSrc] = React.useState(getImageUrl(initialSrc));\r\n\tconst [isLoading, setIsLoading] = React.useState(true);\r\n\tconst [hasError, setHasError] = React.useState(false);\r\n\r\n\tconst loadImage = React.useCallback((newSrc: string) => {\r\n\t\tsetIsLoading(true);\r\n\t\tsetHasError(false);\r\n\r\n\t\tconst imageUrl = getImageUrl(newSrc);\r\n\r\n\t\t// Si es data URL, cargar inmediatamente\r\n\t\tif (imageUrl.startsWith(\"data:\")) {\r\n\t\t\tsetSrc(imageUrl);\r\n\t\t\tsetIsLoading(false);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvalidateImageUrl(imageUrl).then((isValid) => {\r\n\t\t\tif (isValid) {\r\n\t\t\t\tsetSrc(imageUrl);\r\n\t\t\t} else {\r\n\t\t\t\tsetSrc(getDefaultImageUrl());\r\n\t\t\t\tsetHasError(true);\r\n\t\t\t}\r\n\t\t\tsetIsLoading(false);\r\n\t\t});\r\n\t}, []);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tif (initialSrc) {\r\n\t\t\tloadImage(initialSrc);\r\n\t\t}\r\n\t}, [initialSrc, loadImage]);\r\n\r\n\treturn {src, isLoading, hasError, loadImage};\r\n}\r\n\r\n/**\r\n * ✅ Crear una imagen con fallback automático para React\r\n */\r\nexport function createImageWithFallback(\r\n\tsrc: string,\r\n\talt: string = \"Imagen\",\r\n\tclassName: string = \"\",\r\n\tonLoad?: () => void,\r\n\tonError?: () => void\r\n) {\r\n\tif (typeof window === \"undefined\" || !(window as any).React) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\tconst React = (window as any).React;\r\n\tconst [imageSrc, setImageSrc] = React.useState(getImageUrl(src));\r\n\tconst [hasError, setHasError] = React.useState(false);\r\n\r\n\tconst handleError = React.useCallback(() => {\r\n\t\tif (!hasError) {\r\n\t\t\tsetHasError(true);\r\n\t\t\tsetImageSrc(getDefaultImageUrl());\r\n\t\t\tonError?.();\r\n\t\t}\r\n\t}, [hasError, onError]);\r\n\r\n\tconst handleLoad = React.useCallback(() => {\r\n\t\tsetHasError(false);\r\n\t\tonLoad?.();\r\n\t}, [onLoad]);\r\n\r\n\tReact.useEffect(() => {\r\n\t\tsetImageSrc(getImageUrl(src));\r\n\t\tsetHasError(false);\r\n\t}, [src]);\r\n\r\n\treturn React.createElement(\"img\", {\r\n\t\tsrc: imageSrc,\r\n\t\talt,\r\n\t\tclassName,\r\n\t\tonError: handleError,\r\n\t\tonLoad: handleLoad,\r\n\t\tloading: \"lazy\",\r\n\t});\r\n}\r\n\r\n// ✅ Exportar como objeto para facilitar imports\r\nexport const ImageUtils = {\r\n\tgetImageUrl,\r\n\tgetDefaultImageUrl,\r\n\tgetNoImageUrl,\r\n\tgetProductMainImage,\r\n\tgetProductImages,\r\n\tvalidateImageUrl,\r\n\tgeneratePlaceholder,\r\n\tuseImageLoader,\r\n\tcreateImageWithFallback,\r\n};\r\n\r\nexport default ImageUtils;\r\n"],"names":["IMAGE_CONFIG","getImageUrl","imagePath","path","normalizedPath","environment"],"mappings":"wCAMA,MAAMA,EAAe,CAEpB,YACC,gtBAIF,EAwBO,SAASC,EAAYC,EAAmC,CAE9D,GAAI,CAACA,GAAaA,EAAU,KAAA,IAAW,GACtC,OAAOF,EAAa,YAGf,MAAAG,EAAOD,EAAU,KAAK,EAQxB,GALAC,EAAK,WAAW,SAAS,GAAKA,EAAK,WAAW,UAAU,GAKxDA,EAAK,WAAW,OAAO,EACnB,OAAAA,EAIuB,CAC9B,IAAIC,EAAiBD,EACjB,OAAAC,EAAe,WAAW,WAAW,EACvBA,EAAAA,EAAe,UAAU,CAAC,EACjCA,EAAe,WAAW,UAAU,IAC7BA,EAAAA,EAAe,UAAU,CAAC,GAGrC,GAAGC,EAAY,YAAY,GAAGD,CAAc,EAAA,CAerD"}