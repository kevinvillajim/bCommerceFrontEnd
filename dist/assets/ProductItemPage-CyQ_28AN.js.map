{"version":3,"file":"ProductItemPage-CyQ_28AN.js","sources":["../../src/presentation/components/product/ProductReviews.tsx","../../src/presentation/pages/ProductItemPage.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { Star, User, AlertCircle } from 'lucide-react';\r\nimport { useRatings } from '../../hooks/useRatings';\r\n\r\n// Usamos la interfaz Rating del servicio real\r\ninterface Rating {\r\n  id?: number;\r\n  rating: number;\r\n  title?: string;\r\n  comment?: string;\r\n  user_id: number;\r\n  product_id?: number;\r\n  seller_id?: number;\r\n  order_id: number;\r\n  status: \"pending\" | \"approved\" | \"rejected\";\r\n  created_at: string;\r\n  updated_at: string;\r\n  user?: {\r\n    id: number;\r\n    name: string;\r\n    avatar?: string;\r\n  };\r\n  seller_response?: {\r\n    id: number;\r\n    text: string;\r\n    created_at: string;\r\n  };\r\n  is_verified_purchase: boolean;\r\n}\r\n\r\ninterface ProductReviewsProps {\r\n  productId: number;\r\n  rating: number;\r\n  ratingCount: number;\r\n}\r\n\r\nconst ProductReviews: React.FC<ProductReviewsProps> = ({\r\n  productId,\r\n  rating,\r\n  ratingCount,\r\n}) => {\r\n  const [reviews, setReviews] = useState<Rating[]>([]);\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [totalPages, setTotalPages] = useState(1);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [hasNoReviews, setHasNoReviews] = useState(false);\r\n  \r\n  // Ref para evitar llamadas m√∫ltiples\r\n  const isLoadingRef = useRef(false);\r\n  const abortControllerRef = useRef<AbortController | null>(null);\r\n  \r\n  const { getProductRatings } = useRatings();\r\n\r\n  // Funci√≥n para cargar rese√±as sin useCallback para evitar dependencias problem√°ticas\r\n  const loadReviews = async (page: number = currentPage) => {\r\n    // Evitar llamadas m√∫ltiples\r\n    if (isLoadingRef.current || !productId) {\r\n      console.log('üö´ Evitando llamada m√∫ltiple o productId inv√°lido');\r\n      return;\r\n    }\r\n\r\n    // Cancelar llamada anterior si existe\r\n    if (abortControllerRef.current) {\r\n      abortControllerRef.current.abort();\r\n    }\r\n\r\n    // Crear nuevo AbortController\r\n    abortControllerRef.current = new AbortController();\r\n    \r\n    console.log(`üîÑ Cargando rese√±as del producto ${productId}, p√°gina ${page}`);\r\n    \r\n    try {\r\n      setIsLoading(true);\r\n      setError(null);\r\n      isLoadingRef.current = true;\r\n      \r\n      const response = await getProductRatings(productId, page, 5);\r\n      console.log(`üìä Respuesta completa de la API:`, response);\r\n      \r\n      if (response && response.data) {\r\n        console.log(`üìÑ Contenido de response.data:`, response.data);\r\n        console.log(`üß© Tipo de response.data:`, typeof response.data, Array.isArray(response.data));\r\n        \r\n        // Verificar si response.data es un array directamente\r\n        if (Array.isArray(response.data)) {\r\n          console.log(`‚úÖ response.data es un array con ${response.data.length} elementos`);\r\n          if (response.data.length === 0) {\r\n            setHasNoReviews(true);\r\n            setReviews([]);\r\n          } else {\r\n            setReviews(response.data);\r\n            setHasNoReviews(false);\r\n          }\r\n        } \r\n        // Verificar si response.data es un objeto con propiedades\r\n        else if (typeof response.data === 'object' && response.data !== null) {\r\n          console.log(`üìù response.data es un objeto, propiedades:`, Object.keys(response.data));\r\n          \r\n          // Verificar si tiene un array de ratings dentro\r\n          if ((response.data as any).ratings && Array.isArray((response.data as any).ratings)) {\r\n            console.log(`‚úÖ Encontrado response.data.ratings con ${(response.data as any).ratings.length} elementos`);\r\n            if ((response.data as any).ratings.length === 0) {\r\n              setHasNoReviews(true);\r\n              setReviews([]);\r\n            } else {\r\n              setReviews((response.data as any).ratings);\r\n              setHasNoReviews(false);\r\n            }\r\n          }\r\n          // Verificar si el objeto mismo es el array de datos\r\n          else if ((response.data as any).data && Array.isArray((response.data as any).data)) {\r\n            console.log(`‚úÖ Encontrado response.data.data con ${(response.data as any).data.length} elementos`);\r\n            if ((response.data as any).data.length === 0) {\r\n              setHasNoReviews(true);\r\n              setReviews([]);\r\n            } else {\r\n              setReviews((response.data as any).data);\r\n              setHasNoReviews(false);\r\n            }\r\n          }\r\n          else {\r\n            console.warn(`‚ö†Ô∏è Estructura de objeto no reconocida en response.data`);\r\n            setReviews([]);\r\n            setHasNoReviews(true);\r\n          }\r\n        }\r\n        else {\r\n          console.warn(`‚ö†Ô∏è response.data no es ni array ni objeto:`, response.data);\r\n          setReviews([]);\r\n          setHasNoReviews(true);\r\n        }\r\n        \r\n        // Manejar meta informaci√≥n para paginaci√≥n\r\n        const totalItems = response.meta?.total || (response.data as any)?.total || 0;\r\n        setTotalPages(Math.ceil(totalItems / 5));\r\n        console.log(`üìà Total items: ${totalItems}, Total pages: ${Math.ceil(totalItems / 5)}`);\r\n      } else {\r\n        console.log(`‚ùå No hay response o response.data`);\r\n        setReviews([]);\r\n        setHasNoReviews(true);\r\n        setTotalPages(1);\r\n      }\r\n    } catch (error: any) {\r\n      console.error('‚ùå Error cargando rese√±as:', error);\r\n      \r\n      // Manejo espec√≠fico de errores\r\n      if (error?.code === 'ECONNABORTED' || error?.message?.includes('timeout')) {\r\n        setError('La carga de rese√±as est√° tardando m√°s de lo esperado. Int√©ntalo m√°s tarde.');\r\n      } else if (error?.response?.status === 404) {\r\n        setHasNoReviews(true);\r\n        setReviews([]);\r\n        setError(null); // No mostrar error para 404, solo no hay rese√±as\r\n      } else if (error?.response?.status >= 500) {\r\n        setError('Error del servidor. Int√©ntalo m√°s tarde.');\r\n      } else {\r\n        setError('No se pudieron cargar las rese√±as.');\r\n      }\r\n      \r\n      setReviews([]);\r\n      setTotalPages(1);\r\n    } finally {\r\n      setIsLoading(false);\r\n      isLoadingRef.current = false;\r\n      abortControllerRef.current = null;\r\n    }\r\n  };\r\n\r\n  // Effect para cargar rese√±as iniciales\r\n  useEffect(() => {\r\n    if (productId) {\r\n      console.log(`üéÜ Producto cambiado a ${productId}, reseteando p√°gina a 1`);\r\n      setCurrentPage(1); // Resetear p√°gina al cambiar producto\r\n      setError(null);\r\n      setHasNoReviews(false);\r\n      loadReviews(1);\r\n    }\r\n    \r\n    // Cleanup\r\n    return () => {\r\n      if (abortControllerRef.current) {\r\n        abortControllerRef.current.abort();\r\n      }\r\n      isLoadingRef.current = false;\r\n    };\r\n  }, [productId]); // Solo productId como dependencia\r\n\r\n  // Effect separado para cambios de p√°gina (solo si no es p√°gina 1)\r\n  useEffect(() => {\r\n    if (currentPage > 1 && productId) {\r\n      console.log(`üìé Cambiando a p√°gina ${currentPage}`);\r\n      loadReviews(currentPage);\r\n    }\r\n  }, [currentPage]);\r\n\r\n  // Funci√≥n para renderizar estrellas\r\n  const renderStars = (rating: number) => {\r\n    return (\r\n      <div className=\"flex\">\r\n        {[1, 2, 3, 4, 5].map((star) => (\r\n          <Star\r\n            key={star}\r\n            size={16}\r\n            className={`${\r\n              star <= rating\r\n                ? \"text-yellow-400 fill-current\"\r\n                : \"text-gray-300\"\r\n            }`}\r\n          />\r\n        ))}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Funci√≥n para formatear fecha\r\n  const formatDate = (dateString: string) => {\r\n    try {\r\n      const date = new Date(dateString);\r\n      return date.toLocaleDateString('es-ES', {\r\n        year: 'numeric',\r\n        month: 'long',\r\n        day: 'numeric'\r\n      });\r\n    } catch {\r\n      return 'Fecha no disponible';\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"text-center py-8\">\r\n        <div className=\"animate-spin rounded-full h-8 w-8 border-gray-300 border-t-primary-600 mx-auto\"></div>\r\n        <p className=\"text-gray-500 mt-2\">Cargando rese√±as...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Mostrar error si existe\r\n  if (error) {\r\n    return (\r\n      <div className=\"max-w-3xl\">\r\n        {/* Resumen de valoraciones */}\r\n        {rating > 0 && (\r\n          <div className=\"flex items-center mb-6 p-6 bg-gray-50 rounded-lg\">\r\n            <div className=\"mr-6\">\r\n              <div className=\"text-4xl font-bold text-gray-900\">\r\n                {rating.toFixed(1)}\r\n              </div>\r\n              <div className=\"flex mt-2\">\r\n                {renderStars(rating)}\r\n              </div>\r\n              <div className=\"text-sm text-gray-500 mt-1\">\r\n                {ratingCount > 0 ? `${ratingCount} valoraci√≥n${ratingCount > 1 ? 'es' : ''}` : 'Sin valoraciones'}\r\n              </div>\r\n            </div>\r\n            \r\n            <div className=\"flex-grow text-center\">\r\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\r\n                Valoraci√≥n promedio\r\n              </h3>\r\n              <p className=\"text-gray-600\">\r\n                Basado en {ratingCount} valoraci√≥n{ratingCount !== 1 ? 'es' : ''} de clientes\r\n              </p>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Error estado */}\r\n        <div className=\"text-center py-12\">\r\n          <div className=\"text-red-400 mb-4\">\r\n            <AlertCircle size={48} className=\"mx-auto\" />\r\n          </div>\r\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\r\n            Error al cargar rese√±as\r\n          </h3>\r\n          <p className=\"text-gray-500 mb-4\">\r\n            {error}\r\n          </p>\r\n          <button\r\n            onClick={() => loadReviews(currentPage)}\r\n            className=\"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors\"\r\n          >\r\n            Intentar nuevamente\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-3xl\">\r\n      {/* Resumen de valoraciones */}\r\n      {rating > 0 && (\r\n        <div className=\"flex items-center mb-6 p-6 bg-gray-50 rounded-lg\">\r\n          <div className=\"mr-6\">\r\n            <div className=\"text-4xl font-bold text-gray-900\">\r\n              {rating.toFixed(1)}\r\n            </div>\r\n            <div className=\"flex mt-2\">\r\n              {renderStars(rating)}\r\n            </div>\r\n            <div className=\"text-sm text-gray-500 mt-1\">\r\n              {ratingCount > 0 ? `${ratingCount} valoraci√≥n${ratingCount > 1 ? 'es' : ''}` : 'Sin valoraciones'}\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex-grow text-center\">\r\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\r\n              Valoraci√≥n promedio\r\n            </h3>\r\n            <p className=\"text-gray-600\">\r\n              Basado en {ratingCount} valoraci√≥n{ratingCount !== 1 ? 'es' : ''} de clientes\r\n            </p>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Lista de rese√±as */}\r\n      {reviews.length > 0 ? (\r\n        <div className=\"space-y-6\">\r\n          {reviews.map((review, index) => (\r\n            <div key={review.id || index} className=\"border-b border-gray-200 pb-6 last:border-b-0\">\r\n              <div className=\"flex items-start space-x-4\">\r\n                {/* Avatar del usuario */}\r\n                <div className=\"flex-shrink-0\">\r\n                  <div className=\"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center\">\r\n                    <User size={20} className=\"text-primary-600\" />\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Contenido de la rese√±a */}\r\n                <div className=\"flex-grow\">\r\n                  <div className=\"flex items-center justify-between mb-2\">\r\n                    <div>\r\n                      <p className=\"font-medium text-gray-900\">\r\n                      {review.user?.name || 'Usuario an√≥nimo'}\r\n                      </p>\r\n                      <div className=\"flex items-center mt-1\">\r\n                      {renderStars(review.rating)}\r\n                       <span className=\"ml-2 text-sm text-gray-500\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t{formatDate(review.created_at)}\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* T√≠tulo de la rese√±a */}\r\n                  {review.title && (\r\n                    <h4 className=\"font-medium text-gray-900 mb-2\">\r\n                      {review.title}\r\n                    </h4>\r\n                  )}\r\n\r\n                  {/* Comentario */}\r\n                  {review.comment && (\r\n                    <p className=\"text-gray-700 leading-relaxed\">\r\n                      {review.comment}\r\n                    </p>\r\n                  )}\r\n\r\n                  {/* Respuesta del vendedor */}\r\n                  {review.seller_response && (\r\n                    <div className=\"mt-4 p-4 bg-blue-50 rounded-lg\">\r\n                      <div className=\"flex items-center mb-2\">\r\n                        <span className=\"text-sm font-medium text-blue-900\">\r\n                          Respuesta del vendedor\r\n                        </span>\r\n                        <span className=\"ml-2 text-xs text-blue-600\">\r\n                          {formatDate(review.seller_response.created_at)}\r\n                        </span>\r\n                      </div>\r\n                      <p className=\"text-blue-800 text-sm\">\r\n                        {review.seller_response.text}\r\n                      </p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      ) : (\r\n        /* Estado vac√≠o - Sin rese√±as disponibles */\r\n        <div className=\"text-center py-12\">\r\n          <div className=\"text-yellow-400 mb-4\">\r\n            <Star size={48} className=\"mx-auto fill-current\" />\r\n          </div>\r\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\r\n            {hasNoReviews ? 'No hay rese√±as disponibles' : 'Sin rese√±as a√∫n'}\r\n          </h3>\r\n          <p className=\"text-gray-500\">\r\n            {hasNoReviews \r\n              ? 'Este producto a√∫n no tiene rese√±as de clientes' \r\n              : 'S√© el primero en valorar este producto'\r\n            }\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {/* Paginaci√≥n */}\r\n      {totalPages > 1 && (\r\n        <div className=\"flex justify-center mt-8 space-x-2\">\r\n          <button\r\n            onClick={() => {\r\n              if (currentPage > 1) {\r\n                setCurrentPage(prev => prev - 1);\r\n              }\r\n            }}\r\n            disabled={currentPage === 1 || isLoading}\r\n            className=\"px-4 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            Anterior\r\n          </button>\r\n          \r\n          <span className=\"px-4 py-2 text-gray-600\">\r\n            P√°gina {currentPage} de {totalPages}\r\n          </span>\r\n          \r\n          <button\r\n            onClick={() => {\r\n              if (currentPage < totalPages) {\r\n                setCurrentPage(prev => prev + 1);\r\n              }\r\n            }}\r\n            disabled={currentPage === totalPages || isLoading}\r\n            className=\"px-4 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n          >\r\n            Siguiente\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ProductReviews;","import React, {useState, useEffect} from \"react\";\r\nimport {useParams, Link, useNavigate} from \"react-router-dom\";\r\nimport {\r\n\tShoppingCart,\r\n\tHeart,\r\n\tShare2,\r\n\tTruck,\r\n\tShield,\r\n\tRotateCcw,\r\n\tMinus,\r\n\tPlus,\r\n\tLoader,\r\n\tMessageSquare,\r\n\tGift,\r\n\tTrendingDown,\r\n\tAlertTriangle\r\n} from \"lucide-react\";\r\n// ‚ùå NO necesitamos ProductService anymore\r\n// import {ProductService} from \"../../core/services/ProductService\";\r\nimport type {\r\n\tProductDetail,\r\n\tProductImage,\r\n} from \"../../core/domain/entities/Product\";\r\nimport {getImageUrl} from \"../../utils/imageManager\";\r\nimport {useCart} from \"../hooks/useCart\";\r\nimport {useFavorites} from \"../hooks/useFavorites\";\r\nimport {useChat} from \"../hooks/useChat\";\r\nimport {useProducts} from \"../hooks/useProducts\"; // ‚úÖ USAR HOOK OPTIMIZADO\r\nimport {useInvalidateCounters} from \"../hooks/useHeaderCounters\";\r\nimport {useErrorHandler} from \"../hooks/useErrorHandler\";\r\nimport {NotificationType} from \"../contexts/CartContext\";\r\nimport CacheService from \"../../infrastructure/services/CacheService\";\r\nimport ApiClient from \"../../infrastructure/api/apiClient\";\r\nimport {useVolumeDiscounts} from \"../hooks/useUnifiedConfig\";\r\nimport ProductReviews from \"../components/product/ProductReviews\";\r\nimport RatingStars from \"../components/common/RatingStars\";\r\n\r\ninterface SellerApiResponse {\r\n\tstatus?: string;\r\n\tsuccess?: boolean;\r\n\tdata?: {\r\n\t\tid?: number;\r\n\t\tseller_id?: number;\r\n\t\tname?: string;\r\n\t\temail?: string;\r\n\t};\r\n\tmessage?: string;\r\n}\r\n\r\nconst ProductItemPage: React.FC = () => {\r\n\tconst {id} = useParams<{id: string}>();\r\n\tconst navigate = useNavigate();\r\n\t\r\n\t// ‚úÖ USAR HOOKS OPTIMIZADOS\r\n\tconst {\r\n\t\tproduct,\r\n\t\tloading,\r\n\t\terror,\r\n\t\tfetchProductById,\r\n\t\ttrackProductView,\r\n\t\tclearCurrentProduct // ‚úÖ NUEVA FUNCI√ìN PARA LIMPIAR ESTADO\r\n\t} = useProducts();\r\n\t\r\n\tconst [activeImage, setActiveImage] = useState(0);\r\n\tconst [activeTab, setActiveTab] = useState<\r\n\t\t\"description\" | \"specifications\" | \"reviews\"\r\n\t>(\"description\");\r\n\tconst [isUpdating, setIsUpdating] = useState(false);\r\n\t\r\n\tconst {addToCart, showNotification} = useCart();\r\n\tconst {toggleFavorite, checkIsFavorite} = useFavorites();\r\n\tconst {createChat} = useChat();\r\n\t\r\n\t// ‚úÖ Hook para manejo de errores mejorado\r\n\tconst {handleError, handleSuccess, handleStockError} = useErrorHandler({\r\n\t\tshowNotification,\r\n\t\tcontext: 'ProductItemPage'\r\n\t});\r\n\t\r\n\t// ‚úÖ Hook para actualizaciones optimistas\r\n\tconst {\r\n\t\toptimisticCartAdd,\r\n\t\toptimisticFavoriteAdd,\r\n\t\toptimisticFavoriteRemove\r\n\t} = useInvalidateCounters();\r\n\r\n\t// ‚úÖ USAR HOOK CORREGIDO PARA DESCUENTOS POR VOLUMEN\r\n\t// üéØ JORDAN: Migrado a hook unificado + estado local\r\n\tconst [quantity, setQuantity] = useState(1);\r\n\tconst { tiers, getDiscountForQuantity } = useVolumeDiscounts();\r\n\t\r\n\t// Calcular descuento din√°mico basado en cantidad\r\n\tconst applicableDiscount = getDiscountForQuantity(quantity);\r\n\tconst hasVolumeDiscount = applicableDiscount > 0;\r\n\t\r\n\t// Usar final_price como base (ya incluye descuento del seller) y aplicar descuento por volumen encima\r\n\tconst basePrice = product?.final_price || product?.price || 0;\r\n\tconst volumeDiscountedPrice = basePrice * (1 - applicableDiscount);\r\n\tconst finalPrice = hasVolumeDiscount ? volumeDiscountedPrice : basePrice;\r\n\t\r\n\t// El descuento total se calcula desde el precio original\r\n\tconst originalPrice = product?.price || 0;\r\n\tconst hasSellerDiscount = product && product.final_price && product.final_price < product.price;\r\n\tconst hasAnyDiscount = hasSellerDiscount || hasVolumeDiscount;\r\n\t\r\n\tconst totalSavings = hasVolumeDiscount ? (basePrice - finalPrice) * quantity : 0;\r\n\t\r\n\t// Calcular siguiente tier para compatibilidad\r\n\tconst sortedTiers = [...tiers].sort((a, b) => a.quantity - b.quantity);\r\n\tconst nextTier = sortedTiers.find(tier => tier.quantity > quantity);\r\n\tconst itemsNeededForNext = nextTier ? nextTier.quantity - quantity : 0;\r\n\t\r\n\t// Compatibilidad completa con c√≥digo existente\r\n\tconst discountResult = { \r\n\t\tfinalPrice, \r\n\t\ttotalSavings, \r\n\t\thasDiscount: hasVolumeDiscount, // Solo para descuentos por volumen\r\n\t\tdiscountPercentage: applicableDiscount * 100, // ‚úÖ CORRECTO: applicableDiscount ya viene como decimal desde hook\r\n\t\tnextTier,\r\n\t\titemsNeededForNext\r\n\t};\r\n\tconst discountInfo = { tiers, enabled: tiers.length > 0 };\r\n\r\n\r\n\t// ‚ùå YA NO necesitamos ProductService directo\r\n\t// Initialize services - mantener solo para compatibilidad con chat si es necesario\r\n\r\n\t// ‚úÖ HELPER PARA OBTENER STOCK DISPONIBLE\r\n\tconst getAvailableStock = (product: ProductDetail): number => {\r\n\t\t// Prioridad: stockAvailable > stock > 0\r\n\t\tif (typeof product.stockAvailable === 'number') {\r\n\t\t\treturn product.stockAvailable;\r\n\t\t}\r\n\t\tif (typeof product.stock === 'number') {\r\n\t\t\treturn product.stock;\r\n\t\t}\r\n\t\treturn 0;\r\n\t};\r\n\r\n\t// ‚úÖ HELPER PARA VALIDAR DISPONIBILIDAD\r\n\tconst isStockAvailable = (product: ProductDetail, requestedQuantity: number): boolean => {\r\n\t\tconst availableStock = getAvailableStock(product);\r\n\t\treturn availableStock >= requestedQuantity && product.is_in_stock !== false;\r\n\t};\r\n\r\n\t// ‚úÖ HELPER PARA VALIDAR VALORES\r\n\tconst hasValidValue = (value: any): boolean => {\r\n\t\treturn value !== null && value !== undefined && value !== 0 && value !== \"0\" && value !== \"\";\r\n\t};\r\n\r\n\t// ‚úÖ HELPER PARA MOSTRAR RATING COUNT\r\n\tconst displayRatingCount = (count?: number) => {\r\n\t\tif (!count || count === 0 || isNaN(count)) return \"Sin valoraciones\";\r\n\t\treturn `${count} valoraci√≥n${count > 1 ? 'es' : ''}`;\r\n\t};\r\n\r\n\t// ‚úÖ FUNCI√ìN PARA INVALIDAR CACHE DE P√ÅGINAS ESPEC√çFICAS\r\n\tconst invalidateRelatedPages = () => {\r\n\t\tCacheService.removeItem(\"cart_user_data\");\r\n\t\tCacheService.removeItem(\"cart_guest_data\");\r\n\t\tCacheService.removeItem(\"header_counters\");\r\n\t\t\r\n\t\tfor (let page = 1; page <= 10; page++) {\r\n\t\t\tCacheService.removeItem(`user_favorites_${page}_10`);\r\n\t\t}\r\n\t\t\r\n\t\tconsole.log(\"üîÑ Cache de p√°ginas relacionadas invalidado\");\r\n\t};\r\n\r\n\t// ‚úÖ EFECTO OPTIMIZADO PARA CARGAR PRODUCTO POR ID\r\n\tuseEffect(() => {\r\n\t\tconst loadProduct = async () => {\r\n\t\t\tif (!id) {\r\n\t\t\t\tconsole.error(\"‚ùå ProductItemPage: ID no disponible\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst productId = parseInt(id);\r\n\t\t\t\tif (isNaN(productId)) {\r\n\t\t\t\t\tconsole.error(\"‚ùå ProductItemPage: ID inv√°lido:\", id);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconsole.log(\"üöÄ ProductItemPage: Cargando producto ID:\", productId);\r\n\t\t\t\t\r\n\t\t\t\t// Usar el hook optimizado en lugar del servicio directo\r\n\t\t\t\tconst productData = await fetchProductById(productId);\r\n\r\n\t\t\t\tconsole.log(\"üì• ProductItemPage: Producto cargado:\", productData);\r\n\r\n\t\t\t\t// Registrar visualizaci√≥n de producto de manera as√≠ncrona\r\n\t\t\t\ttrackProductView(productId).catch((error) => {\r\n\t\t\t\t\tconsole.error(\"‚ö†Ô∏è Error registrando visualizaci√≥n de producto:\", error);\r\n\t\t\t\t});\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error(\"‚ùå ProductItemPage: Error cargando producto:\", err);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tloadProduct();\r\n\t}, [id, fetchProductById, trackProductView]);\r\n\t\r\n\t// ‚úÖ EFECTO PARA LIMPIAR PRODUCTO CUANDO CAMBIA EL ID\r\n\tuseEffect(() => {\r\n\t\t// Si cambia el ID y tenemos un producto cargado que no coincide, \r\n\t\t// limpiar para evitar mostrar producto incorrecto\r\n\t\tif (product && id && product.id !== parseInt(id)) {\r\n\t\t\tconsole.log(\"üß© ProductItemPage: Limpiando producto anterior, ID cambio de\", product.id, \"a\", id);\r\n\t\t\tclearCurrentProduct(); // ‚úÖ USAR FUNCI√ìN DEL HOOK\r\n\t\t}\r\n\t}, [id, product, clearCurrentProduct]);\r\n\r\n\t// ‚úÖ FUNCI√ìN PARA CAMBIAR CANTIDAD CON VALIDACI√ìN DE STOCK\r\n\tconst handleQuantityChange = (newQuantity: number) => {\r\n\t\tif (newQuantity < 1) return;\r\n\t\t\r\n\t\tif (!product) {\r\n\t\t\thandleError(new Error(\"Producto no disponible\"), \"No se puede cambiar la cantidad\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst availableStock = getAvailableStock(product);\r\n\t\t\r\n\t\tif (newQuantity > availableStock) {\r\n\t\t\thandleStockError(availableStock, newQuantity);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (newQuantity <= 50) {\r\n\t\t\tsetQuantity(newQuantity);\r\n\t\t} else {\r\n\t\t\tshowNotification(\r\n\t\t\t\tNotificationType.WARNING,\r\n\t\t\t\t\"No puedes agregar m√°s de 50 unidades por producto\"\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n\r\n\t// ‚úÖ FUNCI√ìN PARA AGREGAR AL CARRITO CON VALIDACI√ìN DE STOCK\r\n\tconst handleAddToCart = async () => {\r\n\t\tif (isUpdating || !product) {\r\n\t\t\tif (!product) {\r\n\t\t\t\thandleError(new Error(\"Producto no disponible\"), \"Error: No se pudo cargar la informaci√≥n del producto\");\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Validar disponibilidad general\r\n\t\tif (!product!.is_in_stock) {\r\n\t\t\tshowNotification(\r\n\t\t\t\tNotificationType.ERROR,\r\n\t\t\t\t\"Lo sentimos, este producto est√° agotado\"\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Validar stock espec√≠fico\r\n\t\tconst availableStock = getAvailableStock(product!);\r\n\t\tif (!isStockAvailable(product!, quantity)) {\r\n\t\t\thandleStockError(availableStock, quantity);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconsole.log(`A√±adiendo al carrito: ${quantity} unidades de ${product!.name} con precio final: $${finalPrice}`);\r\n\r\n\t\ttry {\r\n\t\t\tsetIsUpdating(true);\r\n\r\n\t\t\t// ‚úÖ ACTUALIZACI√ìN OPTIMISTA INMEDIATA\r\n\t\t\toptimisticCartAdd();\r\n\r\n\t\t\tconst success = await addToCart({\r\n\t\t\t\tproductId: Number(id),\r\n\t\t\t\tquantity: quantity,\r\n\t\t\t});\r\n\r\n\t\t\tif (success) {\r\n\t\t\t\t// ‚úÖ INVALIDAR CACHE DE P√ÅGINAS RELACIONADAS\r\n\t\t\t\tinvalidateRelatedPages();\r\n\r\n\t\t\t\tlet message = `${product!.name} ha sido agregado al carrito`;\r\n\t\t\t\tif (hasVolumeDiscount && totalSavings > 0) {\r\n\t\t\t\t\tmessage += ` con ${discountResult?.discountPercentage}% de descuento por volumen (ahorro: $${totalSavings.toFixed(2)})`;\r\n\t\t\t\t}\r\n\r\n\t\t\t\thandleSuccess(message);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"No se pudo agregar el producto al carrito\");\r\n\t\t\t}\r\n\t\t} catch (error: any) {\r\n\t\t\tconsole.error(\"Error al agregar al carrito:\", error);\r\n\t\t\t\r\n\t\t\t// Manejo espec√≠fico de errores de stock\r\n\t\t\tif (error?.response?.data?.message?.includes('stock') || \r\n\t\t\t\terror?.message?.includes('stock') ||\r\n\t\t\t\terror?.response?.data?.message?.includes('insuficiente')) {\r\n\t\t\t\tconst availableStock = getAvailableStock(product!);\r\n\t\t\t\thandleStockError(availableStock, quantity);\r\n\t\t\t} else {\r\n\t\t\t\thandleError(error, \"Error al agregar producto al carrito. Int√©ntalo de nuevo.\");\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\t// ‚úÖ TIMEOUT PARA PREVENIR SPAM\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tsetIsUpdating(false);\r\n\t\t\t}, 1000);\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleAddToWishlist = async () => {\r\n\t\tif (isUpdating || !product) {\r\n\t\t\tif (!product) {\r\n\t\t\t\thandleError(new Error(\"Producto no disponible\"), \"Error: No se pudo cargar la informaci√≥n del producto\");\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconsole.log(`Gestionando favoritos: ${product!.name}`);\r\n\r\n\t\ttry {\r\n\t\t\tsetIsUpdating(true);\r\n\r\n\t\t\t// ‚úÖ VERIFICAR ESTADO ACTUAL Y ACTUALIZACI√ìN OPTIMISTA\r\n\t\t\tconst isCurrentlyFavorite = checkIsFavorite(Number(id));\r\n\t\t\t\r\n\t\t\tif (isCurrentlyFavorite) {\r\n\t\t\t\toptimisticFavoriteRemove();\r\n\t\t\t} else {\r\n\t\t\t\toptimisticFavoriteAdd();\r\n\t\t\t}\r\n\r\n\t\t\tconst result = await toggleFavorite(Number(id));\r\n\r\n\t\t\t// ‚úÖ INVALIDAR CACHE DE P√ÅGINAS RELACIONADAS\r\n\t\t\tinvalidateRelatedPages();\r\n\r\n\t\t\tif (result) {\r\n\t\t\t\thandleSuccess(\"Producto a√±adido a favoritos\");\r\n\t\t\t} else {\r\n\t\t\t\tshowNotification(NotificationType.INFO, \"Producto eliminado de favoritos\");\r\n\t\t\t}\r\n\t\t} catch (error: any) {\r\n\t\t\tconsole.error(\"Error al manejar favorito:\", error);\r\n\t\t\thandleError(error, \"Error al gestionar favoritos. Int√©ntalo de nuevo.\");\r\n\t\t} finally {\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tsetIsUpdating(false);\r\n\t\t\t}, 1000);\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleChatWithSeller = async () => {\r\n\t\tif (!product) {\r\n\t\t\thandleError(new Error(\"Producto no disponible\"), \"Error: No se pudo cargar la informaci√≥n del producto\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tlet sellerId;\r\n\r\n\t\t\tif (product!.seller_id) {\r\n\t\t\t\tsellerId = product!.seller_id;\r\n\t\t\t\tconsole.log(`Usando seller_id directo del producto: ${sellerId}`);\r\n\t\t\t}\r\n\t\t\telse if (product!.seller?.id) {\r\n\t\t\t\tsellerId = product!.seller.id;\r\n\t\t\t\tconsole.log(`Usando seller.id del producto: ${sellerId}`);\r\n\t\t\t}\r\n\t\t\telse if (product!.user_id) {\r\n\t\t\t\tconsole.log(\r\n\t\t\t\t\t`Intentando obtener seller_id a partir de user_id: ${product!.user_id}`\r\n\t\t\t\t);\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst response = await ApiClient.get<SellerApiResponse>(\r\n\t\t\t\t\t\t`/sellers/by-user/${product!.user_id}`\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tif (response && response.data) {\r\n\t\t\t\t\t\tif (response.data.id) {\r\n\t\t\t\t\t\t\tsellerId = response.data.id;\r\n\t\t\t\t\t\t\tconsole.log(\r\n\t\t\t\t\t\t\t\t`Convertido user_id ${product!.user_id} a seller_id ${sellerId}`\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t} else if (response.data.seller_id) {\r\n\t\t\t\t\t\t\tsellerId = response.data.seller_id;\r\n\t\t\t\t\t\t\tconsole.log(\r\n\t\t\t\t\t\t\t\t`Convertido user_id ${product!.user_id} a seller_id ${sellerId}`\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t\t\t`No se pudo obtener seller_id, usando user_id como fallback`\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tsellerId = product!.user_id;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t\t`Respuesta de API vac√≠a o sin data, usando user_id como fallback`\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tsellerId = product!.user_id;\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error(\"Error al obtener seller_id:\", error);\r\n\t\t\t\t\tsellerId = product!.user_id;\r\n\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t`Fallback: usando user_id ${sellerId} como seller_id debido a error`\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error(\r\n\t\t\t\t\t\"No se encontr√≥ informaci√≥n de vendedor en datos del producto:\",\r\n\t\t\t\t\tproduct\r\n\t\t\t\t);\r\n\t\t\t\tthrow new Error(\"No se pudo determinar el vendedor del producto\");\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log(\r\n\t\t\t\t`Iniciando chat con vendedor ID ${sellerId} para producto ${product!.id}`\r\n\t\t\t);\r\n\r\n\t\t\tconst chatId = await createChat(sellerId, Number(id));\r\n\t\t\tif (chatId) {\r\n\t\t\t\tnavigate(`/chats/${chatId}`);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"No se pudo crear el chat con el vendedor\");\r\n\t\t\t}\r\n\t\t} catch (error: any) {\r\n\t\t\tconsole.error(\"Error al iniciar chat con vendedor:\", error);\r\n\t\t\thandleError(error, \"Error al iniciar chat con vendedor. Int√©ntalo de nuevo.\");\r\n\t\t}\r\n\t};\r\n\r\n\t// ‚úÖ FUNCI√ìN COMPARTIR\r\n\tconst handleShareProduct = async () => {\r\n\t\tconst currentUrl = window.location.href;\r\n\t\t\r\n\t\ttry {\r\n\t\t\tawait navigator.clipboard.writeText(currentUrl);\r\n\t\t\thandleSuccess(\"¬°Enlace copiado al portapapeles!\");\r\n\t\t} catch (error: any) {\r\n\t\t\tconsole.error(\"Error al copiar enlace:\", error);\r\n\t\t\thandleError(error, \"No se pudo copiar el enlace\");\r\n\t\t}\r\n\t};\r\n\r\n\r\n\r\n\t// Show loading state\r\n\tif (loading) {\r\n\t\treturn (\r\n\t\t\t<div className=\"container mx-auto flex items-center justify-center py-20\">\r\n\t\t\t\t<div className=\"text-center\">\r\n\t\t\t\t\t<Loader\r\n\t\t\t\t\t\tsize={40}\r\n\t\t\t\t\t\tclassName=\"animate-spin mx-auto mb-4 text-primary-600\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<p className=\"text-gray-600\">Cargando informaci√≥n del producto...</p>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\t// Show error state - SOLO si no est√° cargando\r\n\tif (!loading && (error || !product)) {\r\n\t\tconsole.log(\"‚ùå ProductItemPage: Mostrando error:\", { loading, error, hasProduct: !!product });\r\n\t\treturn (\r\n\t\t\t<div className=\"container mx-auto py-20\">\r\n\t\t\t\t<div className=\"max-w-lg mx-auto bg-white p-8 rounded-xl shadow-md\">\r\n\t\t\t\t\t<h2 className=\"text-2xl font-bold text-red-600 mb-4\">Error</h2>\r\n\t\t\t\t\t<p className=\"text-gray-700 mb-6\">\r\n\t\t\t\t\t\t{error || \"No se encontr√≥ el producto solicitado.\"}\r\n\t\t\t\t\t</p>\r\n\t\t\t\t\t<div className=\"flex gap-3\">\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tonClick={() => navigate(-1)}\r\n\t\t\t\t\t\t\tclassName=\"bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700 transition-colors\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tVolver\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t{id && (\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\tconst productId = parseInt(id);\r\n\t\t\t\t\t\t\t\t\tif (!isNaN(productId)) {\r\n\t\t\t\t\t\t\t\t\t\tconsole.log(\"üîÑ ProductItemPage: Reintentando cargar producto:\", productId);\r\n\t\t\t\t\t\t\t\t\t\tfetchProductById(productId);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\tclassName=\"bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 transition-colors\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tReintentar\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\t// Process product data for display - product is guaranteed to be non-null here\r\n\tconst categories = product!.category ? [product!.category.name] : [];\r\n\tconst availableStock = getAvailableStock(product!);\r\n\t\r\n\t// üîç LOGS DE DEBUG PARA MONITOREO\r\n\tconsole.log(\"üîç ProductItemPage: Estado actual:\", {\r\n\t\tid,\r\n\t\tloading,\r\n\t\terror,\r\n\t\thasProduct: !!product,\r\n\t\tproductId: product?.id,\r\n\t\tproductName: product?.name,\r\n\t\tavailableStock\r\n\t});\r\n\r\n\t// Funci√≥n helper para obtener URL de imagen\r\n\tconst getImageUrlFromProduct = (image: string | ProductImage): string => {\r\n\t\tif (typeof image === \"string\") {\r\n\t\t\treturn getImageUrl(image);\r\n\t\t}\r\n\t\treturn getImageUrl(image.original || image.medium || image.thumbnail);\r\n\t};\r\n\r\n\t// Parse colors, sizes, and tags\r\n\tconst parseStringArrays = (value: any): string[] => {\r\n\t\tif (!value) return [];\r\n\t\tif (Array.isArray(value)) {\r\n\t\t\tif (typeof value[0] === \"string\" && !value[0].startsWith(\"[\")) {\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t\ttry {\r\n\t\t\t\treturn value\r\n\t\t\t\t\t.join(\",\")\r\n\t\t\t\t\t.replace(/\\[|\\]|\"/g, \"\")\r\n\t\t\t\t\t.split(\",\");\r\n\t\t\t} catch (e) {\r\n\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn [];\r\n\t};\r\n\r\n\tconst colors = parseStringArrays(product!.colors);\r\n\tconst sizes = parseStringArrays(product!.sizes);\r\n\tconst tags = parseStringArrays(product!.tags);\r\n\r\n\t// Create specification items from product data\r\n\tconst specifications = [\r\n\t\t{\r\n\t\t\tname: \"Peso\", \r\n\t\t\tvalue: hasValidValue(product!.weight) ? `${product!.weight} kg` : \"N/A\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Dimensiones\",\r\n\t\t\tvalue: product!.dimensions || \r\n\t\t\t\t(hasValidValue(product!.width) && hasValidValue(product!.height) && hasValidValue(product!.depth))\r\n\t\t\t\t\t? `${product!.width} √ó ${product!.height} √ó ${product!.depth} cm`\r\n\t\t\t\t\t: \"N/A\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Disponibilidad\",\r\n\t\t\tvalue: product!.is_in_stock ? `En stock (${availableStock} unidades)` : \"Agotado\",\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"Categor√≠a\", \r\n\t\t\tvalue: product!.category?.name || \"N/A\"\r\n\t\t},\r\n\t];\r\n\r\n\treturn (\r\n\t\t<div className=\"container mx-auto px-4 py-10\">\r\n\t\t\t<div className=\"max-w-7xl mx-auto\">\r\n\t\t\t\t{/* Breadcrumbs */}\r\n\t\t\t\t<nav className=\"flex mb-6 text-sm text-gray-500\">\r\n\t\t\t\t\t<Link to=\"/\" className=\"hover:text-primary-600\">\r\n\t\t\t\t\t\tInicio\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t\t<span className=\"mx-2\">/</span>\r\n\t\t\t\t\t{product!.category ? (\r\n\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\tto={`/category/${product!.category.slug}`}\r\n\t\t\t\t\t\t\t\tclassName=\"hover:text-primary-600\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{product!.category.name}\r\n\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t<span className=\"mx-2\">/</span>\r\n\t\t\t\t\t\t</>\r\n\t\t\t\t\t) : null}\r\n\t\t\t\t\t<span className=\"text-gray-700 font-medium\">{product!.name}</span>\r\n\t\t\t\t</nav>\r\n\r\n\t\t\t\t<div className=\"bg-white rounded-xl shadow-lg overflow-hidden\">\r\n\t\t\t\t\t<div className=\"grid grid-cols-1 lg:grid-cols-2 gap-10 p-6 lg:p-10\">\r\n\t\t\t\t\t\t{/* Product Images */}\r\n\t\t\t\t\t\t<div className=\"space-y-6\">\r\n\t\t\t\t\t\t\t<div className=\"bg-gray-50 rounded-xl overflow-hidden h-96 lg:h-[500px]\">\r\n\t\t\t\t\t\t\t\t{(product!.images && product!.images.length > 0) ? (\r\n\t\t\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\t\t\tsrc={getImageUrlFromProduct(product!.images[activeImage])}\r\n\t\t\t\t\t\t\t\t\t\talt={product!.name}\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-full object-cover transition-all duration-300\"\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t) : null}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t{(product!.images && product!.images.length > 1) ? (\r\n\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-4 gap-3\">\r\n\t\t\t\t\t\t\t\t\t{product!.images.map((image, index) => (\r\n\t\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\t\t\t\tclassName={`bg-gray-50 rounded-lg h-24 cursor-pointer border-2 transition-all overflow-hidden ${\r\n\t\t\t\t\t\t\t\t\t\t\t\tindex === activeImage\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"border-primary-500 shadow-md\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"border-transparent hover:border-gray-300\"\r\n\t\t\t\t\t\t\t\t\t\t\t}`}\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => setActiveImage(index)}\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\t\t\t\t\tsrc={getImageUrlFromProduct(image)}\r\n\t\t\t\t\t\t\t\t\t\t\t\talt={`${product!.name} thumbnail ${index + 1}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-full object-cover\"\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) : null}\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t{/* Product Info */}\r\n\t\t\t\t\t\t<div className=\"space-y-6\">\r\n\t\t\t\t\t\t\t{/* Seller Info */}\r\n\t\t\t\t\t\t\t{(product!.seller && product!.seller.name) ? (\r\n\t\t\t\t\t\t\t\t<div className=\"flex items-center mb-2\">\r\n\t\t\t\t\t\t\t\t\t<span className=\"text-sm bg-primary-50 text-primary-700 px-2 py-0.5 rounded font-medium\">\r\n\t\t\t\t\t\t\t\t\t\t{product!.seller.name}\r\n\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) : null}\r\n\r\n\t\t\t\t\t\t\t{/* Title */}\r\n\t\t\t\t\t\t\t<h1 className=\"text-3xl font-bold text-gray-900\">\r\n\t\t\t\t\t\t\t\t{product!.name}\r\n\t\t\t\t\t\t\t</h1>\r\n\r\n\t\t\t\t\t\t\t{/* ‚úÖ INFORMACI√ìN DE STOCK PROMINENTE */}\r\n\t\t\t\t\t\t\t<div className=\"flex items-center space-x-3\">\r\n\t\t\t\t\t\t\t\t{product!.is_in_stock ? (\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"w-3 h-3 bg-green-500 rounded-full mr-2\"></div>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-green-700 font-medium\">\r\n\t\t\t\t\t\t\t\t\t\t\tEn stock ({availableStock} disponibles)\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center\">\r\n\t\t\t\t\t\t\t\t\t\t<AlertTriangle size={16} className=\"text-red-500 mr-2\" />\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-red-600 font-medium\">Agotado</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t{/* Rating */}\r\n\t\t\t\t\t\t\t{(product!.rating && \r\n\t\t\t\t\t\t\t  typeof product!.rating === 'number' && \r\n\t\t\t\t\t\t\t  product!.rating > 0) ? (\r\n\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-3\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center\">\r\n\t\t\t\t\t\t\t\t\t\t<RatingStars rating={product!.rating} size={18} showValue={true} />\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-gray-500 text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\r\n\t\t\t\t\t\t\t\t\t\t\t{displayRatingCount(product!.rating_count)}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) : null}\r\n\r\n\t\t\t\t\t\t\t{/* ‚úÖ SECCI√ìN DE PRECIOS CON DESCUENTOS POR VOLUMEN ACTUALIZADOS */}\r\n\t\t\t\t\t\t\t<div className=\"space-y-3\">\r\n\t\t\t\t\t\t\t\t{/* Precio principal */}\r\n\t\t\t\t\t\t\t\t<div className=\"price-container\">\r\n\t\t\t\t\t\t\t\t\t<span className=\"text-3xl font-bold text-primary-700\">\r\n\t\t\t\t\t\t\t\t\t\t${finalPrice.toFixed(2)}\r\n\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t{hasAnyDiscount && (\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"ml-3 text-lg text-gray-500 line-through\">\r\n\t\t\t\t\t\t\t\t\t\t\t${originalPrice.toFixed(2)}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t{hasSellerDiscount && product && (\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"ml-2 px-2 py-1 bg-green-100 text-green-800 text-sm font-medium rounded\">\r\n\t\t\t\t\t\t\t\t\t\t\t{product.discount_percentage}% OFF\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t{hasVolumeDiscount && (\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded\">\r\n\t\t\t\t\t\t\t\t\t\t\t+{discountResult?.discountPercentage}% Volumen\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t{/* ‚úÖ MOSTRAR AHORROS ACTUALES */}\r\n\t\t\t\t\t\t\t\t{hasVolumeDiscount && totalSavings > 0 && (\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center text-green-600\">\r\n\t\t\t\t\t\t\t\t\t\t<Gift size={16} className=\"mr-1\" />\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\r\n\t\t\t\t\t\t\t\t\t\t\t¬°Ahorras ${totalSavings.toFixed(2)} con descuento por volumen!\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t{/* ‚úÖ MOSTRAR INFORMACI√ìN DE DESCUENTOS DISPONIBLES */}\r\n\t\t\t\t\t\t\t{discountInfo.enabled && discountInfo.tiers.length > 0 && (\r\n\t\t\t\t\t\t\t\t<div className=\"bg-gradient-to-r from-blue-50 to-green-50 border border-blue-200 rounded-lg p-4\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-start\">\r\n\t\t\t\t\t\t\t\t\t\t<TrendingDown size={20} className=\"text-blue-600 mr-2 mt-0.5\" />\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t<h4 className=\"text-sm font-medium text-blue-900 mb-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t¬°Descuentos por volumen disponibles!\r\n\t\t\t\t\t\t\t\t\t\t\t</h4>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"space-y-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t{discountInfo.tiers.map((tier, index) => (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div key={index} className=\"flex items-center justify-between text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className={`${\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tquantity >= tier.quantity \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"text-green-700 font-medium\" \r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-blue-800\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tier.quantity}+ unidades = {tier.discount}% descuento\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{quantity >= tier.quantity && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-green-600 text-xs font-medium\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t‚úì Aplicado\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t{/* ‚úÖ MOSTRAR PR√ìXIMO DESCUENTO DISPONIBLE */}\r\n\t\t\t\t\t\t\t\t\t\t\t{discountResult?.nextTier && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"mt-2 pt-2 border-t border-blue-200\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-blue-600\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t¬°A√±ade {discountResult.itemsNeededForNext} m√°s y obt√©n {discountResult.nextTier.discount}% de descuento!\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t{/* Color Selection */}\r\n\t\t\t\t\t\t\t{colors.length > 0 ? (\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<h3 className=\"font-medium text-gray-900 mb-3\">Color:</h3>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex space-x-3\">\r\n\t\t\t\t\t\t\t\t\t\t{colors.map((color, index) => (\r\n\t\t\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-3 py-1 border border-gray-300 rounded-full cursor-pointer hover:border-primary-500\"\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle={color}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{color}\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) : null}\r\n\r\n\t\t\t\t\t\t\t{/* Size Selection */}\r\n\t\t\t\t\t\t\t{sizes.length > 0 ? (\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<h3 className=\"font-medium text-gray-900 mb-3\">Tama√±o:</h3>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex space-x-3\">\r\n\t\t\t\t\t\t\t\t\t\t{sizes.map((size, index) => (\r\n\t\t\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-3 py-1 border border-gray-300 rounded-full cursor-pointer hover:border-primary-500\"\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle={size}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{size}\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) : null}\r\n\r\n\t\t\t\t\t\t\t{/* ‚úÖ CANTIDAD Y PRECIO TOTAL CON VALIDACI√ìN DE STOCK */}\r\n\t\t\t\t\t\t\t<div className=\"space-y-4\">\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<h3 className=\"font-medium text-gray-900 mb-3\">Cantidad:</h3>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center space-x-4\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex border border-gray-300 rounded-lg overflow-hidden h-12\">\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-4 bg-gray-50 text-gray-600 hover:bg-gray-100 flex items-center justify-center disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleQuantityChange(quantity - 1)}\r\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={quantity <= 1}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Minus size={18} />\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-20 text-center border-x border-gray-300 text-gray-700 font-medium focus:outline-none\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tmin=\"1\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tmax={Math.min(availableStock, 50)}\r\n\t\t\t\t\t\t\t\t\t\t\t\tvalue={quantity}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={(e) =>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\thandleQuantityChange(parseInt(e.target.value) || 1)\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-4 bg-gray-50 text-gray-600 hover:bg-gray-100 flex items-center justify-center disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleQuantityChange(quantity + 1)}\r\n\t\t\t\t\t\t\t\t\t\t\t\tdisabled={quantity >= Math.min(availableStock, 50)}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Plus size={18} />\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t{/* ‚úÖ MOSTRAR PRECIO TOTAL EN TIEMPO REAL */}\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-lg\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-600\">Total: </span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-bold text-primary-700\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t${(finalPrice * quantity).toFixed(2)}\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t{hasVolumeDiscount && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm text-green-600\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t(Ahorras ${totalSavings.toFixed(2)})\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t{/* ‚úÖ MOSTRAR L√çMITE DE STOCK */}\r\n\t\t\t\t\t\t\t\t\t{availableStock < 10 && availableStock > 0 && (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"mt-2 text-sm text-amber-600 flex items-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t<AlertTriangle size={14} className=\"mr-1\" />\r\n\t\t\t\t\t\t\t\t\t\t\t¬°Solo quedan {availableStock} unidades disponibles!\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t{/* ‚úÖ BOTONES DE ACCI√ìN */}\r\n\t\t\t\t\t\t\t\t<div className=\"flex flex-col sm:flex-row gap-4\">\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex-grow h-12 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors duration-200 flex items-center justify-center disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={handleAddToCart}\r\n\t\t\t\t\t\t\t\t\t\tdisabled={!product!.is_in_stock || isUpdating || availableStock === 0}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<ShoppingCart size={20} className=\"mr-2\" />\r\n\t\t\t\t\t\t\t\t\t\t{isUpdating ? \"Agregando...\" : product!.is_in_stock && availableStock > 0\r\n\t\t\t\t\t\t\t\t\t\t\t? `A√±adir al Carrito - $${(finalPrice * quantity).toFixed(2)}`\r\n\t\t\t\t\t\t\t\t\t\t\t: \"Producto Agotado\"}\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-12 w-12 border border-gray-300 rounded-lg flex items-center justify-center text-gray-600 hover:text-primary-600 hover:border-primary-600 transition-colors duration-200 disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={handleAddToWishlist}\r\n\t\t\t\t\t\t\t\t\t\tdisabled={isUpdating}\r\n\t\t\t\t\t\t\t\t\t\ttitle=\"A√±adir a favoritos\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<Heart size={20} />\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"h-12 px-4 border border-gray-300 rounded-lg flex items-center justify-center text-gray-600 hover:text-primary-600 hover:border-primary-600 transition-colors duration-200\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={handleChatWithSeller}\r\n\t\t\t\t\t\t\t\t\t\ttitle=\"Chatear con el vendedor\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<MessageSquare size={20} className=\"mr-2\" />\r\n\t\t\t\t\t\t\t\t\t\tContactar\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t{/* Delivery and Benefits */}\r\n\t\t\t\t\t\t\t<div className=\"bg-gray-50 rounded-xl p-5 space-y-4\">\r\n\t\t\t\t\t\t\t\t<div className=\"flex items-start\">\r\n\t\t\t\t\t\t\t\t\t<Truck\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"text-primary-600 mt-1 flex-shrink-0 mr-3\"\r\n\t\t\t\t\t\t\t\t\t\tsize={20}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<h4 className=\"font-medium text-gray-900\">\r\n\t\t\t\t\t\t\t\t\t\t\tEntrega r√°pida\r\n\t\t\t\t\t\t\t\t\t\t</h4>\r\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-gray-600\">\r\n\t\t\t\t\t\t\t\t\t\t\t{product!.is_in_stock ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tDisponible para entrega en{\" \"}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">1-3 d√≠as h√°biles</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\"Producto agotado temporalmente\"\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"flex items-start\">\r\n\t\t\t\t\t\t\t\t\t<Shield\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"text-primary-600 mt-1 flex-shrink-0 mr-3\"\r\n\t\t\t\t\t\t\t\t\t\tsize={20}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<h4 className=\"font-medium text-gray-900\">\r\n\t\t\t\t\t\t\t\t\t\t\tGarant√≠a de 1 a√±o\r\n\t\t\t\t\t\t\t\t\t\t</h4>\r\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-gray-600\">\r\n\t\t\t\t\t\t\t\t\t\t\tGarant√≠a del fabricante contra defectos\r\n\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"flex items-start\">\r\n\t\t\t\t\t\t\t\t\t<RotateCcw\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"text-primary-600 mt-1 flex-shrink-0 mr-3\"\r\n\t\t\t\t\t\t\t\t\t\tsize={20}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<h4 className=\"font-medium text-gray-900\">\r\n\t\t\t\t\t\t\t\t\t\t\tDevoluci√≥n gratuita\r\n\t\t\t\t\t\t\t\t\t\t</h4>\r\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-gray-600\">\r\n\t\t\t\t\t\t\t\t\t\t\tDevoluci√≥n sin costo en los primeros 30 d√≠as\r\n\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t{/* Categories */}\r\n\t\t\t\t\t\t\t{(categories.length > 0 || tags.length > 0) ? (\r\n\t\t\t\t\t\t\t\t<div className=\"pt-4 border-t border-gray-200\">\r\n\t\t\t\t\t\t\t\t\t{categories.length > 0 ? (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center mb-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-600 mr-2\">Categor√≠as:</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t{categories.map((category, index) => (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tto={`/category/${product!.category?.slug || \"\"}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"bg-gray-100 hover:bg-gray-200 px-3 py-1 text-sm rounded-full text-gray-700 transition-colors\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{category}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t) : null}\r\n\r\n\t\t\t\t\t\t\t\t\t{tags.length > 0 ? (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-600 mr-2\">Etiquetas:</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t{tags.map((tag, index) => (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tto={`/tags/${tag}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"bg-gray-100 hover:bg-gray-200 px-3 py-1 text-sm rounded-full text-gray-700 transition-colors\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{tag}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t) : null}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t) : null}\r\n\r\n\t\t\t\t\t\t\t{/* Share */}\r\n\t\t\t\t\t\t\t<button \r\n\t\t\t\t\t\t\t\tonClick={handleShareProduct}\r\n\t\t\t\t\t\t\t\tclassName=\"flex items-center text-gray-500 text-sm hover:text-primary-600 transition-colors cursor-pointer\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<Share2 size={16} className=\"mr-2\" />\r\n\t\t\t\t\t\t\t\t<span>Compartir este producto</span>\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Tabs */}\r\n\t\t\t\t\t<div className=\"border-t border-gray-200\">\r\n\t\t\t\t\t\t<div className=\"flex border-b border-gray-200\">\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tclassName={`py-4 px-6 font-medium text-sm ${\r\n\t\t\t\t\t\t\t\t\tactiveTab === \"description\"\r\n\t\t\t\t\t\t\t\t\t\t? \"text-primary-600 border-b-2 border-primary-600\"\r\n\t\t\t\t\t\t\t\t\t\t: \"text-gray-500 hover:text-gray-700\"\r\n\t\t\t\t\t\t\t\t}`}\r\n\t\t\t\t\t\t\t\tonClick={() => setActiveTab(\"description\")}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tDescripci√≥n\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tclassName={`py-4 px-6 font-medium text-sm ${\r\n\t\t\t\t\t\t\t\t\tactiveTab === \"specifications\"\r\n\t\t\t\t\t\t\t\t\t\t? \"text-primary-600 border-b-2 border-primary-600\"\r\n\t\t\t\t\t\t\t\t\t\t: \"text-gray-500 hover:text-gray-700\"\r\n\t\t\t\t\t\t\t\t}`}\r\n\t\t\t\t\t\t\t\tonClick={() => setActiveTab(\"specifications\")}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tEspecificaciones\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tclassName={`py-4 px-6 font-medium text-sm ${\r\n\t\t\t\t\t\t\t\t\tactiveTab === \"reviews\"\r\n\t\t\t\t\t\t\t\t\t\t? \"text-primary-600 border-b-2 border-primary-600\"\r\n\t\t\t\t\t\t\t\t\t\t: \"text-gray-500 hover:text-gray-700\"\r\n\t\t\t\t\t\t\t\t}`}\r\n\t\t\t\t\t\t\t\tonClick={() => setActiveTab(\"reviews\")}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tValoraciones\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div className=\"flex justify-center p-6 lg:p-10\">\r\n\t\t\t\t\t\t\t{activeTab === \"description\" && (\r\n\t\t\t\t\t\t\t\t<div className=\"max-w-3xl space-y-6\">\r\n\t\t\t\t\t\t\t\t\t{product!.short_description ? (\r\n\t\t\t\t\t\t\t\t\t\t<p className=\"font-medium text-lg text-gray-800\">\r\n\t\t\t\t\t\t\t\t\t\t\t{product!.short_description}\r\n\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t) : null}\r\n\t\t\t\t\t\t\t\t\t<p className=\"text-gray-700 leading-relaxed\">\r\n\t\t\t\t\t\t\t\t\t\t{product!.description}\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t{activeTab === \"specifications\" && (\r\n\t\t\t\t\t\t\t\t<div className=\"max-w-3xl\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-1 sm:grid-cols-2 gap-y-4 gap-x-8\">\r\n\t\t\t\t\t\t\t\t\t\t{specifications.map((spec, index) => (\r\n\t\t\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex border-b border-gray-100 pb-3\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"w-40 font-medium text-gray-700\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{spec.name}:\r\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-600\">{spec.value}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t{activeTab === \"reviews\" && (\r\n\t\t\t\t\t\t\t<ProductReviews \r\n\t\t\t\t\t\t\tproductId={product!.id || 0} \r\n\t\t\t\t\t\t\trating={product!.rating || 0} \r\n\t\t\t\t\t\t\tratingCount={product!.rating_count || product!.ratingCount || 0} \r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t{/* Related Products */}\r\n\t\t\t\t{(product!.related_products && product!.related_products.length > 0) ? (\r\n\t\t\t\t\t<div className=\"mt-16\">\r\n\t\t\t\t\t\t<h2 className=\"text-2xl font-bold mb-8\">Productos relacionados</h2>\r\n\t\t\t\t\t\t<div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6\">\r\n\t\t\t\t\t\t\t{product!.related_products.map((relatedProduct) => (\r\n\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\tkey={relatedProduct.id}\r\n\t\t\t\t\t\t\t\t\tclassName=\"bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<div className=\"h-52 bg-gray-50 flex items-center justify-center p-4\">\r\n\t\t\t\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\t\t\t\tsrc={getImageUrl(\r\n\t\t\t\t\t\t\t\t\t\t\t\trelatedProduct.images &&\r\n\t\t\t\t\t\t\t\t\t\t\t\t\trelatedProduct.images.length > 0\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t? typeof relatedProduct.images[0] === \"string\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? relatedProduct.images[0]\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: (relatedProduct.images[0] as ProductImage)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.original ||\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(relatedProduct.images[0] as ProductImage).medium\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t: null\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\talt={relatedProduct.name}\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"max-h-full max-w-full object-contain\"\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"p-5\">\r\n\t\t\t\t\t\t\t\t\t\t{(relatedProduct.rating && \r\n\t\t\t\t\t\t\t\t\t\ttypeof relatedProduct.rating === 'number' && \r\n\t\t\t\t\t\t\t\t\t\trelatedProduct.rating > 0) ? (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center mb-2\">\r\n\t\t\t\t\t\t\t\t\t\t<RatingStars \r\n\t\t\t\t\t\t\t\t\t\t rating={relatedProduct.rating} \r\n\t\t\t\t\t\t\t\t\t\tsize={14} \r\n\t\t\t\t\t\t\t\t\t\t showValue={true} \r\n\t\t\t\t\t\t\t\t\t\t />\r\n\t\t\t\t\t\t\t\t\t\t </div>\r\n\t\t\t\t\t\t\t\t\t) : null}\r\n\t\t\t\t\t\t\t\t\t\t<Link to={`/product/${relatedProduct.id}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t<h3 className=\"font-medium text-gray-800 mb-2 hover:text-primary-600 transition-colors line-clamp-2 h-12\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t{relatedProduct.name}\r\n\t\t\t\t\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-primary-600 font-bold\">\r\n\t\t\t\t\t\t\t\t\t\t\t$\r\n\t\t\t\t\t\t\t\t\t\t\t{(relatedProduct.final_price && \r\n\t\t\t\t\t\t\t\t\t\t\t  typeof relatedProduct.final_price === 'number' && \r\n\t\t\t\t\t\t\t\t\t\t\t  relatedProduct.final_price > 0)\r\n\t\t\t\t\t\t\t\t\t\t\t\t? relatedProduct.final_price.toFixed(2)\r\n\t\t\t\t\t\t\t\t\t\t\t\t: relatedProduct.price.toFixed(2)}\r\n\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\t\t\t\tto={`/product/${relatedProduct.id}`}\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"block w-full mt-3\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<button className=\"w-full bg-gray-100 hover:bg-gray-200 text-gray-800 py-2 rounded-lg font-medium text-sm transition-colors\">\r\n\t\t\t\t\t\t\t\t\t\t\t\tVer detalles\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t) : null}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default ProductItemPage;"],"names":["ProductReviews","productId","rating","ratingCount","reviews","setReviews","useState","currentPage","setCurrentPage","totalPages","setTotalPages","isLoading","setIsLoading","error","setError","hasNoReviews","setHasNoReviews","isLoadingRef","useRef","abortControllerRef","getProductRatings","useRatings","loadReviews","page","response","totalItems","useEffect","renderStars","jsx","star","Star","formatDate","dateString","jsxs","AlertCircle","review","index","User","prev","ProductItemPage","id","useParams","navigate","useNavigate","product","loading","fetchProductById","trackProductView","clearCurrentProduct","useProducts","activeImage","setActiveImage","activeTab","setActiveTab","isUpdating","setIsUpdating","addToCart","showNotification","useCart","toggleFavorite","checkIsFavorite","useFavorites","createChat","useChat","handleError","handleSuccess","handleStockError","useErrorHandler","optimisticCartAdd","optimisticFavoriteAdd","optimisticFavoriteRemove","useInvalidateCounters","quantity","setQuantity","tiers","getDiscountForQuantity","useVolumeDiscounts","applicableDiscount","hasVolumeDiscount","basePrice","volumeDiscountedPrice","finalPrice","originalPrice","hasSellerDiscount","hasAnyDiscount","totalSavings","nextTier","a","b","tier","itemsNeededForNext","discountResult","discountInfo","getAvailableStock","isStockAvailable","requestedQuantity","hasValidValue","value","displayRatingCount","count","invalidateRelatedPages","CacheService","productData","err","handleQuantityChange","newQuantity","availableStock","NotificationType","handleAddToCart","message","handleAddToWishlist","result","handleChatWithSeller","sellerId","ApiClient","chatId","handleShareProduct","currentUrl","Loader","categories","getImageUrlFromProduct","image","getImageUrl","parseStringArrays","colors","sizes","tags","specifications","Link","Fragment","AlertTriangle","RatingStars","Gift","TrendingDown","color","size","Minus","e","Plus","ShoppingCart","Heart","MessageSquare","Truck","Shield","RotateCcw","category","tag","Share2","spec","relatedProduct"],"mappings":"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"}