const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/seller-chunk-CL4v7LiS.js","assets/ui-vendor-DEBjJ4HS.js","assets/react-vendor-Cy458wKG.js","assets/admin-chunk-C7Ad4l4I.js","assets/utils-vendor-DeGC_a19.js"])))=>i.map(i=>d[i]);
import{_ as j}from"./index-DKar4B-a.js";import{j as r}from"./ui-vendor-DEBjJ4HS.js";import{j as v,u as P,r as x}from"./react-vendor-Cy458wKG.js";import{u as N}from"./chat-chunk-dxmpBB-S.js";import{L as _}from"./seller-chunk-CL4v7LiS.js";import{b}from"./admin-chunk-C7Ad4l4I.js";import"./checkout-chunk-BfPZCzS8.js";import"./utils-vendor-DeGC_a19.js";const C=()=>{const[n]=v(),d=P(),{setUser:m,setIsAuthenticated:f,refreshRoleInfo:h}=N(),[i,t]=x.useState({isProcessing:!0,status:"Procesando autenticación...",error:null});return x.useEffect(()=>{(async()=>{try{console.log("🔄 Procesando Google Auth Success..."),console.log("📊 URL completa:",window.location.href),console.log("📊 Parámetros:",Object.fromEntries(n.entries())),t(e=>({...e,status:"Obteniendo datos de autenticación..."}));const a=n.get("token"),c=n.get("user"),y=n.get("expires_in"),u=n.get("error");if(console.log("🔍 Parámetros obtenidos:",{hasToken:!!a,hasUserData:!!c,tokenLength:a?.length,expiresIn:y,error:u}),u){const e=decodeURIComponent(u);console.error("❌ Error en autenticación:",e),t(o=>({...o,isProcessing:!1,error:e}));return}if(!a||!c){const e=[];a||e.push("token"),c||e.push("userData");const o=`Datos de autenticación incompletos: ${e.join(", ")}`;console.error("❌",o),t(g=>({...g,isProcessing:!1,error:o}));return}t(e=>({...e,status:"Verificando token de acceso..."}));let l;try{const e=atob(c);l=JSON.parse(e),console.log("✅ Datos del usuario decodificados:",l)}catch(e){console.error("❌ Error decodificando datos del usuario:",e),t(o=>({...o,isProcessing:!1,error:"Error al procesar datos del usuario"}));return}t(e=>({...e,status:"Guardando información de sesión..."}));const p=new _;p.setItem(b.storage.authTokenKey,a),p.setItem(b.storage.userKey,l),console.log("✅ Token y datos guardados en localStorage"),console.log("🔑 Token guardado:",a.substring(0,50)+"..."),console.log("👤 Usuario guardado:",l),m(l),f(!0),t(e=>({...e,status:"Obteniendo información de roles..."}));let s="/";try{await h();const o=await(await j(async()=>{const{default:g}=await import("./seller-chunk-CL4v7LiS.js").then(w=>w.e);return{default:g}},__vite__mapDeps([0,1,2,3,4]))).default.checkUserRole(!0);console.log("🎯 Información de rol obtenida:",o),o&&o.success?o.data.is_admin?(s="/admin/dashboard",console.log("👑 Usuario es admin, redirigiendo a:",s)):o.data.is_seller?(s="/seller/dashboard",console.log("🏪 Usuario es seller, redirigiendo a:",s)):o.data.is_payment_user?(s="/payment/dashboard",console.log("💳 Usuario es payment, redirigiendo a:",s)):(s="/",console.log("👤 Usuario normal, redirigiendo a:",s)):(console.log("🔄 Sin rol específico, redirigiendo a home"),s="/")}catch(e){console.warn("⚠️ No se pudo obtener información de rol:",e),s="/"}t(e=>({...e,status:"Completando autenticación..."})),window.history.replaceState({},document.title,window.location.pathname),t(e=>({...e,status:"¡Autenticación exitosa! Redirigiendo..."})),setTimeout(()=>{console.log("🚀 Redirigiendo a:",s),d(s,{replace:!0})},1500)}catch(a){console.error("❌ Error crítico procesando Google Auth Success:",a),t(c=>({...c,isProcessing:!1,error:"Error al procesar la autenticación con Google"}))}})()},[n,d,m,f,h]),i.error?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center",children:[r.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"❌"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Error en la autenticación"}),r.jsx("p",{className:"text-gray-600 mb-6",children:i.error}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("button",{onClick:()=>d("/login"),className:"w-full py-3 px-4 border border-transparent rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Volver al inicio de sesión"}),r.jsx("button",{onClick:()=>d("/register"),className:"w-full py-3 px-4 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Crear cuenta nueva"})]})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center",children:[r.jsx("div",{className:"text-green-500 text-6xl mb-4",children:i.isProcessing?"...":"🎉"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:i.isProcessing?"Procesando autenticación...":"¡Bienvenido!"}),r.jsx("p",{className:"text-gray-600 mb-6",children:i.status}),i.isProcessing&&r.jsx("div",{className:"flex justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-600"})}),!1]})})};export{C as default};
//# sourceMappingURL=GoogleAuthSuccessPage-KAldXYfT.js.map
