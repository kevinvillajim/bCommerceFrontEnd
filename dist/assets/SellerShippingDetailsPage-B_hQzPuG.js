import{j as e,X as I,a6 as A,P as f,J as w,a7 as M,a_ as T,R as U,al as H,K as O,ao as p,e as V,T as q,aZ as F}from"./ui-vendor-DEBjJ4HS.js";import{d as J,u as K,r,L as X}from"./react-vendor-Cy458wKG.js";import{f as Z}from"./admin-chunk-C7Ad4l4I.js";import{S as B}from"./ShippingServiceAdapter-SShxCogr.js";const ee=()=>{const{orderId:l}=J(),S=K(),[s,k]=r.useState(null),[g,c]=r.useState([]),[j,$]=r.useState([]),[E,N]=r.useState(!0),[b,y]=r.useState(null),[i,C]=r.useState(!1),[D,o]=r.useState(null),[z,v]=r.useState(""),x=new B;r.useEffect(()=>{if(!l){console.error("No se proporcionó orderId en la URL"),y("ID de envío no válido"),N(!1);return}console.log(`Iniciando carga de detalles para orderId: ${l}`),m()},[l]);const m=async()=>{N(!0),y(null);try{console.log(`Cargando detalles del envío ${l}`);const t=await x.getShippingDetails(l||"");if(!t)throw new Error("No se pudo obtener la información del envío");if(console.log("Detalles del envío obtenidos:",t),k(t),t.trackingNumber)try{const a=await x.getShippingHistory(t.trackingNumber);c(a);try{const d=await x.getShippingRoute(t.trackingNumber);$(d)}catch(d){console.warn("No se pudo obtener la ruta del envío:",d)}}catch(a){console.warn("No se pudo obtener historial de envío:",a),c([{date:new Date().toISOString(),status:t.status,description:`Estado actual: ${n(t.status)}`}])}else c([{date:new Date().toISOString(),status:t.status,description:`Estado actual: ${n(t.status)}`}])}catch(t){console.error("Error al cargar detalles del envío:",t),y("No se pudo cargar la información del envío. Intenta de nuevo más tarde.")}finally{N(!1)}},h=async t=>{if(s){C(!0),o(null),v("");try{if(console.log(`Actualizando estado del envío ${s.id} a ${t}`),await x.updateShippingStatus(s.id,t)){o(!0),v(`Estado actualizado a ${n(t)}`),k(u=>u?{...u,status:t}:null);const d={date:new Date().toISOString(),status:t,description:`Actualización de estado a: ${n(t)}`};c(u=>[d,...u]),setTimeout(()=>{m(),o(null)},3e3)}else throw new Error("No se pudo actualizar el estado")}catch(a){console.error(`Error al actualizar estado a ${t}:`,a),o(!1),v("Error al actualizar estado. Intenta de nuevo.")}finally{C(!1)}}},P=()=>{!s||!s.trackingNumber||alert(`Imprimiendo etiqueta para envío ${s.trackingNumber}`)},n=t=>{switch(t){case"pending":return"Pendiente";case"ready_to_ship":return"Listo para enviar";case"shipped":return"Enviado";case"in_transit":return"En tránsito";case"delivered":return"Entregado";case"failed":return"Fallido";case"returned":return"Devuelto";default:return"Desconocido"}},L=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-800";case"ready_to_ship":return"bg-blue-100 text-blue-800";case"shipped":return"bg-purple-100 text-purple-800";case"in_transit":return"bg-indigo-100 text-indigo-800";case"delivered":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"returned":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},R=t=>{switch(t){case"pending":return e.jsx(f,{className:"h-5 w-5 text-yellow-600"});case"ready_to_ship":return e.jsx(f,{className:"h-5 w-5 text-blue-600"});case"shipped":return e.jsx(w,{className:"h-5 w-5 text-purple-600"});case"in_transit":return e.jsx(w,{className:"h-5 w-5 text-indigo-600"});case"delivered":return e.jsx(F,{className:"h-5 w-5 text-green-600"});case"failed":return e.jsx(q,{className:"h-5 w-5 text-red-600"});case"returned":return e.jsx(p,{className:"h-5 w-5 text-orange-600"});default:return e.jsx(V,{className:"h-5 w-5 text-gray-500"})}},_=t=>{try{return new Date(t).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return t}};return console.log("SellerShippingDetailsPage - Estados:",{orderId:l,loading:E,error:b,hasShipping:!!s,shippingStatus:s?.status,historyCount:g.length}),E?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"}),e.jsxs("p",{className:"mt-4 text-gray-700",children:["Cargando detalles del envío para orden ",l,"..."]})]}):b||!s?e.jsx("div",{className:"bg-white rounded-lg shadow p-6 max-w-4xl mx-auto my-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-5xl mb-4",children:e.jsx(I,{className:"h-16 w-16 mx-auto"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Error al cargar el envío"}),e.jsx("p",{className:"text-gray-600 mb-6",children:b||"No se pudo encontrar el envío solicitado"}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:()=>S(-1),className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Volver"}),e.jsx("button",{onClick:m,className:"bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Reintentar"})]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>S(-1),className:"flex items-center text-gray-600 hover:text-primary-600 mb-2",children:[e.jsx(A,{size:16,className:"mr-1"}),e.jsx("span",{children:"Volver a envíos"})]}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Envío para Pedido #",s.orderNumber]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.status==="pending"&&e.jsxs("button",{onClick:()=>h("ready_to_ship"),disabled:i,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(f,{size:18}),e.jsx("span",{children:"Preparar envío"})]}),s.status==="ready_to_ship"&&s.trackingNumber&&e.jsxs("button",{onClick:()=>h("shipped"),disabled:i,className:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(w,{size:18}),e.jsx("span",{children:"Marcar como enviado"})]}),(s.status==="in_transit"||s.status==="shipped")&&e.jsxs("button",{onClick:()=>h("delivered"),disabled:i,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(M,{size:18}),e.jsx("span",{children:"Marcar como entregado"})]}),(s.status==="ready_to_ship"||s.status==="in_transit"||s.status==="shipped")&&e.jsxs("button",{onClick:()=>h("failed"),disabled:i,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(I,{size:18}),e.jsx("span",{children:"Marcar como fallido"})]}),s.trackingNumber&&e.jsxs("button",{onClick:P,disabled:i,className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(T,{size:18}),e.jsx("span",{children:"Imprimir etiqueta"})]}),e.jsxs("button",{onClick:m,disabled:i,className:"bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(U,{size:18,className:i?"animate-spin":""}),e.jsx("span",{children:"Actualizar"})]})]})]}),D===!0&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:z})}),D===!1&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:z})}),i&&e.jsx("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative",role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin mr-2 h-4 w-4 border-t-2 border-blue-500"}),e.jsx("span",{className:"block sm:inline",children:"Actualizando estado..."})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"col-span-3 md:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Estado del envío"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Estado:"}),e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium ${L(s.status)}`,children:n(s.status)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Transportista:"}),e.jsx("span",{className:"text-gray-900",children:s.carrier||"No asignado"})]}),s.trackingNumber&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Nº Seguimiento:"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-900 font-mono",children:s.trackingNumber}),s.carrier&&e.jsx("button",{className:"ml-2 text-blue-600 hover:text-blue-800",title:`Rastrear con ${s.carrier}`,onClick:()=>{alert(`Redirigiendo al sitio de ${s.carrier} para rastrear ${s.trackingNumber}`)},children:e.jsx(H,{size:14})})]})]}),s.estimatedDelivery&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Entrega estimada:"}),e.jsx("span",{className:"text-gray-900",children:new Date(s.estimatedDelivery).toLocaleDateString("es-ES")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Fecha de pedido:"}),e.jsx("span",{className:"text-gray-900",children:new Date(s.date).toLocaleDateString("es-ES")})]}),s.lastUpdate&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Última actualización:"}),e.jsx("span",{className:"text-gray-900",children:_(s.lastUpdate)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Cliente"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Nombre:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:s.customer.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Email:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:s.customer.email})]}),s.customer.phone&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Teléfono:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:s.customer.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Dirección de envío:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:s.shippingAddress||"No disponible"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Pedido"}),e.jsx(X,{to:`/seller/orders/${s.orderId}`,className:"text-sm text-primary-600 hover:underline",children:"Ver detalles"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Número de pedido:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:s.orderNumber})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Método de envío:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:s.shippingMethod||"Estándar"})]}),s.weight&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Peso:"}),e.jsxs("div",{className:"mt-1 text-gray-900",children:[s.weight," kg"]})]}),s.shippingCost!==void 0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Coste de envío:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:Z(s.shippingCost)})]})]})]})]}),e.jsxs("div",{className:"col-span-3 md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Historial de envío"}),g.length===0?e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-gray-500",children:"No hay historial disponible para este envío."})}):e.jsx("div",{className:"relative",children:e.jsx("ul",{className:"space-y-6",children:g.map((t,a)=>e.jsx("li",{className:"relative",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center justify-center h-9 w-9 rounded-full bg-white border-2 border-primary-500 z-10",children:R(t.status)}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900",children:n(t.status)}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500 flex items-center",children:[e.jsx(O,{size:14,className:"mr-1"}),_(t.date)]})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:t.description}),t.location&&e.jsxs("p",{className:"mt-1 text-xs text-gray-500 flex items-center",children:[e.jsx(p,{size:12,className:"mr-1"}),t.location]})]})]})},a))})})]}),j.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Ruta de envío"}),e.jsx("div",{className:"h-64 bg-gray-100 rounded-lg overflow-hidden flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(p,{size:32,className:"mx-auto mb-2 text-primary-500"}),e.jsx("p",{className:"text-gray-600",children:"Mapa de seguimiento disponible"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[j.length," puntos de seguimiento disponibles"]})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-2",children:"Puntos de seguimiento:"}),e.jsx("ul",{className:"space-y-2",children:j.map((t,a)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(p,{size:16,className:"mt-0.5 mr-2 text-primary-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.location}),e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:new Date(t.date).toLocaleDateString("es-ES")})]}),e.jsx("p",{className:"text-xs text-gray-600",children:n(t.status)})]})]},a))})]})]})]})]})]})};export{ee as default};
//# sourceMappingURL=SellerShippingDetailsPage-B_hQzPuG.js.map
