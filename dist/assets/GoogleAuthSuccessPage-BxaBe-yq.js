const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/seller-chunk-6swISJwY.js","assets/ui-vendor-BUNMIuFe.js","assets/react-vendor-Cy458wKG.js","assets/admin-chunk-BNcFjXlJ.js","assets/utils-vendor-DeGC_a19.js"])))=>i.map(i=>d[i]);
import{_ as j}from"./index-BStY3ojk.js";import{j as r}from"./ui-vendor-BUNMIuFe.js";import{j as v,u as P,r as x}from"./react-vendor-Cy458wKG.js";import{u as N}from"./chat-chunk-BRsdDZXf.js";import{L as S}from"./seller-chunk-6swISJwY.js";import{b}from"./admin-chunk-BNcFjXlJ.js";import"./checkout-chunk-C5n3Mg9L.js";import"./utils-vendor-DeGC_a19.js";const C=()=>{const[n]=v(),d=P(),{setUser:m,setIsAuthenticated:f,refreshRoleInfo:h}=N(),[i,s]=x.useState({isProcessing:!0,status:"Procesando autenticaciÃ³n...",error:null});return x.useEffect(()=>{(async()=>{try{console.log("ðŸ”„ Procesando Google Auth Success..."),console.log("ðŸ“Š URL completa:",window.location.href),console.log("ðŸ“Š ParÃ¡metros:",Object.fromEntries(n.entries())),s(e=>({...e,status:"Obteniendo datos de autenticaciÃ³n..."}));const a=n.get("token"),c=n.get("user"),y=n.get("expires_in"),u=n.get("error");if(console.log("ðŸ” ParÃ¡metros obtenidos:",{hasToken:!!a,hasUserData:!!c,tokenLength:a?.length,expiresIn:y,error:u}),u){const e=decodeURIComponent(u);console.error("âŒ Error en autenticaciÃ³n:",e),s(o=>({...o,isProcessing:!1,error:e}));return}if(!a||!c){const e=[];a||e.push("token"),c||e.push("userData");const o=`Datos de autenticaciÃ³n incompletos: ${e.join(", ")}`;console.error("âŒ",o),s(g=>({...g,isProcessing:!1,error:o}));return}s(e=>({...e,status:"Verificando token de acceso..."}));let l;try{const e=atob(c);l=JSON.parse(e),console.log("âœ… Datos del usuario decodificados:",l)}catch(e){console.error("âŒ Error decodificando datos del usuario:",e),s(o=>({...o,isProcessing:!1,error:"Error al procesar datos del usuario"}));return}s(e=>({...e,status:"Guardando informaciÃ³n de sesiÃ³n..."}));const p=new S;p.setItem(b.storage.authTokenKey,a),p.setItem(b.storage.userKey,l),console.log("âœ… Token y datos guardados en localStorage"),console.log("ðŸ”‘ Token guardado:",a.substring(0,50)+"..."),console.log("ðŸ‘¤ Usuario guardado:",l),m(l),f(!0),s(e=>({...e,status:"Obteniendo informaciÃ³n de roles..."}));let t="/";try{await h();const o=await(await j(async()=>{const{default:g}=await import("./seller-chunk-6swISJwY.js").then(w=>w.e);return{default:g}},__vite__mapDeps([0,1,2,3,4]))).default.checkUserRole(!0);console.log("ðŸŽ¯ InformaciÃ³n de rol obtenida:",o),o&&o.success?o.data.is_admin?(t="/admin/dashboard",console.log("ðŸ‘‘ Usuario es admin, redirigiendo a:",t)):o.data.is_seller?(t="/seller/dashboard",console.log("ðŸª Usuario es seller, redirigiendo a:",t)):(t="/",console.log("ðŸ‘¤ Usuario normal, redirigiendo a:",t)):(console.log("ðŸ”„ Sin rol especÃ­fico, redirigiendo a home"),t="/")}catch(e){console.warn("âš ï¸ No se pudo obtener informaciÃ³n de rol:",e),t="/"}s(e=>({...e,status:"Completando autenticaciÃ³n..."})),window.history.replaceState({},document.title,window.location.pathname),s(e=>({...e,status:"Â¡AutenticaciÃ³n exitosa! Redirigiendo..."})),setTimeout(()=>{console.log("ðŸš€ Redirigiendo a:",t),d(t,{replace:!0})},1500)}catch(a){console.error("âŒ Error crÃ­tico procesando Google Auth Success:",a),s(c=>({...c,isProcessing:!1,error:"Error al procesar la autenticaciÃ³n con Google"}))}})()},[n,d,m,f,h]),i.error?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center",children:[r.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"âŒ"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Error en la autenticaciÃ³n"}),r.jsx("p",{className:"text-gray-600 mb-6",children:i.error}),r.jsxs("div",{className:"space-y-3",children:[r.jsx("button",{onClick:()=>d("/login"),className:"w-full py-3 px-4 border border-transparent rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Volver al inicio de sesiÃ³n"}),r.jsx("button",{onClick:()=>d("/register"),className:"w-full py-3 px-4 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:"Crear cuenta nueva"})]})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:r.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center",children:[r.jsx("div",{className:"text-green-500 text-6xl mb-4",children:i.isProcessing?"...":"ðŸŽ‰"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:i.isProcessing?"Procesando autenticaciÃ³n...":"Â¡Bienvenido!"}),r.jsx("p",{className:"text-gray-600 mb-6",children:i.status}),i.isProcessing&&r.jsx("div",{className:"flex justify-center",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-600"})}),!1]})})};export{C as default};
//# sourceMappingURL=GoogleAuthSuccessPage-BxaBe-yq.js.map
