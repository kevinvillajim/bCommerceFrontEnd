import{h as R,d as A,r,j as e,X as D,L as T,M as h,q as U}from"./index-DmNDOrWy.js";import{S as H}from"./ShippingServiceAdapter-DX6ZR1a2.js";import{A as q}from"./arrow-left-sVt-VeaA.js";import{P as N}from"./package-CIRlwNqy.js";import{T as _}from"./truck-DP84WB3Y.js";import{C as F}from"./check-CHNPnXXq.js";import{a as O,P as V}from"./printer-C9AKBDpF.js";import{R as X}from"./refresh-cw-BOPCg90x.js";import{E as B}from"./external-link-Bij3ydGU.js";import{C as G}from"./calendar-COADRkv0.js";import{T as J}from"./triangle-alert-B75WTV0P.js";const le=()=>{const{id:u}=R(),b=A(),[s,y]=r.useState(null),[f,c]=r.useState([]),[p,P]=r.useState([]),[I,v]=r.useState(!0),[w,S]=r.useState(null),[i,k]=r.useState(!1),[E,d]=r.useState(null),[C,g]=r.useState(""),o=new H;r.useEffect(()=>{u&&j()},[u]);const j=async()=>{v(!0),S(null);try{const t=await o.getShippingDetails(u||"");if(!t)throw new Error("No se pudo obtener la información del envío");if(y(t),t.trackingNumber)try{const a=await o.getShippingHistory(t.trackingNumber);c(a);try{const n=await o.getShippingRoute(t.trackingNumber);P(n)}catch(n){console.warn("No se pudo obtener la ruta del envío:",n)}}catch(a){console.warn("No se pudo obtener historial de envío:",a),c([{date:new Date().toISOString(),status:t.status,description:`Estado actual: ${l(t.status)}`}])}else c([{date:new Date().toISOString(),status:t.status,description:`Estado actual: ${l(t.status)}`}])}catch(t){console.error("Error al cargar detalles del envío:",t),S("No se pudo cargar la información del envío. Intenta de nuevo más tarde.")}finally{v(!1)}},m=async t=>{if(s){k(!0),d(null),g("");try{if(await o.updateShippingStatus(s.id,t)){d(!0),g(`Estado actualizado a ${l(t)}`),y(x=>x?{...x,status:t}:null);const n={date:new Date().toISOString(),status:t,description:`Actualización de estado a: ${l(t)}`};c(x=>[n,...x]),setTimeout(()=>{j(),d(null)},3e3)}else throw new Error("No se pudo actualizar el estado")}catch(a){console.error(`Error al actualizar estado a ${t}:`,a),d(!1),g("Error al actualizar estado. Intenta de nuevo.")}finally{k(!1)}}},L=()=>{!s||!s.trackingNumber||alert(`Imprimiendo etiqueta para envío ${s.trackingNumber}`)},l=t=>{switch(t){case"pending":return"Pendiente";case"ready_to_ship":return"Listo para enviar";case"in_transit":case"shipped":return"En tránsito";case"delivered":return"Entregado";case"failed":return"Fallido";case"returned":return"Devuelto";default:return"Desconocido"}},$=t=>{switch(t){case"pending":return"bg-yellow-100 text-yellow-800";case"ready_to_ship":return"bg-blue-100 text-blue-800";case"in_transit":case"shipped":return"bg-indigo-100 text-indigo-800";case"delivered":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";case"returned":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}},M=t=>{switch(t){case"pending":return e.jsx(N,{className:"h-5 w-5 text-yellow-600"});case"ready_to_ship":return e.jsx(N,{className:"h-5 w-5 text-blue-600"});case"in_transit":case"shipped":return e.jsx(_,{className:"h-5 w-5 text-indigo-600"});case"delivered":return e.jsx(V,{className:"h-5 w-5 text-green-600"});case"failed":return e.jsx(J,{className:"h-5 w-5 text-red-600"});case"returned":return e.jsx(h,{className:"h-5 w-5 text-orange-600"});default:return e.jsx(U,{className:"h-5 w-5 text-gray-500"})}},z=t=>{try{return new Date(t).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return t}};return I?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"}),e.jsx("p",{className:"mt-4 text-gray-700",children:"Cargando detalles del envío..."})]}):w||!s?e.jsx("div",{className:"bg-white rounded-lg shadow p-6 max-w-4xl mx-auto my-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-5xl mb-4",children:e.jsx(D,{className:"h-16 w-16 mx-auto"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Error al cargar el envío"}),e.jsx("p",{className:"text-gray-600 mb-6",children:w||"No se pudo encontrar el envío solicitado"}),e.jsx("button",{onClick:()=>b(-1),className:"bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg transition-colors",children:"Volver"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>b(-1),className:"flex items-center text-gray-600 hover:text-primary-600 mb-2",children:[e.jsx(q,{size:16,className:"mr-1"}),e.jsx("span",{children:"Volver a envíos"})]}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Envío para Pedido #",s.orderNumber]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.status==="pending"&&e.jsxs("button",{onClick:()=>m("ready_to_ship"),disabled:i,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(N,{size:18}),e.jsx("span",{children:"Preparar envío"})]}),s.status==="ready_to_ship"&&s.trackingNumber&&e.jsxs("button",{onClick:()=>m("shipped"),disabled:i,className:"bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(_,{size:18}),e.jsx("span",{children:"Marcar como enviado"})]}),(s.status==="in_transit"||s.status==="shipped")&&e.jsxs("button",{onClick:()=>m("delivered"),disabled:i,className:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(F,{size:18}),e.jsx("span",{children:"Marcar como entregado"})]}),(s.status==="ready_to_ship"||s.status==="in_transit"||s.status==="shipped")&&e.jsxs("button",{onClick:()=>m("failed"),disabled:i,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(D,{size:18}),e.jsx("span",{children:"Marcar como fallido"})]}),s.trackingNumber&&e.jsxs("button",{onClick:L,disabled:i,className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(O,{size:18}),e.jsx("span",{children:"Imprimir etiqueta"})]}),e.jsxs("button",{onClick:j,disabled:i,className:"bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(X,{size:18}),e.jsx("span",{children:"Actualizar"})]})]})]}),E===!0&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:C})}),E===!1&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:C})}),i&&e.jsx("div",{className:"bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative",role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin mr-2 h-4 w-4 border-t-2 border-blue-500"}),e.jsx("span",{className:"block sm:inline",children:"Actualizando estado..."})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"col-span-3 md:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Estado del envío"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Estado:"}),e.jsx("span",{className:`px-2.5 py-0.5 rounded-full text-xs font-medium ${$(s.status)}`,children:l(s.status)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Transportista:"}),e.jsx("span",{className:"text-gray-900",children:s.carrier||"No asignado"})]}),s.trackingNumber&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Nº Seguimiento:"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-900 font-mono",children:s.trackingNumber}),s.carrier&&e.jsx("a",{href:"#",className:"ml-2 text-blue-600 hover:text-blue-800",title:`Rastrear con ${s.carrier}`,onClick:t=>{t.preventDefault(),alert(`Redirigiendo al sitio de ${s.carrier} para rastrear ${s.trackingNumber}`)},children:e.jsx(B,{size:14})})]})]}),s.estimatedDelivery&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Entrega estimada:"}),e.jsx("span",{className:"text-gray-900",children:new Date(s.estimatedDelivery).toLocaleDateString("es-ES")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Fecha de pedido:"}),e.jsx("span",{className:"text-gray-900",children:new Date(s.date).toLocaleDateString("es-ES")})]}),s.lastUpdate&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Última actualización:"}),e.jsx("span",{className:"text-gray-900",children:z(s.lastUpdate)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Cliente"})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Nombre:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:s.customer.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Email:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:s.customer.email})]}),e.jsxs("div",{children:[s.customer.phone&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Teléfono:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:s.customer.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Dirección de envío:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:s.shippingAddress||"No disponible"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Pedido"}),e.jsx(T,{to:`/seller/orders/${s.orderId}`,className:"text-sm text-primary-600 hover:underline",children:"Ver detalles"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Número de pedido:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:s.orderNumber})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Método de envío:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:s.shippingMethod||"Estándar"})]}),s.weight&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Peso:"}),e.jsxs("div",{className:"mt-1 text-gray-900",children:[s.weight," kg"]})]}),s.shippingCost!==void 0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600",children:"Coste de envío:"}),e.jsx("div",{className:"mt-1 text-gray-900",children:new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR"}).format(s.shippingCost)})]})]})]})]}),e.jsxs("div",{className:"col-span-3 md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Historial de envío"}),f.length===0?e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-gray-500",children:"No hay historial disponible para este envío."})}):e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-9 top-0 bottom-0 w-0.5 bg-gray-200"}),e.jsx("ul",{className:"space-y-6",children:f.map((t,a)=>e.jsx("li",{className:"relative",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex items-center justify-center h-9 w-9 rounded-full bg-white border-2 border-primary-500 z-10",children:M(t.status)}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900",children:l(t.status)}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500 flex items-center",children:[e.jsx(G,{size:14,className:"mr-1"}),z(t.date)]})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:t.description}),t.location&&e.jsxs("p",{className:"mt-1 text-xs text-gray-500 flex items-center",children:[e.jsx(h,{size:12,className:"mr-1"}),t.location]})]})]})},a))})]})]}),p.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Ruta de envío"}),e.jsx("div",{className:"h-64 bg-gray-100 rounded-lg overflow-hidden flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(h,{size:32,className:"mx-auto mb-2 text-primary-500"}),e.jsx("p",{className:"text-gray-600",children:"Mapa de seguimiento disponible"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[p.length," puntos de seguimiento disponibles"]})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-2",children:"Puntos de seguimiento:"}),e.jsx("ul",{className:"space-y-2",children:p.map((t,a)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(h,{size:16,className:"mt-0.5 mr-2 text-primary-500"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:t.location}),e.jsx("span",{className:"ml-2 text-xs text-gray-500",children:new Date(t.date).toLocaleDateString("es-ES")})]}),e.jsx("p",{className:"text-xs text-gray-600",children:l(t.status)})]})]},a))})]})]})]})]})]})};export{le as default};
//# sourceMappingURL=SellerShippingDetailsPage-BmEJlCyc.js.map
