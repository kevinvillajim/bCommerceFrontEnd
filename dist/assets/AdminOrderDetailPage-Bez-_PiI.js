import{h as q,d as F,r as t,j as e,q as L,p as B,L as G,M as R}from"./index-DmNDOrWy.js";import{A as $}from"./AdminOrderServiceAdapter-pJBu4i2T.js";import{O as E}from"./OrderStatusBadge-CE0y32qI.js";import{f as i}from"./formatCurrency-CXuiUHwQ.js";import{A as f}from"./arrow-left-sVt-VeaA.js";import{S as k}from"./square-pen-CTS0gMbb.js";import{C as D}from"./circle-x-BwsT4AZ5.js";import{C as H}from"./calendar-COADRkv0.js";import{C as y}from"./credit-card-DwcG-Fqx.js";import{S as z}from"./shopping-bag-BMmsUIy8.js";import{R as X}from"./refresh-cw-BOPCg90x.js";import{T as J}from"./truck-DP84WB3Y.js";import{P as K}from"./package-CIRlwNqy.js";import{U as Q}from"./user-nLts-VnI.js";const me=()=>{const{id:m}=q(),x=F(),[O,d]=t.useState(!0),[a,p]=t.useState(null),[b,h]=t.useState(null),u=new $,[I,g]=t.useState(!1),[n,N]=t.useState(""),[v,w]=t.useState(!1),[A,j]=t.useState(!1),[l,c]=t.useState({tracking_number:"",shipping_company:"",estimated_delivery:"",notes:""}),[S,C]=t.useState(!1);t.useEffect(()=>{if(!m)return;(async()=>{d(!0),h(null);try{const r=await u.getOrderDetails(parseInt(m));r?p(r):h("No se pudo obtener la información de la orden")}catch(r){console.error("Error al obtener detalles de la orden:",r),h("Error al cargar los detalles de la orden")}finally{d(!1)}})()},[m]);const _=[{value:"pending",label:"Pendiente"},{value:"processing",label:"En proceso"},{value:"paid",label:"Pagado"},{value:"shipped",label:"Enviado"},{value:"delivered",label:"Entregado"},{value:"completed",label:"Completado"},{value:"cancelled",label:"Cancelado"}],o=s=>{if(!s)return"N/A";const r=new Date(s);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(r)},P=async()=>{if(!(!n||!a)){w(!0);try{await u.updateOrderStatus(a.id,n)?(p({...a,status:n,updatedAt:new Date().toISOString()}),g(!1)):alert("Error al actualizar el estado de la orden")}catch(s){console.error("Error al actualizar estado:",s),alert("Error al actualizar el estado de la orden")}finally{w(!1)}}},M=async()=>{if(a){C(!0);try{alert("Funcionalidad aún no implementada"),j(!1)}catch(s){console.error("Error al actualizar información de envío:",s),alert("Error al actualizar la información de envío")}finally{C(!1)}}},T=async()=>{if(a&&window.confirm("¿Estás seguro de que deseas cancelar este pedido?")){d(!0);try{await u.cancelOrder(a.id)?p({...a,status:"cancelled",updatedAt:new Date().toISOString()}):alert("Error al cancelar la orden")}catch(s){console.error("Error al cancelar orden:",s),alert("Error al cancelar la orden")}finally{d(!1)}}};if(O)return e.jsx("div",{className:"p-6 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})});if(b)return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",children:[e.jsx("strong",{className:"font-bold",children:"Error!"}),e.jsxs("span",{className:"block sm:inline",children:[" ",b]})]}),e.jsxs("button",{onClick:()=>x("/admin/orders"),className:"flex items-center text-primary-600 hover:text-primary-800",children:[e.jsx(f,{className:"mr-2",size:16}),"Volver a la lista de pedidos"]})]});if(!a)return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded relative mb-4",children:[e.jsx("strong",{className:"font-bold",children:"No encontrado."}),e.jsxs("span",{className:"block sm:inline",children:[" ","No se encontró la orden solicitada."]})]}),e.jsxs("button",{onClick:()=>x("/admin/orders"),className:"flex items-center text-primary-600 hover:text-primary-800",children:[e.jsx(f,{className:"mr-2",size:16}),"Volver a la lista de pedidos"]})]});const V=!["cancelled","completed"].includes(a.status),U=["pending","processing","paid"].includes(a.status);return e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("button",{onClick:()=>x("/admin/orders"),className:"flex items-center text-primary-600 hover:text-primary-800",children:[e.jsx(f,{className:"mr-2",size:16}),"Volver a la lista de pedidos"]}),e.jsxs("h1",{className:"text-2xl font-bold",children:["Pedido ",a.orderNumber||`#${a.id}`]}),e.jsxs("div",{className:"flex space-x-2",children:[V&&e.jsxs("button",{onClick:()=>{N(a.status),g(!0)},className:"flex items-center px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:[e.jsx(k,{size:16,className:"mr-2"}),"Cambiar Estado"]}),U&&e.jsxs("button",{onClick:T,className:"flex items-center px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:[e.jsx(D,{size:16,className:"mr-2"}),"Cancelar"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Información General"}),e.jsx(E,{status:a.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"Fecha del pedido:"})]}),e.jsx("p",{className:"text-gray-900",children:o(a.date||a.createdAt)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"Última actualización:"})]}),e.jsx("p",{className:"text-gray-900",children:o(a.updatedAt)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"Método de pago:"})]}),e.jsx("p",{className:"text-gray-900",children:a.paymentMethod||"No especificado"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"Estado de pago:"})]}),e.jsx("p",{className:"text-gray-900",children:e.jsx(E,{status:a.paymentStatus,type:"payment"})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Productos"}),e.jsx("div",{className:"space-y-4",children:a.items&&a.items.map(s=>e.jsxs("div",{className:"flex border-b border-gray-200 pb-4 last:border-0 last:pb-0",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-md overflow-hidden flex-shrink-0",children:s.image?e.jsx("img",{src:s.image,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(z,{className:"w-8 h-8 text-gray-400"})})}),e.jsx("div",{className:"ml-4 flex-grow",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",s.productId]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[i(s.price)," x ",s.quantity]}),e.jsx("p",{className:"text-sm font-bold text-gray-900",children:i(s.subtotal)})]})]})})]},s.id))}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),e.jsx("span",{className:"font-medium text-gray-900",children:i(a.items.reduce((s,r)=>s+(r.subtotal||0),0))})]}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-gray-600",children:"IVA (15%):"}),e.jsx("span",{className:"font-medium text-gray-900",children:i(a.items.reduce((s,r)=>s+(r.subtotal||0),0)*.15)})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg mt-2",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:i(a.total)})]})]})]}),a.history&&a.history.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Historial de la Orden"}),e.jsx("div",{className:"space-y-3",children:a.history.map((s,r)=>e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex-shrink-0 h-6 w-6 rounded-full bg-blue-100 flex items-center justify-center text-blue-500",children:[s.status==="created"&&e.jsx(z,{size:12}),s.status==="paid"&&e.jsx(y,{size:12}),s.status==="processing"&&e.jsx(X,{size:12}),s.status==="shipped"&&e.jsx(J,{size:12}),s.status==="delivered"&&e.jsx(K,{size:12}),s.status==="completed"&&e.jsx(B,{size:12}),s.status==="cancelled"&&e.jsx(D,{size:12})]}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[s.status==="created"&&"Orden creada",s.status==="paid"&&"Pago realizado",s.status==="processing"&&"Procesando orden",s.status==="shipped"&&"Orden enviada",s.status==="delivered"&&"Orden entregada",s.status==="completed"&&"Orden completada",s.status==="cancelled"&&"Orden cancelada"]}),e.jsx("p",{className:"text-xs text-gray-500",children:o(s.timestamp)}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description})]})]},r))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Cliente"}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-gray-500"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:a.customer?.name||"Cliente"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",a.customer?.id||a.userId]})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:"Email:"})," ",a.customer?.email||"No disponible"]}),a.customer?.phone&&e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:"Teléfono:"})," ",a.customer.phone]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Vendedor"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:"ID:"})," ",a.seller?.id||a.sellerId||"No disponible"]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:"Nombre:"})," ",a.seller?.name||"Vendedor"]})]}),(a.seller?.id||a.sellerId)&&e.jsx(G,{to:`/admin/sellers/${a.seller?.id||a.sellerId}`,className:"mt-3 inline-flex items-center text-sm text-primary-600 hover:text-primary-800",children:"Ver detalles del vendedor"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Información de Envío"}),e.jsxs("button",{onClick:()=>j(!0),className:"text-sm text-primary-600 hover:text-primary-800",children:[e.jsx(k,{size:14,className:"inline mr-1"}),"Editar"]})]}),a.shippingData?e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"text-gray-600 flex items-start",children:[e.jsx(R,{className:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[a.shippingData.address,",",e.jsx("br",{}),a.shippingData.city,","," ",a.shippingData.state,e.jsx("br",{}),a.shippingData.postalCode,","," ",a.shippingData.country]})]}),a.shippingData.phone&&e.jsxs("p",{className:"text-gray-600 mt-2",children:[e.jsx("strong",{children:"Teléfono:"})," ",a.shippingData.phone]}),a.shippingData.tracking_number&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-gray-600",children:e.jsx("strong",{children:"Número de seguimiento:"})}),e.jsx("p",{className:"font-mono bg-gray-100 px-2 py-1 rounded mt-1",children:a.shippingData.tracking_number})]}),a.shippingData.shipping_company&&e.jsxs("p",{className:"text-gray-600 mt-2",children:[e.jsx("strong",{children:"Transportista:"})," ",a.shippingData.shipping_company]}),a.shippingData.estimated_delivery&&e.jsxs("p",{className:"text-gray-600 mt-2",children:[e.jsx("strong",{children:"Entrega estimada:"})," ",o(a.shippingData.estimated_delivery)]})]}):e.jsx("div",{className:"text-gray-500 text-sm",children:"No hay información de envío disponible."})]})]})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Cambiar Estado del Pedido"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nuevo Estado"}),e.jsx("select",{value:n,onChange:s=>N(s.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",children:_.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>g(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100",children:"Cancelar"}),e.jsx("button",{onClick:P,disabled:v,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:v?"Actualizando...":"Guardar"})]})]})}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Editar Información de Envío"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Número de Seguimiento"}),e.jsx("input",{type:"text",value:l.tracking_number,onChange:s=>c({...l,tracking_number:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Empresa de Transporte"}),e.jsx("input",{type:"text",value:l.shipping_company,onChange:s=>c({...l,shipping_company:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha Estimada de Entrega"}),e.jsx("input",{type:"date",value:l.estimated_delivery,onChange:s=>c({...l,estimated_delivery:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notas"}),e.jsx("textarea",{value:l.notes,onChange:s=>c({...l,notes:s.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",rows:3})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>j(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100",children:"Cancelar"}),e.jsx("button",{onClick:M,disabled:S,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:S?"Actualizando...":"Guardar"})]})]})})]})};export{me as default};
//# sourceMappingURL=AdminOrderDetailPage-Bez-_PiI.js.map
