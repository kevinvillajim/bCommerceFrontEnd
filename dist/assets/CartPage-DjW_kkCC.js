import{r as d,d as K,j as e,L as f,k as l}from"./index-DmNDOrWy.js";import{u as X}from"./useCart-DylEmA2w.js";import{u as Y}from"./useFavorites-T3Y-P3Fr.js";import{f as m}from"./formatCurrency-CXuiUHwQ.js";import{g as Z}from"./imageUtils-B2iUz1H0.js";import{S as ee}from"./shopping-cart-Ck1So-LU.js";import{T as ae}from"./trash-2-DifnXJFx.js";import{H as te}from"./heart-DBtNcst0.js";import{M as se}from"./minus-B_L9SZVF.js";import{P as re}from"./plus--kIPDPVf.js";import{A as oe}from"./arrow-left-sVt-VeaA.js";const he=()=>{const[E,b]=d.useState(!0),[g,R]=d.useState(!1),[h,S]=d.useState(""),[u,I]=d.useState(!1),[j,A]=d.useState(0),[i,c]=d.useState(null),k=K(),{cart:n,loading:x,error:N,fetchCart:y,itemCount:v,removeFromCart:C,updateCartItem:w,clearCart:O,showNotification:o}=X(),{toggleFavorite:z}=Y();d.useEffect(()=>{(async()=>{b(!0);try{await y()}catch(t){console.error("Error al cargar el carrito:",t),o(l.ERROR,"No se pudo cargar el carrito. IntÃ©ntalo de nuevo.")}finally{b(!1)}})()},[y,o]),d.useEffect(()=>{!x&&n&&R(n.items.length===0)},[n,x]);const T=async a=>{if(i)return;c(a);const t=n?.items.find(s=>s.id===a);if(t)try{if(!await w({itemId:a,quantity:t.quantity+1}))throw new Error("No se pudo actualizar la cantidad")}catch(s){console.error("Error al aumentar cantidad:",s),o(l.ERROR,"No se pudo actualizar la cantidad")}finally{c(null)}},q=async a=>{if(i)return;c(a);const t=n?.items.find(s=>s.id===a);if(t&&t.quantity>1)try{if(!await w({itemId:a,quantity:t.quantity-1}))throw new Error("No se pudo actualizar la cantidad")}catch(s){console.error("Error al disminuir cantidad:",s),o(l.ERROR,"No se pudo actualizar la cantidad")}finally{c(null)}},L=async a=>{if(!i){c(a);try{if(await C(a))o(l.SUCCESS,"Producto eliminado del carrito");else throw new Error("No se pudo eliminar el producto")}catch(t){console.error("Error al eliminar del carrito:",t),o(l.ERROR,"No se pudo eliminar el producto")}finally{c(null)}}},U=async(a,t)=>{if(!i){c(a);try{if(await z(t),await C(a))o(l.SUCCESS,"Producto movido a favoritos");else throw new Error("No se pudo mover el producto a favoritos")}catch(s){console.error("Error al mover a favoritos:",s),o(l.ERROR,"No se pudo mover el producto a favoritos")}finally{c(null)}}},_=()=>{h.toLowerCase()==="discount10"?(I(!0),A(10),o(l.SUCCESS,"CupÃ³n aplicado exitosamente")):o(l.ERROR,"CÃ³digo de cupÃ³n invÃ¡lido")},D=async()=>{if(!x)try{if(await O())o(l.SUCCESS,"Carrito vaciado exitosamente");else throw new Error("No se pudo vaciar el carrito")}catch(a){console.error("Error al vaciar el carrito:",a),o(l.ERROR,"No se pudo vaciar el carrito")}},F=a=>{console.log("ðŸŽ¨ CartPage - getProductImage:",a);let t="";if(a?.image)t=a.image;else if(a?.main_image)t=a.main_image;else if(a?.images&&Array.isArray(a.images)&&a.images.length>0){const r=a.images[0];typeof r=="string"?t=r:typeof r=="object"&&r!==null&&(t=r.original||r.medium||r.thumbnail||"")}console.log("ðŸ–¼ï¸ CartPage - Path extraÃ­do:",t);const s=Z(t);return console.log("ðŸ”— CartPage - URL final:",s),s},P=a=>{console.log("ðŸ’° CartPage - Datos del item completo:",a),console.log("ðŸ” DEBUG - Item completo:",JSON.stringify(a,null,2)),console.log("ðŸ” DEBUG - Producto completo:",JSON.stringify(a.product,null,2));const t=a.price||0;let s=t,r=0;a.product&&(a.product.final_price!==void 0&&a.product.final_price!==null?s=a.product.final_price:(r=a.product.discount_percentage||a.product.discountPercentage||a.product.discount||0,r>0&&(s=t-t*(r/100))),r=a.product.discount_percentage||a.product.discountPercentage||a.product.discount||0),console.log("ðŸ’° CartPage - Precio original:",t),console.log("ðŸ’° CartPage - Precio con descuento (final_price):",s),console.log("ðŸ’° CartPage - Descuento %:",r),console.log("ðŸ’° CartPage - Cantidad:",a.quantity);const p=s*a.quantity;return console.log("ðŸ’° CartPage - Subtotal calculado:",p),{original:t,discounted:s,discount:r,subtotal:p}},$=()=>{if(!n||!n.items||n.items.length===0)return{subtotal:0,tax:0,couponAmount:0,total:0};const a=n.items.reduce((Q,V)=>{const W=P(V);return Q+W.subtotal},0);console.log("ðŸ’° CartPage - Subtotal total del carrito:",a);const s=a*.15,r=u?a*(j/100):0,p=a+s-r;return console.log("ðŸ’° CartPage - Totales finales:",{subtotal:a,tax:s,couponAmount:r,total:p}),{subtotal:a,tax:s,couponAmount:r,total:p}},{subtotal:G,tax:M,couponAmount:B,total:H}=$(),J=()=>{if(g){o(l.ERROR,"No hay productos en el carrito");return}k("/checkout")};return e.jsxs("div",{className:"container mx-auto px-4 lg:px-8 py-10",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Mi Carrito"}),E?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})}):g?e.jsxs("div",{className:"text-center py-20 bg-gray-50 rounded-lg",children:[e.jsx(ee,{className:"mx-auto h-16 w-16 text-gray-300 mb-6"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-700 mb-3",children:"Tu carrito estÃ¡ vacÃ­o"}),e.jsx("p",{className:"text-gray-500 mb-8 max-w-md mx-auto",children:"AÃ±ade productos a tu carrito para continuar comprando."}),e.jsx(f,{to:"/products",className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700",children:"Explorar productos"})]}):e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsxs("div",{className:"lg:w-2/3",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden mb-6",children:[e.jsxs("div",{className:"hidden sm:grid sm:grid-cols-12 gap-4 p-5 bg-gray-50 border-b",children:[e.jsx("div",{className:"sm:col-span-6",children:e.jsx("span",{className:"font-medium text-gray-800",children:"Producto"})}),e.jsx("div",{className:"sm:col-span-2 text-center",children:e.jsx("span",{className:"font-medium text-gray-800",children:"Precio"})}),e.jsx("div",{className:"sm:col-span-2 text-center",children:e.jsx("span",{className:"font-medium text-gray-800",children:"Cantidad"})}),e.jsx("div",{className:"sm:col-span-2 text-center",children:e.jsx("span",{className:"font-medium text-gray-800",children:"Total"})})]}),n?.items.map(a=>{const t=P(a);return console.log("ðŸ›’ CartPage - Renderizando item:",{itemId:a.id,prices:t}),e.jsx("div",{className:"border-b border-gray-200 last:border-b-0",children:e.jsxs("div",{className:"grid sm:grid-cols-12 gap-4 p-5",children:[e.jsxs("div",{className:"sm:col-span-6 flex",children:[e.jsx(f,{to:`/products/${a.productId}`,className:"w-24 h-24 flex-shrink-0",children:e.jsx("img",{src:F(a.product),alt:a.product?.name||`Producto ${a.productId}`,className:"w-full h-full object-cover rounded"})}),e.jsxs("div",{className:"ml-4 flex flex-col",children:[e.jsx(f,{to:`/products/${a.productId}`,className:"font-medium text-gray-800 hover:text-primary-600",children:a.product?.name||`Producto ${a.productId}`}),t.discount>0&&e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:"text-xs bg-red-100 text-red-600 px-2 py-1 rounded",children:[t.discount,"% OFF"]})}),e.jsxs("div",{className:"mt-auto flex space-x-3 text-sm pt-3",children:[e.jsxs("button",{onClick:()=>L(a.id),disabled:i===a.id,className:"text-gray-500 hover:text-red-500 flex items-center disabled:opacity-50",children:[e.jsx(ae,{size:14,className:"mr-1"}),"Eliminar"]}),e.jsxs("button",{onClick:()=>U(a.id,a.productId),disabled:i===a.id,className:"text-gray-500 hover:text-primary-600 flex items-center disabled:opacity-50",children:[e.jsx(te,{size:14,className:"mr-1"}),"Guardar"]})]})]})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center justify-center sm:justify-center",children:[e.jsx("div",{className:"sm:hidden mr-2 font-medium text-gray-800",children:"Precio:"}),e.jsxs("div",{className:"font-medium flex flex-col items-center",children:[e.jsx("span",{className:"text-gray-800",children:m(t.discounted)}),t.discount>0&&e.jsx("span",{className:"text-xs text-gray-500 line-through",children:m(t.original)})]})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center justify-center",children:[e.jsx("div",{className:"sm:hidden mr-2 font-medium text-gray-800",children:"Cantidad:"}),e.jsxs("div",{className:"flex items-center border border-gray-300 rounded-md",children:[e.jsx("button",{onClick:()=>q(a.id),disabled:a.quantity<=1||i===a.id,className:"px-2 py-1 text-gray-600 hover:text-gray-800 disabled:opacity-50",children:e.jsx(se,{size:14})}),e.jsx("span",{className:"px-3 py-1 text-gray-800 text-center w-10",children:i===a.id?e.jsx("span",{className:"inline-block h-4 w-4 border-2 border-t-primary-600 border-r-primary-600 border-b-primary-200 border-l-primary-200 rounded-full animate-spin"}):a.quantity}),e.jsx("button",{onClick:()=>T(a.id),disabled:i===a.id,className:"px-2 py-1 text-gray-600 hover:text-gray-800 disabled:opacity-50",children:e.jsx(re,{size:14})})]})]}),e.jsxs("div",{className:"sm:col-span-2 flex items-center justify-center sm:justify-center",children:[e.jsx("div",{className:"sm:hidden mr-2 font-medium text-gray-800",children:"Total:"}),e.jsx("span",{className:"font-bold text-gray-800",children:m(t.subtotal)})]})]})},a.id)}),e.jsxs("div",{className:"flex justify-between items-center p-5 bg-gray-50",children:[e.jsx("button",{onClick:D,disabled:g||x,className:"px-4 py-2 text-red-600 border border-red-200 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50",children:"Vaciar carrito"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[v," ",v===1?"producto":"productos"," en el carrito"]})]})]}),e.jsx("div",{children:e.jsxs(f,{to:"/products",className:"inline-flex items-center text-primary-600 hover:text-primary-700",children:[e.jsx(oe,{size:18,className:"mr-2"}),"Continuar comprando"]})})]}),e.jsx("div",{className:"lg:w-1/3",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Resumen del pedido"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("input",{type:"text",placeholder:"CÃ³digo de cupÃ³n",className:"flex-1 border border-gray-300 rounded-l-md py-3 px-4 focus:outline-none focus:ring-primary-500 focus:border-primary-500",value:h,onChange:a=>S(a.target.value),disabled:u}),e.jsx("button",{onClick:_,disabled:u||!h,className:"bg-primary-600 hover:bg-primary-700 text-white px-4 py-3 rounded-r-md disabled:opacity-50",children:"Aplicar"})]}),u&&e.jsxs("div",{className:"text-green-600 text-sm",children:["CupÃ³n aplicado: ",j,"% de descuento"]})]}),e.jsxs("div",{className:"space-y-4 border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal (con descuentos)"}),e.jsx("span",{className:"font-medium",children:m(G)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"IVA (15%)"}),e.jsx("span",{className:"font-medium",children:m(M)})]}),u&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Descuento de cupÃ³n"}),e.jsxs("span",{children:["-",m(B)]})]}),e.jsxs("div",{className:"flex justify-between border-t border-gray-200 pt-4",children:[e.jsx("span",{className:"text-xl font-bold",children:"Total"}),e.jsx("span",{className:"text-xl font-bold",children:m(H)})]})]}),e.jsx("button",{onClick:J,disabled:g||x,className:"mt-8 w-full bg-primary-600 hover:bg-primary-700 text-white font-medium py-3 px-4 rounded-md transition-colors disabled:opacity-50",children:"Proceder al pago"}),e.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:[e.jsx("p",{children:"Los impuestos y gastos de envÃ­o se calculan durante el proceso de pago."}),e.jsx("p",{className:"mt-1",children:"Aceptamos diversas formas de pago, incluyendo tarjetas de crÃ©dito, transferencias bancarias y pago contra entrega."})]})]})})})]}),N&&e.jsxs("div",{className:"mt-4 p-4 bg-red-50 text-red-700 rounded-lg",children:[e.jsxs("p",{className:"font-medium",children:["Error: ",N]}),e.jsx("button",{onClick:()=>y(),className:"underline text-sm mt-1",children:"Reintentar cargar el carrito"})]})]})};export{he as default};
//# sourceMappingURL=CartPage-DjW_kkCC.js.map
