{"version":3,"file":"PendingRatingsPage-DHkSnXj-.js","sources":["../../src/core/adapters/PendingRatingsAdapter.ts","../../src/presentation/components/rating/RatingModal.tsx","../../src/presentation/components/rating/PendingRatingsList.tsx","../../src/presentation/pages/account/PendingRatingsPage.tsx"],"sourcesContent":["import type {\r\n\tPendingRatingItem,\r\n\tPendingSellerItem,\r\n\tPendingRatingsResponse,\r\n} from \"../services/RatingService\";\r\n\r\n/**\r\n * Interfaz para los grupos de órdenes procesados\r\n */\r\nexport interface OrderGroup {\r\n\torderId: number;\r\n\torderNumber: string;\r\n\torderDate: string;\r\n\tproducts: PendingRatingItem[];\r\n\tsellers: PendingRatingItem[];\r\n}\r\n\r\n/**\r\n * Adaptador para transformar la respuesta de la API de valoraciones pendientes\r\n * al formato requerido por el componente PendingRatingsList\r\n */\r\nexport class PendingRatingsAdapter {\r\n\t/**\r\n\t * Adapta la respuesta de la API al formato esperado por los componentes de UI\r\n\t * @param apiResponse Respuesta de la API con valoraciones pendientes\r\n\t * @returns Lista de grupos de órdenes con sus productos y vendedores pendientes de valorar\r\n\t */\r\n\tstatic adaptPendingRatings(\r\n\t\tapiResponse: PendingRatingsResponse\r\n\t): OrderGroup[] {\r\n\t\t// Si no hay respuesta o es inválida, devolver un array vacío\r\n\t\tif (!apiResponse || !apiResponse.data) {\r\n\t\t\treturn [];\r\n\t\t}\r\n\r\n\t\tconst {products, sellers} = apiResponse.data;\r\n\r\n\t\t// Mapa para agrupar por orden\r\n\t\tconst orderGroupsMap = new Map<number, OrderGroup>();\r\n\r\n\t\t// Procesar productos\r\n\t\t(products || []).forEach((product) => {\r\n\t\t\tconst orderId = product.order_id;\r\n\r\n\t\t\t// Si no existe el grupo para esta orden, crearlo\r\n\t\t\tif (!orderGroupsMap.has(orderId)) {\r\n\t\t\t\torderGroupsMap.set(orderId, {\r\n\t\t\t\t\torderId,\r\n\t\t\t\t\torderNumber: product.order_number,\r\n\t\t\t\t\torderDate: product.order_date,\r\n\t\t\t\t\tproducts: [],\r\n\t\t\t\t\tsellers: [],\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tconst adaptedProduct: PendingRatingItem = {\r\n\t\t\t\t...product,\r\n\t\t\t\tproductId: product.id,\r\n\t\t\t\tseller_id: product.seller_id || product.sellerId,\r\n\t\t\t};\r\n\r\n\t\t\t// Añadir el producto adaptado al grupo\r\n\t\t\torderGroupsMap.get(orderId)?.products.push(adaptedProduct);\r\n\t\t});\r\n\r\n\t\t// Procesar vendedores\r\n\t\tconsole.log('🔍 DEBUG: Sellers raw data:', sellers);\r\n\t\t(sellers || []).forEach((seller: PendingSellerItem, index) => {\r\n\t\t\tconsole.log(`🔍 DEBUG: Seller ${index}:`, seller);\r\n\t\t\tconst orderId = seller.order_id;\r\n\r\n\t\t\t// Si no existe el grupo para esta orden, crearlo\r\n\t\t\tif (!orderGroupsMap.has(orderId)) {\r\n\t\t\t\torderGroupsMap.set(orderId, {\r\n\t\t\t\t\torderId,\r\n\t\t\t\t\torderNumber: seller.order_number,\r\n\t\t\t\t\torderDate: seller.date, // Campo diferente para sellers\r\n\t\t\t\t\tproducts: [],\r\n\t\t\t\t\tsellers: [],\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tconst adaptedSeller: PendingRatingItem = {\r\n\t\t\tid: seller.id || seller.seller_id,\r\n\t\t\tname: seller.name || `Vendedor #${seller.seller_id}`,\r\n\t\t\torder_id: seller.order_id,\r\n\t\t\torder_number: seller.order_number,\r\n\t\t\torder_date: seller.date,\r\n\t\t\timage: seller.image,\r\n\t\t\tseller_id: seller.seller_id,\r\n\t\t\t// Mapear product_id con múltiples posibles nombres\r\n\t\t\t productId: (seller as any).product_id || (seller as any).productId || (seller as any).pivot?.product_id,\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tconsole.log(`🔍 DEBUG: Adapted seller:`, adaptedSeller);\r\n\r\n\t\t\t// Añadir el vendedor al grupo\r\n\t\t\torderGroupsMap.get(orderId)?.sellers.push(adaptedSeller);\r\n\t\t});\r\n\r\n\t\t// Convertir el mapa a array y ordenar por fecha (más reciente primero)\r\n\t\treturn Array.from(orderGroupsMap.values()).sort(\r\n\t\t\t(a, b) =>\r\n\t\t\t\tnew Date(b.orderDate).getTime() - new Date(a.orderDate).getTime()\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default PendingRatingsAdapter;\r\n","import React, {useState} from \"react\";\r\nimport {X, AlertTriangle, Package, Store} from \"lucide-react\";\r\nimport StarRating from \"./StarRating\";\r\n\r\ninterface RatingModalProps {\r\n\ttype: \"product\" | \"seller\";\r\n\tentityId: number;\r\n\tentityName: string;\r\n\tentityImage?: string;\r\n\torderId: number;\r\n\tisOpen: boolean;\r\n\tonClose: () => void;\r\n\tonSubmit: (data: {\r\n\t\trating: number;\r\n\t\ttitle?: string;\r\n\t\tcomment?: string;\r\n\t\tentityId: number;\r\n\t\torderId: number;\r\n\t}) => Promise<void>;\r\n\tonReport?: (data: {\r\n\t\ttype: \"product\" | \"seller\";\r\n\t\tentityId: number;\r\n\t\torderId: number;\r\n\t\tproblemType: string;\r\n\t\tdescription: string;\r\n\t}) => Promise<void>;\r\n}\r\n\r\n/**\r\n * Modal para valorar productos o vendedores\r\n */\r\nconst RatingModal: React.FC<RatingModalProps> = ({\r\n\ttype,\r\n\tentityId,\r\n\tentityName,\r\n\tentityImage,\r\n\torderId,\r\n\tisOpen,\r\n\tonClose,\r\n\tonSubmit,\r\n\tonReport,\r\n}) => {\r\n\t// Estados del formulario de valoración\r\n\tconst [rating, setRating] = useState<number>(0);\r\n\tconst [title, setTitle] = useState<string>(\"\");\r\n\tconst [comment, setComment] = useState<string>(\"\");\r\n\tconst [isSubmitting, setIsSubmitting] = useState<boolean>(false);\r\n\r\n\t// Estados para el modo reporte\r\n\tconst [isReportMode, setIsReportMode] = useState<boolean>(false);\r\n\tconst [problemType, setProblemType] = useState<string>(\"\");\r\n\tconst [problemDescription, setProblemDescription] = useState<string>(\"\");\r\n\r\n\t// Estado para confirmación de valoración negativa\r\n\tconst [showConfirmation, setShowConfirmation] = useState<boolean>(false);\r\n\r\n\t// Si el modal no está abierto, no lo renderizamos\r\n\tif (!isOpen) return null;\r\n\r\n\t// Reset de los formularios\r\n\tconst resetForm = () => {\r\n\t\tsetRating(0);\r\n\t\tsetTitle(\"\");\r\n\t\tsetComment(\"\");\r\n\t\tsetIsReportMode(false);\r\n\t\tsetProblemType(\"\");\r\n\t\tsetProblemDescription(\"\");\r\n\t\tsetShowConfirmation(false);\r\n\t};\r\n\r\n\t// Manejar cierre del modal\r\n\tconst handleClose = () => {\r\n\t\tresetForm();\r\n\t\tonClose();\r\n\t};\r\n\r\n\t// Manejar envío de valoración\r\n\tconst handleSubmit = async () => {\r\n\t\t// Validación: Asegurarse de que haya una calificación seleccionada\r\n\t\tif (rating === 0) {\r\n\t\t\talert(\"Por favor selecciona una calificación de 1 a 5 estrellas\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Si la valoración es baja (1-2 estrellas) y no estamos en modo confirmación\r\n\t\tif (rating <= 2 && !showConfirmation) {\r\n\t\t\tsetShowConfirmation(true);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tsetIsSubmitting(true);\r\n\r\n\t\t\tawait onSubmit({\r\n\t\t\t\trating,\r\n\t\t\t\ttitle: title.trim() || undefined,\r\n\t\t\t\tcomment: comment.trim() || undefined,\r\n\t\t\t\tentityId,\r\n\t\t\t\torderId,\r\n\t\t\t});\r\n\r\n\t\t\tresetForm();\r\n\t\t\tonClose();\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error al enviar valoración:\", error);\r\n\t\t} finally {\r\n\t\t\tsetIsSubmitting(false);\r\n\t\t}\r\n\t};\r\n\r\n\t// Manejar envío de reporte\r\n\tconst handleReportSubmit = async () => {\r\n\t\tif (!onReport) return;\r\n\r\n\t\t// Validación: Asegurarse de que haya un tipo de problema y descripción\r\n\t\tif (!problemType) {\r\n\t\t\talert(\"Por favor selecciona el tipo de problema\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!problemDescription.trim()) {\r\n\t\t\talert(\"Por favor describe el problema\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tsetIsSubmitting(true);\r\n\r\n\t\t\tawait onReport({\r\n\t\t\t\ttype,\r\n\t\t\t\tentityId,\r\n\t\t\t\torderId,\r\n\t\t\t\tproblemType,\r\n\t\t\t\tdescription: problemDescription,\r\n\t\t\t});\r\n\r\n\t\t\tresetForm();\r\n\t\t\tonClose();\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error al enviar reporte:\", error);\r\n\t\t} finally {\r\n\t\t\tsetIsSubmitting(false);\r\n\t\t}\r\n\t};\r\n\r\n\t// Alternar entre modos de valoración y reporte\r\n\tconst toggleReportMode = () => {\r\n\t\tsetIsReportMode(!isReportMode);\r\n\t\tsetShowConfirmation(false);\r\n\t};\r\n\r\n\t// Log para depuración\r\n\tconsole.log(\"Estado actual de rating:\", rating);\r\n\r\n\treturn (\r\n\t\t<div className=\"fixed inset-0 z-50 overflow-y-auto\">\r\n\t\t\t{/* Overlay oscuro */}\r\n\t\t\t<div\r\n\t\t\t\tclassName=\"fixed inset-0 bg-black bg-opacity-50 transition-opacity\"\r\n\t\t\t\tonClick={handleClose}\r\n\t\t\t></div>\r\n\r\n\t\t\t{/* Contenido del modal */}\r\n\t\t\t<div className=\"flex min-h-screen items-center justify-center p-4\">\r\n\t\t\t\t<div className=\"relative bg-white rounded-lg shadow-xl w-full max-w-md mx-auto\">\r\n\t\t\t\t\t{/* Botón de cierre */}\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tonClick={handleClose}\r\n\t\t\t\t\t\tclassName=\"absolute top-3 right-3 text-gray-400 hover:text-gray-500\"\r\n\t\t\t\t\t\tdisabled={isSubmitting}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<X size={24} />\r\n\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t{/* Título del modal */}\r\n\t\t\t\t\t<div className=\"px-6 py-4 border-b border-gray-200\">\r\n\t\t\t\t\t\t<h3 className=\"text-lg font-medium text-gray-900 flex items-center\">\r\n\t\t\t\t\t\t\t{isReportMode ? (\r\n\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"mr-2 text-orange-500\" size={20} />\r\n\t\t\t\t\t\t\t\t\tReportar problema\r\n\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t{type === \"product\" ? (\r\n\t\t\t\t\t\t\t\t\t\t<Package className=\"mr-2 text-blue-500\" size={20} />\r\n\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t<Store className=\"mr-2 text-green-500\" size={20} />\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\tValorar {type === \"product\" ? \"producto\" : \"vendedor\"}\r\n\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"px-6 py-4\">\r\n\t\t\t\t\t\t{/* Información del producto/vendedor */}\r\n\t\t\t\t\t\t<div className=\"flex items-center mb-4\">\r\n  <div className=\"w-16 h-16 bg-gray-200 rounded-md flex items-center justify-center mr-4 relative\">\r\n    {entityImage ? (\r\n      <>\r\n        <img\r\n          src={entityImage}\r\n          alt={entityName}\r\n          className=\"w-16 h-16 object-cover rounded-md\"\r\n          onError={(e) => {\r\n            const target = e.target as HTMLImageElement;\r\n            target.style.display = 'none';\r\n            const parent = target.parentElement;\r\n            if (parent) {\r\n              parent.querySelector('.fallback-icon')?.classList.remove('hidden');\r\n            }\r\n          }}\r\n        />\r\n        {type === \"product\" ? (\r\n          <Package size={24} className=\"text-gray-400 fallback-icon hidden absolute\" />\r\n        ) : (\r\n          <Store size={24} className=\"text-gray-400 fallback-icon hidden absolute\" />\r\n        )}\r\n      </>\r\n    ) : (\r\n      <>\r\n        {type === \"product\" ? (\r\n          <Package size={24} className=\"text-gray-400\" />\r\n        ) : (\r\n          <Store size={24} className=\"text-gray-400\" />\r\n        )}\r\n      </>\r\n    )}\r\n  </div>\r\n  <div>\r\n    <h4 className=\"font-medium text-gray-900\">{entityName}</h4>\r\n    <p className=\"text-sm text-gray-500\">Pedido: #{orderId}</p>\r\n  </div>\r\n</div>\r\n\r\n\r\n\t\t\t\t\t\t{/* Formulario de Valoración */}\r\n\t\t\t\t\t\t{!isReportMode && !showConfirmation && (\r\n\t\t\t\t\t\t\t<div className=\"space-y-4\">\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n\t\t\t\t\t\t\t\t\t\tTu valoración\r\n\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t<StarRating\r\n\t\t\t\t\t\t\t\t\t\tvalue={rating}\r\n\t\t\t\t\t\t\t\t\t\tonChange={(value) => {\r\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"Valor de StarRating seleccionado:\", value);\r\n\t\t\t\t\t\t\t\t\t\t\tsetRating(value);\r\n\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\tsize=\"large\"\r\n\t\t\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<label\r\n\t\t\t\t\t\t\t\t\t\thtmlFor=\"rating-title\"\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"block text-sm font-medium text-gray-700 mb-1\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\tTítulo (opcional)\r\n\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\tid=\"rating-title\"\r\n\t\t\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Resume tu experiencia\"\r\n\t\t\t\t\t\t\t\t\t\tvalue={title}\r\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setTitle(e.target.value)}\r\n\t\t\t\t\t\t\t\t\t\tmaxLength={100}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<label\r\n\t\t\t\t\t\t\t\t\t\thtmlFor=\"rating-comment\"\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"block text-sm font-medium text-gray-700 mb-1\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\tComentario (opcional)\r\n\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t<textarea\r\n\t\t\t\t\t\t\t\t\t\tid=\"rating-comment\"\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Comparte tu experiencia con este producto\"\r\n\t\t\t\t\t\t\t\t\t\tvalue={comment}\r\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setComment(e.target.value)}\r\n\t\t\t\t\t\t\t\t\t\tmaxLength={500}\r\n\t\t\t\t\t\t\t\t\t\trows={4}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t{/* Formulario de Reporte de Problema */}\r\n\t\t\t\t\t\t{isReportMode && !showConfirmation && (\r\n\t\t\t\t\t\t\t<div className=\"space-y-4\">\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<label\r\n\t\t\t\t\t\t\t\t\t\thtmlFor=\"problem-type\"\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"block text-sm font-medium text-gray-700 mb-1\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\tTipo de problema\r\n\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\t\t\t\tid=\"problem-type\"\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500 bg-white\"\r\n\t\t\t\t\t\t\t\t\t\tvalue={problemType}\r\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setProblemType(e.target.value)}\r\n\t\t\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<option value=\"\">Selecciona el tipo de problema</option>\r\n\t\t\t\t\t\t\t\t\t\t{type === \"product\" ? (\r\n\t\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"not_received\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tProducto no recibido\r\n\t\t\t\t\t\t\t\t\t\t\t\t</option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"damaged\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tProducto dañado/defectuoso\r\n\t\t\t\t\t\t\t\t\t\t\t\t</option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"different\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tProducto diferente al descrito\r\n\t\t\t\t\t\t\t\t\t\t\t\t</option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"incomplete\">Producto incompleto</option>\r\n\t\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"communication\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tProblemas de comunicación\r\n\t\t\t\t\t\t\t\t\t\t\t\t</option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"shipping\">Problemas de envío</option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<option value=\"customer_service\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tMala atención al cliente\r\n\t\t\t\t\t\t\t\t\t\t\t\t</option>\r\n\t\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t<option value=\"other\">Otro problema</option>\r\n\t\t\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<label\r\n\t\t\t\t\t\t\t\t\t\thtmlFor=\"problem-description\"\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"block text-sm font-medium text-gray-700 mb-1\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\tDescripción del problema\r\n\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t<textarea\r\n\t\t\t\t\t\t\t\t\t\tid=\"problem-description\"\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\t\t\t\t\tplaceholder=\"Describe el problema en detalle\"\r\n\t\t\t\t\t\t\t\t\t\tvalue={problemDescription}\r\n\t\t\t\t\t\t\t\t\t\tonChange={(e) => setProblemDescription(e.target.value)}\r\n\t\t\t\t\t\t\t\t\t\trows={4}\r\n\t\t\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t{/* Confirmación de valoración negativa */}\r\n\t\t\t\t\t\t{showConfirmation && (\r\n\t\t\t\t\t\t\t<div className=\"bg-yellow-50 p-4 rounded-md\">\r\n\t\t\t\t\t\t\t\t<div className=\"flex items-start\">\r\n\t\t\t\t\t\t\t\t\t<AlertTriangle\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"text-yellow-600 mt-0.5 mr-3\"\r\n\t\t\t\t\t\t\t\t\t\tsize={20}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<h4 className=\"font-medium text-yellow-800\">\r\n\t\t\t\t\t\t\t\t\t\t\t¿Estás seguro de enviar una valoración baja?\r\n\t\t\t\t\t\t\t\t\t\t</h4>\r\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-yellow-700 mt-1\">\r\n\t\t\t\t\t\t\t\t\t\t\tHas calificado este{\" \"}\r\n\t\t\t\t\t\t\t\t\t\t\t{type === \"product\" ? \"producto\" : \"vendedor\"} con{\" \"}\r\n\t\t\t\t\t\t\t\t\t\t\t{rating} {rating === 1 ? \"estrella\" : \"estrellas\"}.\r\n\t\t\t\t\t\t\t\t\t\t\t¿Quieres continuar o prefieres reportar un problema\r\n\t\t\t\t\t\t\t\t\t\t\tespecífico?\r\n\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Pie del modal con botones de acción */}\r\n\t\t\t\t\t<div className=\"px-6 py-4 border-t border-gray-200 flex justify-between\">\r\n\t\t\t\t\t\t{/* Botón izquierdo (varía según el contexto) */}\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t{!showConfirmation && (\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\tonClick={toggleReportMode}\r\n\t\t\t\t\t\t\t\t\tclassName=\"text-sm text-gray-600 hover:text-gray-800 flex items-center\"\r\n\t\t\t\t\t\t\t\t\tdisabled={isSubmitting}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{isReportMode ? (\r\n\t\t\t\t\t\t\t\t\t\t<>Volver a valoración</>\r\n\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t<AlertTriangle size={14} className=\"mr-1\" />\r\n\t\t\t\t\t\t\t\t\t\t\tReportar problema\r\n\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t{/* Botones principales */}\r\n\t\t\t\t\t\t<div className=\"space-x-3\">\r\n\t\t\t\t\t\t\t{/* Botón de cancelar */}\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\tonClick={handleClose}\r\n\t\t\t\t\t\t\t\tclassName=\"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300\"\r\n\t\t\t\t\t\t\t\tdisabled={isSubmitting}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tCancelar\r\n\t\t\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t\t\t{/* Botón de acción principal */}\r\n\t\t\t\t\t\t\t{showConfirmation ? (\r\n\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => setShowConfirmation(false)}\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-yellow-500\"\r\n\t\t\t\t\t\t\t\t\t\tdisabled={isSubmitting}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\tModificar valoración\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\t\tonClick={handleSubmit}\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n\t\t\t\t\t\t\t\t\t\tdisabled={isSubmitting}\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t{isSubmitting ? \"Enviando...\" : \"Enviar valoración\"}\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\t\tonClick={isReportMode ? handleReportSubmit : handleSubmit}\r\n\t\t\t\t\t\t\t\t\tclassName={`px-4 py-2 text-white rounded-lg focus:outline-none focus:ring-2 ${\r\n\t\t\t\t\t\t\t\t\t\tisReportMode\r\n\t\t\t\t\t\t\t\t\t\t\t? \"bg-orange-600 hover:bg-orange-700 focus:ring-orange-500\"\r\n\t\t\t\t\t\t\t\t\t\t\t: \"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500\"\r\n\t\t\t\t\t\t\t\t\t}`}\r\n\t\t\t\t\t\t\t\t\tdisabled={\r\n\t\t\t\t\t\t\t\t\t\tisSubmitting ||\r\n\t\t\t\t\t\t\t\t\t\t(isReportMode &&\r\n\t\t\t\t\t\t\t\t\t\t\t(!problemType || !problemDescription.trim())) ||\r\n\t\t\t\t\t\t\t\t\t\t(!isReportMode && rating === 0)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{isSubmitting\r\n\t\t\t\t\t\t\t\t\t\t? \"Enviando...\"\r\n\t\t\t\t\t\t\t\t\t\t: isReportMode\r\n\t\t\t\t\t\t\t\t\t\t\t? \"Enviar reporte\"\r\n\t\t\t\t\t\t\t\t\t\t\t: \"Enviar valoración\"}\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default RatingModal;\r\n","// src/presentation/components/rating/PendingRatingsList.tsx\r\nimport React from \"react\";\r\nimport {Link} from \"react-router-dom\";\r\nimport {Package, Store, Clock, Star} from \"lucide-react\";\r\nimport {formatDate} from \"../../../utils/formatters/formatDate\";\r\nimport type {PendingRatingItem} from \"../../../core/services/RatingService\";\r\n\r\ninterface PendingRatingsListProps {\r\n\torderGroups: Array<{\r\n\t\torderId: number;\r\n\t\torderNumber: string;\r\n\t\torderDate: string;\r\n\t\tproducts: PendingRatingItem[];\r\n\t\tsellers: PendingRatingItem[];\r\n\t}>;\r\n\tonRateProduct: (product: PendingRatingItem) => void;\r\n\tonRateSeller: (seller: PendingRatingItem) => void;\r\n}\r\n\r\nconst PendingRatingsList: React.FC<PendingRatingsListProps> = ({\r\n\torderGroups,\r\n\tonRateProduct,\r\n\tonRateSeller,\r\n}) => {\r\n\t// ✅ FUNCIÓN PARA MANEJAR ERRORES DE IMAGEN SIN PLACEHOLDER EXTERNO\r\n\tconst handleImageError = (e: React.SyntheticEvent<HTMLImageElement>) => {\r\n\t\tconst target = e.currentTarget;\r\n\t\t// Ocultar la imagen rota y mostrar el ícono de respaldo\r\n\t\ttarget.style.display = 'none';\r\n\t\tconst parentDiv = target.parentElement;\r\n\t\tif (parentDiv) {\r\n\t\t\tparentDiv.querySelector('.fallback-icon')?.classList.remove('hidden');\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div className=\"space-y-6\">\r\n\t\t\t{orderGroups.map((group) => (\r\n\t\t\t\t<div\r\n\t\t\t\t\tkey={`order-${group.orderId}`}\r\n\t\t\t\t\tclassName=\"bg-white rounded-lg shadow-sm overflow-hidden\"\r\n\t\t\t\t>\r\n\t\t\t\t\t{/* Cabecera de la orden */}\r\n\t\t\t\t\t<div className=\"bg-gray-50 px-6 py-4 border-b border-gray-200\">\r\n\t\t\t\t\t\t<div className=\"flex flex-col md:flex-row md:justify-between md:items-center\">\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<h3 className=\"text-lg font-medium text-gray-900\">\r\n\t\t\t\t\t\t\t\t\tPedido #{group.orderNumber}\r\n\t\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t\t\t<p className=\"text-sm text-gray-500\">\r\n\t\t\t\t\t\t\t\t\tFecha: {formatDate(group.orderDate)}\r\n\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\tto={`/orders/${group.orderId}`}\r\n\t\t\t\t\t\t\t\tclassName=\"text-primary-600 hover:text-primary-800 flex items-center mt-2 md:mt-0\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<Clock className=\"w-4 h-4 mr-1\" />\r\n\t\t\t\t\t\t\t\tVer detalles del pedido\r\n\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Lista de productos pendientes */}\r\n\t\t\t\t\t{group.products.length > 0 && (\r\n\t\t\t\t\t\t<div className=\"px-6 py-4\">\r\n\t\t\t\t\t\t\t<h4 className=\"text-md font-medium text-gray-900 mb-3 flex items-center\">\r\n\t\t\t\t\t\t\t\t<Package className=\"w-5 h-5 mr-2 text-primary-600\" />\r\n\t\t\t\t\t\t\t\tProductos\r\n\t\t\t\t\t\t\t</h4>\r\n\t\t\t\t\t\t\t<div className=\"space-y-4\">\r\n\t\t\t\t\t\t\t\t{group.products.map((product, index) => (\r\n\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\tkey={`product-${product.id || product.productId}-order-${group.orderId}-${index}-${product.order_id || ''}`}\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex flex-col sm:flex-row sm:items-center p-3 border border-gray-200 rounded-lg\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t{/* Imagen y detalles del producto */}\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center flex-grow mb-3 sm:mb-0\">\r\n\t\t\t\t\t\t\t\t\t\t\t{/* CONTENEDOR DE IMAGEN CON FALLBACK LOCAL */}\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-16 h-16 rounded-md mr-4 relative bg-gray-100 flex items-center justify-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t{product.image ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={product.image}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={product.name || 'Producto'}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-16 h-16 object-cover rounded-md\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonError={handleImageError}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* ÍCONO DE RESPALDO LOCAL OCULTO POR DEFECTO */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Package className=\"h-8 w-8 text-gray-400 fallback-icon hidden absolute\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Package className=\"h-8 w-8 text-gray-400\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<h5 className=\"font-medium text-gray-900\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{product.name || `Producto #${product.id || product.productId}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</h5>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tto={`/products/${product.id || product.productId}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-sm text-primary-600 hover:text-primary-800\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tVer producto\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t{/* Botón de valorar */}\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => onRateProduct(product)}\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full sm:w-auto px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 flex items-center justify-center transition-colors\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Star className=\"h-4 w-4 mr-2\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\tValorar producto\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t{/* Lista de vendedores pendientes */}\r\n\t\t\t\t\t{group.sellers.length > 0 && (\r\n\t\t\t\t\t\t<div className=\"px-6 py-4 border-t border-gray-200\">\r\n\t\t\t\t\t\t\t<h4 className=\"text-md font-medium text-gray-900 mb-3 flex items-center\">\r\n\t\t\t\t\t\t\t\t<Store className=\"w-5 h-5 mr-2 text-green-600\" />\r\n\t\t\t\t\t\t\t\tVendedores\r\n\t\t\t\t\t\t\t</h4>\r\n\t\t\t\t\t\t\t<div className=\"space-y-4\">\r\n\t\t\t\t\t\t\t\t{group.sellers.map((seller, index) => (\r\n\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\tkey={`seller-${seller.id || seller.seller_id}-order-${group.orderId}-${index}-${seller.productId || ''}`}\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex flex-col sm:flex-row sm:items-center p-3 border border-gray-200 rounded-lg\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t{/* Imagen y detalles del vendedor */}\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center flex-grow mb-3 sm:mb-0\">\r\n\t\t\t\t\t\t\t\t\t\t\t{/* CONTENEDOR DE IMAGEN CON FALLBACK LOCAL */}\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-16 h-16 rounded-md mr-4 relative bg-gray-100 flex items-center justify-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t{seller.image ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={seller.image}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={seller.name || 'Tienda'}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-16 h-16 object-cover rounded-md\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonError={handleImageError}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* ÍCONO DE RESPALDO LOCAL OCULTO POR DEFECTO */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Store className=\"h-8 w-8 text-gray-400 fallback-icon hidden absolute\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Store className=\"h-8 w-8 text-gray-400\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<h5 className=\"font-medium text-gray-900\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{seller.name || `Vendedor #${seller.seller_id || seller.id}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</h5>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm text-gray-500\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tTienda\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{seller.productId && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"ml-2 text-xs bg-gray-100 px-2 py-1 rounded\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tProducto #{seller.productId}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t{/* Botón de valorar */}\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => onRateSeller(seller)}\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full sm:w-auto px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center justify-center transition-colors\"\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Star className=\"h-4 w-4 mr-2\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\tValorar vendedor\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t))}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default PendingRatingsList;\r\n","// src/presentation/pages/account/PendingRatingsPage.tsx\r\nimport React, {useEffect, useState, useCallback, useRef} from \"react\";\r\nimport {Link} from \"react-router-dom\";\r\nimport {ShoppingBag, Search} from \"lucide-react\";\r\n\r\nimport PendingRatingsAdapter from \"../../../core/adapters/PendingRatingsAdapter\";\r\nimport type {PendingRatingItem} from \"../../../core/services/RatingService\";\r\nimport type {OrderGroup} from \"../../../core/adapters/PendingRatingsAdapter\";\r\nimport RatingModal from \"../../components/rating/RatingModal\";\r\nimport {useRatings} from \"../../hooks/useRatings\";\r\nimport PendingRatingsList from \"../../components/rating/PendingRatingsList\";\r\nimport {extractErrorMessage} from \"../../../utils/errorHandler\";\r\n\r\nconst PendingRatingsPage: React.FC = () => {\r\n\t// Estados para filtros y búsqueda\r\n\tconst [searchTerm, setSearchTerm] = useState<string>(\"\");\r\n\tconst [showRated, setShowRated] = useState<boolean>(false);\r\n\r\n\t// Estados para el modal de valoración\r\n\tconst [isModalOpen, setIsModalOpen] = useState<boolean>(false);\r\n\tconst [modalType, setModalType] = useState<\"product\" | \"seller\">(\"product\");\r\n\tconst [selectedEntity, setSelectedEntity] =\r\n\t\tuseState<PendingRatingItem | null>(null);\r\n\r\n\t// Usar nuestro hook de valoraciones\r\n\tconst {\r\n\t\tloading,\r\n\t\terror,\r\n\t\tgetPendingRatings,\r\n\t\trateProduct,\r\n\t\trateSeller,\r\n\t\treportProblem,\r\n\t} = useRatings();\r\n\r\n\t// Estado para almacenar los grupos de órdenes\r\n\tconst [orderGroups, setOrderGroups] = useState<OrderGroup[]>([]);\r\n\r\n\t// ✅ REF PARA CONTROLAR QUE SOLO SE EJECUTE UNA VEZ\r\n\tconst hasLoadedRef = useRef(false);\r\n\r\n\t// Cargar datos al montar el componente - SOLO UNA VEZ\r\n\tuseEffect(() => {\r\n\t\tif (!hasLoadedRef.current) {\r\n\t\t\thasLoadedRef.current = true;\r\n\t\t\t\r\n\t\t\t// Función interna para obtener valoraciones pendientes\r\n\t\t\tconst loadPendingRatings = async () => {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// Usar el hook para obtener los datos\r\n\t\t\t\t\tconst response = await getPendingRatings();\r\n\r\n\t\t\t\t\tif (response.status !== \"success\") {\r\n\t\t\t\t\t\tthrow new Error(\"Error al obtener las valoraciones pendientes\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Usar el adaptador para transformar los datos al formato esperado\r\n\t\t\t\t\tconst groups = PendingRatingsAdapter.adaptPendingRatings(response);\r\n\t\t\t\t\tsetOrderGroups(groups);\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tconsole.error(\"Error al cargar valoraciones pendientes:\", err);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\tloadPendingRatings();\r\n\t\t}\r\n\t}, []); // ✅ DEPENDENCIAS VACÍAS\r\n\r\n\t// ✅ FUNCIÓN SEPARADA PARA RECARGAR DATOS (usado después de enviar ratings)\r\n\tconst fetchPendingRatings = useCallback(async () => {\r\n\t\ttry {\r\n\t\t\tconst response = await getPendingRatings();\r\n\r\n\t\t\tif (response.status !== \"success\") {\r\n\t\t\t\tthrow new Error(\"Error al obtener las valoraciones pendientes\");\r\n\t\t\t}\r\n\r\n\t\t\tconst groups = PendingRatingsAdapter.adaptPendingRatings(response);\r\n\t\t\tsetOrderGroups(groups);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(\"Error al cargar valoraciones pendientes:\", err);\r\n\t\t}\r\n\t}, [getPendingRatings]); // ✅ SOLO PARA RECARGAR DATOS\r\n\r\n\t// Función para abrir el modal de valoración\r\n\tconst openRatingModal = (\r\n\t\ttype: \"product\" | \"seller\",\r\n\t\tentity: PendingRatingItem\r\n\t) => {\r\n\t\tconsole.log(`💱 Abriendo modal de ${type}:`, {\r\n\t\t\tid: entity.id,\r\n\t\t\tproductId: entity.productId,\r\n\t\t\tseller_id: entity.seller_id,\r\n\t\t\tname: entity.name,\r\n\t\t\torder_id: entity.order_id\r\n\t\t});\r\n\t\t\r\n\t\tsetModalType(type);\r\n\t\tsetSelectedEntity(entity);\r\n\t\tsetIsModalOpen(true);\r\n\t};\r\n\r\n\t// Función para cerrar el modal\r\n\tconst closeModal = () => {\r\n\t\tsetIsModalOpen(false);\r\n\t\tsetSelectedEntity(null);\r\n\t};\r\n\r\n\t// Función para enviar una valoración\r\n\tconst handleSubmitRating = async (data: {\r\n\trating: number;\r\n\ttitle?: string;\r\n\tcomment?: string;\r\n\tentityId: number;\r\n\torderId: number;\r\n\t}) => {\r\n\tconsole.log(`📨 Enviando valoración de ${modalType}:`, {\r\n\tmodalType,\r\n\tentityId: data.entityId,\r\n\torderId: data.orderId,\r\n\trating: data.rating,\r\n\ttitle: data.title,\r\n\tcomment: data.comment\r\n\t});\r\n\t\r\n\ttry {\r\n\tif (modalType === \"product\") {\r\n\tconsole.log(`📦 Llamando rateProduct con product_id: ${data.entityId}`);\r\n\tawait rateProduct({\r\n\tproduct_id: data.entityId,\r\n\torder_id: data.orderId,\r\n\trating: data.rating,\r\n\ttitle: data.title,\r\n\tcomment: data.comment,\r\n\t});\r\n\t} else {\r\n\t// Para vendedor: usar el productId asociado desde selectedEntity\r\n\tconst productIdForVendor = selectedEntity?.productId;\r\n\t\r\n\tif (!productIdForVendor) {\r\n\t throw new Error('No se puede calificar al vendedor: falta el ID del producto asociado');\r\n\t}\r\n\t\r\n\tconsole.log(`🏦 Llamando rateSeller con seller_id: ${data.entityId}, product_id: ${productIdForVendor}`);\r\n\t\r\n\t// Construir datos de rating con product_id válido\r\n\tconst ratingData = {\r\n\t seller_id: data.entityId,\r\n\t order_id: data.orderId,\r\n\t rating: data.rating,\r\n\t title: data.title,\r\n\t comment: data.comment,\r\n\tproduct_id: productIdForVendor\r\n\t};\r\n\t\r\n\tconsole.log(`📨 Datos finales para rateSeller:`, ratingData);\r\n\t\r\n\tawait rateSeller(ratingData);\r\n\t}\r\n\r\n\t// Actualizar datos\r\n\tawait fetchPendingRatings();\r\n\r\n\t// Mostrar mensaje de éxito\r\n\talert(\"Valoración enviada con éxito\");\r\n\r\n\t// Cerrar el modal\r\n\tcloseModal();\r\n\t} catch (error) {\r\n\tconsole.error(\"Error al enviar valoración:\", error);\r\n\talert(extractErrorMessage(error, \"Error al enviar la valoración\"));\r\n\t}\r\n\t};\r\n\r\n\t// Función para reportar un problema\r\n\tconst handleReportProblem = async (data: {\r\n\t\ttype: \"product\" | \"seller\";\r\n\t\tentityId: number;\r\n\t\torderId: number;\r\n\t\tproblemType: string;\r\n\t\tdescription: string;\r\n\t}) => {\r\n\t\ttry {\r\n\t\t\tawait reportProblem({\r\n\t\t\t\ttype: data.type,\r\n\t\t\t\tentity_id: data.entityId,\r\n\t\t\t\torder_id: data.orderId,\r\n\t\t\t\tproblem_type: data.problemType,\r\n\t\t\t\tdescription: data.description,\r\n\t\t\t});\r\n\r\n\t\t\t// Actualizar datos\r\n\t\t\tawait fetchPendingRatings();\r\n\r\n\t\t\t// Mostrar mensaje de éxito\r\n\t\t\talert(\"Problema reportado con éxito\");\r\n\r\n\t\t\t// Cerrar el modal\r\n\t\t\tcloseModal();\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error al reportar problema:\", error);\r\n\t\t\talert(extractErrorMessage(error, \"Error al reportar el problema\"));\r\n\t\t}\r\n\t};\r\n\r\n\t// Filtrar órdenes por término de búsqueda\r\n\tconst filteredGroups = orderGroups.filter((group) => {\r\n\t\tif (searchTerm === \"\") return true;\r\n\r\n\t\tconst searchLower = searchTerm.toLowerCase();\r\n\r\n\t\t// Buscar en número de orden\r\n\t\tif (group.orderNumber.toLowerCase().includes(searchLower)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// Buscar en productos\r\n\t\tif (\r\n\t\t\tgroup.products.some((product) =>\r\n\t\t\t\tproduct.name.toLowerCase().includes(searchLower)\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// Buscar en vendedores\r\n\t\tif (\r\n\t\t\tgroup.sellers.some((seller) =>\r\n\t\t\t\t(seller.name || \"\").toLowerCase().includes(searchLower)\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t});\r\n\r\n\t// Verificar si hay elementos pendientes\r\n\tconst hasPendingItems = orderGroups.some(\r\n\t\t(group) => group.products.length > 0 || group.sellers.length > 0\r\n\t);\r\n\r\n\treturn (\r\n\t\t<div className=\"container mx-auto p-4 px-10\">\r\n\t\t\t<h1 className=\"text-2xl font-bold text-gray-900\">\r\n\t\t\t\tValoraciones pendientes\r\n\t\t\t</h1>\r\n\r\n\t\t\t{/* Filtros y búsqueda */}\r\n\t\t\t<div className=\"flex flex-col md:flex-row gap-4 mb-6\">\r\n\t\t\t\t<div className=\"relative flex-grow\">\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\tplaceholder=\"Buscar por pedido o producto...\"\r\n\t\t\t\t\t\tclassName=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\tvalue={searchTerm}\r\n\t\t\t\t\t\tonChange={(e) => setSearchTerm(e.target.value)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Search className=\"absolute left-3 top-2.5 h-5 w-5 text-gray-400\" />\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"flex items-center\">\r\n\t\t\t\t\t<label className=\"inline-flex items-center\">\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype=\"checkbox\"\r\n\t\t\t\t\t\t\tclassName=\"form-checkbox h-5 w-5 text-primary-600\"\r\n\t\t\t\t\t\t\tchecked={showRated}\r\n\t\t\t\t\t\t\tonChange={(e) => setShowRated(e.target.checked)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<span className=\"ml-2 text-gray-700\">\r\n\t\t\t\t\t\t\tMostrar también valorados\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t</label>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t{/* Estado de carga */}\r\n\t\t\t{loading && (\r\n\t\t\t\t<div className=\"flex justify-center my-12\">\r\n\t\t\t\t\t<div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\r\n\t\t\t{/* Mensaje de error */}\r\n\t\t\t{error && (\r\n\t\t\t\t<div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6\">\r\n\t\t\t\t\t<strong className=\"font-bold\">Error: </strong>\r\n\t\t\t\t\t<span className=\"block sm:inline\">{error}</span>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\r\n\t\t\t{/* Sin valoraciones pendientes */}\r\n\t\t\t{!loading && !error && !hasPendingItems && (\r\n\t\t\t\t<div className=\"bg-white rounded-lg shadow-sm p-8 text-center\">\r\n\t\t\t\t\t<ShoppingBag className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\r\n\t\t\t\t\t<h2 className=\"text-xl font-semibold text-gray-900 mb-2\">\r\n\t\t\t\t\t\tNo tienes valoraciones pendientes\r\n\t\t\t\t\t</h2>\r\n\t\t\t\t\t<p className=\"text-gray-600 max-w-md mx-auto\">\r\n\t\t\t\t\t\tTodas tus compras recientes han sido valoradas. ¡Gracias por\r\n\t\t\t\t\t\tcompartir tu opinión!\r\n\t\t\t\t\t</p>\r\n\t\t\t\t\t<Link\r\n\t\t\t\t\t\tto=\"/orders\"\r\n\t\t\t\t\t\tclassName=\"mt-4 inline-block px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tVer mis pedidos\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\r\n\t\t\t{/* Lista de órdenes con valoraciones pendientes */}\r\n\t\t\t{!loading && !error && filteredGroups.length > 0 && (\r\n\t\t\t\t<PendingRatingsList\r\n\t\t\t\t\torderGroups={filteredGroups}\r\n\t\t\t\t\tonRateProduct={(product) => openRatingModal(\"product\", product)}\r\n\t\t\t\t\tonRateSeller={(seller) => openRatingModal(\"seller\", seller)}\r\n\t\t\t\t/>\r\n\t\t\t)}\r\n\r\n\t\t\t{/* Modal de valoración */}\r\n\t\t\t{selectedEntity && (\r\n\t\t\t<RatingModal\r\n\t\t\ttype={modalType}\r\n\t\t\tentityId={\r\n\t\t\t(() => {\r\n\t\t\t// Para productos: usar productId o id\r\n\t\t\t// Para vendedores: usar seller_id o id\r\n\t\t\tconst calculatedId = modalType === \"product\"\r\n\t\t\t? (selectedEntity.productId || selectedEntity.id || 0)\r\n\t\t\t : (selectedEntity.seller_id || selectedEntity.id || 0);\r\n\t\t\t    \r\n\t\t\tconsole.log(`🎭 Modal recibirá entityId para ${modalType}:`, {\r\n\t\t\tcalculatedId,\r\n\t\t\tselectedEntity_id: selectedEntity.id,\r\n\t\t\t selectedEntity_productId: selectedEntity.productId,\r\n\t\t\t selectedEntity_seller_id: selectedEntity.seller_id\r\n\t\t\t});\r\n\t\t\t \r\n\t\t\t  return calculatedId;\r\n\t\t\t })()\r\n\t\t\t}\r\n\t\t\tentityName={\r\n\t\t\tselectedEntity.name ||\r\n\t\t\t`${modalType === \"product\" ? \"Producto\" : \"Vendedor\"} #${\r\n\t\t\tmodalType === \"product\"\r\n\t\t\t  ? (selectedEntity.productId || selectedEntity.id)\r\n\t\t\t   : (selectedEntity.seller_id || selectedEntity.id)\r\n\t\t\t }`\r\n\t\t\t}\r\n\t\t\tentityImage={selectedEntity.image}\r\n\t\t\torderId={selectedEntity.order_id}\r\n\t\t\tisOpen={isModalOpen}\r\n\t\t\tonClose={closeModal}\r\n\t\t\tonSubmit={handleSubmitRating}\r\n\t\t\t onReport={handleReportProblem}\r\n\t\t\t/>\r\n\t\t)}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default PendingRatingsPage;\r\n"],"names":["PendingRatingsAdapter","apiResponse","products","sellers","orderGroupsMap","product","orderId","adaptedProduct","seller","index","adaptedSeller","a","b","RatingModal","type","entityId","entityName","entityImage","isOpen","onClose","onSubmit","onReport","rating","setRating","useState","title","setTitle","comment","setComment","isSubmitting","setIsSubmitting","isReportMode","setIsReportMode","problemType","setProblemType","problemDescription","setProblemDescription","showConfirmation","setShowConfirmation","resetForm","handleClose","handleSubmit","error","handleReportSubmit","toggleReportMode","jsxs","jsx","X","Fragment","AlertTriangle","Package","Store","e","target","parent","StarRating","value","PendingRatingsList","orderGroups","onRateProduct","onRateSeller","handleImageError","parentDiv","group","formatDate","Link","Clock","Star","PendingRatingsPage","searchTerm","setSearchTerm","showRated","setShowRated","isModalOpen","setIsModalOpen","modalType","setModalType","selectedEntity","setSelectedEntity","loading","getPendingRatings","rateProduct","rateSeller","reportProblem","useRatings","setOrderGroups","hasLoadedRef","useRef","useEffect","response","groups","err","fetchPendingRatings","useCallback","openRatingModal","entity","closeModal","handleSubmitRating","data","productIdForVendor","ratingData","extractErrorMessage","handleReportProblem","filteredGroups","searchLower","hasPendingItems","Search","ShoppingBag","calculatedId"],"mappings":"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"}