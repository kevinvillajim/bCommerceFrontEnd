{"version":3,"file":"SellerShippingPage-H3MCosNu.js","sources":["../../src/presentation/pages/seller/SellerShippingPage.tsx"],"sourcesContent":["import React, {useState, useEffect} from \"react\";\r\nimport {Link} from \"react-router-dom\";\r\nimport {\r\n\tTruck,\r\n\tSearch,\r\n\tFilter,\r\n\tRefreshCw,\r\n\tExternalLink,\r\n\tPackageCheck,\r\n\tPrinter,\r\n\tAlertTriangle,\r\n\tPackage,\r\n\tMapPin,\r\n\tClipboardList,\r\n\tBarChart2,\r\n\tChevronDown,\r\n} from \"lucide-react\";\r\nimport Table from \"../../components/dashboard/Table\";\r\nimport {formatCurrency} from \"../../../utils/formatters/formatCurrency\";\r\nimport {SellerStatCardList} from \"../../components/dashboard/SellerStatCardList\";\r\nimport ShippingServiceAdapter from \"../../../core/adapters/ShippingServiceAdapter\";\r\nimport type {ShippingItem} from \"../../../core/adapters/ShippingServiceAdapter\";\r\nimport ShippingFormModal from \"../../components/shipping/ShippingFormModal\";\r\nimport type {ShippingFormData} from \"../../components/shipping/ShippingFormModal\";\r\n\r\n// Componente Dropdown para cambiar estado de envío\r\nconst ShippingStatusDropdown: React.FC<{\r\n\tcurrentStatus: ShippingItem[\"status\"];\r\n\tshippingId: string;\r\n\tonStatusChange: (id: string, status: ShippingItem[\"status\"]) => Promise<void>;\r\n\tdisabled?: boolean;\r\n}> = ({ currentStatus, shippingId, onStatusChange, disabled = false }) => {\r\n\tconst [isOpen, setIsOpen] = useState(false);\r\n\tconst [isUpdating, setIsUpdating] = useState(false);\r\n\r\n\t// Mapeo de estados con labels amigables\r\n\tconst SHIPPING_STATUSES = [\r\n\t\t{ value: 'pending' as const, label: 'Pendiente', color: 'bg-yellow-100 text-yellow-800' },\r\n\t\t{ value: 'ready_to_ship' as const, label: 'Listo para enviar', color: 'bg-blue-100 text-blue-800' },\r\n\t\t{ value: 'shipped' as const, label: 'Enviado', color: 'bg-purple-100 text-purple-800' },\r\n\t\t{ value: 'in_transit' as const, label: 'En tránsito', color: 'bg-indigo-100 text-indigo-800' },\r\n\t\t{ value: 'delivered' as const, label: 'Entregado', color: 'bg-green-100 text-green-800' },\r\n\t\t{ value: 'failed' as const, label: 'Fallido', color: 'bg-red-100 text-red-800' },\r\n\t\t{ value: 'returned' as const, label: 'Devuelto', color: 'bg-orange-100 text-orange-800' },\r\n\t];\r\n\r\n\t// Encontrar el estado actual para mostrar\r\n\tconst currentStatusInfo = SHIPPING_STATUSES.find(s => s.value === currentStatus) || SHIPPING_STATUSES[0];\r\n\r\n\tconst handleStatusChange = async (newStatus: ShippingItem[\"status\"]) => {\r\n\t\tif (newStatus === currentStatus || isUpdating) return;\r\n\t\t\r\n\t\tsetIsUpdating(true);\r\n\t\tsetIsOpen(false);\r\n\t\t\r\n\t\ttry {\r\n\t\t\tawait onStatusChange(shippingId, newStatus);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Error al actualizar estado:', error);\r\n\t\t} finally {\r\n\t\t\tsetIsUpdating(false);\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div className=\"relative inline-block text-left\">\r\n\t\t\t{/* Botón principal */}\r\n\t\t\t<button\r\n\t\t\t\tonClick={() => setIsOpen(!isOpen)}\r\n\t\t\t\tdisabled={disabled || isUpdating}\r\n\t\t\t\tclassName={`\r\n\t\t\t\t\tinline-flex items-center gap-2 px-3 py-1.5 text-xs font-medium rounded-full\r\n\t\t\t\t\t${currentStatusInfo.color}\r\n\t\t\t\t\t${disabled || isUpdating ? 'opacity-50 cursor-not-allowed' : 'hover:opacity-80 cursor-pointer'}\r\n\t\t\t\t\ttransition-all duration-200\r\n\t\t\t\t`}\r\n\t\t\t>\r\n\t\t\t\t<span className={`w-2 h-2 rounded-full ${\r\n\t\t\t\t\tisUpdating ? 'animate-pulse bg-current' : 'bg-current'\r\n\t\t\t\t}`}></span>\r\n\t\t\t\t{isUpdating ? 'Actualizando...' : currentStatusInfo.label}\r\n\t\t\t\t\r\n\t\t\t\t{/* Icono de flecha */}\r\n\t\t\t\t<ChevronDown \r\n\t\t\t\t\tclassName={`w-3 h-3 transition-transform duration-200 ${isOpen ? 'rotate-180' : ''}`}\r\n\t\t\t\t/>\r\n\t\t\t</button>\r\n\r\n\t\t\t{/* Dropdown menu */}\r\n\t\t\t{isOpen && !disabled && !isUpdating && (\r\n\t\t\t\t<>\r\n\t\t\t\t\t{/* Overlay para cerrar */}\r\n\t\t\t\t\t<div \r\n\t\t\t\t\t\tclassName=\"fixed inset-0 z-10\"\r\n\t\t\t\t\t\tonClick={() => setIsOpen(false)}\r\n\t\t\t\t\t></div>\r\n\t\t\t\t\t\r\n\t\t\t\t\t{/* Menu - CORREGIDO: posicionamiento absoluto hacia abajo */}\r\n\t\t\t\t\t<div className=\"absolute top-full left-0 z-20 mt-1 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none\">\r\n\t\t\t\t\t\t<div className=\"flex flex-col divide-y divide-gray-200\">\r\n\t\t\t\t\t\t\t{SHIPPING_STATUSES.map((status) => (\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\tkey={status.value}\r\n\t\t\t\t\t\t\t\t\tonClick={() => handleStatusChange(status.value)}\r\n\t\t\t\t\t\t\t\t\tclassName={`\r\n\t\t\t\t\t\t\t\t\t\tw-full cursor-pointer text-left px-4 py-2 text-sm transition-colors duration-150\r\n\t\t\t\t\t\t\t\t\t\t${status.value === currentStatus \r\n\t\t\t\t\t\t\t\t\t\t\t? 'bg-gray-100 text-gray-900 font-medium' \r\n\t\t\t\t\t\t\t\t\t\t\t: 'text-gray-700 hover:bg-gray-50'\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t`}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-3\">\r\n\t\t\t\t\t\t\t\t\t\t<span className={`w-2 h-2 rounded-full ${\r\n\t\t\t\t\t\t\t\t\t\t\tstatus.color.includes('bg-yellow') ? 'bg-yellow-500' :\r\n\t\t\t\t\t\t\t\t\t\t\tstatus.color.includes('bg-blue') ? 'bg-blue-500' :\r\n\t\t\t\t\t\t\t\t\t\t\tstatus.color.includes('bg-purple') ? 'bg-purple-500' :\r\n\t\t\t\t\t\t\t\t\t\t\tstatus.color.includes('bg-indigo') ? 'bg-indigo-500' :\r\n\t\t\t\t\t\t\t\t\t\t\tstatus.color.includes('bg-green') ? 'bg-green-500' :\r\n\t\t\t\t\t\t\t\t\t\t\tstatus.color.includes('bg-red') ? 'bg-red-500' :\r\n\t\t\t\t\t\t\t\t\t\t\tstatus.color.includes('bg-orange') ? 'bg-orange-500' :\r\n\t\t\t\t\t\t\t\t\t\t\t'bg-gray-400'\r\n\t\t\t\t\t\t\t\t\t\t}`}></span>\r\n\t\t\t\t\t\t\t\t\t\t<span>{status.label}</span>\r\n\t\t\t\t\t\t\t\t\t\t{status.value === currentStatus && (\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"ml-auto text-xs text-gray-500\">Actual</span>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nconst SellerShippingPage: React.FC = () => {\r\n\t// Instanciar el adaptador de servicio\r\n\tconst shippingAdapter = new ShippingServiceAdapter();\r\n\r\n\t// Estados\r\n\tconst [shippingItems, setShippingItems] = useState<ShippingItem[]>([]);\r\n\tconst [loading, setLoading] = useState(true);\r\n\tconst [error, setError] = useState<string | null>(null);\r\n\tconst [statusFilter, setStatusFilter] = useState<string>(\"all\");\r\n\tconst [carrierFilter, setCarrierFilter] = useState<string>(\"all\");\r\n\tconst [dateFilter, setDateFilter] = useState<string>(\"all\");\r\n\tconst [searchTerm, setSearchTerm] = useState<string>(\"\");\r\n\tconst [pagination, setPagination] = useState({\r\n\t\tcurrentPage: 1,\r\n\t\ttotalPages: 1,\r\n\t\ttotalItems: 0,\r\n\t\titemsPerPage: 10,\r\n\t});\r\n\tconst [dateRange, setDateRange] = useState({\r\n\t\tfrom: \"\",\r\n\t\tto: \"\",\r\n\t});\r\n\tconst [isUpdateSuccess, setIsUpdateSuccess] = useState<boolean | null>(null);\r\n\tconst [updateMessage, setUpdateMessage] = useState<string>(\"\");\r\n\tconst [isUpdating, setIsUpdating] = useState(false);\r\n\r\n\t// Estado para controlar el modal de asignación de tracking\r\n\tconst [isShippingModalOpen, setIsShippingModalOpen] = useState(false);\r\n\tconst [selectedOrderId, setSelectedOrderId] = useState<string | null>(null);\r\n\r\n\t// Cargar datos de envíos\r\n\tuseEffect(() => {\r\n\t\tfetchShippingItems();\r\n\t}, [\r\n\t\tstatusFilter,\r\n\t\tcarrierFilter,\r\n\t\tsearchTerm,\r\n\t\tpagination.currentPage,\r\n\t\tdateFilter,\r\n\t\tdateRange,\r\n\t]);\r\n\r\n\t// Función para obtener envíos usando el adaptador\r\n\tconst fetchShippingItems = async () => {\r\n\t\tsetLoading(true);\r\n\t\tsetError(null);\r\n\t\ttry {\r\n\t\t\t// Preparar filtros para la API\r\n\t\t\tconst filters: any = {\r\n\t\t\t\tpage: pagination.currentPage,\r\n\t\t\t\tlimit: pagination.itemsPerPage,\r\n\t\t\t};\r\n\r\n\t\t\tif (statusFilter !== \"all\") {\r\n\t\t\t\tfilters.status = statusFilter;\r\n\t\t\t}\r\n\r\n\t\t\tif (carrierFilter !== \"all\") {\r\n\t\t\t\tfilters.carrier = carrierFilter;\r\n\t\t\t}\r\n\r\n\t\t\tif (searchTerm) {\r\n\t\t\t\tfilters.search = searchTerm;\r\n\t\t\t}\r\n\r\n\t\t\t// Añadir filtros de fecha según la selección\r\n\t\t\tif (dateFilter === \"today\") {\r\n\t\t\t\tconst today = new Date().toISOString().split(\"T\")[0];\r\n\t\t\t\tfilters.dateFrom = today;\r\n\t\t\t\tfilters.dateTo = today;\r\n\t\t\t} else if (dateFilter === \"week\") {\r\n\t\t\t\tconst today = new Date();\r\n\t\t\t\tconst firstDay = new Date(\r\n\t\t\t\t\ttoday.setDate(today.getDate() - today.getDay())\r\n\t\t\t\t);\r\n\t\t\t\tfilters.dateFrom = firstDay.toISOString().split(\"T\")[0];\r\n\t\t\t\tfilters.dateTo = new Date().toISOString().split(\"T\")[0];\r\n\t\t\t} else if (dateFilter === \"month\") {\r\n\t\t\t\tconst today = new Date();\r\n\t\t\t\tconst firstDay = new Date(today.getFullYear(), today.getMonth(), 1);\r\n\t\t\t\tfilters.dateFrom = firstDay.toISOString().split(\"T\")[0];\r\n\t\t\t\tfilters.dateTo = new Date().toISOString().split(\"T\")[0];\r\n\t\t\t} else if (dateFilter === \"custom\" && dateRange.from && dateRange.to) {\r\n\t\t\t\tfilters.dateFrom = dateRange.from;\r\n\t\t\t\tfilters.dateTo = dateRange.to;\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log(\"Cargando envíos con filtros:\", filters);\r\n\r\n\t\t\t// Obtener envíos del adaptador\r\n\t\t\tconst result = await shippingAdapter.getShippingsList(filters);\r\n\r\n\t\t\tconsole.log(\"Datos de envío obtenidos:\", result);\r\n\r\n\t\t\t// Establecer envíos y datos de paginación\r\n\t\t\tsetShippingItems(result.items);\r\n\t\t\tsetPagination(result.pagination);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error al cargar envíos:\", error);\r\n\t\t\tsetError(\r\n\t\t\t\t\"No se pudieron cargar los datos de envíos. Intenta de nuevo más tarde.\"\r\n\t\t\t);\r\n\t\t} finally {\r\n\t\t\tsetLoading(false);\r\n\t\t}\r\n\t};\r\n\r\n\t// Manejar asignación de número de seguimiento\r\n\tconst openShippingModal = (orderId: string) => {\r\n\t\tsetSelectedOrderId(orderId);\r\n\t\tsetIsShippingModalOpen(true);\r\n\t};\r\n\r\n\t// Procesar envío con datos del formulario\r\n\tconst handleShippingSubmit = async (shippingData: ShippingFormData) => {\r\n\t\tif (!selectedOrderId) {\r\n\t\t\tsetIsUpdateSuccess(false);\r\n\t\t\tsetUpdateMessage(\"Error: No se ha seleccionado un pedido válido\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetIsUpdating(true);\r\n\t\tsetIsUpdateSuccess(null);\r\n\t\tsetUpdateMessage(\"\");\r\n\r\n\t\ttry {\r\n\t\t\tconsole.log(\"Procesando envío para orden:\", selectedOrderId, shippingData);\r\n\r\n\t\t\tconst success = await shippingAdapter.markAsShipped(\r\n\t\t\t\tselectedOrderId,\r\n\t\t\t\tshippingData\r\n\t\t\t);\r\n\r\n\t\t\tif (success) {\r\n\t\t\t\tsetIsUpdateSuccess(true);\r\n\t\t\t\tsetUpdateMessage(\"Envío procesado correctamente\");\r\n\r\n\t\t\t\t// Actualizar el estado del envío en la lista local\r\n\t\t\t\tsetShippingItems((prevItems) =>\r\n\t\t\t\t\tprevItems.map((item) => {\r\n\t\t\t\t\t\tif (item.orderId === selectedOrderId) {\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\t\tstatus: \"shipped\",\r\n\t\t\t\t\t\t\t\ttrackingNumber: shippingData.tracking_number,\r\n\t\t\t\t\t\t\t\tcarrier: shippingData.shipping_company,\r\n\t\t\t\t\t\t\t\testimatedDelivery: shippingData.estimated_delivery,\r\n\t\t\t\t\t\t\t\tlastUpdate: new Date().toISOString(),\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Cerrar el modal\r\n\t\t\t\tsetIsShippingModalOpen(false);\r\n\t\t\t\tsetSelectedOrderId(null);\r\n\r\n\t\t\t\t// Recargar los datos después de un breve retraso\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tfetchShippingItems();\r\n\t\t\t\t\tsetIsUpdateSuccess(null);\r\n\t\t\t\t}, 3000);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"El servidor no pudo procesar el envío\");\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error al procesar envío:\", error);\r\n\t\t\tsetIsUpdateSuccess(false);\r\n\t\t\tsetUpdateMessage(\"Error al procesar el envío. Intenta de nuevo.\");\r\n\t\t} finally {\r\n\t\t\tsetIsUpdating(false);\r\n\t\t}\r\n\t};\r\n\r\n\t// Función para actualizar estado de envío\r\n\tconst updateShippingStatus = async (\r\n\t\tshippingId: string,\r\n\t\tnewStatus: ShippingItem[\"status\"]\r\n\t) => {\r\n\t\tsetIsUpdating(true);\r\n\t\tsetIsUpdateSuccess(null);\r\n\t\tsetUpdateMessage(\"\");\r\n\r\n\t\ttry {\r\n\t\t\tconsole.log(`Actualizando estado del envío ${shippingId} a ${newStatus}`);\r\n\r\n\t\t\tconst success = await shippingAdapter.updateShippingStatus(\r\n\t\t\t\tshippingId,\r\n\t\t\t\tnewStatus\r\n\t\t\t);\r\n\r\n\t\t\tif (success) {\r\n\t\t\t\tsetIsUpdateSuccess(true);\r\n\t\t\t\tsetUpdateMessage(`Estado actualizado a ${getStatusText(newStatus)}`);\r\n\r\n\t\t\t\t// Actualizar el estado en la lista local\r\n\t\t\t\tsetShippingItems((prevItems) =>\r\n\t\t\t\t\tprevItems.map((item) => {\r\n\t\t\t\t\t\tif (item.id === shippingId) {\r\n\t\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\t\tstatus: newStatus,\r\n\t\t\t\t\t\t\t\tlastUpdate: new Date().toISOString(),\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Recargar los datos después de un breve retraso\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tfetchShippingItems();\r\n\t\t\t\t\tsetIsUpdateSuccess(null);\r\n\t\t\t\t}, 3000);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"El servidor no pudo actualizar el estado\");\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(`Error al actualizar estado a ${newStatus}:`, error);\r\n\t\t\tsetIsUpdateSuccess(false);\r\n\t\t\tsetUpdateMessage(\"Error al actualizar estado. Intenta de nuevo.\");\r\n\t\t} finally {\r\n\t\t\tsetIsUpdating(false);\r\n\t\t}\r\n\t};\r\n\r\n\t// Función para asignar número de seguimiento\r\n\tconst assignTrackingNumber = async (orderId: string) => {\r\n\t\t// Abrir el modal para capturar los datos de seguimiento\r\n\t\topenShippingModal(orderId);\r\n\t};\r\n\r\n\t// Manejar cambio de página\r\n\tconst handlePageChange = (page: number) => {\r\n\t\tsetPagination((prev) => ({...prev, currentPage: page}));\r\n\t};\r\n\r\n\t// Refrescar datos\r\n\tconst refreshData = () => {\r\n\t\tsetLoading(true);\r\n\t\tsetError(null);\r\n\t\tfetchShippingItems();\r\n\t};\r\n\r\n\t// Obtener texto según el estado\r\n\tconst getStatusText = (status: ShippingItem[\"status\"]): string => {\r\n\t\tswitch (status) {\r\n\t\t\tcase \"pending\":\r\n\t\t\t\treturn \"Pendiente\";\r\n\t\t\tcase \"ready_to_ship\":\r\n\t\t\t\treturn \"Listo para enviar\";\r\n\t\t\tcase \"in_transit\":\r\n\t\t\tcase \"shipped\":\r\n\t\t\t\treturn \"En tránsito\";\r\n\t\t\tcase \"delivered\":\r\n\t\t\t\treturn \"Entregado\";\r\n\t\t\tcase \"failed\":\r\n\t\t\t\treturn \"Fallido\";\r\n\t\t\tcase \"returned\":\r\n\t\t\t\treturn \"Devuelto\";\r\n\t\t\tdefault:\r\n\t\t\t\treturn \"Desconocido\";\r\n\t\t}\r\n\t};\r\n\r\n\t// ✅ FUNCIÓN ELIMINADA: getStatusClass - No se usaba en ningún lugar\r\n\r\n\t// Definir las columnas de la tabla\r\n\tconst columns = [\r\n    {\r\n      key: \"orderNumber\",\r\n      header: \"Nº Pedido\",\r\n      sortable: true,\r\n      render: (item: ShippingItem) => (\r\n        <Link\r\n          to={`/seller/orders/${item.orderId}`}\r\n          className=\"font-medium text-primary-600 hover:underline\"\r\n        >\r\n          {item.orderNumber}\r\n        </Link>\r\n      ),\r\n    },\r\n    {\r\n      key: \"trackingNumber\",\r\n      header: \"Nº Seguimiento\",\r\n      sortable: true,\r\n      render: (item: ShippingItem) => (\r\n        <div>\r\n          {item.trackingNumber ? (\r\n            <div className=\"flex items-center\">\r\n              <span className=\"font-mono text-sm\">{item.trackingNumber}</span>\r\n              {item.carrier && (\r\n                <button\r\n                  onClick={() => {\r\n                    if (item.trackingNumber) {\r\n                      navigator.clipboard\r\n                        .writeText(item.trackingNumber)\r\n                        .then(() => {\r\n                          alert(\r\n                            `${item.trackingNumber} copiado al portapapeles`\r\n                          );\r\n                        })\r\n                        .catch((err) => {\r\n                          console.error(\r\n                            \"Error al copiar al portapapeles:\",\r\n                            err\r\n                          );\r\n                          alert(\"Hubo un error al copiar\");\r\n                        });\r\n                    } else {\r\n                      alert(\"No hay número de seguimiento para copiar\");\r\n                    }\r\n                  }}\r\n                  className=\"ml-2 text-blue-600 hover:text-blue-800\"\r\n                  title={`Rastrear con ${item.carrier}`}\r\n                >\r\n                  <ExternalLink size={14} />\r\n                </button>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <span className=\"text-gray-500 text-sm\">No asignado</span>\r\n          )}\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      key: \"date\",\r\n      header: \"Fecha de Pedido\",\r\n      sortable: true,\r\n      render: (item: ShippingItem) => {\r\n        const date = new Date(item.date);\r\n        return (\r\n          <span className=\"text-sm\">{date.toLocaleDateString(\"es-ES\")}</span>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      key: \"customer\",\r\n      header: \"Cliente\",\r\n      sortable: true,\r\n      render: (item: ShippingItem) => (\r\n        <div>\r\n          <div className=\"font-medium text-sm\">{item.customer.name}</div>\r\n          <div className=\"text-xs text-gray-500 truncate max-w-[150px]\">\r\n            {item.shippingAddress}\r\n          </div>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      key: \"status\",\r\n      header: \"Estado\",\r\n      sortable: true,\r\n      render: (item: ShippingItem) => {\r\n        // ✅ NUEVO: Usar el dropdown en lugar del badge estático\r\n        return (\r\n          <ShippingStatusDropdown\r\n            currentStatus={item.status}\r\n            shippingId={item.id}\r\n            onStatusChange={updateShippingStatus}\r\n            disabled={isUpdating}\r\n          />\r\n        );\r\n      },\r\n    },\r\n    {\r\n      key: \"carrier\",\r\n      header: \"Transportista\",\r\n      sortable: true,\r\n      render: (item: ShippingItem) => (\r\n        <span>{item.carrier || \"No asignado\"}</span>\r\n      ),\r\n    },\r\n    {\r\n      key: \"estimatedDelivery\",\r\n      header: \"Entrega Estimada\",\r\n      sortable: true,\r\n      render: (item: ShippingItem) => (\r\n        <span>\r\n          {item.estimatedDelivery\r\n            ? new Date(item.estimatedDelivery).toLocaleDateString(\"es-ES\")\r\n            : \"No disponible\"}\r\n        </span>\r\n      ),\r\n    },\r\n    {\r\n      key: \"actions\",\r\n      header: \"Acciones\",\r\n      render: (item: ShippingItem) => (\r\n        <div className=\"flex justify-end space-x-2\">\r\n          {/* Ver detalles del envío */}\r\n          <Link\r\n            to={`/seller/shipping/${item.id}`}\r\n            className=\"p-1 text-blue-600 hover:bg-blue-100 rounded-md\"\r\n            title=\"Ver detalles\"\r\n          >\r\n            <ClipboardList size={18} />\r\n          </Link>\r\n\r\n          {/* Asignar número de seguimiento - solo para pendientes */}\r\n          {(item.status === \"pending\" || item.status === \"ready_to_ship\") &&\r\n            !item.trackingNumber && (\r\n              <button\r\n                onClick={() => assignTrackingNumber(item.orderId)}\r\n                className=\"p-1 text-green-600 hover:bg-green-100 rounded-md\"\r\n                title=\"Asignar número de seguimiento\"\r\n                disabled={isUpdating}\r\n              >\r\n                <Package size={18} />\r\n              </button>\r\n            )}\r\n\r\n          {/* Imprimir etiqueta - solo para pedidos con número de seguimiento */}\r\n          {item.trackingNumber &&\r\n            (item.status === \"shipped\" || item.status === \"in_transit\") && (\r\n              <button\r\n                onClick={() =>\r\n                  alert(`Imprimiendo etiqueta para ${item.trackingNumber}`)\r\n                }\r\n                className=\"p-1 text-gray-600 hover:bg-gray-100 rounded-md\"\r\n                title=\"Imprimir etiqueta\"\r\n                disabled={isUpdating}\r\n              >\r\n                <Printer size={18} />\r\n              </button>\r\n            )}\r\n\r\n          {/* ✅ MANTENER: Marcar como fallido - para envíos pendientes, listos o en tránsito */}\r\n          {(item.status === \"ready_to_ship\" ||\r\n            item.status === \"in_transit\" ||\r\n            item.status === \"shipped\" ||\r\n            item.status === \"pending\") && (\r\n            <button\r\n              onClick={() => updateShippingStatus(item.id, \"failed\")}\r\n              className=\"p-1 text-red-600 hover:bg-red-100 rounded-md\"\r\n              title=\"Marcar como fallido\"\r\n              disabled={isUpdating}\r\n            >\r\n              <AlertTriangle size={18} />\r\n            </button>\r\n          )}\r\n        </div>\r\n      ),\r\n    },\r\n  ];\r\n\r\n\t// Calcular estadísticas de envíos\r\n\tconst calculateShippingStats = () => {\r\n\t\tconst stats = {\r\n\t\t\tpending: shippingItems.filter((item) => item.status === \"pending\").length,\r\n\t\t\treadyToShip: shippingItems.filter(\r\n\t\t\t\t(item) => item.status === \"ready_to_ship\"\r\n\t\t\t).length,\r\n\t\t\tinTransit: shippingItems.filter(\r\n\t\t\t\t(item) => item.status === \"in_transit\" || item.status === \"shipped\"\r\n\t\t\t).length,\r\n\t\t\tdelivered: shippingItems.filter((item) => item.status === \"delivered\")\r\n\t\t\t\t.length,\r\n\t\t\tfailed: shippingItems.filter((item) => item.status === \"failed\").length,\r\n\t\t\treturned: shippingItems.filter((item) => item.status === \"returned\")\r\n\t\t\t\t.length,\r\n\t\t\t// Calcular costo de envío total (si está disponible)\r\n\t\t\ttotalShippingCost: shippingItems.reduce(\r\n\t\t\t\t(sum, item) => sum + (item.shippingCost || 0),\r\n\t\t\t\t0\r\n\t\t\t),\r\n\t\t};\r\n\r\n\t\treturn [\r\n\t\t\t{\r\n\t\t\t\tlabel: \"Pendientes\",\r\n\t\t\t\tvalue: stats.pending,\r\n\t\t\t\ticon: (\r\n\t\t\t\t\t<Package className=\"h-5 w-5 text-yellow-600\" />\r\n\t\t\t\t),\r\n\t\t\t\tcolor: \"yellow\",\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tlabel: \"Listos\",\r\n\t\t\t\tvalue: stats.readyToShip,\r\n\t\t\t\ticon: <Package className=\"h-5 w-5 text-blue-600\" />,\r\n\t\t\t\tcolor: \"blue\",\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tlabel: \"En Tránsito\",\r\n\t\t\t\tvalue: stats.inTransit,\r\n\t\t\t\ticon: (\r\n\t\t\t\t\t<Truck className=\"h-5 w-5 text-indigo-600\" />\r\n\t\t\t\t),\r\n\t\t\t\tcolor: \"indigo\",\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tlabel: \"Entregados\",\r\n\t\t\t\tvalue: stats.delivered,\r\n\t\t\t\ticon: (\r\n\t\t\t\t\t<PackageCheck className=\"h-5 w-5 text-green-600\" />\r\n\t\t\t\t),\r\n\t\t\t\tcolor: \"green\",\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tlabel: \"Fallidos\",\r\n\t\t\t\tvalue: stats.failed,\r\n\t\t\t\ticon: (\r\n\t\t\t\t\t<AlertTriangle className=\"h-5 w-5 text-red-600\" />\r\n\t\t\t\t),\r\n\t\t\t\tcolor: \"red\",\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tlabel: \"Devueltos\",\r\n\t\t\t\tvalue: stats.returned,\r\n\t\t\t\ticon: (\r\n\t\t\t\t\t<MapPin className=\"h-5 w-5 text-orange-600\" />\r\n\t\t\t\t),\r\n\t\t\t\tcolor: \"orange\",\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tlabel: \"Coste Envíos\",\r\n\t\t\t\tvalue: formatCurrency(stats.totalShippingCost),\r\n\t\t\t\ticon: (\r\n\t\t\t\t\t<BarChart2 className=\"h-5 w-5 text-primary-600\" />\r\n\t\t\t\t),\r\n\t\t\t\tcolor: \"primary\",\r\n\t\t\t},\r\n\t\t];\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div className=\"space-y-6\">\r\n\t\t\t{/* Modal para asignación de número de seguimiento mejorado */}\r\n\t\t\t<ShippingFormModal\r\n\t\t\t\torderId={selectedOrderId || \"\"}\r\n\t\t\t\torderNumber={shippingItems.find(item => item.orderId === selectedOrderId)?.orderNumber}\r\n\t\t\t\tisOpen={isShippingModalOpen}\r\n\t\t\t\tonClose={() => {\r\n\t\t\t\t\tsetIsShippingModalOpen(false);\r\n\t\t\t\t\tsetSelectedOrderId(null);\r\n\t\t\t\t}}\r\n\t\t\t\tonSubmit={handleShippingSubmit}\r\n\t\t\t\tisLoading={isUpdating}\r\n\t\t\t/>\r\n\r\n\t\t\t<div className=\"flex justify-between items-center\">\r\n\t\t\t\t<h1 className=\"text-2xl font-bold text-gray-900\">\r\n\t\t\t\t\tGestión de Envíos\r\n\t\t\t\t</h1>\r\n\t\t\t\t<div className=\"flex space-x-2\">\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tonClick={refreshData}\r\n\t\t\t\t\t\tclassName=\"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors\"\r\n\t\t\t\t\t\tdisabled={isUpdating || loading}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<RefreshCw size={18} className={`inline mr-2 ${loading ? \"animate-spin\" : \"\"}`} />\r\n\t\t\t\t\t\tActualizar\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t{/* Mensajes de éxito/error */}\r\n\t\t\t{isUpdateSuccess === true && (\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative\"\r\n\t\t\t\t\trole=\"alert\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<span className=\"block sm:inline\">{updateMessage}</span>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\r\n\t\t\t{isUpdateSuccess === false && (\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative\"\r\n\t\t\t\t\trole=\"alert\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<span className=\"block sm:inline\">{updateMessage}</span>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\r\n\t\t\t{error && (\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative\"\r\n\t\t\t\t\trole=\"alert\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<span className=\"block sm:inline\">{error}</span>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\r\n\t\t\t{/* Panel de filtros */}\r\n\t\t\t<div className=\"bg-white rounded-lg shadow-sm p-4\">\r\n\t\t\t\t<div className=\"flex flex-col md:flex-row gap-4\">\r\n\t\t\t\t\t{/* Buscador */}\r\n\t\t\t\t\t<div className=\"relative flex-grow\">\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\tplaceholder=\"Buscar por número de pedido, seguimiento, cliente...\"\r\n\t\t\t\t\t\t\tclassName=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\t\tvalue={searchTerm}\r\n\t\t\t\t\t\t\tonChange={(e) => setSearchTerm(e.target.value)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<Search className=\"absolute left-3 top-2.5 h-5 w-5 text-gray-400\" />\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Filtro de Estado */}\r\n\t\t\t\t\t<div className=\"flex items-center space-x-2\">\r\n\t\t\t\t\t\t<Filter className=\"h-5 w-5 text-gray-500\" />\r\n\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\tclassName=\"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n\t\t\t\t\t\t\tvalue={statusFilter}\r\n\t\t\t\t\t\t\tonChange={(e) => setStatusFilter(e.target.value)}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<option value=\"all\">Todos los estados</option>\r\n\t\t\t\t\t\t\t<option value=\"pending\">Pendientes</option>\r\n\t\t\t\t\t\t\t<option value=\"ready_to_ship\">Listos para enviar</option>\r\n\t\t\t\t\t\t\t<option value=\"shipped\">En tránsito</option>\r\n\t\t\t\t\t\t\t<option value=\"delivered\">Entregados</option>\r\n\t\t\t\t\t\t\t<option value=\"failed\">Fallidos</option>\r\n\t\t\t\t\t\t\t<option value=\"returned\">Devueltos</option>\r\n\t\t\t\t\t\t</select>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Filtro de Transportista */}\r\n\t\t\t\t\t<div className=\"flex items-center space-x-2\">\r\n\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\tclassName=\"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500\"\r\n\t\t\t\t\t\t\tvalue={carrierFilter}\r\n\t\t\t\t\t\t\tonChange={(e) => setCarrierFilter(e.target.value)}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<option value=\"all\">Todos los transportistas</option>\r\n\t\t\t\t\t\t\t<option value=\"Correos Express\">Correos Express</option>\r\n\t\t\t\t\t\t\t<option value=\"SEUR\">SEUR</option>\r\n\t\t\t\t\t\t\t<option value=\"MRW\">MRW</option>\r\n\t\t\t\t\t\t\t<option value=\"DHL\">DHL</option>\r\n\t\t\t\t\t\t\t<option value=\"FedEx\">FedEx</option>\r\n\t\t\t\t\t\t\t<option value=\"UPS\">UPS</option>\r\n\t\t\t\t\t\t</select>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Botón para limpiar filtros */}\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\tsetStatusFilter(\"all\");\r\n\t\t\t\t\t\t\tsetCarrierFilter(\"all\");\r\n\t\t\t\t\t\t\tsetDateFilter(\"all\");\r\n\t\t\t\t\t\t\tsetSearchTerm(\"\");\r\n\t\t\t\t\t\t\tsetDateRange({from: \"\", to: \"\"});\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tclassName=\"bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tLimpiar filtros\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t{/* Estadísticas resumidas */}\r\n\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-7 gap-4\">\r\n\t\t\t\t<SellerStatCardList items={calculateShippingStats()} />\r\n\t\t\t</div>\r\n\r\n\t\t\t{/* Tabla de Envíos */}\r\n\t\t\t<Table\r\n\t\t\t\tdata={shippingItems}\r\n\t\t\t\tcolumns={columns}\r\n\t\t\t\tsearchFields={[\r\n\t\t\t\t\t\"orderNumber\",\r\n\t\t\t\t\t\"trackingNumber\",\r\n\t\t\t\t\t\"shippingAddress\",\r\n\t\t\t\t]}\r\n\t\t\t\tloading={loading}\r\n\t\t\t\temptyMessage=\"No se encontraron envíos\"\r\n\t\t\t\tpagination={{\r\n\t\t\t\t\tcurrentPage: pagination.currentPage,\r\n\t\t\t\t\ttotalPages: pagination.totalPages,\r\n\t\t\t\t\ttotalItems: pagination.totalItems,\r\n\t\t\t\t\titemsPerPage: pagination.itemsPerPage,\r\n\t\t\t\t\tonPageChange: handlePageChange,\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default SellerShippingPage;"],"names":["ShippingStatusDropdown","currentStatus","shippingId","onStatusChange","disabled","isOpen","setIsOpen","useState","isUpdating","setIsUpdating","SHIPPING_STATUSES","currentStatusInfo","s","handleStatusChange","newStatus","error","jsxs","jsx","ChevronDown","Fragment","status","SellerShippingPage","shippingAdapter","ShippingServiceAdapter","shippingItems","setShippingItems","loading","setLoading","setError","statusFilter","setStatusFilter","carrierFilter","setCarrierFilter","dateFilter","setDateFilter","searchTerm","setSearchTerm","pagination","setPagination","dateRange","setDateRange","isUpdateSuccess","setIsUpdateSuccess","updateMessage","setUpdateMessage","isShippingModalOpen","setIsShippingModalOpen","selectedOrderId","setSelectedOrderId","useEffect","fetchShippingItems","filters","today","firstDay","result","openShippingModal","orderId","handleShippingSubmit","shippingData","prevItems","item","updateShippingStatus","getStatusText","assignTrackingNumber","handlePageChange","page","prev","refreshData","columns","Link","err","ExternalLink","date","ClipboardList","Package","Printer","AlertTriangle","calculateShippingStats","stats","sum","Truck","PackageCheck","MapPin","formatCurrency","BarChart2","ShippingFormModal","RefreshCw","Search","Filter","SellerStatCardList","Table"],"mappings":"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"}