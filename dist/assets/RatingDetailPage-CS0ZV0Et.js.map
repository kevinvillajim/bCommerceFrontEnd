{"version":3,"file":"RatingDetailPage-CS0ZV0Et.js","sources":["../../src/presentation/pages/RatingDetailPage.tsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useParams, useNavigate, Link } from \"react-router-dom\";\r\nimport {\r\n\tArrowLeft,\r\n\tUser,\r\n\tPackage,\r\n\tStore,\r\n\tCalendar,\r\n\tCheckCircle,\r\n\tXCircle,\r\n\tClock,\r\n\tAlertTriangle,\r\n\tMessageSquare,\r\n\tFlag,\r\n\tShield,\r\n\tExternalLink,\r\n\tRefreshCw,\r\n} from \"lucide-react\";\r\n\r\nimport StarRating from \"../components/rating/StarRating\";\r\nimport { formatDate } from \"../../utils/formatters/formatDate\";\r\nimport { useAuth } from \"../hooks/useAuth\";\r\nimport ApiClient from \"../../infrastructure/api/apiClient\";\r\nimport { API_ENDPOINTS } from \"../../constants/apiEndpoints\";\r\n\r\n// Interfaces\r\ninterface RatingDetail {\r\n\tid: number;\r\n\trating: number;\r\n\ttitle?: string;\r\n\tcomment?: string;\r\n\ttype: string;\r\n\tstatus: \"pending\" | \"approved\" | \"rejected\" | \"flagged\";\r\n\tuser_id: number;\r\n\tseller_id?: number;\r\n\tproduct_id?: number;\r\n\torder_id: number;\r\n\tcreated_at: string;\r\n\tupdated_at: string;\r\n\tis_verified_purchase?: boolean;\r\n\tuser?: {\r\n\t\tid: number;\r\n\t\tname: string;\r\n\t\tavatar?: string;\r\n\t\temail?: string; // Solo para admins\r\n\t};\r\n\tseller?: {\r\n\t\tid: number;\r\n\t\tstore_name: string;\r\n\t\tuser_id?: number;\r\n\t\tstatus?: string;\r\n\t};\r\n\tproduct?: {\r\n\t\tid: number;\r\n\t\tname: string;\r\n\t\timage?: string;\r\n\t\tprice?: number;\r\n\t\tstatus?: string;\r\n\t};\r\n\torder_details?: {\r\n\t\tid: number;\r\n\t\torder_number: string;\r\n\t\tstatus: string;\r\n\t\ttotal?: number;\r\n\t\tcreated_at: string;\r\n\t};\r\n\tseller_response?: {\r\n\t\tid: number;\r\n\t\ttext: string;\r\n\t\tcreated_at: string;\r\n\t};\r\n\t// Campos espec√≠ficos para admins\r\n\tuser_details?: any;\r\n\tseller_details?: any;\r\n\tproduct_details?: any;\r\n\tstatus_history?: any[];\r\n}\r\n\r\nconst RatingDetailPage: React.FC = async () => {\r\n\tconst { id } = useParams<{ id: string }>();\r\n\tconst navigate = useNavigate();\r\n\tconst { isAdmin, isSeller } = useAuth();\r\n\r\n\t// Estados\r\n\tconst [rating, setRating] = useState<RatingDetail | null>(null);\r\n\tconst [loading, setLoading] = useState<boolean>(true);\r\n\tconst [error, setError] = useState<string | null>(null);\r\n\tconst [isActionsLoading, setIsActionsLoading] = useState<boolean>(false);\r\n\r\n\t// Estados para formularios (admin/seller)\r\n\tconst [showReplyForm, setShowReplyForm] = useState<boolean>(false);\r\n\tconst [replyText, setReplyText] = useState<string>(\"\");\r\n\tconst [showReportForm, setShowReportForm] = useState<boolean>(false);\r\n\tconst [reportReason, setReportReason] = useState<string>(\"\");\r\n\r\n\t// Cargar datos al montar el componente\r\n\tuseEffect(() => {\r\n\t\tif (id) {\r\n\t\t\tfetchRatingDetails(parseInt(id));\r\n\t\t}\r\n\t}, [id]);\r\n\r\n\t// Funci√≥n para obtener detalles de la valoraci√≥n\r\n\tconst fetchRatingDetails = async (ratingId: number) => {\r\n\t\tsetLoading(true);\r\n\t\tsetError(null);\r\n\r\n\t\ttry {\r\n\t\t\tlet endpoint = \"\";\r\n\t\t\t\r\n\t\t\t// üîß CORREGIDO: Determinar endpoint seg√∫n el rol usando las rutas correctas\r\n\t\t\t// ‚úÖ CORREGIDO: Verificar valor booleano, no existencia de funci√≥n\r\n\t\t\tif (await isAdmin() === true) {\r\n\t\t\t\tendpoint = `/admin/ratings/${ratingId}`;\r\n\t\t\t} else if (await isSeller() === true) {\r\n\t\t\t\tendpoint = `/ratings/${ratingId}`;\r\n\t\t\t} else {\r\n\t\t\t\tendpoint = `/ratings/${ratingId}`;\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log(\"üîç Obteniendo detalles de valoraci√≥n desde:\", endpoint);\r\n\r\n\t\t\tconst response = await ApiClient.get<{\r\n\t\t\t\tstatus: string;\r\n\t\t\t\tdata: RatingDetail;\r\n\t\t\t\tmessage?: string;\r\n\t\t\t}>(endpoint);\r\n\r\n\t\t\tconsole.log(\"üì¶ Respuesta del servidor:\", response);\r\n\r\n\t\t\tif (response.status === \"success\" && response.data) {\r\n\t\t\t\tsetRating(response.data);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(response.message || \"Error al obtener detalles de la valoraci√≥n\");\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(\"‚ùå Error fetching rating details:\", err);\r\n\t\t\t\r\n\t\t\t// Manejo espec√≠fico de errores 403 y otros c√≥digos de estado\r\n\t\t\tif (err instanceof Error && err.message.includes('403')) {\r\n\t\t\t\tsetError(\"No tienes permiso para ver esta valoraci√≥n\");\r\n\t\t\t} else if (err instanceof Error && err.message.includes('404')) {\r\n\t\t\t\tsetError(\"La valoraci√≥n no fue encontrada\");\r\n\t\t\t} else {\r\n\t\t\t\tsetError(\r\n\t\t\t\t\terr instanceof Error \r\n\t\t\t\t\t\t? err.message \r\n\t\t\t\t\t\t: \"Error al cargar los detalles de la valoraci√≥n\"\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t} finally {\r\n\t\t\tsetLoading(false);\r\n\t\t}\r\n\t};\r\n\r\n\t// Funci√≥n para responder a una valoraci√≥n (solo vendedores)\r\n\tconst handleReply = async () => {\r\n\t\tif (!rating || !replyText.trim()) return;\r\n\r\n\t\tsetIsActionsLoading(true);\r\n\t\ttry {\r\n\t\t\tawait ApiClient.post(API_ENDPOINTS.RATINGS.REPLY, {\r\n\t\t\t\trating_id: rating.id,\r\n\t\t\t\treply_text: replyText.trim(),\r\n\t\t\t});\r\n\r\n\t\t\t// Recargar datos\r\n\t\t\tawait fetchRatingDetails(rating.id);\r\n\t\t\tsetShowReplyForm(false);\r\n\t\t\tsetReplyText(\"\");\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(\"Error replying to rating:\", err);\r\n\t\t\talert(\"Error al enviar la respuesta\");\r\n\t\t} finally {\r\n\t\t\tsetIsActionsLoading(false);\r\n\t\t}\r\n\t};\r\n\r\n\t// Funci√≥n para reportar una valoraci√≥n\r\n\tconst handleReport = async () => {\r\n\t\tif (!rating || !reportReason.trim()) return;\r\n\r\n\t\tsetIsActionsLoading(true);\r\n\t\ttry {\r\n\t\t\tawait ApiClient.post(API_ENDPOINTS.RATINGS.REPORT, {\r\n\t\t\t\trating_id: rating.id,\r\n\t\t\t\treason: reportReason.trim(),\r\n\t\t\t});\r\n\r\n\t\t\t// Recargar datos\r\n\t\t\tawait fetchRatingDetails(rating.id);\r\n\t\t\tsetShowReportForm(false);\r\n\t\t\tsetReportReason(\"\");\r\n\t\t\talert(\"Reporte enviado correctamente\");\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(\"Error reporting rating:\", err);\r\n\t\t\talert(\"Error al enviar el reporte\");\r\n\t\t} finally {\r\n\t\t\tsetIsActionsLoading(false);\r\n\t\t}\r\n\t};\r\n\r\n\t// Funci√≥n para moderar valoraci√≥n (solo admins)\r\n\tconst handleModeration = async (action: \"approve\" | \"reject\" | \"flag\", note?: string) => {\r\n\t\tif (!rating) return;\r\n\r\n\t\tsetIsActionsLoading(true);\r\n\t\ttry {\r\n\t\t\tconst endpoint = `${API_ENDPOINTS.ADMIN.RATINGS.LIST}/${rating.id}/${action}`;\r\n\t\t\tawait ApiClient.post(endpoint, note ? { note } : {});\r\n\r\n\t\t\t// Recargar datos\r\n\t\t\tawait fetchRatingDetails(rating.id);\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error(`Error ${action}ing rating:`, err);\r\n\t\t\talert(`Error al ${action === \"approve\" ? \"aprobar\" : action === \"reject\" ? \"rechazar\" : \"marcar\"} la valoraci√≥n`);\r\n\t\t} finally {\r\n\t\t\tsetIsActionsLoading(false);\r\n\t\t}\r\n\t};\r\n\r\n\t// Mapeo de estados para UI\r\n\tconst getStatusInfo = (status: string) => {\r\n\t\tconst statusMap = {\r\n\t\t\tpending: {\r\n\t\t\t\ticon: Clock,\r\n\t\t\t\tcolor: \"text-yellow-600 bg-yellow-100\",\r\n\t\t\t\tlabel: \"Pendiente\",\r\n\t\t\t},\r\n\t\t\tapproved: {\r\n\t\t\t\ticon: CheckCircle,\r\n\t\t\t\tcolor: \"text-green-600 bg-green-100\",\r\n\t\t\t\tlabel: \"Aprobada\",\r\n\t\t\t},\r\n\t\t\trejected: {\r\n\t\t\t\ticon: XCircle,\r\n\t\t\t\tcolor: \"text-red-600 bg-red-100\",\r\n\t\t\t\tlabel: \"Rechazada\",\r\n\t\t\t},\r\n\t\t\tflagged: {\r\n\t\t\t\ticon: AlertTriangle,\r\n\t\t\t\tcolor: \"text-orange-600 bg-orange-100\",\r\n\t\t\t\tlabel: \"Marcada\",\r\n\t\t\t},\r\n\t\t};\r\n\r\n\t\treturn statusMap[status as keyof typeof statusMap] || statusMap.pending;\r\n\t};\r\n\r\n\t// ‚úÖ CORREGIDO: Verificar permisos para mostrar acciones - valores booleanos, no funciones\r\n\tconst canReply = await isSeller() === true && rating?.type === \"user_to_seller\" && !rating?.seller_response;\r\n\tconst canReport = await isAdmin() !== true && rating;\r\n\tconst canModerate = await isAdmin() === true && rating;\r\n\r\n\tif (loading) {\r\n\t\treturn (\r\n\t\t\t<div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n\t\t\t\t<div className=\"text-center\">\r\n\t\t\t\t\t<RefreshCw className=\"h-8 w-8 animate-spin text-primary-600 mx-auto mb-4\" />\r\n\t\t\t\t\t<p className=\"text-gray-600\">Cargando detalles de la valoraci√≥n...</p>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tif (error || !rating) {\r\n\t\treturn (\r\n\t\t\t<div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\r\n\t\t\t\t<div className=\"text-center max-w-md mx-auto\">\r\n\t\t\t\t\t<AlertTriangle className=\"h-12 w-12 text-red-500 mx-auto mb-4\" />\r\n\t\t\t\t\t<h2 className=\"text-xl font-semibold text-gray-900 mb-2\">\r\n\t\t\t\t\t\tError al cargar la valoraci√≥n\r\n\t\t\t\t\t</h2>\r\n\t\t\t\t\t<p className=\"text-gray-600 mb-4\">\r\n\t\t\t\t\t\t{error || \"No se pudo encontrar la valoraci√≥n solicitada\"}\r\n\t\t\t\t\t</p>\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tonClick={() => navigate(-1)}\r\n\t\t\t\t\t\tclassName=\"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tVolver atr√°s\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tconst statusInfo = getStatusInfo(rating.status);\r\n\r\n\treturn (\r\n\t\t<div className=\"min-h-screen bg-gray-50\">\r\n\t\t\t<div className=\"max-w-4xl mx-auto px-4 py-6\">\r\n\t\t\t\t{/* Header con navegaci√≥n */}\r\n\t\t\t\t<div className=\"flex items-center justify-between mb-6\">\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tonClick={() => navigate(-1)}\r\n\t\t\t\t\t\tclassName=\"flex items-center text-gray-600 hover:text-gray-900\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<ArrowLeft className=\"h-5 w-5 mr-2\" />\r\n\t\t\t\t\t\tVolver atr√°s\r\n\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t{/* ‚úÖ CORREGIDO: Verificar valor booleano */}\r\n\t\t\t\t\t{await isAdmin() === true && (\r\n\t\t\t\t\t\t<div className=\"flex items-center space-x-2\">\r\n\t\t\t\t\t\t\t<Shield className=\"h-5 w-5 text-blue-600\" />\r\n\t\t\t\t\t\t\t<span className=\"text-sm font-medium text-blue-600\">\r\n\t\t\t\t\t\t\t\tVista Administrador\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t{/* Contenido principal */}\r\n\t\t\t\t<div className=\"bg-white rounded-lg shadow-sm overflow-hidden\">\r\n\t\t\t\t\t{/* Header de la valoraci√≥n */}\r\n\t\t\t\t\t<div className=\"px-6 py-4 border-b border-gray-200\">\r\n\t\t\t\t\t\t<div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between\">\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<h1 className=\"text-2xl font-bold text-gray-900\">\r\n\t\t\t\t\t\t\t\t\tValoraci√≥n #{rating.id}\r\n\t\t\t\t\t\t\t\t</h1>\r\n\t\t\t\t\t\t\t\t<div className=\"flex items-center mt-2 space-x-4\">\r\n\t\t\t\t\t\t\t\t\t<StarRating value={rating.rating} readOnly size=\"medium\" />\r\n\t\t\t\t\t\t\t\t\t<span className=\"text-lg font-semibold\">\r\n\t\t\t\t\t\t\t\t\t\t{rating.rating}/5\r\n\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t{/* Estado */}\r\n\t\t\t\t\t\t\t<div className=\"mt-4 sm:mt-0\">\r\n\t\t\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\t\t\tclassName={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${statusInfo.color}`}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<statusInfo.icon className=\"h-4 w-4 mr-2\" />\r\n\t\t\t\t\t\t\t\t\t{statusInfo.label}\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t{/* T√≠tulo de la valoraci√≥n */}\r\n\t\t\t\t\t\t{rating.title && (\r\n\t\t\t\t\t\t\t<h2 className=\"text-lg font-medium text-gray-900 mt-4\">\r\n\t\t\t\t\t\t\t\t{rating.title}\r\n\t\t\t\t\t\t\t</h2>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Contenido de la valoraci√≥n */}\r\n\t\t\t\t\t<div className=\"px-6 py-4\">\r\n\t\t\t\t\t\t{/* Comentario */}\r\n\t\t\t\t\t\t{rating.comment && (\r\n\t\t\t\t\t\t\t<div className=\"mb-6\">\r\n\t\t\t\t\t\t\t\t<h3 className=\"text-sm font-medium text-gray-700 mb-2\">\r\n\t\t\t\t\t\t\t\t\tComentario\r\n\t\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t\t\t<div className=\"bg-gray-50 p-4 rounded-lg\">\r\n\t\t\t\t\t\t\t\t\t<p className=\"text-gray-800 whitespace-pre-wrap\">\r\n\t\t\t\t\t\t\t\t\t\t{rating.comment}\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t{/* Informaci√≥n del usuario */}\r\n\t\t\t\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<h3 className=\"text-sm font-medium text-gray-700 mb-3 flex items-center\">\r\n\t\t\t\t\t\t\t\t\t<User className=\"h-4 w-4 mr-2\" />\r\n\t\t\t\t\t\t\t\t\tUsuario\r\n\t\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t\t\t<div className=\"flex items-center space-x-3\">\r\n\t\t\t\t\t\t\t\t\t{rating.user?.avatar ? (\r\n\t\t\t\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\t\t\t\tsrc={rating.user.avatar}\r\n\t\t\t\t\t\t\t\t\t\t\talt={rating.user.name}\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-10 h-10 rounded-full object-cover\"\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t<User className=\"h-6 w-6 text-gray-500\" />\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<p className=\"font-medium text-gray-900\">\r\n\t\t\t\t\t\t\t\t\t\t\t{rating.user?.name || `Usuario #${rating.user_id}`}\r\n\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t{rating.is_verified_purchase && (\r\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-green-600 flex items-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<CheckCircle className=\"h-4 w-4 mr-1\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\tCompra verificada\r\n\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t{/* ‚úÖ CORREGIDO: Verificar valor booleano */}\r\n\t\t\t\t\t\t\t\t\t\t{await isAdmin() === true && rating.user_details?.email && (\r\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-gray-500\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t{rating.user_details.email}\r\n\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t{/* Informaci√≥n del producto/vendedor */}\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t{rating.product && (\r\n\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t<h3 className=\"text-sm font-medium text-gray-700 mb-3 flex items-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t<Package className=\"h-4 w-4 mr-2\" />\r\n\t\t\t\t\t\t\t\t\t\t\tProducto\r\n\t\t\t\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center space-x-3\">\r\n\t\t\t\t\t\t\t\t\t\t\t{rating.product.image ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={rating.product.image}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\talt={rating.product.name}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-10 h-10 rounded object-cover\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-10 h-10 bg-gray-200 rounded flex items-center justify-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Package className=\"h-6 w-6 text-gray-500\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tto={`/products/${rating.product.id}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"font-medium text-primary-600 hover:text-primary-800 flex items-center\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{rating.product.name}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<ExternalLink className=\"h-4 w-4 ml-1\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{/* ‚úÖ CORREGIDO: Verificar valor booleano */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t{await isAdmin() === true && rating.product_details?.price && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-gray-500\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t${rating.product_details.price}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t\t{rating.seller && (\r\n\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t<h3 className=\"text-sm font-medium text-gray-700 mb-3 flex items-center mt-4\">\r\n\t\t\t\t\t\t\t\t\t\t\t<Store className=\"h-4 w-4 mr-2\" />\r\n\t\t\t\t\t\t\t\t\t\t\tVendedor\r\n\t\t\t\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center space-x-3\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-10 h-10 bg-gray-200 rounded flex items-center justify-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Store className=\"h-6 w-6 text-gray-500\" />\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"font-medium text-gray-900\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{rating.seller.store_name}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{/* ‚úÖ CORREGIDO: Verificar valor booleano */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t{await isAdmin() === true && rating.seller_details?.status && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-gray-500\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tEstado: {rating.seller_details.status}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t{/* Informaci√≥n de la orden */}\r\n\t\t\t\t\t\t{rating.order_details && (\r\n\t\t\t\t\t\t\t<div className=\"mb-6\">\r\n\t\t\t\t\t\t\t\t<h3 className=\"text-sm font-medium text-gray-700 mb-3 flex items-center\">\r\n\t\t\t\t\t\t\t\t\t<Calendar className=\"h-4 w-4 mr-2\" />\r\n\t\t\t\t\t\t\t\t\tOrden\r\n\t\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t\t\t<div className=\"bg-gray-50 p-4 rounded-lg\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-500\">N√∫mero:</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"font-medium\">#{rating.order_details.order_number}</p>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-500\">Estado:</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"font-medium\">{rating.order_details.status}</p>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t{rating.order_details.total && (\r\n\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-500\">Total:</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p className=\"font-medium\">${rating.order_details.total}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-500\">Fecha:</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"font-medium\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t{formatDate(rating.order_details.created_at)}\r\n\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\t\t\tto={`/orders/${rating.order_id}`}\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"inline-flex items-center mt-3 text-primary-600 hover:text-primary-800\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\tVer orden completa\r\n\t\t\t\t\t\t\t\t\t\t<ExternalLink className=\"h-4 w-4 ml-1\" />\r\n\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t{/* Respuesta del vendedor */}\r\n\t\t\t\t\t\t{rating.seller_response && (\r\n\t\t\t\t\t\t\t<div className=\"mb-6\">\r\n\t\t\t\t\t\t\t\t<h3 className=\"text-sm font-medium text-gray-700 mb-3 flex items-center\">\r\n\t\t\t\t\t\t\t\t\t<MessageSquare className=\"h-4 w-4 mr-2\" />\r\n\t\t\t\t\t\t\t\t\tRespuesta del vendedor\r\n\t\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t\t\t<div className=\"bg-blue-50 border border-blue-200 p-4 rounded-lg\">\r\n\t\t\t\t\t\t\t\t\t<p className=\"text-gray-800 mb-2\">{rating.seller_response.text}</p>\r\n\t\t\t\t\t\t\t\t\t<p className=\"text-sm text-gray-500\">\r\n\t\t\t\t\t\t\t\t\t\t{formatDate(rating.seller_response.created_at)}\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t{/* Fechas */}\r\n\t\t\t\t\t\t<div className=\"mb-6\">\r\n\t\t\t\t\t\t\t<h3 className=\"text-sm font-medium text-gray-700 mb-3\">\r\n\t\t\t\t\t\t\t\tInformaci√≥n temporal\r\n\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<span className=\"text-gray-500\">Creada:</span>\r\n\t\t\t\t\t\t\t\t\t<p className=\"font-medium\">{formatDate(rating.created_at)}</p>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t{rating.updated_at !== rating.created_at && (\r\n\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-500\">Actualizada:</span>\r\n\t\t\t\t\t\t\t\t\t\t<p className=\"font-medium\">{formatDate(rating.updated_at)}</p>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Acciones */}\r\n\t\t\t\t\t{(canReply || canReport || canModerate) && (\r\n\t\t\t\t\t\t<div className=\"px-6 py-4 border-t border-gray-200 bg-gray-50\">\r\n\t\t\t\t\t\t\t<h3 className=\"text-sm font-medium text-gray-700 mb-4\">\r\n\t\t\t\t\t\t\t\tAcciones disponibles\r\n\t\t\t\t\t\t\t</h3>\r\n\r\n\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-3\">\r\n\t\t\t\t\t\t\t\t{/* Responder (vendedores) */}\r\n\t\t\t\t\t\t\t\t{canReply && (\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => setShowReplyForm(!showReplyForm)}\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<MessageSquare className=\"h-4 w-4 mr-2\" />\r\n\t\t\t\t\t\t\t\t\t\tResponder\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t\t{/* Reportar */}\r\n\t\t\t\t\t\t\t\t{canReport && (\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => setShowReportForm(!showReportForm)}\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<Flag className=\"h-4 w-4 mr-2\" />\r\n\t\t\t\t\t\t\t\t\t\tReportar\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t\t{/* Acciones de admin */}\r\n\t\t\t\t\t\t\t\t{/* ‚úÖ CORREGIDO: Verificar valor booleano */}\r\n\t\t\t\t\t\t\t\t{canModerate && rating.status === \"pending\" && (\r\n\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleModeration(\"approve\")}\r\n\t\t\t\t\t\t\t\t\t\t\tdisabled={isActionsLoading}\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<CheckCircle className=\"h-4 w-4 mr-2\" />\r\n\t\t\t\t\t\t\t\t\t\t\tAprobar\r\n\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst note = prompt(\"Raz√≥n del rechazo (obligatorio):\");\r\n\t\t\t\t\t\t\t\t\t\t\t\tif (note) handleModeration(\"reject\", note);\r\n\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\tdisabled={isActionsLoading}\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t<XCircle className=\"h-4 w-4 mr-2\" />\r\n\t\t\t\t\t\t\t\t\t\t\tRechazar\r\n\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t\t{/* ‚úÖ CORREGIDO: Verificar valor booleano */}\r\n\t\t\t\t\t\t\t\t{canModerate && (\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\t\t\tconst reason = prompt(\"Raz√≥n para marcar:\");\r\n\t\t\t\t\t\t\t\t\t\t\tif (reason) handleModeration(\"flag\", reason);\r\n\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\tdisabled={isActionsLoading}\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"flex items-center px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<AlertTriangle className=\"h-4 w-4 mr-2\" />\r\n\t\t\t\t\t\t\t\t\t\tMarcar\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t{/* Formulario de respuesta */}\r\n\t\t\t\t{showReplyForm && (\r\n\t\t\t\t\t<div className=\"mt-6 bg-white rounded-lg shadow-sm p-6\">\r\n\t\t\t\t\t\t<h3 className=\"text-lg font-medium text-gray-900 mb-4\">\r\n\t\t\t\t\t\t\tResponder a la valoraci√≥n\r\n\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t<textarea\r\n\t\t\t\t\t\t\tvalue={replyText}\r\n\t\t\t\t\t\t\tonChange={(e) => setReplyText(e.target.value)}\r\n\t\t\t\t\t\t\tclassName=\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\t\trows={4}\r\n\t\t\t\t\t\t\tplaceholder=\"Escribe tu respuesta...\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<div className=\"flex justify-end space-x-3 mt-4\">\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\tsetShowReplyForm(false);\r\n\t\t\t\t\t\t\t\t\tsetReplyText(\"\");\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\tclassName=\"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300\"\r\n\t\t\t\t\t\t\t\tdisabled={isActionsLoading}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tCancelar\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={handleReply}\r\n\t\t\t\t\t\t\t\tdisabled={!replyText.trim() || isActionsLoading}\r\n\t\t\t\t\t\t\t\tclassName=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{isActionsLoading ? \"Enviando...\" : \"Enviar respuesta\"}\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t{/* Formulario de reporte */}\r\n\t\t\t\t{showReportForm && (\r\n\t\t\t\t\t<div className=\"mt-6 bg-white rounded-lg shadow-sm p-6\">\r\n\t\t\t\t\t\t<h3 className=\"text-lg font-medium text-gray-900 mb-4\">\r\n\t\t\t\t\t\t\tReportar valoraci√≥n\r\n\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t<textarea\r\n\t\t\t\t\t\t\tvalue={reportReason}\r\n\t\t\t\t\t\t\tonChange={(e) => setReportReason(e.target.value)}\r\n\t\t\t\t\t\t\tclassName=\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\t\trows={4}\r\n\t\t\t\t\t\t\tplaceholder=\"Describe el motivo del reporte...\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<div className=\"flex justify-end space-x-3 mt-4\">\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\tsetShowReportForm(false);\r\n\t\t\t\t\t\t\t\t\tsetReportReason(\"\");\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\tclassName=\"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300\"\r\n\t\t\t\t\t\t\t\tdisabled={isActionsLoading}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tCancelar\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={handleReport}\r\n\t\t\t\t\t\t\t\tdisabled={!reportReason.trim() || isActionsLoading}\r\n\t\t\t\t\t\t\t\tclassName=\"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 disabled:opacity-50\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{isActionsLoading ? \"Enviando...\" : \"Enviar reporte\"}\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default RatingDetailPage;"],"names":["RatingDetailPage","id","useParams","navigate","useNavigate","isAdmin","isSeller","useAuth","rating","setRating","useState","loading","setLoading","error","setError","isActionsLoading","setIsActionsLoading","showReplyForm","setShowReplyForm","replyText","setReplyText","showReportForm","setShowReportForm","reportReason","setReportReason","useEffect","fetchRatingDetails","ratingId","endpoint","response","ApiClient","err","handleReply","API_ENDPOINTS","handleReport","handleModeration","action","note","getStatusInfo","status","statusMap","Clock","CheckCircle","XCircle","AlertTriangle","canReply","canReport","canModerate","jsxs","jsx","RefreshCw","statusInfo","ArrowLeft","Shield","StarRating","User","Fragment","Package","Link","ExternalLink","Store","Calendar","MessageSquare","formatDate","Flag","reason","e"],"mappings":"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"}