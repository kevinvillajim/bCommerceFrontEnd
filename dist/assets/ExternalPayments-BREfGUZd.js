import{j as e,H as _,l as u,a as C,D as S,Z as U,U as $,S as F,h as I,K as X,E as B,X as P,b7 as O,e as Y}from"./ui-vendor-DEBjJ4HS.js";import{r as l}from"./react-vendor-Cy458wKG.js";import{g as z,c as j,A as N,N as y}from"./admin-chunk-bhOJ3jtA.js";const V=()=>{const{showToast:o}=z(),[a,A]=l.useState(null),[f,T]=l.useState([]),[L,b]=l.useState(!0),[v,m]=l.useState(null),[c,h]=l.useState(1),[n,R]=l.useState(1),[t,w]=l.useState(null),[i,k]=l.useState({status:"",search:""});l.useEffect(()=>{g()},[]),l.useEffect(()=>{p()},[c,i]);const g=async()=>{try{const s=await j.get(N.EXTERNAL_PAYMENT.ADMIN.DASHBOARD);s.success&&A(s.data)}catch(s){console.error("Error loading admin dashboard:",s)}},p=async()=>{try{b(!0);const s=new URLSearchParams({page:c.toString(),per_page:"15"});i.status&&s.append("status",i.status),i.search&&s.append("search",i.search);const r=await j.get(`${N.EXTERNAL_PAYMENT.ADMIN.LIST}?${s.toString()}`);r.success?(T(r.data.data),h(r.data.current_page),R(r.data.last_page),m(null)):m("Error cargando links")}catch(s){console.error("Error loading links:",s),m(s.response?.data?.message||"Error cargando links")}finally{b(!1)}},D=async(s,r)=>{if(confirm(`¿Estás seguro de cancelar el link ${r}?`))try{const d=await j.patch(`${N.EXTERNAL_PAYMENT.ADMIN.CANCEL}/${s}`);d.success?(o(y.SUCCESS,"Link cancelado exitosamente"),p(),g()):o(y.ERROR,d.message||"Error cancelando el link")}catch(d){console.error("Error cancelling link:",d),o(y.ERROR,d.response?.data?.message||"Error cancelando el link")}},E=s=>s.status==="paid"?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(C,{className:"h-3 w-3 mr-1"}),"Pagado"]}):s.status==="cancelled"?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),"Cancelado"]}):s.is_expired?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx(O,{className:"h-3 w-3 mr-1"}),"Expirado"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),"Pendiente"]}),x=s=>new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),M=a&&a.stats.total_links>0?(a.stats.paid_links/a.stats.total_links*100).toFixed(1):"0.0";return v&&!a?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(_,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error"}),e.jsx("p",{className:"text-gray-600 mb-4",children:v}),e.jsx("button",{onClick:()=>{g(),p()},className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"Reintentar"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{className:"h-8 w-8 text-blue-600 mr-3"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Pagos Externos"}),e.jsx("p",{className:"text-gray-600",children:"Administración global de todos los links de pago"})]})]})}),a&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(u,{className:"h-8 w-8 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Links"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.stats.total_links})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(C,{className:"h-8 w-8 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Pagados"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.stats.paid_links})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(S,{className:"h-8 w-8 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Total Recaudado"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",Number(a.stats.total_amount_collected).toFixed(2)]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(U,{className:"h-8 w-8 text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Conversión"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[M,"%"]})]})]})})]}),a&&a.top_users.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx($,{className:"h-5 w-5 mr-2"}),"Usuarios Más Activos"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 text-sm font-medium text-gray-500",children:"Usuario"}),e.jsx("th",{className:"text-left py-2 text-sm font-medium text-gray-500",children:"Links Creados"}),e.jsx("th",{className:"text-left py-2 text-sm font-medium text-gray-500",children:"Total Recaudado"})]})}),e.jsx("tbody",{children:a.top_users.map(s=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("td",{className:"py-2",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})}),e.jsx("td",{className:"py-2 text-sm text-gray-900",children:s.total_links}),e.jsxs("td",{className:"py-2 text-sm text-gray-900",children:["$",Number(s.total_collected).toFixed(2)]})]},s.id))})]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por cliente, código o descripción...",value:i.search,onChange:s=>k(r=>({...r,search:s.target.value})),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})}),e.jsx("div",{className:"sm:w-48",children:e.jsxs("select",{value:i.status,onChange:s=>k(r=>({...r,status:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"pending",children:"Pendiente"}),e.jsx("option",{value:"paid",children:"Pagado"}),e.jsx("option",{value:"expired",children:"Expirado"}),e.jsx("option",{value:"cancelled",children:"Cancelado"})]})})]})}),L?e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto"})}):f.length===0?e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center",children:[e.jsx(u,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No se encontraron links"}),e.jsx("p",{className:"text-gray-600",children:"No hay links de pago que coincidan con los filtros"})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cliente"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Creado por"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Código"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.customer_name}),s.description&&e.jsx("div",{className:"text-sm text-gray-500 truncate max-w-32",children:s.description})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{className:"h-4 w-4 text-gray-400 mr-1"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["$",(typeof s.amount=="string"?parseFloat(s.amount):s.amount).toFixed(2)]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:E(s)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.creator.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.creator.email})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"text-sm font-mono text-gray-900",children:s.link_code})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),x(s.created_at)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>w(s),className:"text-blue-600 hover:text-blue-900 inline-flex items-center",title:"Ver detalles",children:e.jsx(B,{className:"h-4 w-4"})}),s.status==="pending"&&!s.is_expired&&e.jsx("button",{onClick:()=>D(s.id,s.link_code),className:"text-red-600 hover:text-red-900 inline-flex items-center",title:"Cancelar link",children:e.jsx(P,{className:"h-4 w-4"})})]})})]},s.id))})]})}),n>1&&e.jsxs("div",{className:"bg-white px-4 py-3 border-t border-gray-200 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center",children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Página ",c," de ",n]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>h(s=>Math.max(1,s-1)),disabled:c===1,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-200",children:"Anterior"}),e.jsx("button",{onClick:()=>h(s=>Math.min(n,s+1)),disabled:c===n,className:"px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-200",children:"Siguiente"})]})]})]}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Detalles del Link"}),e.jsx("button",{onClick:()=>w(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx(P,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Cliente"}),e.jsx("p",{className:"text-gray-900",children:t.customer_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Monto"}),e.jsxs("p",{className:"text-gray-900",children:["$",t.amount.toFixed(2)," USD"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Estado"}),E(t)]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Código"}),e.jsx("p",{className:"text-gray-900 font-mono",children:t.link_code})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Creado por"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-900 font-medium",children:t.creator.name}),e.jsx("p",{className:"text-sm text-gray-500",children:t.creator.email})]})]}),t.description&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Descripción"}),e.jsx("p",{className:"text-gray-900",children:t.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"URL Pública"}),e.jsx("p",{className:"text-gray-900 font-mono text-sm break-all",children:t.public_url})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Creado"}),e.jsx("p",{className:"text-gray-900 text-sm",children:x(t.created_at)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Expira"}),e.jsx("p",{className:"text-gray-900 text-sm",children:x(t.expires_at)})]})]}),t.paid_at&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Pagado el"}),e.jsx("p",{className:"text-gray-900 text-sm",children:x(t.paid_at)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Método"}),e.jsx("p",{className:"text-gray-900 text-sm capitalize",children:t.payment_method})]})]}),t.transaction_id&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"ID de Transacción"}),e.jsx("p",{className:"text-gray-900 text-sm font-mono",children:t.transaction_id})]})]})]})})})]})};export{V as default};
//# sourceMappingURL=ExternalPayments-BREfGUZd.js.map
