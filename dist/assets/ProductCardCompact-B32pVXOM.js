import{j as e,at as c,a7 as S,au as d}from"./ui-vendor-DEBjJ4HS.js";import{r as x,R as ee,L}from"./react-vendor-Cy458wKG.js";import{R as te}from"./seller-chunk-B6Pjm2KH.js";import{b as ae,u as oe}from"./checkout-chunk-D9tWfuim.js";import{u as se}from"./useFavorites-CRNKuI5K.js";import{N as u,C as h}from"./admin-chunk-bhOJ3jtA.js";const pe=x.memo(({id:s,name:f,price:_,discount:D,rating:W=null,reviews:q=null,image:M,category:F,isNew:U=!1,color:T=!0,stock:H=10,onAddToCart:b,onAddToWishlist:v})=>{const y=(t,a=0)=>{if(typeof t=="number")return t;if(typeof t=="string"){const r=parseFloat(t);return isNaN(r)?a:r}return a},k=(t,a=0)=>{if(typeof t=="number")return Math.floor(t);if(typeof t=="string"){const r=parseInt(t,10);return isNaN(r)?a:r}return a},m=y(_),p=y(D),N=k(H,10),z=y(W),J=k(q),[i,O]=x.useState(!1),[n,R]=x.useState(!1),[g,j]=x.useState(!1),[C,w]=x.useState(!1),{addToCart:B,showNotification:l}=ae(),{toggleFavorite:G,checkIsFavorite:I}=se(),{optimisticCartAdd:K,optimisticFavoriteAdd:Q,optimisticFavoriteRemove:V}=oe(),$=()=>{h.removeItem("cart_user_data"),h.removeItem("cart_guest_data"),h.removeItem("header_counters");for(let t=1;t<=10;t++)h.removeItem(`user_favorites_${t}_10`);console.log("🔄 Cache invalidado desde ProductCardCompact")};ee.useEffect(()=>{const t=I(s);j(t),(()=>{try{const r=localStorage.getItem("cart_items")||localStorage.getItem("cart_data");r&&JSON.parse(r).items?.some(E=>E.product_id===s||E.productId===s||E.id===s)&&w(!0)}catch(r){console.log("📝 Verificación opcional de carrito:",r)}})()},[s,I]);const X=p?m-m*(p/100):m,o=N>0,Y=async()=>{if(console.log("🚀 ProductCardCompact.executeAddToCart INICIADO",{productId:s,hasExternalFunction:!!b,isAddingToCart:i,hasStock:o}),i||!o){o||l(u.ERROR,"Lo sentimos, este producto está agotado"),console.log("❌ Acción bloqueada - isAddingToCart:",i,"hasStock:",o);return}O(!0);try{if(b){console.log("🔄 Ejecutando SOLO función externa (NO optimización aquí)");const t=b(s);t&&typeof t.then=="function"?(console.log("⏳ Esperando función externa async..."),await t,console.log("✅ Función externa completada")):console.log("✅ Función externa sync completada")}else{if(console.log("🔄 NO hay función externa - aplicando optimización + API"),console.log("📈 Aplicando optimisticCartAdd..."),K(),console.log("📞 Llamando addToCart API..."),!await B({productId:s,quantity:1}))throw console.log("❌ API falló"),new Error("No se pudo agregar el producto al carrito");console.log("✅ API exitosa"),l(u.SUCCESS,`${f} ha sido agregado al carrito`),console.log("🔄 Invalidando cache..."),$()}w(!0),setTimeout(()=>{w(!1)},3e3),console.log("🎉 ProductCardCompact.executeAddToCart COMPLETADO")}catch(t){console.error("❌ Error en ProductCardCompact.executeAddToCart:",t),l(u.ERROR,"Error al agregar producto al carrito. Inténtalo de nuevo.")}finally{console.log("🔚 Limpiando estado isAddingToCart..."),setTimeout(()=>{O(!1),console.log("✅ Estado limpio")},500)}},Z=async()=>{const t=I(s);if(console.log("💖 ProductCardCompact.executeAddToWishlist INICIADO",{productId:s,isCurrentlyFavorite:t,hasExternalFunction:!!v,isAddingToWishlist:n}),n){console.log("❌ Click ignorado - ya se está procesando");return}R(!0);try{if(v){console.log("🔄 Ejecutando SOLO función externa (NO optimización aquí)");const a=v(s);a&&typeof a.then=="function"?(console.log("⏳ Esperando función externa async..."),await a,console.log("✅ Función externa completada")):console.log("✅ Función externa sync completada"),j(!g)}else{console.log("🔄 NO hay función externa - aplicando optimización + API"),console.log(`📈 Aplicando optimistic${t?"Remove":"Add"}...`),t?V():Q(),console.log("📞 Llamando toggleFavorite API...");const a=await G(s);if(a===void 0)throw console.log("❌ API falló"),new Error("No se pudo gestionar el favorito");console.log("✅ API exitosa, resultado:",a),j(a),a?l(u.SUCCESS,"Producto añadido a favoritos"):l(u.INFO,"Producto eliminado de favoritos"),console.log("🔄 Invalidando cache..."),$()}console.log("🎉 ProductCardCompact.executeAddToWishlist COMPLETADO")}catch(a){console.error("❌ Error en ProductCardCompact.executeAddToWishlist:",a),l(u.ERROR,"Error al gestionar favoritos. Inténtalo de nuevo.")}finally{console.log("🔚 Limpiando estado isAddingToWishlist..."),setTimeout(()=>{R(!1),console.log("✅ Estado limpio")},500)}},A=async t=>{t.preventDefault(),t.stopPropagation(),await Y()},P=async t=>{t.preventDefault(),t.stopPropagation(),await Z()};return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-300 overflow-hidden group product-card",children:[e.jsxs("div",{className:"relative h-48 overflow-hidden",children:[e.jsx(L,{to:`/products/${s}`,children:e.jsx("img",{src:M,alt:f,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"})}),p>0&&e.jsxs("div",{className:`absolute top-2 left-2 ${T?"bg-red-500":"bg-primary-600"} text-white text-xs font-bold py-1 px-2 rounded-md badge`,children:["-",p,"%"]}),U&&e.jsx("div",{className:`absolute top-2 right-2 ${T?"bg-green-500":"bg-primary-800"} text-white text-xs font-bold py-1 px-2 rounded-md badge`,children:"Nuevo"}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-30 opacity-0 group-hover:opacity-100 hover:opacity-100 transition-opacity duration-300 items-center justify-center gap-3 hidden sm:flex",children:[e.jsx("button",{onClick:P,disabled:n,className:"cursor-pointer bg-white p-3 rounded-full hover:bg-primary-50 hover:text-primary-600 transition-all duration-200 disabled:opacity-50 shadow-lg hover:shadow-xl transform hover:scale-105","aria-label":"Añadir a favoritos",title:"Añadir a favoritos",children:n?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-red-500 border-t-transparent"}):g?e.jsx(c,{size:20,className:"text-red-500 fill-current"}):e.jsx(c,{size:20,className:"text-gray-600"})}),e.jsx("button",{onClick:A,disabled:i||!o,className:`cursor-pointer bg-white p-3 rounded-full hover:bg-primary-50 hover:text-primary-600 transition-all duration-200 disabled:opacity-50 shadow-lg hover:shadow-xl transform hover:scale-105 ${o?"":"cursor-not-allowed"}`,"aria-label":"Añadir al carrito",title:o?"Añadir al carrito":"Sin stock",children:i?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-green-500 border-t-transparent"}):C?e.jsx(S,{size:20,className:"text-green-500"}):o?e.jsx(d,{size:20,className:"text-gray-600"}):e.jsx(d,{size:20,className:"text-gray-400"})})]}),e.jsxs("div",{className:"absolute bottom-2 right-2 flex gap-2 sm:hidden",children:[e.jsx("button",{onClick:P,disabled:n,className:"bg-white/90 backdrop-blur-sm p-2 rounded-full hover:bg-white transition-all duration-200 disabled:opacity-50 shadow-md","aria-label":"Añadir a favoritos",children:n?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-red-500 border-t-transparent"}):g?e.jsx(c,{size:16,className:"text-red-500 fill-current"}):e.jsx(c,{size:16,className:"text-gray-600"})}),e.jsx("button",{onClick:A,disabled:i||!o,className:`bg-white/90 backdrop-blur-sm p-2 rounded-full hover:bg-white transition-all duration-200 disabled:opacity-50 shadow-md ${o?"":"cursor-not-allowed"}`,"aria-label":"Añadir al carrito",children:i?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-green-500 border-t-transparent"}):C?e.jsx(S,{size:16,className:"text-green-500"}):o?e.jsx(d,{size:16,className:"text-gray-600"}):e.jsx(d,{size:16,className:"text-gray-400"})})]})]}),e.jsxs("div",{className:"p-3",children:[F&&e.jsx("span",{className:"text-xs text-gray-500 uppercase mb-1 block",children:F}),e.jsx(L,{to:`/products/${s}`,children:e.jsx("h3",{className:"font-medium text-gray-800 mb-1 line-clamp-1 hover:text-primary-600 transition-colors",children:f})}),z>0&&e.jsx("div",{className:"mb-2",children:e.jsx(te,{rating:z,size:14,showValue:!0,reviews:J})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center flex-wrap",children:p>0?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-bold text-primary-600 text-lg",children:["$",X.toFixed(2)]}),e.jsxs("span",{className:"text-sm text-gray-500 line-through ml-2",children:["$",m.toFixed(2)]})]}):e.jsxs("span",{className:"font-bold text-primary-600 product-price text-lg",children:["$",m.toFixed(2)]})}),e.jsxs("div",{className:"hidden xs:flex sm:hidden md:flex lg:hidden xl:flex gap-2",children:[e.jsx("button",{onClick:P,disabled:n,className:"text-gray-500 hover:text-red-500 transition-colors disabled:opacity-50 p-1 rounded-full hover:bg-gray-100","aria-label":"Añadir a favoritos",children:n?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-red-500 border-t-transparent"}):g?e.jsx(c,{size:18,className:"text-red-500 fill-current"}):e.jsx(c,{size:18})}),e.jsx("button",{onClick:A,disabled:i||!o,className:`text-gray-500 hover:text-primary-600 transition-colors disabled:opacity-50 p-1 rounded-full hover:bg-gray-100 ${o?"":"cursor-not-allowed"}`,"aria-label":"Añadir al carrito",children:i?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-green-500 border-t-transparent"}):C?e.jsx(S,{size:18,className:"text-green-500"}):o?e.jsx(d,{size:18}):e.jsx(d,{size:18,className:"text-gray-400"})})]})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[!o&&e.jsx("p",{className:"text-xs text-red-500 font-medium",children:"Agotado"}),o&&N<=5&&e.jsxs("p",{className:"text-xs text-amber-600 font-medium",children:["Solo quedan ",N]})]})]})]})});export{pe as P};
//# sourceMappingURL=ProductCardCompact-B32pVXOM.js.map
