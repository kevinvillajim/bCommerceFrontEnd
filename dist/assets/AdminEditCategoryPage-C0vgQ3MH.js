import{d as T,h as U,r as d,j as e,L as v,X as V}from"./index-DmNDOrWy.js";import{u as q}from"./useAdminCategories-D_zTNu7p.js";import{L as B}from"./loader-DQksLurc.js";import{A as G}from"./arrow-left-sVt-VeaA.js";import{F as H}from"./folder-Df2fqr5L.js";import{T as R}from"./tag-z784mohN.js";import{H as M,A as X}from"./hash-BCGLeVla.js";import{F as J}from"./file-text-DT6_O-Nw.js";import{E as K}from"./eye-CldZNoIz.js";import{S as Q}from"./star-DFFyFcok.js";import{S as W}from"./save-Dhxxo4vd.js";const de=()=>{const g=T(),{id:w}=U(),l=Number(w),{loading:C,error:h,categoryDetail:m,mainCategories:f,fetchCategoryById:E,fetchMainCategories:S,updateCategory:_,setError:n}=q(),[r,p]=d.useState({id:l,name:"",slug:"",description:"",parent_id:void 0,icon:"",order:0,is_active:!0,featured:!1}),[t,b]=d.useState({}),[y,j]=d.useState(!1),[k,N]=d.useState(!0),[L,F]=d.useState("");d.useEffect(()=>{z()},[l]);const z=async()=>{if(!l||isNaN(l)){n("ID de categor√≠a inv√°lido"),g("/admin/categories");return}N(!0);try{const[a]=await Promise.all([E(l),S(!0)]);if(!a){n("Categor√≠a no encontrada"),g("/admin/categories");return}p({id:a.id,name:a.name||"",slug:a.slug||"",description:a.description||"",parent_id:a.parent_id||void 0,icon:a.icon||"",order:a.order||0,is_active:a.is_active??!0,featured:a.featured??!1}),F(a.slug||"")}catch(a){console.error("Error al cargar datos de categor√≠a:",a),n("Error al cargar los datos de la categor√≠a")}finally{N(!1)}},D=a=>a.toLowerCase().trim().replace(/[√°√†√§√¢]/g,"a").replace(/[√©√®√´√™]/g,"e").replace(/[√≠√¨√Ø√Æ]/g,"i").replace(/[√≥√≤√∂√¥]/g,"o").replace(/[√∫√π√º√ª]/g,"u").replace(/[√±]/g,"n").replace(/[√ß]/g,"c").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),i=a=>{const{name:s,value:o,type:u}=a.target;let x=o;if(u==="checkbox"&&(x=a.target.checked),(s==="order"||s==="parent_id")&&(x=o===""?0:Number(o)),p(c=>({...c,[s]:x})),s==="name"&&o&&(r.slug||"")===L){const c=D(o);p(O=>({...O,slug:c}))}t[s]&&b(c=>({...c,[s]:""}))},$=()=>{const a={},s=r.name||"";s.trim()?s.length<2?a.name="El nombre debe tener al menos 2 caracteres":s.length>100&&(a.name="El nombre no puede tener m√°s de 100 caracteres"):a.name="El nombre es obligatorio";const o=r.slug||"";o.trim()?/^[a-z0-9-]+$/.test(o)?o.length>150&&(a.slug="El slug no puede tener m√°s de 150 caracteres"):a.slug="El slug solo puede contener letras min√∫sculas, n√∫meros y guiones":a.slug="El slug es obligatorio";const u=r.description||"";return u&&u.length>500&&(a.description="La descripci√≥n no puede tener m√°s de 500 caracteres"),r.order!==void 0&&(r.order<0||r.order>999)&&(a.order="El orden debe estar entre 0 y 999"),r.parent_id===l&&(a.parent_id="Una categor√≠a no puede ser padre de s√≠ misma"),b(a),Object.keys(a).length===0},I=async a=>{if(a.preventDefault(),!!$()){j(!0),n(null);try{const s={...r,name:(r.name||"").trim(),slug:(r.slug||"").trim(),description:(r.description||"").trim()||void 0,icon:(r.icon||"").trim()||void 0,parent_id:r.parent_id===0?void 0:r.parent_id};console.log("üì§ Enviando datos de categor√≠a:",s);const o=await _(s);o?(console.log("‚úÖ Categor√≠a actualizada exitosamente:",o),g("/admin/categories",{state:{message:`Categor√≠a "${o.name}" actualizada exitosamente`}})):n("Error al actualizar la categor√≠a. Int√©ntalo de nuevo.")}catch(s){console.error("‚ùå Error al actualizar categor√≠a:",s),n(s instanceof Error?s.message:"Error inesperado al actualizar la categor√≠a")}finally{j(!1)}}},A=a=>{if(!a)return"Sin categor√≠a padre";const s=f.find(o=>o.id===a);return s?s.name:"Categor√≠a padre desconocida"},P=f.filter(a=>a.id!==l);return k?e.jsx("div",{className:"flex items-center justify-center min-h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(B,{className:"h-8 w-8 animate-spin text-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando datos de la categor√≠a..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(v,{to:"/admin/categories",className:"p-2 text-gray-600 hover:bg-gray-100 rounded-md",title:"Volver a categor√≠as",children:e.jsx(G,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Editar Categor√≠a"}),m&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Editando: ",m.name,m.parent_id&&e.jsxs("span",{className:"ml-2",children:["(Subcategor√≠a de:"," ",A(m.parent_id),")"]})]})]})]})}),h&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:h}),e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 mb-6 flex items-center",children:[e.jsx(H,{className:"h-5 w-5 mr-2"}),"Informaci√≥n B√°sica"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre *"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",id:"name",name:"name",value:r.name||"",onChange:i,className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${t.name?"border-red-300":"border-gray-300"}`,placeholder:"Nombre de la categor√≠a",maxLength:100,required:!0})]}),t.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"slug",className:"block text-sm font-medium text-gray-700 mb-2",children:"Slug *"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",id:"slug",name:"slug",value:r.slug||"",onChange:i,className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${t.slug?"border-red-300":"border-gray-300"}`,placeholder:"slug-de-la-categoria",maxLength:150,pattern:"^[a-z0-9-]+$",required:!0})]}),t.slug&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.slug}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Solo letras min√∫sculas, n√∫meros y guiones. Cambiar el slug puede afectar URLs existentes."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"parent_id",className:"block text-sm font-medium text-gray-700 mb-2",children:"Categor√≠a Padre"}),e.jsxs("select",{id:"parent_id",name:"parent_id",value:r.parent_id||0,onChange:i,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${t.parent_id?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:0,children:"Sin categor√≠a padre (principal)"}),P.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),t.parent_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.parent_id})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"order",className:"block text-sm font-medium text-gray-700 mb-2",children:"Orden"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",id:"order",name:"order",value:r.order||0,onChange:i,className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${t.order?"border-red-300":"border-gray-300"}`,placeholder:"0",min:"0",max:"999"})]}),t.order&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.order}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Orden de aparici√≥n (0 = primero)"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-2",children:"Descripci√≥n"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("textarea",{id:"description",name:"description",value:r.description||"",onChange:i,rows:4,className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${t.description?"border-red-300":"border-gray-300"}`,placeholder:"Descripci√≥n de la categor√≠a (opcional)",maxLength:500})]}),t.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:t.description}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[(r.description||"").length,"/500 caracteres"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{htmlFor:"icon",className:"block text-sm font-medium text-gray-700 mb-2",children:"Icono (opcional)"}),e.jsx("input",{type:"text",id:"icon",name:"icon",value:r.icon||"",onChange:i,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"Ej: fas fa-laptop, lucide:computer, etc."}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Clase CSS del icono o nombre del icono a mostrar"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:"Estados"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",name:"is_active",checked:r.is_active??!0,onChange:i,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsxs("label",{htmlFor:"is_active",className:"ml-2 text-sm text-gray-900 flex items-center",children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"Categor√≠a activa"]})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"Las categor√≠as inactivas no aparecen en la tienda"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"featured",name:"featured",checked:r.featured??!1,onChange:i,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsxs("label",{htmlFor:"featured",className:"ml-2 text-sm text-gray-900 flex items-center",children:[e.jsx(Q,{className:"h-4 w-4 mr-1"}),"Categor√≠a destacada"]})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"Las categor√≠as destacadas aparecen en secciones especiales"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsxs(v,{to:"/admin/categories",className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors flex items-center",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs("button",{type:"submit",disabled:y||C,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),y?"Guardando...":"Guardar Cambios"]})]})})]})]})};export{de as default};
//# sourceMappingURL=AdminEditCategoryPage-C0vgQ3MH.js.map
