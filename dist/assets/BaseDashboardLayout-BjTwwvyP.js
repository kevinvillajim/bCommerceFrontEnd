import{j as e,X as D,ab as I,av as S,ae as E,a7 as V,o as B,ah as $,T as M,k as F,an as H,N as q,au as G,f as J,Z as W,J as X,P as Y,V as Z,as as K,aD as Q,h as ee,W as se,aw as te}from"./ui-vendor-DEBjJ4HS.js";import{r as o,a as ae,i as re,L as T,O as ne}from"./react-vendor-Cy458wKG.js";import{A as ie}from"./seller-chunk-CL4v7LiS.js";import{u as R,a as le}from"./checkout-chunk-BfPZCzS8.js";import{T as oe}from"./ThemeToggle-BFxvmuLz.js";import{u as O}from"./index-DKar4B-a.js";import{u as ce,f as de}from"./chat-chunk-dxmpBB-S.js";const L=o.createContext(void 0),me=()=>Date.now().toString(36)+Math.random().toString(36).substr(2),ze=({children:i,initialType:s,initialPageTitles:m={}})=>{const[t,l]=o.useState(!0),[c]=o.useState(s),[x,h]=o.useState([]),[g,y]=o.useState(0),[v,d]=o.useState({}),[p,j]=o.useState(m),w=ae(),k=()=>{const{pathname:a}=w;if(p[a])return p[a];for(const[n,u]of Object.entries(p))if(a.includes(n))return u;switch(c){case"admin":return"Panel de AdministraciÃ³n";case"seller":return"Portal del Vendedor";case"customer":return"Mi Cuenta";default:return"Dashboard"}};o.useEffect(()=>{const a=x.filter(n=>!n.read).length;y(a)},[x]);const C=()=>l(a=>!a),z=a=>{const n={...a,id:me()};h(u=>[n,...u])},b=()=>{h(a=>a.map(n=>({...n,read:!0})))},N=a=>{h(n=>n.map(u=>u.id===a?{...u,read:!0}:u))},r=(a,n)=>{d(u=>({...u,[a]:n}))},f=a=>{d(n=>({...n,[a]:(n[a]||0)+1}))},_=a=>{d(n=>({...n,[a]:Math.max(0,(n[a]||0)-1)}))},P=(a,n)=>{j(u=>({...u,[a]:n}))},A={isSidebarOpen:t,toggleSidebar:C,notifications:x,unreadNotificationsCount:g,addNotification:z,markAllNotificationsAsRead:b,markNotificationAsRead:N,pendingActions:v,setPendingAction:r,incrementPendingAction:f,decrementPendingAction:_,dashboardType:c,currentPageTitle:k(),setPageTitle:P};return e.jsx(L.Provider,{value:A,children:i})},U=()=>{const i=o.useContext(L);if(i===void 0)throw new Error("useDashboard debe ser usado dentro de un DashboardProvider");return i},xe=({path:i,label:s,icon:m,isNotificated:t,notificationCount:l})=>(console.log("SidebarLink â†’",{label:s,notificationCount:l}),e.jsxs(re,{to:i,end:!0,className:({isActive:c})=>`flex items-center px-4 py-2 mt-2 text-sm transition-colors duration-200 rounded-lg ${c?"bg-primary-100 text-primary-700":"text-gray-600 hover:bg-gray-200"}`,children:[m,e.jsx("span",{className:"mx-1",children:s}),t&&l&&l>0&&e.jsxs("span",{className:"ml-auto inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 bg-red-500 rounded-full",children:[(()=>{const c=Number(l);return c>99?"99+":c>0?c:""})(),"				"]})]})),ue=({groups:i,title:s,isOpen:m=!0,toggleSidebar:t=()=>{}})=>e.jsxs("aside",{className:`bg-white fixed md:static inset-y-0 left-0 z-30 w-64 transition-transform duration-300 transform ${m?"translate-x-0":"-translate-x-full"} md:translate-x-0 overflow-y-auto`,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center",children:[s.icon,e.jsx("h2",{className:"text-lg font-semibold text-gray-900 ml-2",children:s.title})]}),e.jsx("button",{onClick:t,className:"p-1 rounded-md text-gray-500 md:hidden hover:text-gray-900 hover:bg-gray-100",children:e.jsx(D,{size:20})})]}),e.jsx("div",{className:"p-4",children:i.map((l,c)=>e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:l.title}),e.jsx("div",{className:"mt-2",children:l.links.map((x,h)=>e.jsx(xe,{...x},h))})]},c))})]}),he=i=>{switch(i){case"new_message":return e.jsx(Z,{className:"text-blue-500",size:16});case"order_status":return e.jsx(Y,{className:"text-green-500",size:16});case"shipping_update":return e.jsx(X,{className:"text-purple-500",size:16});case"product_update":return e.jsx(W,{className:"text-orange-500",size:16});case"rating_received":case"seller_rated":return e.jsx(J,{className:"text-yellow-500",size:16});case"new_order":return e.jsx(G,{className:"text-green-600",size:16});case"low_stock":return e.jsx(M,{className:"text-red-500",size:16});case"feedback_response":return e.jsx(q,{className:"text-indigo-500",size:16});case"promotion":case"discount":return e.jsx(H,{className:"text-pink-500",size:16});case"seller_strike":return e.jsx(F,{className:"text-orange-500",size:16});case"account_blocked":return e.jsx($,{className:"text-red-500",size:16});case"seller_suspended":return e.jsx(M,{className:"text-yellow-600",size:16});case"seller_inactive":return e.jsx($,{className:"text-red-600",size:16});default:return e.jsx(S,{className:"text-gray-500",size:16})}},ge=(i,s)=>{const{type:m,data:t}=i;switch(m){case"new_message":return t.chat_id?s?`/seller/messages/${t.chat_id}`:`/chats/${t.chat_id}`:s?"/seller/messages":"/chats";case"order_status":return t.order_id?s?`/seller/orders/${t.order_id}`:`/orders/${t.order_id}`:s?"/seller/orders":"/orders";case"shipping_update":return t.tracking_number?`/tracking/${t.tracking_number}`:t.order_id?s?`/seller/orders/${t.order_id}`:`/orders/${t.order_id}`:null;case"rating_received":case"seller_rated":return t.rating_id?`/ratings/${t.rating_id}`:s?"/seller/ratings":"/profile";case"new_order":return t.order_id?s?`/seller/orders/${t.order_id}`:null:s?"/seller/orders":null;case"seller_suspended":case"seller_inactive":return s?"/seller/dashboard":null;default:return null}},fe=({isOpen:i,onClose:s,isAdmin:m=!1})=>{const[t,l]=o.useState(null),{roleInfo:c}=ce(),{optimisticNotificationRead:x,forceRefresh:h}=R(),{notifications:g,loading:y,error:v,unreadCount:d,fetchNotifications:p,markAsRead:j,markAllAsRead:w,deleteNotification:k}=O();o.useEffect(()=>{i&&p(1,!1)},[i,p]);const C=o.useCallback(async r=>{l(null),r.read||await j(r.id)&&(x(),console.log("ðŸ”” Contador del header actualizado por clic en notificaciÃ³n")),s();const f=ge(r,c.isSeller);f&&(window.location.href=f)},[j,s,c.isSeller,x]),z=o.useCallback(async()=>{await w()&&(await h(),console.log("ðŸ”” Contadores del header actualizados - marcar todas como leÃ­das"))},[w,h]),b=o.useCallback(async r=>{await k(r),l(null)},[k]),N=o.useCallback(async r=>{await j(r)&&(x(),console.log("ðŸ”” Contador del header actualizado por marcar como leÃ­da individual")),l(null)},[j,x]);return i?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 transition-opacity",onClick:s}),e.jsx("div",{className:"relative flex items-start justify-center min-h-screen px-4 pt-16 pb-20",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Notificaciones"}),d>0&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[d," sin leer"]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[d>0&&e.jsxs("button",{onClick:z,disabled:y,className:"px-4 py-2 bg-primary-100 text-primary-700 hover:bg-primary-200 disabled:opacity-50 flex items-center rounded-lg transition-all duration-200 text-sm font-medium border border-primary-200 hover:border-primary-300",title:`Marcar ${d} notificaciÃ³n${d>1?"es":""} como leÃ­da${d>1?"s":""}`,children:[e.jsx(I,{size:16,className:"mr-2"}),"Marcar todas (",d,")"]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",title:"Cerrar notificaciones",children:e.jsx(D,{size:20,className:"text-gray-500"})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:y&&g.length===0?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-600"})}):v?e.jsxs("div",{className:"p-6 text-center text-red-600",children:[e.jsx("p",{children:v}),e.jsx("button",{onClick:()=>p(1,!1),className:"mt-2 text-sm underline",children:"Reintentar"})]}):g.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(S,{className:"mx-auto h-12 w-12 text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-700 mb-2",children:"No tienes notificaciones"}),e.jsx("p",{className:"text-gray-500",children:"Cuando tengas actualizaciones importantes, aparecerÃ¡n aquÃ­."})]}):e.jsx("div",{className:"divide-y divide-gray-100",children:g.slice(0,10).map(r=>e.jsx("div",{onClick:()=>C(r),className:`p-4 hover:bg-gray-50 cursor-pointer transition-colors ${r.read?"bg-white":"bg-primary-50"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:he(r.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h4",{className:`text-sm font-medium ${r.read?"text-gray-700":"text-gray-900"}`,children:r.title}),!r.read&&e.jsx("div",{className:"w-1.5 h-1.5 bg-primary-500 rounded-full"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:r.message}),e.jsx("p",{className:"text-xs text-gray-400",children:de(r.createdAt)})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:f=>{f.stopPropagation(),l(t===r.id?null:r.id)},className:"p-1 rounded-full hover:bg-gray-200 transition-colors",children:e.jsx(E,{size:14,className:"text-gray-500"})}),t===r.id&&e.jsxs("div",{className:"absolute right-0 top-8 bg-white rounded-lg shadow-lg border border-gray-200 z-10 min-w-[140px]",children:[!r.read&&e.jsxs("button",{onClick:f=>{f.stopPropagation(),N(r.id)},className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center",children:[e.jsx(V,{size:12,className:"mr-2"}),"Marcar como leÃ­da"]}),e.jsxs("button",{onClick:f=>{f.stopPropagation(),b(r.id)},className:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center",children:[e.jsx(B,{size:12,className:"mr-2"}),"Eliminar"]})]})]})]})},r.id))})}),e.jsx("div",{className:"p-4 border-t border-gray-200 bg-gray-50",children:e.jsx(T,{to:m?"/admin/notifications":"/seller/notifications",onClick:s,className:"block w-full text-center py-2 px-4 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors text-sm font-medium",children:"Ver todas las notificaciones"})})]})}),t!==null&&e.jsx("div",{className:"fixed inset-0 z-0",onClick:()=>l(null)})]}):null},pe=({toggleSidebar:i,isAdmin:s=!1,unreadNotifications:m,notifications:t=[],pendingActions:l={},onReadAllNotifications:c=()=>{},visibleInMobile:x=!0})=>{const[h,g]=o.useState(!1),[y,v]=o.useState(!1),{user:d,logout:p}=o.useContext(ie),{currentPageTitle:j}=U(),{counters:w,loading:k}=le(),{forceRefresh:C}=R(),{markAllAsRead:z}=O(),b=w.notificationCount;console.log("DashboardHeader: Contadores optimizados",{finalUnreadNotifications:b,hookUnread:w.notificationCount,isAdmin:s,loading:k});const N=Object.values(l).reduce((a,n)=>a+(n||0),0),r=()=>{g(!h)},f=()=>{v(!y)},_=async()=>{await z()&&(await C(),console.log("ðŸ”” Header - Contadores actualizados despuÃ©s de marcar todas")),c()},P=()=>d?.name?.charAt(0).toUpperCase()||(s?"A":"U");o.useEffect(()=>{const a=n=>{const u=n.target;!u.closest(".profile-menu")&&!u.closest(".profile-button")&&g(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]);const A=()=>s?"bg-red-100 text-red-600":"bg-primary-100 text-primary-600";return e.jsxs("header",{className:"bg-white shadow-sm z-20",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center",children:[x&&e.jsx("button",{className:"md:hidden text-gray-600 focus:outline-none mr-3",onClick:i,children:e.jsx(K,{size:24})}),N>0&&e.jsx("div",{className:"flex items-center mr-4",children:e.jsxs("span",{className:"bg-red-500 text-white text-sm font-medium rounded-md px-2 py-1 flex items-center",children:[e.jsx(M,{size:16,className:"mr-1"}),N," acciÃ³n",N===1?"":"es"," pendiente",N===1?"":"s"]})}),e.jsx("h1",{className:"text-lg font-medium text-gray-800 items-center",children:j})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(oe,{}),(s||d?.role==="seller")&&e.jsx("a",{href:"/",target:"",rel:"noopener noreferrer",className:"text-gray-600 hover:text-gray-900",children:e.jsx("span",{className:"text-sm",children:s?"Visitar Tienda":"Ir a Tienda"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[b>0&&e.jsx("button",{onClick:_,className:"text-xs text-primary-600 hover:text-primary-700 px-2 py-1 rounded-md hover:bg-primary-50 transition-colors",title:"Marcar todas como leÃ­das",children:"Marcar todas"}),e.jsxs("button",{className:"text-gray-600 hover:text-gray-900 p-1 rounded-full relative transition-colors",onClick:f,children:[e.jsx(S,{size:20}),b>0&&e.jsx("span",{className:"absolute top-0 right-0 transform translate-x-1/2 -translate-y-1/2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:b>9?"9+":b}),k&&e.jsx("span",{className:"absolute top-0 right-0 transform translate-x-1/2 -translate-y-1/2 bg-blue-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"})})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{className:"profile-button flex items-center space-x-2 text-gray-800 focus:outline-none",onClick:r,children:[e.jsx("div",{className:`h-8 w-8 rounded-full ${A()} flex items-center justify-center font-medium`,children:P()}),e.jsx("span",{className:"hidden md:block font-medium",children:d?.name||(s?"Admin":"Usuario")}),e.jsx(Q,{size:18,className:"hidden md:block"})]}),h&&e.jsxs("div",{className:"profile-menu absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-30 border border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200",children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:d?.name||(s?"Admin":"Usuario")}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:d?.email||(s?"admin@ejemplo.com":"usuario@ejemplo.com")})]}),e.jsx(T,{to:s?"/admin/profile":"/seller/profile",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>g(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{size:16,className:"mr-2"}),"Mi Perfil"]})}),e.jsx(T,{to:s?"/admin/settings":"/seller/settings",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",onClick:()=>g(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{size:16,className:"mr-2"}),"ConfiguraciÃ³n"]})}),e.jsx("button",{onClick:p,className:"block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(te,{size:16,className:"mr-2"}),"Cerrar SesiÃ³n"]})})]})]})]})]}),e.jsx(fe,{isOpen:y,onClose:()=>v(!1),isAdmin:s})]})},be=({type:i="admin",year:s=new Date().getFullYear(),additionalText:m})=>{const t=()=>{switch(i){case"admin":return"Panel de AdministraciÃ³n Comersia";case"seller":return"Portal de Vendedor Comersia";case"customer":return"Comersia";case"payment":return"Panel de Pagos Comersia";default:return"Comersia"}};return e.jsx("footer",{className:"bg-white py-3 px-4 text-center text-sm text-gray-500 border-t border-gray-200",children:e.jsxs("p",{children:["Â© ",s," ",t(),".",m?` ${m}`:" Todos los derechos reservados."]})})},_e=({sidebarGroups:i,sidebarTitle:s,headerExtras:m,footerExtras:t})=>{const{isSidebarOpen:l,toggleSidebar:c,markAllNotificationsAsRead:x,pendingActions:h,dashboardType:g}=U();return e.jsxs("div",{className:"flex h-screen bg-gray-100",children:[e.jsx(ue,{groups:i,title:s,isOpen:l,toggleSidebar:c}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(pe,{toggleSidebar:c,isAdmin:g==="admin",pendingActions:h,onReadAllNotifications:x}),m&&m,e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-50 p-4 md:p-6",children:e.jsx(ne,{})}),t&&t,e.jsx(be,{type:g})]})]})};export{_e as B,ze as D};
//# sourceMappingURL=BaseDashboardLayout-BjTwwvyP.js.map
