{"version":3,"file":"AdminProductsPage-B0U8ge78.js","sources":["../../src/core/services/AdminProductService.ts","../../src/core/useCases/admin/product/GetAllProductsUseCase.ts","../../src/core/useCases/admin/product/CreateProductAsAdminUseCase.ts","../../src/core/useCases/admin/product/UpdateAnyProductUseCase.ts","../../src/core/useCases/admin/product/DeleteAnyProductUseCase.ts","../../src/core/useCases/admin/product/ToggleProductFeaturedUseCase.ts","../../src/core/useCases/admin/product/ToggleProductPublishedUseCase.ts","../../src/core/useCases/admin/product/UpdateProductStatusUseCase.ts","../../src/core/useCases/admin/product/GetProductsBySellerUseCase.ts","../../src/core/useCases/admin/product/GetProductStatsUseCase.ts","../../src/presentation/hooks/useAdminProducts.ts","../../src/utils/unifiedImageUtils.ts","../../src/presentation/pages/admin/AdminProductsPage.tsx"],"sourcesContent":["// src/core/services/AdminProductService.ts\r\n\r\nimport ApiClient from \"../../infrastructure/api/apiClient\";\r\nimport {API_ENDPOINTS} from \"../../constants/apiEndpoints\";\r\nimport type {\r\n\tProduct,\r\n\tProductDetail,\r\n\tProductListResponse,\r\n\tProductCreationData,\r\n\tProductUpdateData,\r\n} from \"../domain/entities/Product\";\r\nimport type {ExtendedProductFilterParams} from \"../../presentation/types/ProductFilterParams\";\r\n\r\n/**\r\n * Servicio de administraci√≥n de productos - Solo para administradores\r\n * Permite gestionar cualquier producto en el sistema\r\n */\r\nexport class AdminProductService {\r\n\t/**\r\n\t * Obtiene todos los productos del sistema (como admin)\r\n\t */\r\n\tasync getAllProducts(\r\n\t\tfilterParams?: ExtendedProductFilterParams\r\n\t): Promise<ProductListResponse | null> {\r\n\t\ttry {\r\n\t\t\tconsole.log(\r\n\t\t\t\t\"üì§ AdminProductService: Obteniendo todos los productos como admin:\",\r\n\t\t\t\tfilterParams\r\n\t\t\t);\r\n\r\n\t\t\t// Limpiar par√°metros espec√≠ficos de frontend que el backend no reconoce\r\n\t\t\tconst cleanParams = {...filterParams};\r\n\t\t\tif (cleanParams && \"admin_view\" in cleanParams) {\r\n\t\t\t\tdelete cleanParams.admin_view; // CORREGIDO: verificar si existe antes de eliminar\r\n\t\t\t}\r\n\r\n\t\t\tconst response = await ApiClient.get<ProductListResponse>(\r\n\t\t\t\tAPI_ENDPOINTS.PRODUCTS.LIST,\r\n\t\t\t\tcleanParams\r\n\t\t\t);\r\n\r\n\t\t\tconsole.log(\"üì• AdminProductService: Respuesta del servidor:\", response);\r\n\t\t\treturn response;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"‚ùå Error en AdminProductService.getAllProducts:\", error);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Obtiene un producto por ID (como admin)\r\n\t */\r\n\tasync getProductById(id: number): Promise<ProductDetail | null> {\r\n\t\ttry {\r\n\t\t\tconsole.log(\r\n\t\t\t\t`üì§ AdminProductService: Obteniendo producto ${id} como admin`\r\n\t\t\t);\r\n\r\n\t\t\tconst response = await ApiClient.get<{data: ProductDetail}>(\r\n\t\t\t\tAPI_ENDPOINTS.PRODUCTS.DETAILS(id)\r\n\t\t\t);\r\n\r\n\t\t\treturn response?.data || null;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"‚ùå Error en AdminProductService.getProductById:\", error);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Crea un producto (como admin para cualquier vendedor)\r\n\t */\r\n\tasync createProduct(\r\n\t\tdata: ProductCreationData,\r\n\t\tsellerId?: number\r\n\t): Promise<Product | null> {\r\n\t\ttry {\r\n\t\t\tconsole.log(\"üì§ AdminProductService: Creando producto como admin:\", data);\r\n\r\n\t\t\tconst formData = new FormData();\r\n\r\n\t\t\t// Campos b√°sicos\r\n\t\t\tformData.append(\"name\", data.name);\r\n\t\t\tformData.append(\"description\", data.description);\r\n\t\t\tformData.append(\"price\", String(data.price));\r\n\t\t\tformData.append(\"stock\", String(data.stock));\r\n\t\t\tformData.append(\"category_id\", String(data.category_id));\r\n\r\n\t\t\t// Si se especifica un vendedor, asignarlo\r\n\t\t\tif (sellerId) {\r\n\t\t\t\tformData.append(\"seller_id\", String(sellerId));\r\n\t\t\t}\r\n\r\n\t\t\t// Campos opcionales\r\n\t\t\tif (data.shortDescription)\r\n\t\t\t\tformData.append(\"short_description\", data.shortDescription);\r\n\t\t\tif (data.weight !== undefined)\r\n\t\t\t\tformData.append(\"weight\", String(data.weight));\r\n\t\t\tif (data.width !== undefined)\r\n\t\t\t\tformData.append(\"width\", String(data.width));\r\n\t\t\tif (data.height !== undefined)\r\n\t\t\t\tformData.append(\"height\", String(data.height));\r\n\t\t\tif (data.depth !== undefined)\r\n\t\t\t\tformData.append(\"depth\", String(data.depth));\r\n\t\t\tif (data.dimensions) formData.append(\"dimensions\", data.dimensions);\r\n\t\t\tif (data.sku) formData.append(\"sku\", data.sku);\r\n\t\t\tif (data.status) formData.append(\"status\", data.status);\r\n\t\t\tif (data.featured !== undefined)\r\n\t\t\t\tformData.append(\"featured\", String(data.featured));\r\n\t\t\tif (data.published !== undefined)\r\n\t\t\t\tformData.append(\"published\", String(data.published));\r\n\t\t\tif (data.discount_percentage !== undefined) {\r\n\t\t\t\tformData.append(\r\n\t\t\t\t\t\"discount_percentage\",\r\n\t\t\t\t\tString(data.discount_percentage)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// Arrays\r\n\t\t\tif (data.colors) {\r\n\t\t\t\tconst colorsValue =\r\n\t\t\t\t\ttypeof data.colors === \"string\"\r\n\t\t\t\t\t\t? data.colors\r\n\t\t\t\t\t\t: JSON.stringify(data.colors);\r\n\t\t\t\tformData.append(\"colors\", colorsValue);\r\n\t\t\t}\r\n\t\t\tif (data.sizes) {\r\n\t\t\t\tconst sizesValue =\r\n\t\t\t\t\ttypeof data.sizes === \"string\"\r\n\t\t\t\t\t\t? data.sizes\r\n\t\t\t\t\t\t: JSON.stringify(data.sizes);\r\n\t\t\t\tformData.append(\"sizes\", sizesValue);\r\n\t\t\t}\r\n\t\t\tif (data.tags) {\r\n\t\t\t\tconst tagsValue =\r\n\t\t\t\t\ttypeof data.tags === \"string\" ? data.tags : JSON.stringify(data.tags);\r\n\t\t\t\tformData.append(\"tags\", tagsValue);\r\n\t\t\t}\r\n\r\n\t\t\t// Atributos\r\n\t\t\tif (data.attributes && Object.keys(data.attributes).length > 0) {\r\n\t\t\t\tformData.append(\"attributes\", JSON.stringify(data.attributes));\r\n\t\t\t}\r\n\r\n\t\t\t// Im√°genes\r\n\t\t\tif (data.images && data.images.length > 0) {\r\n\t\t\t\tdata.images.forEach((file, index) => {\r\n\t\t\t\t\tformData.append(`images[${index}]`, file);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tconst response = await ApiClient.uploadFile<Product>(\r\n\t\t\t\tAPI_ENDPOINTS.PRODUCTS.CREATE,\r\n\t\t\t\tformData\r\n\t\t\t);\r\n\r\n\t\t\tconsole.log(\"‚úÖ AdminProductService: Producto creado:\", response);\r\n\t\t\treturn response;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"‚ùå Error en AdminProductService.createProduct:\", error);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Actualiza cualquier producto (como admin)\r\n\t */\r\n\tasync updateProduct(data: ProductUpdateData): Promise<Product | null> {\r\n\t\ttry {\r\n\t\t\tconsole.log(\r\n\t\t\t\t`üì§ AdminProductService: Actualizando producto ${data.id} como admin:`,\r\n\t\t\t\tdata\r\n\t\t\t);\r\n\r\n\t\t\tconst formData = new FormData();\r\n\r\n\t\t\t// Campos opcionales para actualizaci√≥n\r\n\t\t\tif (data.name) formData.append(\"name\", data.name);\r\n\t\t\tif (data.description) formData.append(\"description\", data.description);\r\n\t\t\tif (data.shortDescription)\r\n\t\t\t\tformData.append(\"short_description\", data.shortDescription);\r\n\t\t\tif (data.price !== undefined)\r\n\t\t\t\tformData.append(\"price\", String(data.price));\r\n\t\t\tif (data.stock !== undefined)\r\n\t\t\t\tformData.append(\"stock\", String(data.stock));\r\n\t\t\tif (data.category_id)\r\n\t\t\t\tformData.append(\"category_id\", String(data.category_id));\r\n\r\n\t\t\t// Campos opcionales\r\n\t\t\tif (data.weight !== undefined)\r\n\t\t\t\tformData.append(\"weight\", String(data.weight));\r\n\t\t\tif (data.width !== undefined)\r\n\t\t\t\tformData.append(\"width\", String(data.width));\r\n\t\t\tif (data.height !== undefined)\r\n\t\t\t\tformData.append(\"height\", String(data.height));\r\n\t\t\tif (data.depth !== undefined)\r\n\t\t\t\tformData.append(\"depth\", String(data.depth));\r\n\t\t\tif (data.dimensions) formData.append(\"dimensions\", data.dimensions);\r\n\t\t\tif (data.sku) formData.append(\"sku\", data.sku);\r\n\t\t\tif (data.status) formData.append(\"status\", data.status);\r\n\t\t\tif (data.featured !== undefined)\r\n\t\t\t\tformData.append(\"featured\", String(data.featured));\r\n\t\t\tif (data.published !== undefined)\r\n\t\t\t\tformData.append(\"published\", String(data.published));\r\n\t\t\tif (data.discount_percentage !== undefined) {\r\n\t\t\t\tformData.append(\r\n\t\t\t\t\t\"discount_percentage\",\r\n\t\t\t\t\tString(data.discount_percentage)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// Arrays\r\n\t\t\tif (data.colors) {\r\n\t\t\t\tconst colorsValue =\r\n\t\t\t\t\ttypeof data.colors === \"string\"\r\n\t\t\t\t\t\t? data.colors\r\n\t\t\t\t\t\t: JSON.stringify(data.colors);\r\n\t\t\t\tformData.append(\"colors\", colorsValue);\r\n\t\t\t}\r\n\t\t\tif (data.sizes) {\r\n\t\t\t\tconst sizesValue =\r\n\t\t\t\t\ttypeof data.sizes === \"string\"\r\n\t\t\t\t\t\t? data.sizes\r\n\t\t\t\t\t\t: JSON.stringify(data.sizes);\r\n\t\t\t\tformData.append(\"sizes\", sizesValue);\r\n\t\t\t}\r\n\t\t\tif (data.tags) {\r\n\t\t\t\tconst tagsValue =\r\n\t\t\t\t\ttypeof data.tags === \"string\" ? data.tags : JSON.stringify(data.tags);\r\n\t\t\t\tformData.append(\"tags\", tagsValue);\r\n\t\t\t}\r\n\r\n\t\t\t// Atributos\r\n\t\t\tif (data.attributes && Object.keys(data.attributes).length > 0) {\r\n\t\t\t\tformData.append(\"attributes\", JSON.stringify(data.attributes));\r\n\t\t\t}\r\n\r\n\t\t\t// Gesti√≥n de im√°genes\r\n\t\t\tif (data.replace_images !== undefined) {\r\n\t\t\t\tformData.append(\"replace_images\", String(data.replace_images));\r\n\t\t\t}\r\n\t\t\tif (data.remove_images && data.remove_images.length > 0) {\r\n\t\t\t\tformData.append(\"remove_images\", JSON.stringify(data.remove_images));\r\n\t\t\t}\r\n\t\t\tif (data.images && data.images.length > 0) {\r\n\t\t\t\tdata.images.forEach((file, index) => {\r\n\t\t\t\t\tformData.append(`images[${index}]`, file);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tconst response = await ApiClient.updateFile<Product>(\r\n\t\t\t\tAPI_ENDPOINTS.PRODUCTS.UPDATE(data.id),\r\n\t\t\t\tformData\r\n\t\t\t);\r\n\r\n\t\t\tconsole.log(\"‚úÖ AdminProductService: Producto actualizado:\", response);\r\n\t\t\treturn response;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"‚ùå Error en AdminProductService.updateProduct:\", error);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Elimina cualquier producto (como admin)\r\n\t */\r\n\tasync deleteProduct(id: number): Promise<boolean> {\r\n\t\ttry {\r\n\t\t\tconsole.log(\r\n\t\t\t\t`üì§ AdminProductService: Eliminando producto ${id} como admin`\r\n\t\t\t);\r\n\r\n\t\t\tconst response = await ApiClient.delete(\r\n\t\t\t\tAPI_ENDPOINTS.PRODUCTS.DELETE(id)\r\n\t\t\t);\r\n\r\n\t\t\tconsole.log(\"‚úÖ AdminProductService: Producto eliminado:\", response);\r\n\t\t\treturn true;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"‚ùå Error en AdminProductService.deleteProduct:\", error);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Cambia el estado destacado de un producto - CORREGIDO\r\n\t */\r\n\tasync toggleFeatured(id: number, featured: boolean): Promise<boolean> {\r\n\t\ttry {\r\n\t\t\tconsole.log(\r\n\t\t\t\t`üì§ AdminProductService: Cambiando featured del producto ${id} a ${featured}`\r\n\t\t\t);\r\n\r\n\t\t\t// Usar PATCH en lugar de PUT para actualizaciones parciales\r\n\t\t\tconst response = await ApiClient.patch(\r\n\t\t\t\tAPI_ENDPOINTS.PRODUCTS.UPDATE(id),\r\n\t\t\t\t{featured: featured}\r\n\t\t\t);\r\n\r\n\t\t\tconsole.log(\"‚úÖ AdminProductService: Featured actualizado:\", response);\r\n\t\t\treturn true;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"‚ùå Error en AdminProductService.toggleFeatured:\", error);\r\n\t\t\tif (error instanceof Error) {\r\n\t\t\t\tconsole.error(\"Error message:\", error.message);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Cambia el estado de publicaci√≥n de un producto - CORREGIDO\r\n\t */\r\n\tasync togglePublished(id: number, published: boolean): Promise<boolean> {\r\n\t\ttry {\r\n\t\t\tconsole.log(\r\n\t\t\t\t`üì§ AdminProductService: Cambiando published del producto ${id} a ${published}`\r\n\t\t\t);\r\n\r\n\t\t\t// Usar PATCH en lugar de PUT para actualizaciones parciales\r\n\t\t\tconst response = await ApiClient.patch(\r\n\t\t\t\tAPI_ENDPOINTS.PRODUCTS.UPDATE(id),\r\n\t\t\t\t{published: published}\r\n\t\t\t);\r\n\r\n\t\t\tconsole.log(\"‚úÖ AdminProductService: Published actualizado:\", response);\r\n\t\t\treturn true;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"‚ùå Error en AdminProductService.togglePublished:\", error);\r\n\t\t\tif (error instanceof Error) {\r\n\t\t\t\tconsole.error(\"Error message:\", error.message);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Cambia el estado de un producto - CORREGIDO\r\n\t */\r\n\tasync updateStatus(id: number, status: string): Promise<boolean> {\r\n\t\ttry {\r\n\t\t\tconsole.log(\r\n\t\t\t\t`üì§ AdminProductService: Cambiando status del producto ${id} a ${status}`\r\n\t\t\t);\r\n\r\n\t\t\t// Usar PATCH en lugar de PUT para actualizaciones parciales\r\n\t\t\tconst response = await ApiClient.patch(\r\n\t\t\t\tAPI_ENDPOINTS.PRODUCTS.UPDATE(id),\r\n\t\t\t\t{status: status}\r\n\t\t\t);\r\n\r\n\t\t\tconsole.log(\"‚úÖ AdminProductService: Status actualizado:\", response);\r\n\t\t\treturn true;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"‚ùå Error en AdminProductService.updateStatus:\", error);\r\n\t\t\tif (error instanceof Error) {\r\n\t\t\t\tconsole.error(\"Error message:\", error.message);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Obtiene estad√≠sticas de productos para admin\r\n\t */\r\n\tasync getProductStats(): Promise<any> {\r\n\t\ttry {\r\n\t\t\tconsole.log(\r\n\t\t\t\t\"üì§ AdminProductService: Obteniendo estad√≠sticas de productos\"\r\n\t\t\t);\r\n\r\n\t\t\t// Este endpoint podr√≠a necesitar ser creado en el backend\r\n\t\t\tconst response = await ApiClient.get(\"/admin/products/stats\");\r\n\r\n\t\t\tconsole.log(\"‚úÖ AdminProductService: Estad√≠sticas obtenidas:\", response);\r\n\t\t\treturn response;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"‚ùå Error en AdminProductService.getProductStats:\", error);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Busca productos por vendedor (como admin)\r\n\t */\r\n\tasync getProductsBySeller(\r\n\t\tsellerId: number,\r\n\t\tfilterParams?: ExtendedProductFilterParams\r\n\t): Promise<ProductListResponse | null> {\r\n\t\ttry {\r\n\t\t\tconsole.log(\r\n\t\t\t\t`üì§ AdminProductService: Obteniendo productos del vendedor ${sellerId}`\r\n\t\t\t);\r\n\r\n\t\t\tconst response = await ApiClient.get<ProductListResponse>(\r\n\t\t\t\tAPI_ENDPOINTS.PRODUCTS.BY_SELLER(sellerId),\r\n\t\t\t\tfilterParams\r\n\t\t\t);\r\n\r\n\t\t\tconsole.log(\r\n\t\t\t\t\"‚úÖ AdminProductService: Productos del vendedor obtenidos:\",\r\n\t\t\t\tresponse\r\n\t\t\t);\r\n\t\t\treturn response;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\r\n\t\t\t\t\"‚ùå Error en AdminProductService.getProductsBySeller:\",\r\n\t\t\t\terror\r\n\t\t\t);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default AdminProductService;\r\n","// src/core/useCases/admin/product/GetAllProductsUseCase.ts\r\n\r\nimport {AdminProductService} from \"../../../services/AdminProductService\";\r\nimport type {ProductListResponse} from \"../../../domain/entities/Product\";\r\nimport type {ExtendedProductFilterParams} from \"../../../../presentation/types/ProductFilterParams\";\r\n\r\nexport class GetAllProductsUseCase {\r\n\tprivate adminProductService: AdminProductService;\r\n\r\n\tconstructor(adminProductService: AdminProductService) {\r\n\t\tthis.adminProductService = adminProductService;\r\n\t}\r\n\r\n\tasync execute(\r\n\t\tfilterParams?: ExtendedProductFilterParams\r\n\t): Promise<ProductListResponse | null> {\r\n\t\tconsole.log(\r\n\t\t\t\"GetAllProductsUseCase: Obteniendo todos los productos como admin\"\r\n\t\t);\r\n\t\ttry {\r\n\t\t\tconst products =\r\n\t\t\t\tawait this.adminProductService.getAllProducts(filterParams);\r\n\t\t\tconsole.log(\r\n\t\t\t\t\"GetAllProductsUseCase: Productos obtenidos correctamente:\",\r\n\t\t\t\tproducts\r\n\t\t\t);\r\n\t\t\treturn products;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\r\n\t\t\t\t\"GetAllProductsUseCase: Error al obtener productos:\",\r\n\t\t\t\terror\r\n\t\t\t);\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n}\r\n","// src/core/useCases/admin/product/CreateProductAsAdminUseCase.ts\r\n\r\nimport {AdminProductService} from \"../../../services/AdminProductService\";\r\nimport type {\r\n    Product,\r\n    ProductCreationData,\r\n} from \"../../../domain/entities/Product\";\r\n\r\nexport class CreateProductAsAdminUseCase {\r\n    private adminProductService: AdminProductService;\r\n\r\n    constructor(adminProductService: AdminProductService) {\r\n        this.adminProductService = adminProductService;\r\n    }\r\n\r\n    async execute(\r\n        data: ProductCreationData,\r\n        sellerId?: number\r\n    ): Promise<Product | null> {\r\n        console.log(\r\n            \"CreateProductAsAdminUseCase: Creando producto como admin:\",\r\n            data\r\n        );\r\n        try {\r\n            const product = await this.adminProductService.createProduct(\r\n                data,\r\n                sellerId\r\n            );\r\n            console.log(\r\n                \"CreateProductAsAdminUseCase: Producto creado correctamente:\",\r\n                product\r\n            );\r\n            return product;\r\n        } catch (error) {\r\n            console.error(\r\n                \"CreateProductAsAdminUseCase: Error al crear producto:\",\r\n                error\r\n            );\r\n            throw error;\r\n        }\r\n    }\r\n}","// src/core/useCases/admin/product/UpdateAnyProductUseCase.ts\r\n\r\nimport {AdminProductService} from \"../../../services/AdminProductService\";\r\nimport type {\r\n    Product,\r\n    ProductUpdateData,\r\n} from \"../../../domain/entities/Product\";\r\n\r\nexport class UpdateAnyProductUseCase {\r\n    private adminProductService: AdminProductService;\r\n\r\n    constructor(adminProductService: AdminProductService) {\r\n        this.adminProductService = adminProductService;\r\n    }\r\n\r\n    async execute(data: ProductUpdateData): Promise<Product | null> {\r\n        console.log(\r\n            `UpdateAnyProductUseCase: Actualizando producto ${data.id} como admin:`,\r\n            data\r\n        );\r\n        try {\r\n            const product = await this.adminProductService.updateProduct(data);\r\n            console.log(\r\n                \"UpdateAnyProductUseCase: Producto actualizado correctamente:\",\r\n                product\r\n            );\r\n            return product;\r\n        } catch (error) {\r\n            console.error(\r\n                \"UpdateAnyProductUseCase: Error al actualizar producto:\",\r\n                error\r\n            );\r\n            throw error;\r\n        }\r\n    }\r\n}","// src/core/useCases/admin/product/DeleteAnyProductUseCase.ts\r\n\r\nimport {AdminProductService} from \"../../../services/AdminProductService\";\r\n\r\nexport class DeleteAnyProductUseCase {\r\n    private adminProductService: AdminProductService;\r\n\r\n    constructor(adminProductService: AdminProductService) {\r\n        this.adminProductService = adminProductService;\r\n    }\r\n\r\n    async execute(id: number): Promise<boolean> {\r\n        console.log(\r\n            `DeleteAnyProductUseCase: Eliminando producto ${id} como admin`\r\n        );\r\n        try {\r\n            const result = await this.adminProductService.deleteProduct(id);\r\n            console.log(\r\n                \"DeleteAnyProductUseCase: Producto eliminado correctamente:\",\r\n                result\r\n            );\r\n            return result;\r\n        } catch (error) {\r\n            console.error(\r\n                \"DeleteAnyProductUseCase: Error al eliminar producto:\",\r\n                error\r\n            );\r\n            throw error;\r\n        }\r\n    }\r\n}","// src/core/useCases/admin/product/ToggleProductFeaturedUseCase.ts\r\n\r\nimport {AdminProductService} from \"../../../services/AdminProductService\";\r\n\r\nexport class ToggleProductFeaturedUseCase {\r\n    private adminProductService: AdminProductService;\r\n\r\n    constructor(adminProductService: AdminProductService) {\r\n        this.adminProductService = adminProductService;\r\n    }\r\n\r\n    async execute(id: number, featured: boolean): Promise<boolean> {\r\n        console.log(\r\n            `ToggleProductFeaturedUseCase: Cambiando featured del producto ${id} a ${featured}`\r\n        );\r\n        try {\r\n            const result = await this.adminProductService.toggleFeatured(\r\n                id,\r\n                featured\r\n            );\r\n            console.log(\r\n                \"ToggleProductFeaturedUseCase: Featured actualizado correctamente:\",\r\n                result\r\n            );\r\n            return result;\r\n        } catch (error) {\r\n            console.error(\r\n                \"ToggleProductFeaturedUseCase: Error al cambiar featured:\",\r\n                error\r\n            );\r\n            throw error;\r\n        }\r\n    }\r\n}","// src/core/useCases/admin/product/ToggleProductPublishedUseCase.ts\r\n\r\nimport {AdminProductService} from \"../../../services/AdminProductService\";\r\n\r\nexport class ToggleProductPublishedUseCase {\r\n    private adminProductService: AdminProductService;\r\n\r\n    constructor(adminProductService: AdminProductService) {\r\n        this.adminProductService = adminProductService;\r\n    }\r\n\r\n    async execute(id: number, published: boolean): Promise<boolean> {\r\n        console.log(\r\n            `ToggleProductPublishedUseCase: Cambiando published del producto ${id} a ${published}`\r\n        );\r\n        try {\r\n            const result = await this.adminProductService.togglePublished(\r\n                id,\r\n                published\r\n            );\r\n            console.log(\r\n                \"ToggleProductPublishedUseCase: Published actualizado correctamente:\",\r\n                result\r\n            );\r\n            return result;\r\n        } catch (error) {\r\n            console.error(\r\n                \"ToggleProductPublishedUseCase: Error al cambiar published:\",\r\n                error\r\n            );\r\n            throw error;\r\n        }\r\n    }\r\n}","// src/core/useCases/admin/product/UpdateProductStatusUseCase.ts\r\n\r\nimport {AdminProductService} from \"../../../services/AdminProductService\";\r\n\r\nexport class UpdateProductStatusUseCase {\r\n    private adminProductService: AdminProductService;\r\n\r\n    constructor(adminProductService: AdminProductService) {\r\n        this.adminProductService = adminProductService;\r\n    }\r\n\r\n    async execute(id: number, status: string): Promise<boolean> {\r\n        console.log(\r\n            `UpdateProductStatusUseCase: Cambiando status del producto ${id} a ${status}`\r\n        );\r\n        try {\r\n            const result = await this.adminProductService.updateStatus(id, status);\r\n            console.log(\r\n                \"UpdateProductStatusUseCase: Status actualizado correctamente:\",\r\n                result\r\n            );\r\n            return result;\r\n        } catch (error) {\r\n            console.error(\r\n                \"UpdateProductStatusUseCase: Error al cambiar status:\",\r\n                error\r\n            );\r\n            throw error;\r\n        }\r\n    }\r\n}","// src/core/useCases/admin/product/GetProductsBySellerUseCase.ts\r\n\r\nimport {AdminProductService} from \"../../../services/AdminProductService\";\r\nimport type {ProductListResponse} from \"../../../domain/entities/Product\";\r\nimport type {ExtendedProductFilterParams} from \"../../../../presentation/types/ProductFilterParams\";\r\n\r\nexport class GetProductsBySellerUseCase {\r\n\tprivate adminProductService: AdminProductService;\r\n\r\n\tconstructor(adminProductService: AdminProductService) {\r\n\t\tthis.adminProductService = adminProductService;\r\n\t}\r\n\r\n\tasync execute(\r\n\t\tsellerId: number,\r\n\t\tfilterParams?: ExtendedProductFilterParams\r\n\t): Promise<ProductListResponse | null> {\r\n\t\tconsole.log(\r\n\t\t\t`GetProductsBySellerUseCase: Obteniendo productos del vendedor ${sellerId}`\r\n\t\t);\r\n\t\ttry {\r\n\t\t\tconst products = await this.adminProductService.getProductsBySeller(\r\n\t\t\t\tsellerId,\r\n\t\t\t\tfilterParams\r\n\t\t\t);\r\n\t\t\tconsole.log(\r\n\t\t\t\t\"GetProductsBySellerUseCase: Productos obtenidos correctamente:\",\r\n\t\t\t\tproducts\r\n\t\t\t);\r\n\t\t\treturn products;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\r\n\t\t\t\t\"GetProductsBySellerUseCase: Error al obtener productos del vendedor:\",\r\n\t\t\t\terror\r\n\t\t\t);\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n}\r\n","// src/core/useCases/admin/product/GetProductStatsUseCase.ts\r\n\r\nimport {AdminProductService} from \"../../../services/AdminProductService\";\r\n\r\nexport class GetProductStatsUseCase {\r\n\tprivate adminProductService: AdminProductService;\r\n\r\n\tconstructor(adminProductService: AdminProductService) {\r\n\t\tthis.adminProductService = adminProductService;\r\n\t}\r\n\r\n\tasync execute(): Promise<any> {\r\n\t\tconsole.log(\"GetProductStatsUseCase: Obteniendo estad√≠sticas de productos\");\r\n\t\ttry {\r\n\t\t\tconst stats = await this.adminProductService.getProductStats();\r\n\t\t\tconsole.log(\r\n\t\t\t\t\"GetProductStatsUseCase: Estad√≠sticas obtenidas correctamente:\",\r\n\t\t\t\tstats\r\n\t\t\t);\r\n\t\t\treturn stats;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\r\n\t\t\t\t\"GetProductStatsUseCase: Error al obtener estad√≠sticas:\",\r\n\t\t\t\terror\r\n\t\t\t);\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n}\r\n","// src/presentation/hooks/useAdminProducts.ts\r\n\r\nimport {useState, useCallback} from \"react\";\r\nimport {AdminProductService} from \"../../core/services/AdminProductService\";\r\nimport CacheService from \"../../infrastructure/services/CacheService\";\r\nimport appConfig from \"../../config/appConfig\";\r\n\r\n// Use Cases\r\nimport {GetAllProductsUseCase} from \"../../core/useCases/admin/product/GetAllProductsUseCase\";\r\nimport {CreateProductAsAdminUseCase} from \"../../core/useCases/admin/product/CreateProductAsAdminUseCase\";\r\nimport {UpdateAnyProductUseCase} from \"../../core/useCases/admin/product/UpdateAnyProductUseCase\";\r\nimport {DeleteAnyProductUseCase} from \"../../core/useCases/admin/product/DeleteAnyProductUseCase\";\r\nimport {ToggleProductFeaturedUseCase} from \"../../core/useCases/admin/product/ToggleProductFeaturedUseCase\";\r\nimport {ToggleProductPublishedUseCase} from \"../../core/useCases/admin/product/ToggleProductPublishedUseCase\";\r\nimport {UpdateProductStatusUseCase} from \"../../core/useCases/admin/product/UpdateProductStatusUseCase\";\r\nimport {GetProductsBySellerUseCase} from \"../../core/useCases/admin/product/GetProductsBySellerUseCase\";\r\nimport {GetProductStatsUseCase} from \"../../core/useCases/admin/product/GetProductStatsUseCase\";\r\n\r\nimport type {\r\n\tProduct,\r\n\tProductDetail,\r\n\tProductListResponse,\r\n\tProductCreationData,\r\n\tProductUpdateData,\r\n} from \"../../core/domain/entities/Product\";\r\nimport type {ExtendedProductFilterParams} from \"../types/ProductFilterParams\";\r\n\r\n// Crear instancias del servicio y use cases\r\nconst adminProductService = new AdminProductService();\r\n\r\nconst getAllProductsUseCase = new GetAllProductsUseCase(adminProductService);\r\nconst createProductAsAdminUseCase = new CreateProductAsAdminUseCase(\r\n\tadminProductService\r\n);\r\nconst updateAnyProductUseCase = new UpdateAnyProductUseCase(\r\n\tadminProductService\r\n);\r\nconst deleteAnyProductUseCase = new DeleteAnyProductUseCase(\r\n\tadminProductService\r\n);\r\nconst toggleProductFeaturedUseCase = new ToggleProductFeaturedUseCase(\r\n\tadminProductService\r\n);\r\nconst toggleProductPublishedUseCase = new ToggleProductPublishedUseCase(\r\n\tadminProductService\r\n);\r\nconst updateProductStatusUseCase = new UpdateProductStatusUseCase(\r\n\tadminProductService\r\n);\r\nconst getProductsBySellerUseCase = new GetProductsBySellerUseCase(\r\n\tadminProductService\r\n);\r\nconst getProductStatsUseCase = new GetProductStatsUseCase(adminProductService);\r\n\r\n// Funci√≥n para generar clave de cach√©\r\nconst getAdminCacheKey = (params?: ExtendedProductFilterParams): string => {\r\n\tif (!params) return \"admin_products_default\";\r\n\treturn `admin_products_${JSON.stringify(params)}`;\r\n};\r\n\r\n/**\r\n * Hook para gesti√≥n administrativa de productos\r\n * Solo para usuarios con rol de administrador\r\n */\r\nexport const useAdminProducts = () => {\r\n\tconst [loading, setLoading] = useState<boolean>(false);\r\n\tconst [error, setError] = useState<string | null>(null);\r\n\tconst [products, setProducts] = useState<Product[]>([]);\r\n\tconst [productDetail, setProductDetail] = useState<ProductDetail | null>(\r\n\t\tnull\r\n\t);\r\n\tconst [stats, setStats] = useState<any>(null);\r\n\tconst [meta, setMeta] = useState<{\r\n\t\ttotal: number;\r\n\t\tlimit: number;\r\n\t\toffset: number;\r\n\t\tcurrentPage?: number;\r\n\t\ttotalPages?: number;\r\n\t} | null>(null);\r\n\r\n\t/**\r\n\t * Funci√≥n adaptadora para productos - CORREGIDA PARA BACKEND REAL\r\n\t */\r\n\tconst adaptProduct = useCallback((apiProduct: any): Product => {\r\n\t\tif (!apiProduct || typeof apiProduct !== \"object\") {\r\n\t\t\tconsole.error(\"Producto inv√°lido para adaptar:\", apiProduct);\r\n\t\t\treturn {} as Product;\r\n\t\t}\r\n\r\n\t\tconsole.log(\"üîÑ Adaptando producto desde API:\", apiProduct);\r\n\r\n\t\t// Procesar im√°genes - CORREGIDO para el formato real del backend\r\n\t\tlet processedImages: string[] = [];\r\n\r\n\t\t// Prioridad 1: main_image (formato actual del backend)\r\n\t\tif (apiProduct.main_image) {\r\n\t\t\tprocessedImages = [apiProduct.main_image];\r\n\t\t}\r\n\t\t// Prioridad 2: array images si existe\r\n\t\telse if (Array.isArray(apiProduct.images) && apiProduct.images.length > 0) {\r\n\t\t\tprocessedImages = apiProduct.images\r\n\t\t\t\t.map((img: any) => {\r\n\t\t\t\t\tif (typeof img === \"string\") return img;\r\n\t\t\t\t\tif (typeof img === \"object\" && img !== null) {\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\timg.original ||\r\n\t\t\t\t\t\t\timg.large ||\r\n\t\t\t\t\t\t\timg.medium ||\r\n\t\t\t\t\t\t\timg.url ||\r\n\t\t\t\t\t\t\timg.path ||\r\n\t\t\t\t\t\t\t\"\"\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn \"\";\r\n\t\t\t\t})\r\n\t\t\t\t.filter(Boolean);\r\n\t\t}\r\n\t\t// Prioridad 3: campo image individual\r\n\t\telse if (apiProduct.image) {\r\n\t\t\tprocessedImages = [apiProduct.image];\r\n\t\t}\r\n\r\n\t\t// Procesar tags - el backend devuelve arrays con strings JSON\r\n\t\tlet processedTags: string[] = [];\r\n\t\tif (Array.isArray(apiProduct.tags)) {\r\n\t\t\tapiProduct.tags.forEach((tag: any) => {\r\n\t\t\t\tif (typeof tag === \"string\") {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// Si es un string JSON, parsearlo\r\n\t\t\t\t\t\tconst parsed = JSON.parse(tag);\r\n\t\t\t\t\t\tif (Array.isArray(parsed)) {\r\n\t\t\t\t\t\t\tprocessedTags.push(...parsed);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tprocessedTags.push(tag);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch {\r\n\t\t\t\t\t\t// Si no es JSON v√°lido, agregarlo directamente\r\n\t\t\t\t\t\tprocessedTags.push(tag);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tconst adaptedProduct: Product = {\r\n\t\t\tid: apiProduct.id,\r\n\t\t\tuserId: apiProduct.user_id,\r\n\t\t\tsellerId: apiProduct.seller_id,\r\n\t\t\tcategoryId: apiProduct.category_id,\r\n\t\t\tname: apiProduct.name,\r\n\t\t\tslug: apiProduct.slug,\r\n\t\t\tdescription: apiProduct.description || \"\",\r\n\t\t\tshortDescription: apiProduct.short_description,\r\n\t\t\tprice: Number(apiProduct.price || 0),\r\n\t\t\tfinalPrice: Number(apiProduct.final_price || apiProduct.price || 0),\r\n\t\t\tstock: Number(apiProduct.stock || 0),\r\n\t\t\tweight: apiProduct.weight,\r\n\t\t\twidth: apiProduct.width,\r\n\t\t\theight: apiProduct.height,\r\n\t\t\tdepth: apiProduct.depth,\r\n\t\t\tdimensions: apiProduct.dimensions,\r\n\t\t\tcolors: apiProduct.colors,\r\n\t\t\tsizes: apiProduct.sizes,\r\n\t\t\ttags: processedTags,\r\n\t\t\tsku: apiProduct.sku,\r\n\t\t\tattributes: apiProduct.attributes,\r\n\t\t\timages: processedImages,\r\n\t\t\tfeatured: Boolean(apiProduct.featured),\r\n\t\t\tpublished: Boolean(apiProduct.published ?? true), // Por defecto true si no viene\r\n\t\t\tstatus: apiProduct.status || \"active\",\r\n\t\t\tviewCount: apiProduct.view_count || 0,\r\n\t\t\tsalesCount: apiProduct.sales_count || 0,\r\n\t\t\tdiscountPercentage: Number(apiProduct.discount_percentage || 0),\r\n\t\t\tisInStock: Boolean(apiProduct.is_in_stock ?? apiProduct.stock > 0),\r\n\t\t\trating: Number(apiProduct.rating || 0),\r\n\t\t\tratingCount: Number(apiProduct.rating_count || 0),\r\n\t\t\tcreatedAt: apiProduct.created_at,\r\n\t\t\tupdatedAt: apiProduct.updated_at,\r\n\r\n\t\t\t// Campos espec√≠ficos de admin\r\n\t\t\tcategory: apiProduct.category_name\r\n\t\t\t\t? {\r\n\t\t\t\t\t\tid: apiProduct.category_id,\r\n\t\t\t\t\t\tname: apiProduct.category_name,\r\n\t\t\t\t\t}\r\n\t\t\t\t: apiProduct.category,\r\n\t\t\tseller: apiProduct.seller,\r\n\t\t\tuser: apiProduct.user,\r\n\t\t};\r\n\r\n\t\tconsole.log(\"‚úÖ Producto adaptado:\", {\r\n\t\t\tid: adaptedProduct.id,\r\n\t\t\tname: adaptedProduct.name,\r\n\t\t\tpublished: adaptedProduct.published,\r\n\t\t\tfeatured: adaptedProduct.featured,\r\n\t\t\tstatus: adaptedProduct.status,\r\n\t\t\timages: adaptedProduct.images,\r\n\t\t\ttags: adaptedProduct.tags,\r\n\t\t});\r\n\r\n\t\treturn adaptedProduct;\r\n\t}, []);\r\n\r\n\t/**\r\n\t * Obtiene todos los productos (como admin)\r\n\t */\r\n\tconst fetchAllProducts = useCallback(\r\n\t\tasync (\r\n\t\t\tfilterParams?: ExtendedProductFilterParams,\r\n\t\t\tforceRefresh: boolean = false\r\n\t\t): Promise<ProductListResponse | null> => {\r\n\t\t\tsetLoading(true);\r\n\t\t\tsetError(null);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst cacheKey = getAdminCacheKey(filterParams);\r\n\r\n\t\t\t\t// Verificar cach√© si no se fuerza refresh\r\n\t\t\t\tif (!forceRefresh) {\r\n\t\t\t\t\tconst cachedData = CacheService.getItem(cacheKey);\r\n\t\t\t\t\tif (cachedData) {\r\n\t\t\t\t\t\tconsole.log(\"üíæ useAdminProducts: Usando datos en cach√©\");\r\n\t\t\t\t\t\tsetProducts(cachedData.data || []);\r\n\t\t\t\t\t\tsetMeta(cachedData.meta || null);\r\n\t\t\t\t\t\tsetLoading(false);\r\n\t\t\t\t\t\treturn cachedData;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconsole.log(\r\n\t\t\t\t\t\"üåê useAdminProducts: Obteniendo productos desde API con filtros:\",\r\n\t\t\t\t\tfilterParams\r\n\t\t\t\t);\r\n\t\t\t\tconst response = await getAllProductsUseCase.execute(filterParams);\r\n\r\n\t\t\t\tconsole.log(\"üîç RESPUESTA RAW DE LA API:\", response);\r\n\r\n\t\t\t\tif (response) {\r\n\t\t\t\t\tlet adaptedData: Product[] = [];\r\n\t\t\t\t\tlet responseMeta = null;\r\n\r\n\t\t\t\t\t// Procesar la respuesta seg√∫n su estructura\r\n\t\t\t\t\tif (response.data && Array.isArray(response.data)) {\r\n\t\t\t\t\t\tconsole.log(\r\n\t\t\t\t\t\t\t\"üì¶ Respuesta contiene array en data, procesando productos...\"\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tadaptedData = response.data.map((product) => {\r\n\t\t\t\t\t\t\tconsole.log(\"üîÑ Procesando producto:\", product);\r\n\t\t\t\t\t\t\treturn adaptProduct(product);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tresponseMeta = response.meta;\r\n\t\t\t\t\t} else if (Array.isArray(response)) {\r\n\t\t\t\t\t\tconsole.log(\"üì¶ Respuesta es directamente un array\");\r\n\t\t\t\t\t\tadaptedData = response.map(adaptProduct);\r\n\t\t\t\t\t\tresponseMeta = {\r\n\t\t\t\t\t\t\ttotal: response.length,\r\n\t\t\t\t\t\t\tlimit: filterParams?.limit || 10,\r\n\t\t\t\t\t\t\toffset: filterParams?.offset || 0,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.warn(\"‚ö†Ô∏è Estructura de respuesta no reconocida:\", response);\r\n\t\t\t\t\t\tadaptedData = [];\r\n\t\t\t\t\t\tresponseMeta = {total: 0, limit: 0, offset: 0};\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tconst result: ProductListResponse = {\r\n\t\t\t\t\t\tdata: adaptedData,\r\n\t\t\t\t\t\tmeta: responseMeta || {\r\n\t\t\t\t\t\t\ttotal: adaptedData.length,\r\n\t\t\t\t\t\t\tlimit: filterParams?.limit || 10,\r\n\t\t\t\t\t\t\toffset: filterParams?.offset || 0,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tconsole.log(\"üí´ Datos procesados:\", {\r\n\t\t\t\t\t\tproductCount: adaptedData.length,\r\n\t\t\t\t\t\tmeta: result.meta,\r\n\t\t\t\t\t\tfirstProductSample: adaptedData[0]\r\n\t\t\t\t\t\t\t? {\r\n\t\t\t\t\t\t\t\t\tid: adaptedData[0].id,\r\n\t\t\t\t\t\t\t\t\tname: adaptedData[0].name,\r\n\t\t\t\t\t\t\t\t\tpublished: adaptedData[0].published,\r\n\t\t\t\t\t\t\t\t\tfeatured: adaptedData[0].featured,\r\n\t\t\t\t\t\t\t\t\timages: adaptedData[0].images,\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t: null,\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\t// Guardar en cach√©\r\n\t\t\t\t\tCacheService.setItem(\r\n\t\t\t\t\t\tcacheKey,\r\n\t\t\t\t\t\tresult,\r\n\t\t\t\t\t\tappConfig.cache.productCacheTime\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tsetProducts(adaptedData);\r\n\t\t\t\t\tsetMeta(result.meta);\r\n\t\t\t\t\treturn result;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.warn(\"‚ö†Ô∏è Respuesta vac√≠a de la API\");\r\n\t\t\t\t\tsetProducts([]);\r\n\t\t\t\t\tsetMeta({total: 0, limit: 0, offset: 0});\r\n\t\t\t\t\treturn {data: [], meta: {total: 0, limit: 0, offset: 0}};\r\n\t\t\t\t}\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconst errorMessage =\r\n\t\t\t\t\terr instanceof Error ? err.message : \"Error al obtener productos\";\r\n\t\t\t\tconsole.error(\"‚ùå Error obteniendo productos:\", err);\r\n\t\t\t\tsetError(errorMessage);\r\n\t\t\t\tsetProducts([]);\r\n\t\t\t\tsetMeta({total: 0, limit: 0, offset: 0});\r\n\t\t\t\treturn null;\r\n\t\t\t} finally {\r\n\t\t\t\tsetLoading(false);\r\n\t\t\t}\r\n\t\t},\r\n\t\t[adaptProduct]\r\n\t);\r\n\r\n\t/**\r\n\t * Obtiene un producto por ID (como admin)\r\n\t */\r\n\tconst fetchProductById = useCallback(\r\n\t\tasync (id: number): Promise<ProductDetail | null> => {\r\n\t\t\tsetLoading(true);\r\n\t\t\tsetError(null);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst product = await adminProductService.getProductById(id);\r\n\t\t\t\tsetProductDetail(product);\r\n\t\t\t\treturn product;\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconst errorMessage =\r\n\t\t\t\t\terr instanceof Error ? err.message : \"Error al obtener producto\";\r\n\t\t\t\tsetError(errorMessage);\r\n\t\t\t\tsetProductDetail(null);\r\n\t\t\t\treturn null;\r\n\t\t\t} finally {\r\n\t\t\t\tsetLoading(false);\r\n\t\t\t}\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\r\n\t/**\r\n\t * Crea un producto (como admin)\r\n\t */\r\n\tconst createProduct = useCallback(\r\n\t\tasync (\r\n\t\t\tdata: ProductCreationData,\r\n\t\t\tsellerId?: number\r\n\t\t): Promise<Product | null> => {\r\n\t\t\tsetLoading(true);\r\n\t\t\tsetError(null);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst product = await createProductAsAdminUseCase.execute(\r\n\t\t\t\t\tdata,\r\n\t\t\t\t\tsellerId\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (product) {\r\n\t\t\t\t\t// Limpiar cach√© relacionada\r\n\t\t\t\t\tclearProductCache();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn product;\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconst errorMessage =\r\n\t\t\t\t\terr instanceof Error ? err.message : \"Error al crear producto\";\r\n\t\t\t\tsetError(errorMessage);\r\n\t\t\t\treturn null;\r\n\t\t\t} finally {\r\n\t\t\t\tsetLoading(false);\r\n\t\t\t}\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\r\n\t/**\r\n\t * Actualiza cualquier producto (como admin)\r\n\t */\r\n\tconst updateProduct = useCallback(\r\n\t\tasync (data: ProductUpdateData): Promise<Product | null> => {\r\n\t\t\tsetLoading(true);\r\n\t\t\tsetError(null);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst product = await updateAnyProductUseCase.execute(data);\r\n\r\n\t\t\t\tif (product) {\r\n\t\t\t\t\t// Actualizar producto en la lista actual\r\n\t\t\t\t\tsetProducts((prev) =>\r\n\t\t\t\t\t\tprev.map((p) => (p.id === data.id ? adaptProduct(product) : p))\r\n\t\t\t\t\t);\r\n\t\t\t\t\t// Limpiar cach√© relacionada\r\n\t\t\t\t\tclearProductCache();\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn product;\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconst errorMessage =\r\n\t\t\t\t\terr instanceof Error ? err.message : \"Error al actualizar producto\";\r\n\t\t\t\tsetError(errorMessage);\r\n\t\t\t\treturn null;\r\n\t\t\t} finally {\r\n\t\t\t\tsetLoading(false);\r\n\t\t\t}\r\n\t\t},\r\n\t\t[adaptProduct]\r\n\t);\r\n\r\n\t/**\r\n\t * Elimina cualquier producto (como admin)\r\n\t */\r\n\tconst deleteProduct = useCallback(async (id: number): Promise<boolean> => {\r\n\t\tsetLoading(true);\r\n\t\tsetError(null);\r\n\r\n\t\ttry {\r\n\t\t\tconst result = await deleteAnyProductUseCase.execute(id);\r\n\r\n\t\t\tif (result) {\r\n\t\t\t\t// Remover producto de la lista actual\r\n\t\t\t\tsetProducts((prev) => prev.filter((p) => p.id !== id));\r\n\t\t\t\t// Limpiar cach√© relacionada\r\n\t\t\t\tclearProductCache();\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t} catch (err) {\r\n\t\t\tconst errorMessage =\r\n\t\t\t\terr instanceof Error ? err.message : \"Error al eliminar producto\";\r\n\t\t\tsetError(errorMessage);\r\n\t\t\treturn false;\r\n\t\t} finally {\r\n\t\t\tsetLoading(false);\r\n\t\t}\r\n\t}, []);\r\n\r\n\t/**\r\n\t * Alterna el estado destacado de un producto - CORREGIDO\r\n\t */\r\n\tconst toggleFeatured = useCallback(\r\n\t\tasync (id: number, featured: boolean): Promise<boolean> => {\r\n\t\t\tsetError(null);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log(`üåü Cambiando featured del producto ${id} a ${featured}`);\r\n\r\n\t\t\t\tconst result = await toggleProductFeaturedUseCase.execute(id, featured);\r\n\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\t// Actualizar producto en la lista actual INMEDIATAMENTE\r\n\t\t\t\t\tsetProducts((prev) =>\r\n\t\t\t\t\t\tprev.map((p) => (p.id === id ? {...p, featured} : p))\r\n\t\t\t\t\t);\r\n\t\t\t\t\t// Limpiar cach√© relacionada\r\n\t\t\t\t\tclearProductCache();\r\n\t\t\t\t\tconsole.log(\r\n\t\t\t\t\t\t`‚úÖ Featured actualizado correctamente para producto ${id}`\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error(`‚ùå Error al actualizar featured para producto ${id}`);\r\n\t\t\t\t\tsetError(\"Error al cambiar estado destacado del producto\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconst errorMessage =\r\n\t\t\t\t\terr instanceof Error\r\n\t\t\t\t\t\t? err.message\r\n\t\t\t\t\t\t: \"Error al cambiar estado destacado\";\r\n\t\t\t\tconsole.error(\"‚ùå Error en toggleFeatured:\", err);\r\n\t\t\t\tsetError(errorMessage);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\r\n\t/**\r\n\t * Alterna el estado de publicaci√≥n de un producto - CORREGIDO\r\n\t */\r\n\tconst togglePublished = useCallback(\r\n\t\tasync (id: number, published: boolean): Promise<boolean> => {\r\n\t\t\tsetError(null);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log(`üì¢ Cambiando published del producto ${id} a ${published}`);\r\n\r\n\t\t\t\tconst result = await toggleProductPublishedUseCase.execute(\r\n\t\t\t\t\tid,\r\n\t\t\t\t\tpublished\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\t// Actualizar producto en la lista actual INMEDIATAMENTE\r\n\t\t\t\t\tsetProducts((prev) =>\r\n\t\t\t\t\t\tprev.map((p) => (p.id === id ? {...p, published} : p))\r\n\t\t\t\t\t);\r\n\t\t\t\t\t// Limpiar cach√© relacionada\r\n\t\t\t\t\tclearProductCache();\r\n\t\t\t\t\tconsole.log(\r\n\t\t\t\t\t\t`‚úÖ Published actualizado correctamente para producto ${id}`\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error(`‚ùå Error al actualizar published para producto ${id}`);\r\n\t\t\t\t\tsetError(\"Error al cambiar estado de publicaci√≥n del producto\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconst errorMessage =\r\n\t\t\t\t\terr instanceof Error\r\n\t\t\t\t\t\t? err.message\r\n\t\t\t\t\t\t: \"Error al cambiar estado de publicaci√≥n\";\r\n\t\t\t\tconsole.error(\"‚ùå Error en togglePublished:\", err);\r\n\t\t\t\tsetError(errorMessage);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\r\n\t/**\r\n\t * Actualiza el estado de un producto - CORREGIDO\r\n\t */\r\n\tconst updateStatus = useCallback(\r\n\t\tasync (id: number, status: string): Promise<boolean> => {\r\n\t\t\tsetError(null);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log(`üîÑ Cambiando status del producto ${id} a ${status}`);\r\n\r\n\t\t\t\tconst result = await updateProductStatusUseCase.execute(id, status);\r\n\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\t// Actualizar producto en la lista actual INMEDIATAMENTE\r\n\t\t\t\t\tsetProducts((prev) =>\r\n\t\t\t\t\t\tprev.map((p) => (p.id === id ? {...p, status} : p))\r\n\t\t\t\t\t);\r\n\t\t\t\t\t// Limpiar cach√© relacionada\r\n\t\t\t\t\tclearProductCache();\r\n\t\t\t\t\tconsole.log(\r\n\t\t\t\t\t\t`‚úÖ Status actualizado correctamente para producto ${id}`\r\n\t\t\t\t\t);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error(`‚ùå Error al actualizar status para producto ${id}`);\r\n\t\t\t\t\tsetError(\"Error al actualizar estado del producto\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconst errorMessage =\r\n\t\t\t\t\terr instanceof Error ? err.message : \"Error al actualizar estado\";\r\n\t\t\t\tconsole.error(\"‚ùå Error en updateStatus:\", err);\r\n\t\t\t\tsetError(errorMessage);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t[]\r\n\t);\r\n\r\n\t/**\r\n\t * Obtiene productos por vendedor (como admin)\r\n\t */\r\n\tconst fetchProductsBySeller = useCallback(\r\n\t\tasync (\r\n\t\t\tsellerId: number,\r\n\t\t\tfilterParams?: ExtendedProductFilterParams\r\n\t\t): Promise<ProductListResponse | null> => {\r\n\t\t\tsetLoading(true);\r\n\t\t\tsetError(null);\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst response = await getProductsBySellerUseCase.execute(\r\n\t\t\t\t\tsellerId,\r\n\t\t\t\t\tfilterParams\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (response && Array.isArray(response.data)) {\r\n\t\t\t\t\tconst adaptedData = response.data.map(adaptProduct);\r\n\t\t\t\t\tsetProducts(adaptedData);\r\n\t\t\t\t\tsetMeta(response.meta || null);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn response;\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconst errorMessage =\r\n\t\t\t\t\terr instanceof Error\r\n\t\t\t\t\t\t? err.message\r\n\t\t\t\t\t\t: \"Error al obtener productos del vendedor\";\r\n\t\t\t\tsetError(errorMessage);\r\n\t\t\t\treturn null;\r\n\t\t\t} finally {\r\n\t\t\t\tsetLoading(false);\r\n\t\t\t}\r\n\t\t},\r\n\t\t[adaptProduct]\r\n\t);\r\n\r\n\t/**\r\n\t * Obtiene estad√≠sticas de productos\r\n\t */\r\n\tconst fetchProductStats = useCallback(async (): Promise<any> => {\r\n\t\tsetLoading(true);\r\n\t\tsetError(null);\r\n\r\n\t\ttry {\r\n\t\t\tconst statsData = await getProductStatsUseCase.execute();\r\n\t\t\tsetStats(statsData);\r\n\t\t\treturn statsData;\r\n\t\t} catch (err) {\r\n\t\t\tconst errorMessage =\r\n\t\t\t\terr instanceof Error ? err.message : \"Error al obtener estad√≠sticas\";\r\n\t\t\tsetError(errorMessage);\r\n\t\t\treturn null;\r\n\t\t} finally {\r\n\t\t\tsetLoading(false);\r\n\t\t}\r\n\t}, []);\r\n\r\n\t/**\r\n\t * Limpia la cach√© de productos de admin\r\n\t */\r\n\tconst clearProductCache = useCallback(() => {\r\n\t\tconst allKeys = Object.keys(localStorage);\r\n\t\tconst adminProductKeys = allKeys.filter(\r\n\t\t\t(key) =>\r\n\t\t\t\tkey.startsWith(\"admin_products_\") ||\r\n\t\t\t\tkey.startsWith(\"product_\") ||\r\n\t\t\t\tkey.startsWith(\"products_\")\r\n\t\t);\r\n\r\n\t\tadminProductKeys.forEach((key) => {\r\n\t\t\tCacheService.removeItem(key);\r\n\t\t});\r\n\r\n\t\tconsole.log(\r\n\t\t\t`üóëÔ∏è ${adminProductKeys.length} claves de cach√© de productos de admin eliminadas`\r\n\t\t);\r\n\t}, []);\r\n\r\n\treturn {\r\n\t\t// Estado\r\n\t\tloading,\r\n\t\terror,\r\n\t\tproducts,\r\n\t\tproductDetail,\r\n\t\tstats,\r\n\t\tmeta,\r\n\r\n\t\t// M√©todos\r\n\t\tfetchAllProducts,\r\n\t\tfetchProductById,\r\n\t\tcreateProduct,\r\n\t\tupdateProduct,\r\n\t\tdeleteProduct,\r\n\t\ttoggleFeatured,\r\n\t\ttogglePublished,\r\n\t\tupdateStatus,\r\n\t\tfetchProductsBySeller,\r\n\t\tfetchProductStats,\r\n\t\tclearProductCache,\r\n\r\n\t\t// Utilidades\r\n\t\tsetError: (error: string | null) => setError(error),\r\n\t\tsetLoading: (loading: boolean) => setLoading(loading),\r\n\t};\r\n};\r\n\r\nexport default useAdminProducts;\r\n","// src/utils/unifiedImageUtils.ts - VERSI√ìN CORREGIDA\r\nimport environment from \"../config/environment\";\r\n\r\n/**\r\n * Placeholder como Data URI (imagen SVG embebida) - No requiere conexi√≥n externa\r\n */\r\nconst PLACEHOLDER_DATA_URI = `data:image/svg+xml,${encodeURIComponent(`\r\n<svg width=\"300\" height=\"300\" xmlns=\"http://www.w3.org/2000/svg\">\r\n  <rect width=\"300\" height=\"300\" fill=\"#e5e7eb\"/>\r\n  <text x=\"150\" y=\"150\" font-family=\"Arial, sans-serif\" font-size=\"16\" fill=\"#6b7280\" text-anchor=\"middle\" dy=\"0.3em\">\r\n    Sin imagen\r\n  </text>\r\n</svg>\r\n`)}`;\r\n\r\n/**\r\n * Placeholder peque√±o para miniaturas\r\n */\r\nconst SMALL_PLACEHOLDER_DATA_URI = `data:image/svg+xml,${encodeURIComponent(`\r\n<svg width=\"100\" height=\"100\" xmlns=\"http://www.w3.org/2000/svg\">\r\n  <rect width=\"100\" height=\"100\" fill=\"#f3f4f6\"/>\r\n  <text x=\"50\" y=\"50\" font-family=\"Arial, sans-serif\" font-size=\"12\" fill=\"#9ca3af\" text-anchor=\"middle\" dy=\"0.3em\">\r\n    Sin img\r\n  </text>\r\n</svg>\r\n`)}`;\r\n\r\n/**\r\n * Configuraci√≥n global para im√°genes\r\n */\r\nconst IMAGE_CONFIG = {\r\n  placeholder: PLACEHOLDER_DATA_URI,\r\n  smallPlaceholder: SMALL_PLACEHOLDER_DATA_URI,\r\n  defaultProduct: \"/images/default-product.jpg\"\r\n};\r\n\r\n/**\r\n * Obtiene la URL base de la API din√°micamente\r\n */\r\nfunction getApiBaseUrl(): string {\r\n  if (typeof window === 'undefined') {\r\n    return 'http://127.0.0.1:8000'; // Fallback para SSR\r\n  }\r\n\r\n  const { protocol, hostname } = window.location;\r\n  \r\n  // En desarrollo local, usar puerto 8000 para Laravel\r\n  if (hostname === 'localhost' || hostname === '127.0.0.1') {\r\n    return `${protocol}//${hostname}:8000`;\r\n  }\r\n  \r\n  // En producci√≥n, asumir mismo dominio\r\n  return `${protocol}//${hostname}`;\r\n}\r\n\r\n/**\r\n * Funci√≥n principal unificada para obtener URLs de im√°genes\r\n * Esta es la √öNICA funci√≥n que debe usarse en toda la aplicaci√≥n\r\n */\r\nexport function getImageUrl(imagePath?: string | null, useSmallPlaceholder: boolean = false): string {\r\n  // Caso 1: Sin imagen - retornar placeholder\r\n  if (!imagePath || imagePath.trim() === '') {\r\n    return useSmallPlaceholder ? IMAGE_CONFIG.smallPlaceholder : IMAGE_CONFIG.placeholder;\r\n  }\r\n\r\n  const path = imagePath.trim();\r\n\r\n  // Caso 2: URL completa (http/https) - retornar tal como est√°\r\n  if (path.startsWith('http://') || path.startsWith('https://')) {\r\n    return path;\r\n  }\r\n\r\n  // Caso 3: Data URI - retornar tal como est√°\r\n  if (path.startsWith('data:')) {\r\n    return path;\r\n  }\r\n\r\n  // Caso 4: Usar configuraci√≥n de environment si est√° disponible\r\n  if (environment?.imageBaseUrl) {\r\n    // Eliminar /storage/ del inicio si ya est√° incluido para evitar duplicaci√≥n\r\n    let normalizedPath = path;\r\n    if (normalizedPath.startsWith('/storage/')) {\r\n      normalizedPath = normalizedPath.substring(9);\r\n    } else if (normalizedPath.startsWith('storage/')) {\r\n      normalizedPath = normalizedPath.substring(8);\r\n    }\r\n    \r\n    return `${environment.imageBaseUrl}${normalizedPath}`;\r\n  }\r\n\r\n  // Caso 5: Fallback usando detecci√≥n autom√°tica de API base\r\n  const apiBaseUrl = getApiBaseUrl();\r\n  \r\n  // Si comienza con 'products/', construir URL de storage\r\n  if (path.startsWith('products/')) {\r\n    return `${apiBaseUrl}/storage/${path}`;\r\n  }\r\n\r\n  // Si comienza con 'storage/', construir la URL\r\n  if (path.startsWith('storage/')) {\r\n    return `${apiBaseUrl}/${path}`;\r\n  }\r\n\r\n  // Si comienza con '/', asumir que es una ruta absoluta\r\n  if (path.startsWith('/')) {\r\n    return `${apiBaseUrl}${path}`;\r\n  }\r\n\r\n  // Para cualquier otra ruta, asumir que es relativa al storage\r\n  return `${apiBaseUrl}/storage/${path}`;\r\n}\r\n\r\n/**\r\n * Obtiene la URL de imagen por defecto del producto\r\n */\r\nexport function getDefaultImageUrl(): string {\r\n  if (environment?.imageBaseUrl) {\r\n    return `${environment.imageBaseUrl}${IMAGE_CONFIG.defaultProduct}`;\r\n  }\r\n  \r\n  const apiBaseUrl = getApiBaseUrl();\r\n  return `${apiBaseUrl}${IMAGE_CONFIG.defaultProduct}`;\r\n}\r\n\r\n/**\r\n * Extrae la imagen principal de un producto\r\n * Maneja diferentes estructuras de datos de im√°genes\r\n */\r\nexport function getProductMainImage(product: any, useSmallPlaceholder: boolean = false): string {\r\n  if (!product) {\r\n    return getImageUrl(null, useSmallPlaceholder);\r\n  }\r\n\r\n  // Prioridad 1: main_image desde la API\r\n  if (product.main_image) {\r\n    return getImageUrl(product.main_image, useSmallPlaceholder);\r\n  }\r\n\r\n  // Prioridad 2: image (singular) desde la API\r\n  if (product.image) {\r\n    return getImageUrl(product.image, useSmallPlaceholder);\r\n  }\r\n\r\n  // Prioridad 3: primer elemento del array images\r\n  if (product.images && Array.isArray(product.images) && product.images.length > 0) {\r\n    const firstImage = product.images[0];\r\n    \r\n    // Si es un string, usarlo directamente\r\n    if (typeof firstImage === 'string') {\r\n      return getImageUrl(firstImage, useSmallPlaceholder);\r\n    }\r\n    \r\n    // Si es un objeto, extraer la URL apropiada\r\n    if (typeof firstImage === 'object' && firstImage !== null) {\r\n      const imageUrl = firstImage.original || \r\n                     firstImage.large || \r\n                     firstImage.medium || \r\n                     firstImage.thumbnail || \r\n                     '';\r\n      return getImageUrl(imageUrl, useSmallPlaceholder);\r\n    }\r\n  }\r\n\r\n  // Fallback: placeholder\r\n  return getImageUrl(null, useSmallPlaceholder);\r\n}\r\n\r\n/**\r\n * Obtiene todas las im√°genes de un producto como array\r\n */\r\nexport function getProductImages(product: any): string[] {\r\n  const images: string[] = [];\r\n\r\n  if (product?.images && Array.isArray(product.images)) {\r\n    for (const image of product.images) {\r\n      if (typeof image === 'string') {\r\n        images.push(getImageUrl(image));\r\n      } else if (typeof image === 'object' && image !== null) {\r\n        const imageUrl = image.original || \r\n                        image.large || \r\n                        image.medium || \r\n                        image.thumbnail || \r\n                        '';\r\n        if (imageUrl) {\r\n          images.push(getImageUrl(imageUrl));\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // Si no hay im√°genes, agregar la imagen principal o placeholder\r\n  if (images.length === 0) {\r\n    images.push(getProductMainImage(product));\r\n  }\r\n\r\n  return images;\r\n}\r\n\r\n/**\r\n * Valida si una URL de imagen es v√°lida (puede cargarse)\r\n */\r\nexport function validateImageUrl(url: string): Promise<boolean> {\r\n  return new Promise((resolve) => {\r\n    // Si es un data URI, considerarlo v√°lido\r\n    if (url.startsWith('data:')) {\r\n      resolve(true);\r\n      return;\r\n    }\r\n\r\n    const img = new Image();\r\n    \r\n    // Timeout despu√©s de 3 segundos\r\n    const timeout = setTimeout(() => {\r\n      resolve(false);\r\n    }, 3000);\r\n    \r\n    img.onload = () => {\r\n      clearTimeout(timeout);\r\n      resolve(true);\r\n    };\r\n    \r\n    img.onerror = () => {\r\n      clearTimeout(timeout);\r\n      resolve(false);\r\n    };\r\n    \r\n    img.src = url;\r\n  });\r\n}\r\n\r\n/**\r\n * Componente de imagen con fallback mejorado\r\n */\r\nexport interface ImageWithFallbackProps {\r\n  src: string;\r\n  alt: string;\r\n  className?: string;\r\n  fallbackSrc?: string;\r\n  useSmallPlaceholder?: boolean;\r\n  onError?: (error: Event) => void;\r\n  [key: string]: any;\r\n}\r\n\r\nexport function createImageWithFallback(React: any) {\r\n\treturn function ImageWithFallback({\r\n\t\tsrc,\r\n\t\talt,\r\n\t\tclassName = \"\",\r\n\t\tfallbackSrc,\r\n\t\tuseSmallPlaceholder = false,\r\n\t\tonError,\r\n\t\t...props // CORREGIDO: mantener solo si se usa\r\n\t}: ImageWithFallbackProps) {\r\n\t\tconst [imageSrc, setImageSrc] = React.useState(\r\n\t\t\tgetImageUrl(src, useSmallPlaceholder)\r\n\t\t);\r\n\t\tconst [hasError, setHasError] = React.useState(false);\r\n\t\tconst [errorCount, setErrorCount] = React.useState(0);\r\n\r\n\t\tReact.useEffect(() => {\r\n\t\t\tsetImageSrc(getImageUrl(src, useSmallPlaceholder));\r\n\t\t\tsetHasError(false);\r\n\t\t\tsetErrorCount(0);\r\n\t\t}, [src, useSmallPlaceholder]);\r\n\r\n\t\tconst handleError = React.useCallback(\r\n\t\t\t(error: Event) => {\r\n\t\t\t\tconsole.warn(\"Error cargando imagen:\", imageSrc);\r\n\r\n\t\t\t\tif (onError) {\r\n\t\t\t\t\tonError(error);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (errorCount >= 2) {\r\n\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t\"Demasiados errores de imagen, usando placeholder final\"\r\n\t\t\t\t\t);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsetErrorCount((prev: number) => prev + 1);\r\n\r\n\t\t\t\tif (!hasError) {\r\n\t\t\t\t\tsetHasError(true);\r\n\r\n\t\t\t\t\tif (fallbackSrc && errorCount === 0) {\r\n\t\t\t\t\t\tsetImageSrc(getImageUrl(fallbackSrc, useSmallPlaceholder));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsetImageSrc(getImageUrl(null, useSmallPlaceholder));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t[\r\n\t\t\t\timageSrc,\r\n\t\t\t\thasError,\r\n\t\t\t\tfallbackSrc,\r\n\t\t\t\tuseSmallPlaceholder,\r\n\t\t\t\terrorCount,\r\n\t\t\t\tonError,\r\n\t\t\t]\r\n\t\t);\r\n\r\n\t\treturn React.createElement(\"img\", {\r\n\t\t\tsrc: imageSrc,\r\n\t\t\talt,\r\n\t\t\tclassName,\r\n\t\t\tonError: handleError,\r\n\t\t\t...props, // Usar props aqu√≠ si es necesario\r\n\t\t});\r\n\t};\r\n}\r\n\r\n/**\r\n * Hook de React para manejar carga de im√°genes con estado\r\n */\r\nexport function useImageLoader(initialSrc: string, useSmallPlaceholder: boolean = false) {\r\n  // Verificar si React est√° disponible\r\n  if (typeof window === 'undefined' || !(window as any).React) {\r\n    return {\r\n      src: getImageUrl(initialSrc, useSmallPlaceholder),\r\n      isLoading: false,\r\n      hasError: false,\r\n      loadImage: () => {}\r\n    };\r\n  }\r\n\r\n  const React = (window as any).React;\r\n  const [src, setSrc] = React.useState(getImageUrl(initialSrc, useSmallPlaceholder));\r\n  const [isLoading, setIsLoading] = React.useState(Boolean(initialSrc));\r\n  const [hasError, setHasError] = React.useState(false);\r\n\r\n  const loadImage = React.useCallback((newSrc: string) => {\r\n    const imageUrl = getImageUrl(newSrc, useSmallPlaceholder);\r\n    \r\n    // Si es un data URI, no necesita validaci√≥n\r\n    if (imageUrl.startsWith('data:')) {\r\n      setSrc(imageUrl);\r\n      setIsLoading(false);\r\n      setHasError(false);\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    setHasError(false);\r\n    \r\n    validateImageUrl(imageUrl).then(isValid => {\r\n      if (isValid) {\r\n        setSrc(imageUrl);\r\n      } else {\r\n        setSrc(getImageUrl(null, useSmallPlaceholder));\r\n        setHasError(true);\r\n      }\r\n      setIsLoading(false);\r\n    });\r\n  }, [useSmallPlaceholder]);\r\n\r\n  React.useEffect(() => {\r\n    if (initialSrc) {\r\n      loadImage(initialSrc);\r\n    } else {\r\n      setSrc(getImageUrl(null, useSmallPlaceholder));\r\n      setIsLoading(false);\r\n    }\r\n  }, [initialSrc, loadImage, useSmallPlaceholder]);\r\n\r\n  return { src, isLoading, hasError, loadImage };\r\n}\r\n\r\n// Exportar como objeto para facilitar imports\r\nexport const ImageUtils = {\r\n  getImageUrl,\r\n  getDefaultImageUrl,\r\n  getProductMainImage,\r\n  getProductImages,\r\n  validateImageUrl,\r\n  useImageLoader,\r\n  createImageWithFallback\r\n};\r\n\r\n// Export por defecto para compatibilidad\r\nexport default ImageUtils;","import React, {useState, useEffect, useCallback} from \"react\";\r\nimport Table from \"../../components/dashboard/Table\";\r\nimport {\r\n\tTag,\r\n\tEye,\r\n\tEdit,\r\n\tTrash2,\r\n\tStar,\r\n\tFilter,\r\n\tRefreshCw,\r\n\tArchive,\r\n\tClock,\r\n\tCheckCircle,\r\n\tPlus,\r\n\tSearch,\r\n} from \"lucide-react\";\r\nimport {Link} from \"react-router-dom\";\r\nimport type {Product} from \"../../../core/domain/entities/Product\";\r\nimport type {ExtendedProductFilterParams} from \"../../types/ProductFilterParams\";\r\n\r\n// Hooks personalizados\r\nimport {useAdminProducts} from \"../../hooks/useAdminProducts\";\r\nimport {useAdminCategories} from \"../../hooks/useAdminCategories\";\r\n\r\n// Utilities corregidas - USAR SOLO UNA FUENTE\r\nimport {getProductMainImage} from \"../../../utils/unifiedImageUtils\";\r\nimport {formatCurrency} from \"../../../utils/formatters/formatCurrency\";\r\n\r\nconst AdminProductsPage: React.FC = () => {\r\n\t// Hooks de administraci√≥n\r\n\tconst {\r\n\t\tloading: productsLoading,\r\n\t\terror: productsError,\r\n\t\tproducts,\r\n\t\tmeta,\r\n\t\tfetchAllProducts,\r\n\t\tdeleteProduct,\r\n\t\ttoggleFeatured,\r\n\t\ttogglePublished,\r\n\t\tclearProductCache,\r\n\t} = useAdminProducts();\r\n\r\n\tconst {\r\n\t\tloading: categoriesLoading,\r\n\t\tcategories,\r\n\t\tfetchAllCategories,\r\n\t} = useAdminCategories();\r\n\r\n\t// Estado local para filtros y paginaci√≥n\r\n\tconst [categoryFilter, setCategoryFilter] = useState<number>(0); // 0 = Todas\r\n\tconst [statusFilter, setStatusFilter] = useState<string>(\"all\");\r\n\tconst [stockFilter, setStockFilter] = useState<string>(\"all\");\r\n\tconst [searchTerm, setSearchTerm] = useState<string>(\"\");\r\n\tconst [currentPage, setCurrentPage] = useState<number>(1);\r\n\tconst [itemsPerPage] = useState<number>(15);\r\n\r\n\t// Estado para mostrar confirmaciones\r\n\tconst [loadingAction, setLoadingAction] = useState<number | null>(null);\r\n\r\n\t// Cargar datos iniciales\r\n\tuseEffect(() => {\r\n\t\tloadData();\r\n\t\tloadCategories();\r\n\t}, []);\r\n\r\n\t// Cargar datos cuando cambien los filtros\r\n\tuseEffect(() => {\r\n\t\tloadData();\r\n\t}, [categoryFilter, statusFilter, stockFilter, searchTerm, currentPage]);\r\n\r\n\t/**\r\n\t * Carga las categor√≠as\r\n\t */\r\n\tconst loadCategories = useCallback(async () => {\r\n\t\ttry {\r\n\t\t\tawait fetchAllCategories({with_counts: true});\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error al cargar categor√≠as:\", error);\r\n\t\t}\r\n\t}, [fetchAllCategories]);\r\n\r\n\t/**\r\n\t * Carga los productos con filtros aplicados\r\n\t */\r\n\tconst loadData = useCallback(async () => {\r\n\t\ttry {\r\n\t\t\tconst filterParams: ExtendedProductFilterParams = {\r\n\t\t\t\tlimit: itemsPerPage,\r\n\t\t\t\toffset: (currentPage - 1) * itemsPerPage,\r\n\t\t\t\t// NO incluir filtros por defecto - admin debe ver TODOS los productos\r\n\t\t\t};\r\n\r\n\t\t\t// Aplicar filtros\r\n\t\t\tif (searchTerm) {\r\n\t\t\t\tfilterParams.term = searchTerm;\r\n\t\t\t}\r\n\r\n\t\t\tif (categoryFilter && categoryFilter > 0) {\r\n\t\t\t\tfilterParams.categoryId = categoryFilter;\r\n\t\t\t}\r\n\r\n\t\t\t// Filtros de estado - SOLO si se especifica expl√≠citamente\r\n\t\t\tswitch (statusFilter) {\r\n\t\t\t\tcase \"active\":\r\n\t\t\t\t\tfilterParams.status = \"active\";\r\n\t\t\t\t\tfilterParams.published = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"draft\":\r\n\t\t\t\t\tfilterParams.status = \"draft\";\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"inactive\":\r\n\t\t\t\t\tfilterParams.published = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t// \"all\" NO a√±ade filtros - admin ve todo\r\n\t\t\t}\r\n\r\n\t\t\t// Filtros de stock\r\n\t\t\tswitch (stockFilter) {\r\n\t\t\t\tcase \"inStock\":\r\n\t\t\t\t\tfilterParams.inStock = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"lowStock\":\r\n\t\t\t\t\tfilterParams.inStock = true;\r\n\t\t\t\t\t// Este filtro se podr√≠a implementar en el backend\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"outOfStock\":\r\n\t\t\t\t\tfilterParams.inStock = false;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t// \"all\" no a√±ade filtros\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log(\r\n\t\t\t\t\"üîß AdminProductsPage: Cargando productos con filtros:\",\r\n\t\t\t\tfilterParams\r\n\t\t\t);\r\n\t\t\tawait fetchAllProducts(filterParams);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error al cargar productos:\", error);\r\n\t\t}\r\n\t}, [\r\n\t\tfetchAllProducts,\r\n\t\tcategoryFilter,\r\n\t\tstatusFilter,\r\n\t\tstockFilter,\r\n\t\tsearchTerm,\r\n\t\tcurrentPage,\r\n\t\titemsPerPage,\r\n\t]);\r\n\r\n\t/**\r\n\t * Maneja la eliminaci√≥n de un producto\r\n\t */\r\n\tconst handleDeleteProduct = useCallback(\r\n\t\tasync (productId: number, productName: string) => {\r\n\t\t\tconst confirmed = window.confirm(\r\n\t\t\t\t`¬øEst√°s seguro de que deseas eliminar el producto \"${productName}\"?`\r\n\t\t\t);\r\n\r\n\t\t\tif (confirmed) {\r\n\t\t\t\tsetLoadingAction(productId);\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst success = await deleteProduct(productId);\r\n\t\t\t\t\tif (success) {\r\n\t\t\t\t\t\t// Recargar datos para reflejar cambios\r\n\t\t\t\t\t\tloadData();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\talert(\"Error al eliminar el producto\");\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tconsole.error(\"Error al eliminar producto:\", error);\r\n\t\t\t\t\talert(\"Error al eliminar el producto\");\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tsetLoadingAction(null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t[deleteProduct, loadData]\r\n\t);\r\n\r\n\t/**\r\n\t * Maneja el cambio de estado destacado\r\n\t */\r\n\tconst handleToggleFeatured = useCallback(\r\n\t\tasync (productId: number, currentFeatured: boolean) => {\r\n\t\t\tsetLoadingAction(productId);\r\n\t\t\ttry {\r\n\t\t\t\t// PASAR EL VALOR OPUESTO PARA HACER EL TOGGLE\r\n\t\t\t\tconst newFeaturedValue = !currentFeatured;\r\n\t\t\t\tconsole.log(\r\n\t\t\t\t\t`üåü Toggling featured for product ${productId}: ${currentFeatured} -> ${newFeaturedValue}`\r\n\t\t\t\t);\r\n\r\n\t\t\t\tconst success = await toggleFeatured(productId, newFeaturedValue);\r\n\t\t\t\tif (!success) {\r\n\t\t\t\t\talert(\"Error al cambiar estado destacado\");\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error(\"Error al cambiar estado destacado:\", error);\r\n\t\t\t\talert(\"Error al cambiar estado destacado\");\r\n\t\t\t} finally {\r\n\t\t\t\tsetLoadingAction(null);\r\n\t\t\t}\r\n\t\t},\r\n\t\t[toggleFeatured]\r\n\t);\r\n\r\n\t/**\r\n\t * Maneja el cambio de estado de publicaci√≥n\r\n\t */\r\n\tconst handleTogglePublished = useCallback(\r\n\t\tasync (productId: number, currentPublished: boolean) => {\r\n\t\t\tsetLoadingAction(productId);\r\n\t\t\ttry {\r\n\t\t\t\t// PASAR EL VALOR OPUESTO PARA HACER EL TOGGLE\r\n\t\t\t\tconst newPublishedValue = !currentPublished;\r\n\t\t\t\tconsole.log(\r\n\t\t\t\t\t`üì¢ Toggling published for product ${productId}: ${currentPublished} -> ${newPublishedValue}`\r\n\t\t\t\t);\r\n\r\n\t\t\t\tconst success = await togglePublished(productId, newPublishedValue);\r\n\t\t\t\tif (!success) {\r\n\t\t\t\t\talert(\"Error al cambiar estado de publicaci√≥n\");\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error(\"Error al cambiar estado de publicaci√≥n:\", error);\r\n\t\t\t\talert(\"Error al cambiar estado de publicaci√≥n\");\r\n\t\t\t} finally {\r\n\t\t\t\tsetLoadingAction(null);\r\n\t\t\t}\r\n\t\t},\r\n\t\t[togglePublished]\r\n\t);\r\n\r\n\t/**\r\n\t * Refrescar datos\r\n\t */\r\n\tconst refreshData = useCallback(() => {\r\n\t\tclearProductCache();\r\n\t\tloadData();\r\n\t}, [clearProductCache, loadData]);\r\n\r\n\t/**\r\n\t * Manejar cambio de p√°gina\r\n\t */\r\n\tconst handlePageChange = useCallback((page: number) => {\r\n\t\tsetCurrentPage(page);\r\n\t}, []);\r\n\r\n\t/**\r\n\t * Obtener el nombre de la categor√≠a por ID\r\n\t */\r\n\tconst getCategoryName = (categoryId?: number): string => {\r\n\t\tif (!categoryId) return \"Sin categor√≠a\";\r\n\t\tconst category = categories.find((c) => c.id === categoryId);\r\n\t\treturn category ? category.name : \"Categor√≠a desconocida\";\r\n\t};\r\n\r\n\t/**\r\n\t * Componente de imagen mejorado con manejo de errores\r\n\t */\r\n\tconst ProductImage: React.FC<{product: Product}> = ({product}) => {\r\n\t\tconst [imageSrc, setImageSrc] = useState<string>(\r\n\t\t\tgetProductMainImage(product, true)\r\n\t\t);\r\n\t\tconst [hasError, setHasError] = useState<boolean>(false);\r\n\t\tconst [errorCount, setErrorCount] = useState<number>(0);\r\n\r\n\t\tuseEffect(() => {\r\n\t\t\tsetImageSrc(getProductMainImage(product, true));\r\n\t\t\tsetHasError(false);\r\n\t\t\tsetErrorCount(0);\r\n\t\t}, [product]);\r\n\r\n\t\tconst handleImageError = useCallback(() => {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t`Error cargando imagen para producto ${product.id}:`,\r\n\t\t\t\timageSrc\r\n\t\t\t);\r\n\r\n\t\t\t// Evitar loops infinitos de error\r\n\t\t\tif (errorCount >= 2) {\r\n\t\t\t\tconsole.warn(\r\n\t\t\t\t\t`Demasiados errores para producto ${product.id}, manteniendo placeholder`\r\n\t\t\t\t);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tsetErrorCount((prev) => prev + 1);\r\n\r\n\t\t\tif (!hasError) {\r\n\t\t\t\tsetHasError(true);\r\n\t\t\t\t// Intentar con placeholder peque√±o\r\n\t\t\t\tsetImageSrc(getProductMainImage(null, true));\r\n\t\t\t}\r\n\t\t}, [imageSrc, hasError, errorCount, product.id]);\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"flex-shrink-0 h-10 w-10 rounded-md bg-gray-200 flex items-center justify-center overflow-hidden\">\r\n\t\t\t\t<img\r\n\t\t\t\t\tsrc={imageSrc}\r\n\t\t\t\t\talt={product.name}\r\n\t\t\t\t\tclassName=\"h-10 w-10 object-cover\"\r\n\t\t\t\t\tonError={handleImageError}\r\n\t\t\t\t\tloading=\"lazy\"\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t);\r\n\t};\r\n\r\n\t// Filtrar productos localmente para manejar filtros adicionales\r\n\tconst filteredProducts = products.filter((product) => {\r\n\t\t// Filtro de stock bajo (ya que no se implement√≥ en backend)\r\n\t\tif (stockFilter === \"lowStock\") {\r\n\t\t\treturn product.stock > 0 && product.stock <= 10;\r\n\t\t}\r\n\t\treturn true;\r\n\t});\r\n\r\n\t// Definir columnas de la tabla\r\n\tconst columns = [\r\n\t\t{\r\n\t\t\tkey: \"product\",\r\n\t\t\theader: \"Producto\",\r\n\t\t\tsortable: true,\r\n\t\t\trender: (product: Product) => (\r\n\t\t\t\t<div className=\"flex items-center\">\r\n\t\t\t\t\t<ProductImage product={product} />\r\n\t\t\t\t\t<div className=\"ml-4\">\r\n\t\t\t\t\t\t<div className=\"text-sm font-medium text-gray-900 flex items-center\">\r\n\t\t\t\t\t\t\t{product.name}\r\n\t\t\t\t\t\t\t{product.featured && (\r\n\t\t\t\t\t\t\t\t<span className=\"ml-2\">\r\n\t\t\t\t\t\t\t\t\t<Star className=\"h-4 w-4 text-yellow-500 inline\" />\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"text-xs text-gray-500\">\r\n\t\t\t\t\t\t\tID: {product.id} - SKU: {product.sku || \"N/A\"}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t),\r\n\t\t},\r\n\t\t{\r\n\t\t\tkey: \"category\",\r\n\t\t\theader: \"Categor√≠a\",\r\n\t\t\tsortable: true,\r\n\t\t\trender: (product: Product) => (\r\n\t\t\t\t<span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\r\n\t\t\t\t\t<Tag className=\"w-3 h-3 mr-1\" />\r\n\t\t\t\t\t{getCategoryName(product.categoryId)}\r\n\t\t\t\t</span>\r\n\t\t\t),\r\n\t\t},\r\n\t\t{\r\n\t\t\tkey: \"seller\",\r\n\t\t\theader: \"Vendedor\",\r\n\t\t\tsortable: true,\r\n\t\t\trender: (product: Product) => (\r\n\t\t\t\t<div className=\"text-sm\">\r\n\t\t\t\t\t<div className=\"font-medium text-gray-900\">\r\n\t\t\t\t\t\t{product.seller?.name ||\r\n\t\t\t\t\t\t\tproduct.user?.name ||\r\n\t\t\t\t\t\t\t\"Usuario desconocido\"}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"text-xs text-gray-500\">\r\n\t\t\t\t\t\tID: {product.sellerId || product.userId || \"N/A\"}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t),\r\n\t\t},\r\n\t\t{\r\n\t\t\tkey: \"price\",\r\n\t\t\theader: \"Precio\",\r\n\t\t\tsortable: true,\r\n\t\t\trender: (product: Product) => (\r\n\t\t\t\t<div>\r\n\t\t\t\t\t{product.discountPercentage && product.discountPercentage > 0 ? (\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<span className=\"text-gray-500 line-through text-xs mr-1\">\r\n\t\t\t\t\t\t\t\t{formatCurrency(product.price)}\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t<span className=\"font-semibold text-green-600\">\r\n\t\t\t\t\t\t\t\t{formatCurrency(\r\n\t\t\t\t\t\t\t\t\tproduct.finalPrice ||\r\n\t\t\t\t\t\t\t\t\t\tproduct.price * (1 - product.discountPercentage / 100)\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t<span className=\"ml-1 bg-green-100 text-green-800 text-xs font-semibold px-1.5 py-0.5 rounded\">\r\n\t\t\t\t\t\t\t\t-{product.discountPercentage}%\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t<span className=\"font-semibold\">\r\n\t\t\t\t\t\t\t{formatCurrency(product.price)}\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t),\r\n\t\t},\r\n\t\t{\r\n\t\t\tkey: \"stock\",\r\n\t\t\theader: \"Stock\",\r\n\t\t\tsortable: true,\r\n\t\t\trender: (product: Product) => (\r\n\t\t\t\t<div>\r\n\t\t\t\t\t{product.stock === 0 ? (\r\n\t\t\t\t\t\t<span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800\">\r\n\t\t\t\t\t\t\tAgotado\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t) : product.stock <= 10 ? (\r\n\t\t\t\t\t\t<span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800\">\r\n\t\t\t\t\t\t\t{product.stock} unidades\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t<span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\r\n\t\t\t\t\t\t\t{product.stock} unidades\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t),\r\n\t\t},\r\n\t\t{\r\n\t\t\tkey: \"status\",\r\n\t\t\theader: \"Estado\",\r\n\t\t\tsortable: true,\r\n\t\t\trender: (product: Product) => {\r\n\t\t\t\tlet statusColor = \"\";\r\n\t\t\t\tlet statusText = \"\";\r\n\t\t\t\tlet StatusIcon = CheckCircle;\r\n\r\n\t\t\t\tif (!product.published) {\r\n\t\t\t\t\tstatusColor = \"bg-yellow-100 text-yellow-800\";\r\n\t\t\t\t\tstatusText = \"No publicado\";\r\n\t\t\t\t\tStatusIcon = Clock;\r\n\t\t\t\t} else if (product.status === \"draft\") {\r\n\t\t\t\t\tstatusColor = \"bg-gray-100 text-gray-800\";\r\n\t\t\t\t\tstatusText = \"Borrador\";\r\n\t\t\t\t\tStatusIcon = Archive;\r\n\t\t\t\t} else if (product.status === \"active\") {\r\n\t\t\t\t\tstatusColor = \"bg-green-100 text-green-800\";\r\n\t\t\t\t\tstatusText = \"Activo\";\r\n\t\t\t\t\tStatusIcon = CheckCircle;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tstatusColor = \"bg-red-100 text-red-800\";\r\n\t\t\t\t\tstatusText = \"Inactivo\";\r\n\t\t\t\t\tStatusIcon = Archive;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<span\r\n\t\t\t\t\t\tclassName={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusColor}`}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<StatusIcon className=\"w-3 h-3 mr-1\" />\r\n\t\t\t\t\t\t{statusText}\r\n\t\t\t\t\t</span>\r\n\t\t\t\t);\r\n\t\t\t},\r\n\t\t},\r\n\t\t{\r\n\t\t\tkey: \"rating\",\r\n\t\t\theader: \"Valoraci√≥n\",\r\n\t\t\tsortable: true,\r\n\t\t\trender: (product: Product) => (\r\n\t\t\t\t<div className=\"flex items-center\">\r\n\t\t\t\t\t{(product.rating ?? 0) > 0 ? (\r\n\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t<Star className=\"h-4 w-4 text-yellow-500 mr-1\" />\r\n\t\t\t\t\t\t\t<span>{(product.rating ?? 0).toFixed(1)}</span>\r\n\t\t\t\t\t\t\t<span className=\"text-xs text-gray-500 ml-1\">\r\n\t\t\t\t\t\t\t\t({product.ratingCount ?? 0})\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t</>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t<span className=\"text-xs text-gray-500\">Sin valoraciones</span>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t),\r\n\t\t},\r\n\t\t{\r\n\t\t\tkey: \"sales\",\r\n\t\t\theader: \"Ventas\",\r\n\t\t\tsortable: true,\r\n\t\t\trender: (product: Product) => <span>{product.salesCount || 0} uds.</span>,\r\n\t\t},\r\n\t\t{\r\n\t\t\tkey: \"actions\",\r\n\t\t\theader: \"Acciones\",\r\n\t\t\trender: (product: Product) => (\r\n\t\t\t\t<div className=\"flex justify-end space-x-1\">\r\n\t\t\t\t\t{/* Bot√≥n para ver producto en la tienda - USAR ID EN LUGAR DE SLUG */}\r\n\t\t\t\t\t<Link\r\n\t\t\t\t\t\tto={`/products/${product.id}`}\r\n\t\t\t\t\t\ttarget=\"_blank\"\r\n\t\t\t\t\t\tclassName=\"p-1 text-blue-600 hover:bg-blue-100 rounded-md\"\r\n\t\t\t\t\t\ttitle=\"Ver en tienda\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Eye size={16} />\r\n\t\t\t\t\t</Link>\r\n\r\n\t\t\t\t\t{/* Bot√≥n para editar producto - USAR ID NO SLUG */}\r\n\t\t\t\t\t<Link\r\n\t\t\t\t\t\tto={`/admin/products/edit/${product.id}`}\r\n\t\t\t\t\t\tclassName=\"p-1 text-yellow-600 hover:bg-yellow-100 rounded-md\"\r\n\t\t\t\t\t\ttitle=\"Editar producto\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Edit size={16} />\r\n\t\t\t\t\t</Link>\r\n\r\n\t\t\t\t\t{/* Bot√≥n para destacar/quitar destacado */}\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tonClick={() =>\r\n\t\t\t\t\t\t\thandleToggleFeatured(product.id!, product.featured || false)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdisabled={loadingAction === product.id}\r\n\t\t\t\t\t\tclassName={`p-1 rounded-md transition-colors ${\r\n\t\t\t\t\t\t\tproduct.featured\r\n\t\t\t\t\t\t\t\t? \"text-yellow-500 hover:bg-yellow-100\"\r\n\t\t\t\t\t\t\t\t: \"text-gray-600 hover:bg-gray-100\"\r\n\t\t\t\t\t\t} ${loadingAction === product.id ? \"opacity-50 cursor-not-allowed\" : \"\"}`}\r\n\t\t\t\t\t\ttitle={product.featured ? \"Quitar destacado\" : \"Destacar producto\"}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Star\r\n\t\t\t\t\t\t\tsize={16}\r\n\t\t\t\t\t\t\tclassName={product.featured ? \"fill-current\" : \"\"}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t{/* Bot√≥n para publicar/despublicar */}\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tonClick={() =>\r\n\t\t\t\t\t\t\thandleTogglePublished(product.id!, product.published || false)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tdisabled={loadingAction === product.id}\r\n\t\t\t\t\t\tclassName={`p-1 rounded-md transition-colors ${\r\n\t\t\t\t\t\t\tproduct.published\r\n\t\t\t\t\t\t\t\t? \"text-green-600 hover:bg-green-100\"\r\n\t\t\t\t\t\t\t\t: \"text-gray-600 hover:bg-gray-100\"\r\n\t\t\t\t\t\t} ${loadingAction === product.id ? \"opacity-50 cursor-not-allowed\" : \"\"}`}\r\n\t\t\t\t\t\ttitle={product.published ? \"Despublicar\" : \"Publicar\"}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<CheckCircle size={16} />\r\n\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t{/* Bot√≥n para eliminar */}\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tonClick={() => handleDeleteProduct(product.id!, product.name)}\r\n\t\t\t\t\t\tdisabled={loadingAction === product.id}\r\n\t\t\t\t\t\tclassName={`p-1 text-red-600 hover:bg-red-100 rounded-md transition-colors ${\r\n\t\t\t\t\t\t\tloadingAction === product.id\r\n\t\t\t\t\t\t\t\t? \"opacity-50 cursor-not-allowed\"\r\n\t\t\t\t\t\t\t\t: \"\"\r\n\t\t\t\t\t\t}`}\r\n\t\t\t\t\t\ttitle=\"Eliminar producto\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Trash2 size={16} />\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t),\r\n\t\t},\r\n\t];\r\n\r\n\tconst loading = productsLoading || categoriesLoading;\r\n\r\n\treturn (\r\n\t\t<div className=\"space-y-6\">\r\n\t\t\t{/* Header */}\r\n\t\t\t<div className=\"flex justify-between items-center\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<h1 className=\"text-2xl font-bold text-gray-900\">\r\n\t\t\t\t\t\tGesti√≥n de Productos\r\n\t\t\t\t\t</h1>\r\n\t\t\t\t\t{meta && (\r\n\t\t\t\t\t\t<p className=\"text-sm text-gray-600 mt-1\">\r\n\t\t\t\t\t\t\t{meta.total} productos encontrados\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"flex space-x-2\">\r\n\t\t\t\t\t<Link\r\n\t\t\t\t\t\tto=\"/admin/products/create\"\r\n\t\t\t\t\t\tclassName=\"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Plus className=\"w-4 h-4 mr-2\" />\r\n\t\t\t\t\t\tNuevo Producto\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tonClick={refreshData}\r\n\t\t\t\t\t\tdisabled={loading}\r\n\t\t\t\t\t\tclassName=\"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center disabled:opacity-50\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<RefreshCw\r\n\t\t\t\t\t\t\tsize={16}\r\n\t\t\t\t\t\t\tclassName={`mr-2 ${loading ? \"animate-spin\" : \"\"}`}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\tActualizar\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t{/* Mostrar errores */}\r\n\t\t\t{productsError && (\r\n\t\t\t\t<div className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded\">\r\n\t\t\t\t\tError: {productsError}\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\r\n\t\t\t{/* Filtros */}\r\n\t\t\t<div className=\"bg-white rounded-lg shadow-sm p-4\">\r\n\t\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n\t\t\t\t\t{/* B√∫squeda */}\r\n\t\t\t\t\t<div className=\"flex items-center space-x-2\">\r\n\t\t\t\t\t\t<Search className=\"h-5 w-5 text-gray-500\" />\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\tplaceholder=\"Buscar productos...\"\r\n\t\t\t\t\t\t\tvalue={searchTerm}\r\n\t\t\t\t\t\t\tonChange={(e) => setSearchTerm(e.target.value)}\r\n\t\t\t\t\t\t\tclassName=\"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1\"\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Filtro de Categor√≠a */}\r\n\t\t\t\t\t<div className=\"flex items-center space-x-2\">\r\n\t\t\t\t\t\t<Filter className=\"h-5 w-5 text-gray-500\" />\r\n\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\tclassName=\"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1\"\r\n\t\t\t\t\t\t\tvalue={categoryFilter}\r\n\t\t\t\t\t\t\tonChange={(e) => setCategoryFilter(Number(e.target.value))}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<option value={0}>Todas las categor√≠as</option>\r\n\t\t\t\t\t\t\t{categories.map((category) => (\r\n\t\t\t\t\t\t\t\t<option key={category.id} value={category.id}>\r\n\t\t\t\t\t\t\t\t\t{category.name} ({category.product_count || 0})\r\n\t\t\t\t\t\t\t\t</option>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</select>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Filtro de Estado */}\r\n\t\t\t\t\t<div className=\"flex items-center space-x-2\">\r\n\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\tclassName=\"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1\"\r\n\t\t\t\t\t\t\tvalue={statusFilter}\r\n\t\t\t\t\t\t\tonChange={(e) => setStatusFilter(e.target.value)}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<option value=\"all\">Todos los Estados</option>\r\n\t\t\t\t\t\t\t<option value=\"active\">Activos</option>\r\n\t\t\t\t\t\t\t<option value=\"draft\">Borrador</option>\r\n\t\t\t\t\t\t\t<option value=\"inactive\">Inactivos</option>\r\n\t\t\t\t\t\t</select>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Filtro de Stock */}\r\n\t\t\t\t\t<div className=\"flex items-center space-x-2\">\r\n\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\tclassName=\"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1\"\r\n\t\t\t\t\t\t\tvalue={stockFilter}\r\n\t\t\t\t\t\t\tonChange={(e) => setStockFilter(e.target.value)}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<option value=\"all\">Todo el Stock</option>\r\n\t\t\t\t\t\t\t<option value=\"inStock\">En stock</option>\r\n\t\t\t\t\t\t\t<option value=\"lowStock\">Stock bajo (‚â§10)</option>\r\n\t\t\t\t\t\t\t<option value=\"outOfStock\">Sin stock</option>\r\n\t\t\t\t\t\t</select>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t{/* Tabla de Productos */}\r\n\t\t\t<Table\r\n\t\t\t\tdata={filteredProducts}\r\n\t\t\t\tcolumns={columns}\r\n\t\t\t\tsearchFields={[]} // B√∫squeda se maneja externamente\r\n\t\t\t\tloading={loading}\r\n\t\t\t\temptyMessage=\"No se encontraron productos\"\r\n\t\t\t\tpagination={{\r\n\t\t\t\t\tcurrentPage: currentPage,\r\n\t\t\t\t\ttotalPages: Math.ceil((meta?.total || 0) / itemsPerPage),\r\n\t\t\t\t\ttotalItems: meta?.total || 0,\r\n\t\t\t\t\titemsPerPage: itemsPerPage,\r\n\t\t\t\t\tonPageChange: handlePageChange,\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default AdminProductsPage;\r\n"],"names":["AdminProductService","filterParams","cleanParams","response","ApiClient","API_ENDPOINTS","error","id","data","sellerId","formData","colorsValue","sizesValue","tagsValue","file","index","featured","published","status","GetAllProductsUseCase","adminProductService","products","CreateProductAsAdminUseCase","product","UpdateAnyProductUseCase","DeleteAnyProductUseCase","result","ToggleProductFeaturedUseCase","ToggleProductPublishedUseCase","UpdateProductStatusUseCase","GetProductsBySellerUseCase","GetProductStatsUseCase","stats","getAllProductsUseCase","createProductAsAdminUseCase","updateAnyProductUseCase","deleteAnyProductUseCase","toggleProductFeaturedUseCase","toggleProductPublishedUseCase","updateProductStatusUseCase","getProductsBySellerUseCase","getProductStatsUseCase","getAdminCacheKey","params","useAdminProducts","loading","setLoading","useState","setError","setProducts","productDetail","setProductDetail","setStats","meta","setMeta","adaptProduct","useCallback","apiProduct","processedImages","img","processedTags","tag","parsed","adaptedProduct","fetchAllProducts","forceRefresh","cacheKey","cachedData","CacheService","adaptedData","responseMeta","appConfig","err","errorMessage","fetchProductById","createProduct","clearProductCache","updateProduct","prev","p","deleteProduct","toggleFeatured","togglePublished","updateStatus","fetchProductsBySeller","fetchProductStats","statsData","adminProductKeys","key","PLACEHOLDER_DATA_URI","SMALL_PLACEHOLDER_DATA_URI","IMAGE_CONFIG","getImageUrl","imagePath","useSmallPlaceholder","path","normalizedPath","environment","getProductMainImage","firstImage","imageUrl","AdminProductsPage","productsLoading","productsError","categoriesLoading","categories","fetchAllCategories","useAdminCategories","categoryFilter","setCategoryFilter","statusFilter","setStatusFilter","stockFilter","setStockFilter","searchTerm","setSearchTerm","currentPage","setCurrentPage","itemsPerPage","loadingAction","setLoadingAction","useEffect","loadData","loadCategories","handleDeleteProduct","productId","productName","handleToggleFeatured","currentFeatured","newFeaturedValue","handleTogglePublished","currentPublished","newPublishedValue","refreshData","handlePageChange","page","getCategoryName","categoryId","category","c","ProductImage","imageSrc","setImageSrc","hasError","setHasError","errorCount","setErrorCount","handleImageError","jsx","filteredProducts","columns","jsxs","Star","Tag","formatCurrency","statusColor","statusText","StatusIcon","CheckCircle","Archive","Clock","Fragment","Link","Eye","Edit","Trash2","Plus","RefreshCw","Search","e","Filter","Table"],"mappings":"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"}