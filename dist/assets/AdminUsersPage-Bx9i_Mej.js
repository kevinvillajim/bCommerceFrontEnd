import{c as G,s as x,t as p,r as c,j as e,w as H,X as W,b as X}from"./index-DmNDOrWy.js";import{T as J}from"./Table-BdEePeKQ.js";import{e as b}from"./errorHandler-ugMJT1nb.js";import{R as Q}from"./refresh-cw-BOPCg90x.js";import{F as Y}from"./funnel-CAFb7hhq.js";import{U as Z}from"./user-nLts-VnI.js";import{L as ee}from"./lock-BvRvPCln.js";import{S as se}from"./store-BV-a-_hn.js";import{S as re}from"./shield-C7SSAF2o.js";import"./chevron-left-Dl3DF2OO.js";import"./search-CbEKe7UQ.js";import"./arrow-up-DQySjn32.js";/**
 * @license lucide-react v0.484.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],ae=G("lock-open",te);class oe{async getUsers(l=1,n=15){return(await x.get(p.ADMIN.USERS,{params:{page:l,per_page:n}})).data}async blockUser(l){return(await x.put(p.ADMIN.BLOCK_USER(l))).data.success}async unblockUser(l){return(await x.put(p.ADMIN.UNBLOCK_USER(l))).data.success}async sendPasswordResetEmail(l){return(await x.post(p.ADMIN.RESET_PASSWORD(l))).data.success}async getUserDetails(l){return(await x.get(p.ADMIN.USER_DETAIL(l))).data}async makeAdmin(l){return(await x.put(p.ADMIN.MAKE_ADMIN(l))).data.success}async makeSeller(l,n){return(await x.post(p.ADMIN.MAKE_SELLER(l),n)).data.success}}const ne=()=>{const[m,l]=c.useState([]),[n,i]=c.useState(!0),[P,d]=c.useState(null),[C,E]=c.useState({currentPage:1,totalPages:5,totalItems:0,itemsPerPage:10}),g=new oe,y=r=>{let a="customer";r.is_admin?a="admin":r.is_seller&&(a="seller");const t=r.is_blocked?"blocked":"active";return{id:r.id,name:r.name,email:r.email,role:a,status:t,lastLogin:r.last_login_at||"N/A",registeredDate:r.created_at,ordersCount:r.orders_count||0}},U=c.useCallback(async(r=1,a=10)=>{i(!0),d(null);try{const t=await g.getUsers(r,a),o=t.data.map(y);return l(o),E({currentPage:t.meta.current_page,totalPages:t.meta.last_page,totalItems:t.meta.total,itemsPerPage:t.meta.per_page}),o}catch(t){const o=b(t,"Error al obtener la lista de usuarios");return console.error("Error fetching users:",o),d(o),[]}finally{i(!1)}},[]),v=c.useCallback(async(r,a)=>{i(!0),d(null);try{let t;return a?t=await g.unblockUser(r):t=await g.blockUser(r),t?(l(o=>o.map(u=>u.id===r?{...u,status:a?"active":"blocked"}:u)),!0):(d(`No se pudo ${a?"desbloquear":"bloquear"} al usuario`),!1)}catch(t){const o=b(t,`Error al ${a?"desbloquear":"bloquear"} al usuario`);return console.error("Error toggling user status:",o),d(o),!1}finally{i(!1)}},[]),A=c.useCallback(async r=>{i(!0),d(null);try{const a=await g.sendPasswordResetEmail(r);return a||d("No se pudo enviar el correo de restablecimiento de contraseña"),a}catch(a){const t=b(a,"Error al enviar correo de restablecimiento");return console.error("Error sending password reset:",t),d(t),!1}finally{i(!1)}},[]),j=c.useCallback(async r=>{i(!0),d(null);try{return await g.makeAdmin(r)?(l(t=>t.map(o=>o.id===r?{...o,role:"admin"}:o)),!0):(d("No se pudo convertir al usuario en administrador"),!1)}catch(a){const t=b(a,"Error al convertir usuario en administrador");return console.error("Error making user admin:",t),d(t),!1}finally{i(!1)}},[]),M=c.useCallback(async(r,a)=>{i(!0),d(null);try{return await g.makeSeller(r,a)?(l(o=>o.map(u=>u.id===r?{...u,role:"seller"}:u)),!0):(d("No se pudo convertir al usuario en vendedor"),!1)}catch(t){const o=b(t,"Error al convertir usuario en vendedor");return console.error("Error making user seller:",o),d(o),!1}finally{i(!1)}},[]),N=c.useCallback(r=>{const{role:a,status:t,searchTerm:o}=r;return m.filter(u=>{const h=!a||a==="all"||u.role===a,f=!t||t==="all"||u.status===t,w=!o||u.name.toLowerCase().includes(o.toLowerCase())||u.email.toLowerCase().includes(o.toLowerCase());return h&&f&&w})},[m]);return{users:m,loading:n,error:P,pagination:C,fetchUsers:U,toggleUserStatus:v,sendPasswordReset:A,makeUserAdmin:j,makeUserSeller:M,filterUsers:N}},ve=()=>{const{loading:m,error:l,pagination:n,fetchUsers:i,toggleUserStatus:P,sendPasswordReset:d,makeUserAdmin:C,makeUserSeller:E,filterUsers:g}=ne(),[y,U]=c.useState("all"),[v,A]=c.useState("all"),[j,M]=c.useState(""),[N,r]=c.useState(null),[a,t]=c.useState(!1),[o,u]=c.useState(null),[h,f]=c.useState(""),[w,_]=c.useState(""),[D,R]=c.useState({});c.useEffect(()=>{i(n.currentPage,n.itemsPerPage)},[i,n.currentPage,n.itemsPerPage]);const L=g({role:y,status:v,searchTerm:j}),I=async(s,k)=>{const T=k==="blocked";await P(s,T)&&(r(`Usuario ${T?"desbloqueado":"bloqueado"} correctamente.`),setTimeout(()=>r(null),3e3))},q=async s=>{await d(s)&&(r("Correo de restablecimiento de contraseña enviado correctamente."),setTimeout(()=>r(null),3e3))},z=async s=>{await C(s)&&(r("Usuario promocionado a administrador correctamente."),setTimeout(()=>r(null),3e3))},F=s=>{u(s),f(""),_(""),R({}),t(!0)},S=()=>{t(!1),u(null),f(""),_(""),R({})},$=()=>{const s={};return(!h||h.trim().length<3)&&(s.storeName="El nombre de la tienda debe tener al menos 3 caracteres"),R(s),Object.keys(s).length===0},O=async()=>{o&&$()&&await E(o,{store_name:h,description:w})&&(r("Usuario convertido en vendedor correctamente."),S(),setTimeout(()=>r(null),3e3))},V=s=>{i(s,n.itemsPerPage)},B=()=>{i(n.currentPage,n.itemsPerPage)},K=[{key:"user",header:"Usuario",sortable:!0,render:s=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:e.jsx(Z,{className:"h-6 w-6 text-gray-500"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email})]})]})},{key:"role",header:"Rol",sortable:!0,render:s=>e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.role==="admin"?"bg-red-100 text-red-800":s.role==="seller"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:[s.role==="admin"&&"Administrador",s.role==="seller"&&"Vendedor",s.role==="customer"&&"Cliente"]})},{key:"status",header:"Estado",sortable:!0,render:s=>e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.status==="active"?"Activo":"Bloqueado"})},{key:"lastLogin",header:"Último Acceso",sortable:!0},{key:"registeredDate",header:"Registrado",sortable:!0},{key:"ordersCount",header:"Pedidos",sortable:!0},{key:"actions",header:"Acciones",render:s=>e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>I(s.id,s.status),className:`p-1 rounded-md ${s.status==="active"?"text-red-600 hover:bg-red-100":"text-green-600 hover:bg-green-100"}`,title:s.status==="active"?"Bloquear Usuario":"Desbloquear Usuario",children:s.status==="active"?e.jsx(ee,{size:18}):e.jsx(ae,{size:18})}),e.jsx("button",{onClick:()=>q(s.id),className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Enviar Restablecimiento de Contraseña",children:e.jsx(X,{size:18})}),s.role!=="seller"&&e.jsx("button",{onClick:()=>F(s.id),className:"p-1 text-green-600 hover:bg-green-100 rounded-md",title:"Convertir en Vendedor",children:e.jsx(se,{size:18})}),s.role!=="admin"&&e.jsx("button",{onClick:()=>z(s.id),className:"p-1 text-purple-600 hover:bg-purple-100 rounded-md",title:"Hacer Administrador",children:e.jsx(re,{size:18})})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Usuarios"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("button",{onClick:B,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",disabled:m,children:[e.jsx(Q,{size:18,className:`inline mr-2 ${m?"animate-spin":""}`}),"Actualizar"]})})]}),l&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"h-5 w-5 mr-2"}),e.jsx("span",{children:l})]})}),N&&e.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",children:e.jsx("span",{children:N})}),e.jsx("div",{className:"bg-white0 rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"h-5 w-5 text-gray-500"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:y,onChange:s=>U(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos los Roles"}),e.jsx("option",{value:"customer",children:"Cliente"}),e.jsx("option",{value:"seller",children:"Vendedor"}),e.jsx("option",{value:"admin",children:"Administrador"})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:v,onChange:s=>A(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos los Estados"}),e.jsx("option",{value:"active",children:"Activo"}),e.jsx("option",{value:"blocked",children:"Bloqueado"})]})}),e.jsx("div",{className:"flex-grow",children:e.jsx("input",{type:"text",placeholder:"Buscar por nombre o email...",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:j,onChange:s=>M(s.target.value)})})]})}),e.jsx(J,{data:L,columns:K,searchFields:["name","email"],loading:m,emptyMessage:"No se encontraron usuarios",pagination:{currentPage:n.currentPage,totalPages:n.totalPages,totalItems:n.totalItems,itemsPerPage:n.itemsPerPage,onPageChange:V}}),a&&e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:S}),e.jsxs("div",{className:"bg-white0 rounded-lg p-6 w-full max-w-md relative z-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Convertir en Vendedor"}),e.jsx("button",{onClick:S,className:"text-gray-500 hover:text-gray-700",children:e.jsx(W,{size:20})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"store_name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de la Tienda *"}),e.jsx("input",{type:"text",id:"store_name",className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 ${D.storeName?"border-red-500":"border-gray-300"}`,value:h,onChange:s=>f(s.target.value)}),D.storeName&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:D.storeName})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),e.jsx("textarea",{id:"description",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:w,onChange:s=>_(s.target.value),rows:4})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:S,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100",children:"Cancelar"}),e.jsx("button",{onClick:O,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",disabled:m,children:m?"Procesando...":"Guardar"})]})]})]})]})]})};export{ve as default};
//# sourceMappingURL=AdminUsersPage-Bx9i_Mej.js.map
