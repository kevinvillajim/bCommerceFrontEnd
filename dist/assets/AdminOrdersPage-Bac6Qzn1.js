import{r as c,j as a,p,q as M,L as j}from"./index-DmNDOrWy.js";import{T as R}from"./Table-BdEePeKQ.js";import{A as $}from"./AdminOrderServiceAdapter-pJBu4i2T.js";import{R as v}from"./refresh-cw-BOPCg90x.js";import{F as _}from"./funnel-CAFb7hhq.js";import{S as N}from"./shopping-bag-BMmsUIy8.js";import{R as L}from"./rotate-ccw-CNCWbRSg.js";import{C as P}from"./circle-x-BwsT4AZ5.js";import{P as V}from"./package-CIRlwNqy.js";import{T as U}from"./truck-DP84WB3Y.js";import{C as q}from"./calendar-COADRkv0.js";import{U as B}from"./user-nLts-VnI.js";import{E as G}from"./eye-CldZNoIz.js";import{F as H}from"./file-text-DT6_O-Nw.js";import{T as X}from"./triangle-alert-B75WTV0P.js";import"./chevron-left-Dl3DF2OO.js";import"./search-CbEKe7UQ.js";import"./arrow-up-DQySjn32.js";const ue=()=>{const[w,d]=c.useState([]),[C,n]=c.useState(!0),[r,h]=c.useState({status:"all",paymentStatus:"all",sellerId:null}),[l,m]=c.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),u=new $;c.useEffect(()=>{y()},[r,l.currentPage]);const y=async()=>{n(!0);try{const e={status:r.status!=="all"?r.status:void 0,paymentStatus:r.paymentStatus!=="all"?r.paymentStatus:void 0,sellerId:r.sellerId,dateFrom:r.dateFrom,dateTo:r.dateTo,search:r.search,page:l.currentPage,limit:l.itemsPerPage},s=await u.getAdminOrders(e);d(s.orders),m({currentPage:s.pagination.currentPage,totalPages:s.pagination.totalPages,totalItems:s.pagination.totalItems,itemsPerPage:s.pagination.itemsPerPage})}catch(e){console.error("Error al cargar órdenes:",e)}finally{n(!1)}},g={pending:{label:"Pendiente",color:"bg-yellow-100 text-yellow-800",icon:a.jsx(M,{className:"w-3 h-3 mr-1"})},processing:{label:"En proceso",color:"bg-blue-100 text-blue-800",icon:a.jsx(v,{className:"w-3 h-3 mr-1"})},paid:{label:"Pagado",color:"bg-teal-100 text-teal-800",icon:a.jsx(p,{className:"w-3 h-3 mr-1"})},shipped:{label:"Enviado",color:"bg-indigo-100 text-indigo-800",icon:a.jsx(U,{className:"w-3 h-3 mr-1"})},delivered:{label:"Entregado",color:"bg-purple-100 text-purple-800",icon:a.jsx(V,{className:"w-3 h-3 mr-1"})},completed:{label:"Completado",color:"bg-emerald-100 text-emerald-800",icon:a.jsx(p,{className:"w-3 h-3 mr-1"})},cancelled:{label:"Cancelado",color:"bg-red-100 text-red-800",icon:a.jsx(P,{className:"w-3 h-3 mr-1"})},returned:{label:"Devuelto",color:"bg-orange-100 text-orange-800",icon:a.jsx(L,{className:"w-3 h-3 mr-1"})},ready_for_pickup:{label:"Listo para recoger",color:"bg-purple-100 text-purple-800",icon:a.jsx(N,{className:"w-3 h-3 mr-1"})}},f={paid:{label:"Pagado",color:"bg-green-100 text-green-800"},completed:{label:"Completado",color:"bg-green-100 text-green-800"},pending:{label:"Pendiente",color:"bg-yellow-100 text-yellow-800"},refunded:{label:"Reembolsado",color:"bg-red-100 text-red-800"},failed:{label:"Fallido",color:"bg-gray-100 text-gray-800"}},S={credit_card:"Tarjeta de crédito",paypal:"PayPal",bank_transfer:"Transferencia bancaria",cash_on_delivery:"Contra reembolso"},b=e=>({pending:"processing",processing:"shipped",shipped:"delivered",delivered:"completed"})[e]||e,E=async(e,s)=>{n(!0);try{await u.updateOrderStatus(e,s)?d(i=>i.map(x=>x.id===e?{...x,status:s,updatedAt:new Date().toISOString()}:x)):alert("Error al actualizar el estado de la orden")}catch(t){console.error("Error al actualizar estado:",t),alert("Error al actualizar el estado de la orden")}finally{n(!1)}},F=(e,s)=>{const t=b(s);t!==s&&E(e,t)},T=async e=>{if(window.confirm("¿Estás seguro de que deseas cancelar este pedido?")){n(!0);try{await u.cancelOrder(e)?d(t=>t.map(i=>i.id===e?{...i,status:"cancelled",updatedAt:new Date().toISOString()}:i)):alert("Error al cancelar la orden")}catch(s){console.error("Error al cancelar orden:",s),alert("Error al cancelar la orden")}finally{n(!1)}}},k=e=>new Intl.NumberFormat("es-ES",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(e),I=e=>{if(!e)return"N/A";const s=new Date(e);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(s)},A=e=>{m(s=>({...s,currentPage:e}))},O=()=>{y()},o=(e,s)=>{h(t=>({...t,[e]:s})),m(t=>({...t,currentPage:1}))},z=()=>{h({status:"all",paymentStatus:"all",sellerId:null,dateFrom:void 0,dateTo:void 0,search:void 0})},D=[{key:"orderNumber",header:"Pedido",sortable:!0,render:e=>a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-lg bg-primary-100 flex items-center justify-center",children:a.jsx(N,{className:"h-6 w-6 text-primary-600"})}),a.jsxs("div",{className:"ml-4",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.orderNumber}),a.jsxs("div",{className:"text-xs text-gray-500 flex items-center",children:[a.jsx(q,{className:"w-3 h-3 mr-1"}),I(e.date)]})]})]})},{key:"customer",header:"Cliente",sortable:!0,render:e=>{const s=e.customer.name||`Usuario ${e.customer.id}`;return a.jsxs("div",{className:"flex items-center",children:[a.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center",children:a.jsx(B,{className:"h-4 w-4 text-gray-500"})}),a.jsxs("div",{className:"ml-3",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900",children:s}),a.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",e.customer.id]})]})]})}},{key:"items",header:"Productos",render:e=>a.jsxs("div",{className:"text-sm",children:[a.jsx("span",{className:"font-medium",children:e.items.length})," producto(s)",e.items.length>0&&a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[e.items.slice(0,2).map(s=>a.jsxs("div",{children:[s.quantity,"x ",s.name||`Producto ${s.productId}`]},s.id)),e.items.length>2&&a.jsxs("div",{children:["+ ",e.items.length-2," más..."]})]})]})},{key:"total",header:"Total",sortable:!0,render:e=>a.jsx("div",{className:"font-medium text-gray-900",children:k(e.total)})},{key:"status",header:"Estado",sortable:!0,render:e=>{const s=g[e.status]||{label:e.status,color:"bg-gray-100 text-gray-800",icon:a.jsx(X,{className:"w-3 h-3 mr-1"})};return a.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.color}`,children:[s.icon,s.label]})}},{key:"payment",header:"Pago",sortable:!0,render:e=>{const s=S[e.paymentMethod||""]||e.paymentMethod,t=f[e.paymentStatus||"pending"]||{label:e.paymentStatus,color:"bg-gray-100 text-gray-800"};return a.jsxs("div",{children:[a.jsx("div",{className:"text-sm text-gray-500",children:s}),a.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${t.color}`,children:t.label})]})}},{key:"actions",header:"Acciones",render:e=>{const s=["pending","processing","shipped","delivered"].includes(e.status),t=["pending","processing"].includes(e.status);return a.jsxs("div",{className:"flex justify-end space-x-2",children:[a.jsx(j,{to:`/admin/orders/${e.id}`,className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Ver detalles del pedido",children:a.jsx(G,{size:18})}),["completed","delivered"].includes(e.status)&&a.jsx(j,{to:`/admin/invoices?orderId=${e.id}`,className:"p-1 text-indigo-600 hover:bg-indigo-100 rounded-md",title:"Ver factura",children:a.jsx(H,{size:18})}),s&&a.jsx("button",{onClick:()=>F(e.id,e.status),className:"p-1 text-green-600 hover:bg-green-100 rounded-md",title:`Avanzar a ${g[b(e.status)]?.label||"siguiente estado"}`,children:a.jsx(p,{size:18})}),t&&a.jsx("button",{onClick:()=>T(e.id),className:"p-1 text-red-600 hover:bg-red-100 rounded-md",title:"Cancelar pedido",children:a.jsx(P,{size:18})})]})}}];return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Pedidos"}),a.jsx("div",{className:"flex space-x-2",children:a.jsxs("button",{onClick:O,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[a.jsx(v,{size:18,className:"inline mr-2"}),"Actualizar"]})})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"flex flex-col space-y-1",children:[a.jsx("label",{className:"text-sm text-gray-600",children:"Estado del pedido"}),a.jsxs("div",{className:"flex items-center",children:[a.jsx(_,{className:"h-5 w-5 text-gray-500 mr-2"}),a.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:r.status,onChange:e=>o("status",e.target.value),children:[a.jsx("option",{value:"all",children:"Todos los Estados"}),Object.entries(g).map(([e,{label:s}])=>a.jsx("option",{value:e,children:s},e))]})]})]}),a.jsxs("div",{className:"flex flex-col space-y-1",children:[a.jsx("label",{className:"text-sm text-gray-600",children:"Estado de pago"}),a.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:r.paymentStatus,onChange:e=>o("paymentStatus",e.target.value),children:[a.jsx("option",{value:"all",children:"Todos los Estados"}),Object.entries(f).map(([e,{label:s}])=>a.jsx("option",{value:e,children:s},e))]})]}),a.jsxs("div",{className:"flex flex-col space-y-1",children:[a.jsx("label",{className:"text-sm text-gray-600",children:"Vendedor"}),a.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:r.sellerId===null?"null":r.sellerId,onChange:e=>o("sellerId",e.target.value==="null"?null:Number(e.target.value)),children:[a.jsx("option",{value:"null",children:"Todos los Vendedores"}),[1,2,3,4,5].map(e=>a.jsxs("option",{value:e,children:["Vendedor ",e]},e))]})]}),a.jsxs("div",{className:"flex flex-col space-y-1",children:[a.jsx("label",{className:"text-sm text-gray-600",children:"Rango de fechas"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:r.dateFrom||"",onChange:e=>o("dateFrom",e.target.value),placeholder:"Desde"}),a.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:r.dateTo||"",onChange:e=>o("dateTo",e.target.value),placeholder:"Hasta"})]})]})]}),a.jsx("div",{className:"mt-4 flex justify-end",children:a.jsx("button",{onClick:z,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Limpiar filtros"})})]}),a.jsx(R,{data:w,columns:D,searchFields:["orderNumber","customer"],loading:C,emptyMessage:"No se encontraron pedidos",pagination:{currentPage:l.currentPage,totalPages:l.totalPages,totalItems:l.totalItems,itemsPerPage:l.itemsPerPage,onPageChange:A}})]})};export{ue as default};
//# sourceMappingURL=AdminOrdersPage-Bac6Qzn1.js.map
