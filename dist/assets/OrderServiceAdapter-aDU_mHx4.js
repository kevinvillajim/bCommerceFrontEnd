import{c as i,A as d,h as m}from"./admin-chunk-bhOJ3jtA.js";import{i as v}from"./checkout-chunk-D9tWfuim.js";import{i as _}from"./seller-chunk-B6Pjm2KH.js";class y{async getSellerOrders(e){try{console.log("OrderService: Obteniendo Ã³rdenes del vendedor con filtros:",e);const r=await i.get(d.ORDERS.SELLER_ORDERS,e);console.log("OrderService: Respuesta de Ã³rdenes:",r);const t=r?.data||[],a=r?.pagination||{currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10};return{data:t,meta:{total:a.totalItems,per_page:a.itemsPerPage,current_page:a.currentPage,last_page:a.totalPages}}}catch(r){return console.error("OrderService: Error al obtener Ã³rdenes:",r),{data:[],meta:{total:0,per_page:10,current_page:1,last_page:1}}}}async getOrderDetails(e){try{console.log(`OrderService: Obteniendo detalle de orden ${e}`);const r=await i.get(d.USER.ORDER_DETAILS(e));if(console.log(`OrderService: Respuesta para orden ${e}:`,r),!r||!r.data)throw new Error("Respuesta vacÃ­a al obtener detalle de orden");let t=r.data;if(t.items&&Array.isArray(t.items)){const a=t.items.reduce((c,l)=>c+l.price*l.quantity,0),u=(await m.getInstance().getUnifiedConfig()).config.tax_rate,g=a*u,n=a+g;v(t.total,n)||(console.warn(`ðŸ”§ OrderService: Corrigiendo total de orden ${e}: ${t.total} â†’ ${n}`),t.total=n)}return t}catch(r){throw console.error(`OrderService: Error al obtener detalle de orden ${e}:`,r),r}}async updateOrderStatus(e,r){try{console.log(`OrderService: Actualizando estado de orden ${e} a ${r.status}`);const t=await i.patch(d.ORDERS.UPDATE_STATUS(e),r);if(console.log(`OrderService: Respuesta de actualizaciÃ³n para orden ${e}:`,t),!t||!t.data)throw new Error("Respuesta vacÃ­a al actualizar estado de orden");return t.data}catch(t){throw console.error(`OrderService: Error al actualizar estado de orden ${e}:`,t),t}}async completeOrder(e){try{console.log(`OrderService: Completando orden ${e}`);const r=await i.post(d.ORDERS.COMPLETE(e));return console.log(`OrderService: Respuesta de completar orden ${e}:`,r),r?.success||!1}catch(r){return console.error(`OrderService: Error al completar orden ${e}:`,r),!1}}async cancelOrder(e,r=""){try{console.log(`OrderService: Cancelando orden ${e}`);const t=await i.post(d.ORDERS.CANCEL(e),{reason:r});return console.log(`OrderService: Respuesta de cancelar orden ${e}:`,t),t?.success||!1}catch(t){return console.error(`OrderService: Error al cancelar orden ${e}:`,t),!1}}async updateShippingInfo(e,r){try{console.log(`OrderService: Actualizando informaciÃ³n de envÃ­o para orden ${e}`);const t=await i.patch(d.ORDERS.UPDATE_SHIPPING(e),r);return console.log(`OrderService: Respuesta de actualizaciÃ³n de envÃ­o para ${e}:`,t),t?.success||!1}catch(t){return console.error(`OrderService: Error al actualizar envÃ­o de orden ${e}:`,t),!1}}async getOrderStats(){try{console.log("OrderService: Obteniendo estadÃ­sticas de Ã³rdenes");const e=await i.get(d.ORDERS.STATS);if(console.log("OrderService: Respuesta de estadÃ­sticas:",e),!e||!e.data)throw new Error("Respuesta vacÃ­a al obtener estadÃ­sticas");return e.data}catch(e){return console.error("OrderService: Error al obtener estadÃ­sticas:",e),{totalOrders:0,pendingOrders:0,processingOrders:0,shippedOrders:0,deliveredOrders:0,cancelledOrders:0,totalSales:0}}}async getOrdersAwaitingShipment(e=10,r=0){try{console.log("OrderService: Obteniendo Ã³rdenes pendientes de envÃ­o");const t=await i.get(d.ORDERS.AWAITING_SHIPMENT,{limit:e,offset:r});return console.log("OrderService: Respuesta de Ã³rdenes pendientes de envÃ­o:",t),!t||!t.data?[]:Array.isArray(t.data)?t.data:[]}catch(t){return console.error("OrderService: Error al obtener Ã³rdenes pendientes de envÃ­o:",t),[]}}async getSellerCustomers(e=10,r=0){try{console.log("OrderService: Obteniendo clientes del vendedor");const t=await i.get(d.ORDERS.CUSTOMERS,{limit:e,offset:r});return console.log("OrderService: Respuesta de clientes:",t),!t||!t.data?[]:Array.isArray(t.data)?t.data:[]}catch(t){return console.error("OrderService: Error al obtener clientes:",t),[]}}async getOrdersWithProduct(e,r=10,t=0){try{console.log(`OrderService: Obteniendo Ã³rdenes con producto ${e}`);const a=await i.get(d.ORDERS.WITH_PRODUCT(e),{limit:r,offset:t});return console.log(`OrderService: Respuesta de Ã³rdenes con producto ${e}:`,a),!a||!a.data?[]:Array.isArray(a.data)?a.data:[]}catch(a){return console.error(`OrderService: Error al obtener Ã³rdenes con producto ${e}:`,a),[]}}async getUserOrders(e){try{console.log("OrderService: Obteniendo Ã³rdenes del cliente con filtros:",e);const r=await i.get(d.USER.ORDERS,e);console.log("OrderService: Respuesta de Ã³rdenes de cliente:",r);const t=r?.data||[],a=r?.pagination||{currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10},u=(await m.getInstance().getUnifiedConfig()).config.tax_rate;return{data:t.map(n=>{if(n.items&&Array.isArray(n.items)){const c=n.items.reduce((S,h)=>S+h.price*h.quantity,0),l=c*u,o=c+l;v(n.total,o)||(console.warn(`ðŸ”§ OrderService: Corrigiendo total de orden: ${n.total} â†’ ${o}`),n.total=o)}return n}),meta:{total:a.totalItems,per_page:a.itemsPerPage,current_page:a.currentPage,last_page:a.totalPages}}}catch(r){return console.error("OrderService: Error al obtener Ã³rdenes del cliente:",r),{data:[],meta:{total:0,per_page:10,current_page:1,last_page:1}}}}}class b{orderService;constructor(e){this.orderService=e}async execute(e){try{const r=this.validateFilters(e||{});return await this.orderService.getSellerOrders(r)}catch(r){throw console.error("Error en GetSellerOrdersUseCase:",r),r}}validateFilters(e){const r={};return e.status&&["pending","processing","paid","shipped","delivered","completed","cancelled"].includes(e.status)&&(r.status=e.status),e.paymentStatus&&["pending","completed","failed"].includes(e.paymentStatus)&&(r.paymentStatus=e.paymentStatus),e.dateFrom&&this.isValidDate(e.dateFrom)&&(r.dateFrom=e.dateFrom),e.dateTo&&this.isValidDate(e.dateTo)&&(r.dateTo=e.dateTo),e.search&&typeof e.search=="string"&&(r.search=e.search.trim()),e.page&&Number.isInteger(Number(e.page))&&Number(e.page)>0&&(r.page=Number(e.page)),e.limit&&Number.isInteger(Number(e.limit))&&Number(e.limit)>0&&(r.limit=Number(e.limit)),r}isValidDate(e){const r=new Date(e);return!isNaN(r.getTime())}}class f{orderService;constructor(e){this.orderService=e}async execute(){try{const e=await this.orderService.getOrderStats();return{totalOrders:e.totalOrders||0,pendingOrders:e.pendingOrders||0,processingOrders:e.processingOrders||0,shippedOrders:e.shippedOrders||0,deliveredOrders:e.deliveredOrders||0,completedOrders:e.completedOrders||0,cancelledOrders:e.cancelledOrders||0,totalSales:e.totalSales||0}}catch(e){return console.error("Error en GetOrderStatsUseCase:",e),{totalOrders:0,pendingOrders:0,processingOrders:0,shippedOrders:0,deliveredOrders:0,completedOrders:0,cancelledOrders:0,totalSales:0}}}}class w{orderService;constructor(e){this.orderService=e}async execute(e,r){try{if(!e||e<=0)throw new Error("ID de orden invÃ¡lido");if(!_(r))throw new Error(`Estado de orden '${r}' no vÃ¡lido`);return await this.orderService.updateOrderStatus(e,{status:r})}catch(t){throw console.error(`Error en UpdateOrderStatusUseCase para orden ${e}:`,t),t}}}class D{orderService;constructor(e){this.orderService=e}async execute(e){try{if(!e||e<=0)throw new Error("ID de orden invÃ¡lido");return await this.orderService.getOrderDetails(e)}catch(r){throw console.error(`Error en GetOrderDetailUseCase para orden ${e}:`,r),r}}}class E{orderService;constructor(e){this.orderService=e}async execute(e){try{return await this.orderService.getUserOrders(e)}catch(r){throw console.error("Error en GetUserOrdersUseCase:",r),r}}}class U{orderService;sellerOrdersUseCase;userOrdersUseCase;orderStatsUseCase;updateOrderStatusUseCase;getOrderDetailUseCase;constructor(){this.orderService=new y,this.sellerOrdersUseCase=new b(this.orderService),this.userOrdersUseCase=new E(this.orderService),this.orderStatsUseCase=new f(this.orderService),this.updateOrderStatusUseCase=new w(this.orderService),this.getOrderDetailUseCase=new D(this.orderService)}async getSellerOrders(e){try{const r=await this.sellerOrdersUseCase.execute(e),t=r.data.map(s=>this.adaptOrderToUI(s)),a={currentPage:r.meta.current_page,totalPages:r.meta.last_page,totalItems:r.meta.total,itemsPerPage:r.meta.per_page};return{orders:t,pagination:a}}catch(r){return console.error("Error en OrderServiceAdapter.getSellerOrders:",r),{orders:[],pagination:{currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}}}}async getUserOrders(e){try{const r=await this.userOrdersUseCase.execute(e),t=r.data.map(s=>this.adaptOrderToUI(s)),a={currentPage:Number(r.meta.current_page)||1,totalPages:Math.ceil(r.meta.total/Number(r.meta.last_page||10)),totalItems:Number(r.meta.total)||0,itemsPerPage:Number(r.meta.per_page)||10};return{orders:t,pagination:a}}catch(r){return console.error("Error en OrderServiceAdapter.getUserOrders:",r),{orders:[],pagination:{currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}}}}async getOrderStats(){try{const e=await this.orderStatsUseCase.execute();return[{label:"Total Pedidos",value:e.totalOrders,color:"blue",isCurrency:!1},{label:"Pendientes",value:e.pendingOrders,color:"yellow",isCurrency:!1},{label:"En Proceso",value:e.processingOrders,color:"blue",isCurrency:!1},{label:"Enviados",value:e.shippedOrders,color:"indigo",isCurrency:!1},{label:"Total Ventas",value:e.totalSales,color:"green",isCurrency:!0}]}catch(e){return console.error("Error en OrderServiceAdapter.getOrderStats:",e),[]}}async updateOrderStatus(e,r){try{const t=typeof e=="string"?parseInt(e):e;return!!await this.updateOrderStatusUseCase.execute(t,r)}catch(t){return console.error(`Error en OrderServiceAdapter.updateOrderStatus para orden ${e}:`,t),!1}}async getOrderDetails(e){try{const r=typeof e=="string"?parseInt(e):e,t=await this.getOrderDetailUseCase.execute(r);if(t){const a={...t,userId:t.userId,sellerId:t.sellerId,paymentId:t.paymentId,paymentMethod:t.payment_method,paymentStatus:t.paymentStatus,createdAt:t.createdAt?.replace(/Z$/,"")||t.createdAt,created_at:t.created_at?.replace(/Z$/,"")||t.created_at,updatedAt:t.updatedAt,orderNumber:t.orderNumber,shippingData:t.shippingData,items:t.items?.map(s=>({...s,productId:s.productId,product:{name:s.product?.name||s.product_name||"Unknown Product",image:s.product?.image||s.product_image,slug:s.product?.slug,sku:s.product?.sku||s.product_sku},product_name:s.product_name,product_sku:s.product_sku,product_image:s.product_image,original_price:s.original_price,volume_discount_percentage:s.volume_discount_percentage,volume_savings:s.volume_savings,discount_label:s.discount_label,hasVolumeDiscount:(s.volume_discount_percentage||0)>0}))||[],subtotal_products:t.subtotal_products,iva_amount:t.iva_amount,original_total:t.original_total,volume_discount_savings:t.volume_discount_savings,volume_discounts_applied:t.volume_discounts_applied,shipping_cost:t.shipping_cost,free_shipping:t.free_shipping,total_discounts:t.total_discounts,pricing_breakdown:t.pricing_breakdown};if(console.log("âœ… Orden adaptada para UI con descuentos por volumen:",a),a.subtotal_products&&a.iva_amount)console.log("ðŸ’° Usando totales calculados del backend:",{subtotal_products:a.subtotal_products,iva_amount:a.iva_amount,total:a.total,volume_savings:a.volume_discount_savings});else{const s=a.items?.reduce((l,o)=>l+o.price*o.quantity,0)||0,g=(await m.getInstance().getUnifiedConfig()).config.tax_rate,n=s*g,c=s+n;v(a.total,c)||(console.warn("ðŸ”§ OrderServiceAdapter: Corrigiendo diferencia en cÃ¡lculo de totales:",{original:a.total,calculated:c,difference:Math.abs(a.total-c)}),a.total=c)}return a}return t}catch(r){throw console.error(`Error en OrderServiceAdapter.getOrderDetails para orden ${e}:`,r),r}}adaptOrderToUI(e){const r=e.subtotal_products||e.items?.reduce((o,S)=>o+S.price*S.quantity,0)||0,s=m.getInstance().getConfigSync()?.tax_rate||.15,O=e.iva_amount||r*s,u=e.total||r+O,g=e.items?.length||e.itemCount||void 0,n=e.items?.map(o=>({id:o.id||0,productId:o.productId,name:o.product?.name||o.product_name||"Producto",quantity:o.quantity,price:o.price,subtotal:o.price*o.quantity,image:o.product?.image||o.product_image,originalPrice:o.original_price||o.price,volumeDiscountPercentage:o.volume_discount_percentage||0,volumeSavings:o.volume_savings||0,discountLabel:o.discount_label||null,hasVolumeDiscount:(o.volume_discount_percentage||0)>0}))||[],c=e.shippingData?`${e.shippingData.address}, ${e.shippingData.city}, ${e.shippingData.state}, ${e.shippingData.country}`:void 0,l=e.paymentStatus;return{id:String(e.id),orderNumber:e.orderNumber,date:(e.date||e.createdAt||new Date().toISOString()).replace(/Z$/,""),customer:{id:e.userId,name:e.user_name||"Cliente",email:e.user_email||"email@example.com"},subtotal:r,taxAmount:O,total:u,items:n,status:e.status||"pending",paymentStatus:l,shippingAddress:c,notes:e.shippingData?.notes,itemCount:g,originalTotal:e.original_total||u,volumeDiscountSavings:e.volume_discount_savings||0,volumeDiscountsApplied:e.volume_discounts_applied||!1,shippingCost:e.shipping_cost||0,freeShipping:e.free_shipping||!1,totalDiscounts:e.total_discounts||0,pricingBreakdown:e.pricing_breakdown||null}}getOrderDiscountSummary(e){const r=e.items.filter(a=>a.hasVolumeDiscount).length,t=e.volumeDiscountSavings||0;return{hasDiscounts:t>0,totalSavings:t,volumeDiscounts:e.volumeDiscountsApplied||!1,itemsWithDiscounts:r}}formatPricingBreakdown(e){return{subtotal:`$${e.subtotal.toFixed(2)}`,tax:`$${e.taxAmount.toFixed(2)}`,shipping:e.freeShipping?"GRATIS":`$${(e.shippingCost||0).toFixed(2)}`,discounts:(e.volumeDiscountSavings||0)>0?`-$${(e.volumeDiscountSavings||0).toFixed(2)}`:"$0.00",total:`$${e.total.toFixed(2)}`}}}export{U as O};
//# sourceMappingURL=OrderServiceAdapter-aDU_mHx4.js.map
