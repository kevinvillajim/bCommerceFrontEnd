{"version":3,"file":"CartPage-DjW_kkCC.js","sources":["../../src/presentation/pages/CartPage.tsx"],"sourcesContent":["import React, {useState, useEffect} from \"react\";\r\nimport {Link, useNavigate} from \"react-router-dom\";\r\nimport {\r\n\tShoppingCart,\r\n\tTrash2,\r\n\tPlus,\r\n\tMinus,\r\n\tArrowLeft,\r\n\tHeart,\r\n} from \"lucide-react\";\r\nimport {useCart} from \"../hooks/useCart\";\r\nimport {useFavorites} from \"../hooks/useFavorites\";\r\nimport {formatCurrency} from \"../../utils/formatters/formatCurrency\";\r\nimport { NotificationType } from \"../contexts/CartContext\";\r\n\r\n// IMPORTAR EL HELPER DE IM√ÅGENES CORREGIDO\r\nimport { getImageUrl } from \"../../utils/imageUtils\";\r\n\r\nconst CartPage: React.FC = () => {\r\n\tconst [isLoading, setIsLoading] = useState(true);\r\n\tconst [isEmpty, setIsEmpty] = useState(false);\r\n\tconst [couponCode, setCouponCode] = useState(\"\");\r\n\tconst [couponApplied, setCouponApplied] = useState(false);\r\n\tconst [couponDiscount, setCouponDiscount] = useState(0);\r\n\tconst [loadingItem, setLoadingItem] = useState<number | null>(null);\r\n\r\n\tconst navigate = useNavigate();\r\n\r\n\t// Obtener datos del carrito y funciones para manipularlo\r\n\tconst {\r\n\t\tcart,\r\n\t\tloading,\r\n\t\terror,\r\n\t\tfetchCart,\r\n\t\titemCount,\r\n\t\tremoveFromCart,\r\n\t\tupdateCartItem,\r\n\t\tclearCart,\r\n\t\tshowNotification,\r\n\t} = useCart();\r\n\r\n\tconst {toggleFavorite} = useFavorites();\r\n\r\n\t// Cargar el carrito al montar el componente\r\n\tuseEffect(() => {\r\n\t\tconst loadCart = async () => {\r\n\t\t\tsetIsLoading(true);\r\n\t\t\ttry {\r\n\t\t\t\tawait fetchCart();\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error(\"Error al cargar el carrito:\", error);\r\n\t\t\t\tshowNotification(\r\n\t\t\t\t\tNotificationType.ERROR,\r\n\t\t\t\t\t\"No se pudo cargar el carrito. Int√©ntalo de nuevo.\"\r\n\t\t\t\t);\r\n\t\t\t} finally {\r\n\t\t\t\tsetIsLoading(false);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tloadCart();\r\n\t}, [fetchCart, showNotification]);\r\n\r\n\t// Actualizar estado de carrito vac√≠o cuando cambia el carrito\r\n\tuseEffect(() => {\r\n\t\tif (!loading && cart) {\r\n\t\t\tsetIsEmpty(cart.items.length === 0);\r\n\t\t}\r\n\t}, [cart, loading]);\r\n\r\n\t// Funciones para manipular el carrito\r\n\tconst increaseQuantity = async (id: number) => {\r\n\t\tif (loadingItem) return; // Evitar m√∫ltiples clics simult√°neos\r\n\r\n\t\tsetLoadingItem(id);\r\n\t\tconst item = cart?.items.find((item) => item.id === id);\r\n\r\n\t\tif (item) {\r\n\t\t\ttry {\r\n\t\t\t\tconst result = await updateCartItem({\r\n\t\t\t\t\titemId: id,\r\n\t\t\t\t\tquantity: item.quantity + 1,\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (!result) {\r\n\t\t\t\t\tthrow new Error(\"No se pudo actualizar la cantidad\");\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error(\"Error al aumentar cantidad:\", error);\r\n\t\t\t\tshowNotification(\r\n\t\t\t\t\tNotificationType.ERROR,\r\n\t\t\t\t\t\"No se pudo actualizar la cantidad\"\r\n\t\t\t\t);\r\n\t\t\t} finally {\r\n\t\t\t\tsetLoadingItem(null);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst decreaseQuantity = async (id: number) => {\r\n\t\tif (loadingItem) return; // Evitar m√∫ltiples clics simult√°neos\r\n\r\n\t\tsetLoadingItem(id);\r\n\t\tconst item = cart?.items.find((item) => item.id === id);\r\n\r\n\t\tif (item && item.quantity > 1) {\r\n\t\t\ttry {\r\n\t\t\t\tconst result = await updateCartItem({\r\n\t\t\t\t\titemId: id,\r\n\t\t\t\t\tquantity: item.quantity - 1,\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (!result) {\r\n\t\t\t\t\tthrow new Error(\"No se pudo actualizar la cantidad\");\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error(\"Error al disminuir cantidad:\", error);\r\n\t\t\t\tshowNotification(\r\n\t\t\t\t\tNotificationType.ERROR,\r\n\t\t\t\t\t\"No se pudo actualizar la cantidad\"\r\n\t\t\t\t);\r\n\t\t\t} finally {\r\n\t\t\t\tsetLoadingItem(null);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleRemoveFromCart = async (id: number) => {\r\n\t\tif (loadingItem) return; // Evitar m√∫ltiples clics simult√°neos\r\n\r\n\t\tsetLoadingItem(id);\r\n\t\ttry {\r\n\t\t\tconst result = await removeFromCart(id);\r\n\r\n\t\t\tif (result) {\r\n\t\t\t\tshowNotification(\r\n\t\t\t\t\tNotificationType.SUCCESS,\r\n\t\t\t\t\t\"Producto eliminado del carrito\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"No se pudo eliminar el producto\");\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error al eliminar del carrito:\", error);\r\n\t\t\tshowNotification(\r\n\t\t\t\tNotificationType.ERROR,\r\n\t\t\t\t\"No se pudo eliminar el producto\"\r\n\t\t\t);\r\n\t\t} finally {\r\n\t\t\tsetLoadingItem(null);\r\n\t\t}\r\n\t};\r\n\r\n\tconst moveToWishlist = async (id: number, productId: number) => {\r\n\t\tif (loadingItem) return; // Evitar m√∫ltiples clics simult√°neos\r\n\r\n\t\tsetLoadingItem(id);\r\n\t\ttry {\r\n\t\t\t// Primero agregamos a favoritos\r\n\t\t\tawait toggleFavorite(productId);\r\n\r\n\t\t\t// Luego eliminamos del carrito\r\n\t\t\tconst result = await removeFromCart(id);\r\n\r\n\t\t\tif (result) {\r\n\t\t\t\tshowNotification(\r\n\t\t\t\t\tNotificationType.SUCCESS,\r\n\t\t\t\t\t\"Producto movido a favoritos\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"No se pudo mover el producto a favoritos\");\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error al mover a favoritos:\", error);\r\n\t\t\tshowNotification(\r\n\t\t\t\tNotificationType.ERROR,\r\n\t\t\t\t\"No se pudo mover el producto a favoritos\"\r\n\t\t\t);\r\n\t\t} finally {\r\n\t\t\tsetLoadingItem(null);\r\n\t\t}\r\n\t};\r\n\r\n\tconst applyCoupon = () => {\r\n\t\tif (couponCode.toLowerCase() === \"discount10\") {\r\n\t\t\tsetCouponApplied(true);\r\n\t\t\tsetCouponDiscount(10);\r\n\t\t\tshowNotification(NotificationType.SUCCESS, \"Cup√≥n aplicado exitosamente\");\r\n\t\t} else {\r\n\t\t\tshowNotification(NotificationType.ERROR, \"C√≥digo de cup√≥n inv√°lido\");\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleEmptyCart = async () => {\r\n\t\tif (loading) return;\r\n\r\n\t\ttry {\r\n\t\t\tconst result = await clearCart();\r\n\r\n\t\t\tif (result) {\r\n\t\t\t\tshowNotification(\r\n\t\t\t\t\tNotificationType.SUCCESS,\r\n\t\t\t\t\t\"Carrito vaciado exitosamente\"\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"No se pudo vaciar el carrito\");\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error al vaciar el carrito:\", error);\r\n\t\t\tshowNotification(NotificationType.ERROR, \"No se pudo vaciar el carrito\");\r\n\t\t}\r\n\t};\r\n\r\n\t// FUNCI√ìN CORREGIDA PARA OBTENER IMAGEN DEL PRODUCTO\r\n\tconst getProductImage = (product: any): string => {\r\n\t\tconsole.log(\"üé® CartPage - getProductImage:\", product);\r\n\t\t\r\n\t\tlet imagePath = \"\";\r\n\r\n\t\t// Prioridad 1: image\r\n\t\tif (product?.image) {\r\n\t\t\timagePath = product.image;\r\n\t\t}\r\n\t\t// Prioridad 2: main_image  \r\n\t\telse if (product?.main_image) {\r\n\t\t\timagePath = product.main_image;\r\n\t\t}\r\n\t\t// Prioridad 3: primer elemento de images array\r\n\t\telse if (product?.images && Array.isArray(product.images) && product.images.length > 0) {\r\n\t\t\tconst firstImage = product.images[0];\r\n\t\t\tif (typeof firstImage === 'string') {\r\n\t\t\t\timagePath = firstImage;\r\n\t\t\t} else if (typeof firstImage === 'object' && firstImage !== null) {\r\n\t\t\t\timagePath = firstImage.original || firstImage.medium || firstImage.thumbnail || \"\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconsole.log(\"üñºÔ∏è CartPage - Path extra√≠do:\", imagePath);\r\n\t\t\r\n\t\t// USAR EL HELPER CORREGIDO\r\n\t\tconst finalUrl = getImageUrl(imagePath);\r\n\t\tconsole.log(\"üîó CartPage - URL final:\", finalUrl);\r\n\t\t\r\n\t\treturn finalUrl;\r\n\t};\r\n\r\n\t// FUNCI√ìN SIMPLIFICADA PARA CALCULAR PRECIOS DE ITEM\r\n\tconst calculateItemPrices = (item: any): { original: number, discounted: number, discount: number, subtotal: number } => {\r\n\t\tconsole.log(\"üí∞ CartPage - Datos del item completo:\", item);\r\n\t\r\n\t// *** AGREG√Å ESTE DEBUG TEMPORAL ***\r\n\tconsole.log(\"üîç DEBUG - Item completo:\", JSON.stringify(item, null, 2));\r\n\tconsole.log(\"üîç DEBUG - Producto completo:\", JSON.stringify(item.product, null, 2));\r\n\r\n\t\t\r\n\t\t// Obtener precio original del item\r\n\t\tconst originalPrice = item.price || 0;\r\n\t\t\r\n\t\t// USAR DIRECTAMENTE final_price DE LA API - ESTA ES LA CORRECCI√ìN PRINCIPAL\r\n\t\tlet discountedPrice = originalPrice; // Por defecto usar precio original\r\n\t\tlet discountPercentage = 0;\r\n\t\t\r\n\t\tif (item.product) {\r\n\t\t\t// PRIORIDAD 1: usar final_price si existe (viene calculado desde la API)\r\n\t\t\tif (item.product.final_price !== undefined && item.product.final_price !== null) {\r\n\t\t\t\tdiscountedPrice = item.product.final_price;\r\n\t\t\t}\r\n\t\t\t// FALLBACK: si no hay final_price, calcular manualmente (caso raro)\r\n\t\t\telse {\r\n\t\t\t\tdiscountPercentage = item.product.discount_percentage || \r\n\t\t\t\t\t\t\t\t\titem.product.discountPercentage || \r\n\t\t\t\t\t\t\t\t\titem.product.discount || \r\n\t\t\t\t\t\t\t\t\t0;\r\n\t\t\t\tif (discountPercentage > 0) {\r\n\t\t\t\t\tdiscountedPrice = originalPrice - (originalPrice * (discountPercentage / 100));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Obtener porcentaje de descuento para mostrar en UI\r\n\t\t\tdiscountPercentage = item.product.discount_percentage || \r\n\t\t\t\t\t\t\t\titem.product.discountPercentage || \r\n\t\t\t\t\t\t\t\titem.product.discount || \r\n\t\t\t\t\t\t\t\t0;\r\n\t\t}\r\n\t\t\r\n\t\tconsole.log(\"üí∞ CartPage - Precio original:\", originalPrice);\r\n\t\tconsole.log(\"üí∞ CartPage - Precio con descuento (final_price):\", discountedPrice);\r\n\t\tconsole.log(\"üí∞ CartPage - Descuento %:\", discountPercentage);\r\n\t\tconsole.log(\"üí∞ CartPage - Cantidad:\", item.quantity);\r\n\t\t\r\n\t\t// CALCULAR SUBTOTAL usando el precio con descuento (final_price)\r\n\t\tconst subtotal = discountedPrice * item.quantity;\r\n\t\t\r\n\t\tconsole.log(\"üí∞ CartPage - Subtotal calculado:\", subtotal);\r\n\t\t\r\n\t\treturn {\r\n\t\t\toriginal: originalPrice,\r\n\t\t\tdiscounted: discountedPrice,\r\n\t\t\tdiscount: discountPercentage,\r\n\t\t\tsubtotal: subtotal\r\n\t\t};\r\n\t};\r\n\r\n\t// CALCULAR TOTALES DEL CARRITO\r\n\tconst calculateCartTotals = () => {\r\n\t\tif (!cart || !cart.items || cart.items.length === 0) {\r\n\t\t\treturn {\r\n\t\t\t\tsubtotal: 0,\r\n\t\t\t\ttax: 0,\r\n\t\t\t\tcouponAmount: 0,\r\n\t\t\t\ttotal: 0\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Calcular subtotal sumando todos los subtotales con descuento\r\n\t\tconst subtotal = cart.items.reduce((sum, item) => {\r\n\t\t\tconst itemPrices = calculateItemPrices(item);\r\n\t\t\treturn sum + itemPrices.subtotal;\r\n\t\t}, 0);\r\n\r\n\t\tconsole.log(\"üí∞ CartPage - Subtotal total del carrito:\", subtotal);\r\n\r\n\t\tconst taxRate = 0.15; // 15% IVA\r\n\t\tconst tax = subtotal * taxRate;\r\n\t\tconst couponAmount = couponApplied ? subtotal * (couponDiscount / 100) : 0;\r\n\t\tconst total = subtotal + tax - couponAmount;\r\n\r\n\t\tconsole.log(\"üí∞ CartPage - Totales finales:\", {\r\n\t\t\tsubtotal,\r\n\t\t\ttax,\r\n\t\t\tcouponAmount,\r\n\t\t\ttotal\r\n\t\t});\r\n\r\n\t\treturn {\r\n\t\t\tsubtotal,\r\n\t\t\ttax, \r\n\t\t\tcouponAmount,\r\n\t\t\ttotal\r\n\t\t};\r\n\t};\r\n\r\n\tconst { subtotal, tax, couponAmount, total } = calculateCartTotals();\r\n\r\n\t// Funci√≥n para proceder al checkout\r\n\tconst handleCheckout = () => {\r\n\t\tif (isEmpty) {\r\n\t\t\tshowNotification(\r\n\t\t\t\tNotificationType.ERROR,\r\n\t\t\t\t\"No hay productos en el carrito\"\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Redireccionar a la p√°gina de checkout\r\n\t\tnavigate(\"/checkout\");\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div className=\"container mx-auto px-4 lg:px-8 py-10\">\r\n\t\t\t<h1 className=\"text-3xl font-bold mb-8\">Mi Carrito</h1>\r\n\r\n\t\t\t{isLoading ? (\r\n\t\t\t\t<div className=\"flex justify-center items-center h-64\">\r\n\t\t\t\t\t<div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t) : isEmpty ? (\r\n\t\t\t\t<div className=\"text-center py-20 bg-gray-50 rounded-lg\">\r\n\t\t\t\t\t<ShoppingCart className=\"mx-auto h-16 w-16 text-gray-300 mb-6\" />\r\n\t\t\t\t\t<h2 className=\"text-2xl font-semibold text-gray-700 mb-3\">\r\n\t\t\t\t\t\tTu carrito est√° vac√≠o\r\n\t\t\t\t\t</h2>\r\n\t\t\t\t\t<p className=\"text-gray-500 mb-8 max-w-md mx-auto\">\r\n\t\t\t\t\t\tA√±ade productos a tu carrito para continuar comprando.\r\n\t\t\t\t\t</p>\r\n\t\t\t\t\t<Link\r\n\t\t\t\t\t\tto=\"/products\"\r\n\t\t\t\t\t\tclassName=\"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tExplorar productos\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t</div>\r\n\t\t\t) : (\r\n\t\t\t\t<div className=\"flex flex-col lg:flex-row gap-8\">\r\n\t\t\t\t\t{/* Lista de productos */}\r\n\t\t\t\t\t<div className=\"lg:w-2/3\">\r\n\t\t\t\t\t\t<div className=\"bg-white rounded-lg shadow-lg overflow-hidden mb-6\">\r\n\t\t\t\t\t\t\t{/* Encabezado */}\r\n\t\t\t\t\t\t\t<div className=\"hidden sm:grid sm:grid-cols-12 gap-4 p-5 bg-gray-50 border-b\">\r\n\t\t\t\t\t\t\t\t<div className=\"sm:col-span-6\">\r\n\t\t\t\t\t\t\t\t\t<span className=\"font-medium text-gray-800\">Producto</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"sm:col-span-2 text-center\">\r\n\t\t\t\t\t\t\t\t\t<span className=\"font-medium text-gray-800\">Precio</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"sm:col-span-2 text-center\">\r\n\t\t\t\t\t\t\t\t\t<span className=\"font-medium text-gray-800\">Cantidad</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"sm:col-span-2 text-center\">\r\n\t\t\t\t\t\t\t\t\t<span className=\"font-medium text-gray-800\">Total</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t{/* Productos */}\r\n\t\t\t\t\t\t\t{cart?.items.map((item) => {\r\n\t\t\t\t\t\t\t\t// CALCULAR PRECIOS USANDO LA FUNCI√ìN SIMPLIFICADA\r\n\t\t\t\t\t\t\t\tconst prices = calculateItemPrices(item);\r\n\r\n\t\t\t\t\t\t\t\tconsole.log(\"üõí CartPage - Renderizando item:\", {\r\n\t\t\t\t\t\t\t\t\titemId: item.id,\r\n\t\t\t\t\t\t\t\t\tprices\r\n\t\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\tkey={item.id}\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"border-b border-gray-200 last:border-b-0\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"grid sm:grid-cols-12 gap-4 p-5\">\r\n\t\t\t\t\t\t\t\t\t\t\t{/* Producto (imagen y nombre) - NAVEGACI√ìN CORREGIDA */}\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"sm:col-span-6 flex\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tto={`/products/${item.productId}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-24 h-24 flex-shrink-0\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsrc={getProductImage(item.product)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\talt={\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\titem.product?.name || `Producto ${item.productId}`\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"w-full h-full object-cover rounded\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"ml-4 flex flex-col\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tto={`/products/${item.productId}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"font-medium text-gray-800 hover:text-primary-600\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{item.product?.name || `Producto ${item.productId}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Mostrar descuento si existe */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{prices.discount > 0 && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"mt-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs bg-red-100 text-red-600 px-2 py-1 rounded\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{prices.discount}% OFF\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"mt-auto flex space-x-3 text-sm pt-3\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => handleRemoveFromCart(item.id)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={loadingItem === item.id}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-gray-500 hover:text-red-500 flex items-center disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 size={14} className=\"mr-1\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tEliminar\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmoveToWishlist(item.id, item.productId)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={loadingItem === item.id}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-gray-500 hover:text-primary-600 flex items-center disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Heart size={14} className=\"mr-1\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tGuardar\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t{/* Precio - MOSTRAR PRECIO CON DESCUENTO */}\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"sm:col-span-2 flex items-center justify-center sm:justify-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"sm:hidden mr-2 font-medium text-gray-800\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tPrecio:\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"font-medium flex flex-col items-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-800\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(prices.discounted)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{prices.discount > 0 && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-gray-500 line-through\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(prices.original)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t{/* Cantidad */}\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"sm:col-span-2 flex items-center justify-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"sm:hidden mr-2 font-medium text-gray-800\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tCantidad:\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center border border-gray-300 rounded-md\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => decreaseQuantity(item.id)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\titem.quantity <= 1 || loadingItem === item.id\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-2 py-1 text-gray-600 hover:text-gray-800 disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Minus size={14} />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"px-3 py-1 text-gray-800 text-center w-10\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{loadingItem === item.id ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"inline-block h-4 w-4 border-2 border-t-primary-600 border-r-primary-600 border-b-primary-200 border-l-primary-200 rounded-full animate-spin\"></span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\titem.quantity\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => increaseQuantity(item.id)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={loadingItem === item.id}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-2 py-1 text-gray-600 hover:text-gray-800 disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Plus size={14} />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t{/* Total - USAR SUBTOTAL CALCULADO CON DESCUENTO */}\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"sm:col-span-2 flex items-center justify-center sm:justify-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"sm:hidden mr-2 font-medium text-gray-800\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tTotal:\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-bold text-gray-800\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(prices.subtotal)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t})}\r\n\r\n\t\t\t\t\t\t\t{/* Botones de acci√≥n en la parte inferior */}\r\n\t\t\t\t\t\t\t<div className=\"flex justify-between items-center p-5 bg-gray-50\">\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\tonClick={handleEmptyCart}\r\n\t\t\t\t\t\t\t\t\tdisabled={isEmpty || loading}\r\n\t\t\t\t\t\t\t\t\tclassName=\"px-4 py-2 text-red-600 border border-red-200 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\tVaciar carrito\r\n\t\t\t\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t\t\t\t<div className=\"text-sm text-gray-600\">\r\n\t\t\t\t\t\t\t\t\t{itemCount} {itemCount === 1 ? \"producto\" : \"productos\"} en el\r\n\t\t\t\t\t\t\t\t\tcarrito\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t{/* Bot√≥n para continuar comprando */}\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\tto=\"/products\"\r\n\t\t\t\t\t\t\t\tclassName=\"inline-flex items-center text-primary-600 hover:text-primary-700\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<ArrowLeft size={18} className=\"mr-2\" />\r\n\t\t\t\t\t\t\t\tContinuar comprando\r\n\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Resumen del pedido - C√ÅLCULOS CORREGIDOS */}\r\n\t\t\t\t\t<div className=\"lg:w-1/3\">\r\n\t\t\t\t\t\t<div className=\"bg-white rounded-lg shadow-lg overflow-hidden\">\r\n\t\t\t\t\t\t\t<div className=\"p-6\">\r\n\t\t\t\t\t\t\t\t<h2 className=\"text-xl font-bold text-gray-800 mb-4\">\r\n\t\t\t\t\t\t\t\t\tResumen del pedido\r\n\t\t\t\t\t\t\t\t</h2>\r\n\r\n\t\t\t\t\t\t\t\t{/* Cup√≥n */}\r\n\t\t\t\t\t\t\t\t<div className=\"mb-6\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-center mb-2\">\r\n\t\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"C√≥digo de cup√≥n\"\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex-1 border border-gray-300 rounded-l-md py-3 px-4 focus:outline-none focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\t\t\t\t\t\tvalue={couponCode}\r\n\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => setCouponCode(e.target.value)}\r\n\t\t\t\t\t\t\t\t\t\t\tdisabled={couponApplied}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={applyCoupon}\r\n\t\t\t\t\t\t\t\t\t\t\tdisabled={couponApplied || !couponCode}\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"bg-primary-600 hover:bg-primary-700 text-white px-4 py-3 rounded-r-md disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\tAplicar\r\n\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t{couponApplied && (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-green-600 text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t\tCup√≥n aplicado: {couponDiscount}% de descuento\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t{/* C√°lculos */}\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-4 border-t border-gray-200 pt-4\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-600\">Subtotal (con descuentos)</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\r\n\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(subtotal)}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-600\">IVA (15%)</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">{formatCurrency(tax)}</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t{couponApplied && (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between text-green-600\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span>Descuento de cup√≥n</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span>-{formatCurrency(couponAmount)}</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between border-t border-gray-200 pt-4\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-xl font-bold\">Total</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-xl font-bold\">\r\n\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(total)}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t{/* Bot√≥n de checkout */}\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\tonClick={handleCheckout}\r\n\t\t\t\t\t\t\t\t\tdisabled={isEmpty || loading}\r\n\t\t\t\t\t\t\t\t\tclassName=\"mt-8 w-full bg-primary-600 hover:bg-primary-700 text-white font-medium py-3 px-4 rounded-md transition-colors disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\tProceder al pago\r\n\t\t\t\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t\t\t\t{/* Informaci√≥n adicional */}\r\n\t\t\t\t\t\t\t\t<div className=\"mt-4 text-xs text-gray-500\">\r\n\t\t\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t\t\tLos impuestos y gastos de env√≠o se calculan durante el\r\n\t\t\t\t\t\t\t\t\t\tproceso de pago.\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t<p className=\"mt-1\">\r\n\t\t\t\t\t\t\t\t\t\tAceptamos diversas formas de pago, incluyendo tarjetas de\r\n\t\t\t\t\t\t\t\t\t\tcr√©dito, transferencias bancarias y pago contra entrega.\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\r\n\t\t\t{/* Mostrar errores de la API */}\r\n\t\t\t{error && (\r\n\t\t\t\t<div className=\"mt-4 p-4 bg-red-50 text-red-700 rounded-lg\">\r\n\t\t\t\t\t<p className=\"font-medium\">Error: {error}</p>\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tonClick={() => fetchCart()}\r\n\t\t\t\t\t\tclassName=\"underline text-sm mt-1\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tReintentar cargar el carrito\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\r\n\t\t\t{/* Herramienta de depuraci√≥n de seller_id - solo en desarrollo */}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default CartPage;"],"names":["CartPage","isLoading","setIsLoading","useState","isEmpty","setIsEmpty","couponCode","setCouponCode","couponApplied","setCouponApplied","couponDiscount","setCouponDiscount","loadingItem","setLoadingItem","navigate","useNavigate","cart","loading","error","fetchCart","itemCount","removeFromCart","updateCartItem","clearCart","showNotification","useCart","toggleFavorite","useFavorites","useEffect","NotificationType","increaseQuantity","id","item","decreaseQuantity","handleRemoveFromCart","moveToWishlist","productId","applyCoupon","handleEmptyCart","getProductImage","product","imagePath","firstImage","finalUrl","getImageUrl","calculateItemPrices","originalPrice","discountedPrice","discountPercentage","subtotal","calculateCartTotals","sum","itemPrices","tax","couponAmount","total","handleCheckout","jsxs","jsx","ShoppingCart","Link","prices","Trash2","Heart","formatCurrency","Minus","Plus","ArrowLeft","e"],"mappings":"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"}