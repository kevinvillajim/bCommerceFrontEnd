import{r as g,L as ee,u as ur,a as mr}from"./react-vendor-Cy458wKG.js";import{j as s,R as W,X as ze,I as he,T as H,C as me,a as re,b as gr,c as ks,S as Ds,A as ut,d as mt,e as qe,M as hr,B as pr,f as ge,P as Us,g as Ss,U as os,D as is,h as _e,i as fr,k as Se,l as xr,F as ls,m as Hs,n as yr,o as ve,L as $s,p as br,q as gt,r as Ls,s as vr,E as ts,t as ht,u as Ws,v as Nr,w as jr,x as Ks,y as Sr,z as Er,G as Cr,H as Js,J as Ms,K as pt,N as Fs,O as Es,Q as de,V as wr,W as ft,Y as xt,Z as xs,_ as yt,$ as Ar,a0 as rs,a1 as _r,a2 as Tr,a3 as Pr}from"./ui-vendor-DEBjJ4HS.js";const Rr={development:{apiBaseUrl:"http://localhost:8000/api",imageBaseUrl:"http://localhost:8000/storage/",debug:!0},staging:{apiBaseUrl:"https://api.comersia.app/api",imageBaseUrl:"https://api.comersia.app/storage/",debug:!0},production:{apiBaseUrl:"https://api.comersia.app/api",imageBaseUrl:"https://api.comersia.app/storage/",debug:!1}},Ir="production",Cs=Rr[Ir],q={appName:"Comersia",api:{baseUrl:Cs.apiBaseUrl,timeout:3e4,retryAttempts:1},imageBaseUrl:Cs.imageBaseUrl,pagination:{defaultPageSize:12,pageSizes:[12,24,48,96]},cache:{productCacheTime:1e3*60*15,categoryCacheTime:1e3*60*60},storage:{authTokenKey:"auth_token",refreshTokenKey:"refresh_token",cartKey:"shopping_cart",userKey:"user_data",themeKey:"user_theme",languageKey:"app_language"},routes:{home:"/",login:"/login",register:"/register",products:"/products",productDetails:t=>`/products/${t}`,cart:"/cart",checkout:"/checkout",dashboard:"/dashboard",notFound:"/404",categories:"/categories",contact:"/contact",faq:"/faq",favorites:"/favorites"},fileUpload:{maxImageSize:2097152,allowedImageTypes:["image/jpeg","image/png","image/webp"],maxProductImages:5},validation:{minPasswordLength:8,maxProductNameLength:100,maxDescriptionLength:5e3}};function bt(t,e){return function(){return t.apply(e,arguments)}}const{toString:Or}=Object.prototype,{getPrototypeOf:zs}=Object,{iterator:cs,toStringTag:vt}=Symbol,ds=(t=>e=>{const r=Or.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),oe=t=>(t=t.toLowerCase(),e=>ds(e)===t),us=t=>e=>typeof e===t,{isArray:Te}=Array,Be=us("undefined");function kr(t){return t!==null&&!Be(t)&&t.constructor!==null&&!Be(t.constructor)&&se(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const Nt=oe("ArrayBuffer");function Dr(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Nt(t.buffer),e}const Ur=us("string"),se=us("function"),jt=us("number"),ms=t=>t!==null&&typeof t=="object",$r=t=>t===!0||t===!1,Qe=t=>{if(ds(t)!=="object")return!1;const e=zs(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(vt in t)&&!(cs in t)},Lr=oe("Date"),Mr=oe("File"),Fr=oe("Blob"),zr=oe("FileList"),Br=t=>ms(t)&&se(t.pipe),qr=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||se(t.append)&&((e=ds(t))==="formdata"||e==="object"&&se(t.toString)&&t.toString()==="[object FormData]"))},Vr=oe("URLSearchParams"),[Gr,Hr,Wr,Kr]=["ReadableStream","Request","Response","Headers"].map(oe),Jr=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ve(t,e,{allOwnKeys:r=!1}={}){if(t===null||typeof t>"u")return;let a,n;if(typeof t!="object"&&(t=[t]),Te(t))for(a=0,n=t.length;a<n;a++)e.call(null,t[a],a,t);else{const o=r?Object.getOwnPropertyNames(t):Object.keys(t),i=o.length;let d;for(a=0;a<i;a++)d=o[a],e.call(null,t[d],d,t)}}function St(t,e){e=e.toLowerCase();const r=Object.keys(t);let a=r.length,n;for(;a-- >0;)if(n=r[a],e===n.toLowerCase())return n;return null}const be=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Et=t=>!Be(t)&&t!==be;function ws(){const{caseless:t}=Et(this)&&this||{},e={},r=(a,n)=>{const o=t&&St(e,n)||n;Qe(e[o])&&Qe(a)?e[o]=ws(e[o],a):Qe(a)?e[o]=ws({},a):Te(a)?e[o]=a.slice():e[o]=a};for(let a=0,n=arguments.length;a<n;a++)arguments[a]&&Ve(arguments[a],r);return e}const Xr=(t,e,r,{allOwnKeys:a}={})=>(Ve(e,(n,o)=>{r&&se(n)?t[o]=bt(n,r):t[o]=n},{allOwnKeys:a}),t),Yr=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Zr=(t,e,r,a)=>{t.prototype=Object.create(e.prototype,a),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),r&&Object.assign(t.prototype,r)},Qr=(t,e,r,a)=>{let n,o,i;const d={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),o=n.length;o-- >0;)i=n[o],(!a||a(i,t,e))&&!d[i]&&(e[i]=t[i],d[i]=!0);t=r!==!1&&zs(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e},ea=(t,e,r)=>{t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;const a=t.indexOf(e,r);return a!==-1&&a===r},sa=t=>{if(!t)return null;if(Te(t))return t;let e=t.length;if(!jt(e))return null;const r=new Array(e);for(;e-- >0;)r[e]=t[e];return r},ta=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&zs(Uint8Array)),ra=(t,e)=>{const a=(t&&t[cs]).call(t);let n;for(;(n=a.next())&&!n.done;){const o=n.value;e.call(t,o[0],o[1])}},aa=(t,e)=>{let r;const a=[];for(;(r=t.exec(e))!==null;)a.push(r);return a},na=oe("HTMLFormElement"),oa=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,a,n){return a.toUpperCase()+n}),Xs=(({hasOwnProperty:t})=>(e,r)=>t.call(e,r))(Object.prototype),ia=oe("RegExp"),Ct=(t,e)=>{const r=Object.getOwnPropertyDescriptors(t),a={};Ve(r,(n,o)=>{let i;(i=e(n,o,t))!==!1&&(a[o]=i||n)}),Object.defineProperties(t,a)},la=t=>{Ct(t,(e,r)=>{if(se(t)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const a=t[r];if(se(a)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},ca=(t,e)=>{const r={},a=n=>{n.forEach(o=>{r[o]=!0})};return Te(t)?a(t):a(String(t).split(e)),r},da=()=>{},ua=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function ma(t){return!!(t&&se(t.append)&&t[vt]==="FormData"&&t[cs])}const ga=t=>{const e=new Array(10),r=(a,n)=>{if(ms(a)){if(e.indexOf(a)>=0)return;if(!("toJSON"in a)){e[n]=a;const o=Te(a)?[]:{};return Ve(a,(i,d)=>{const c=r(i,n+1);!Be(c)&&(o[d]=c)}),e[n]=void 0,o}}return a};return r(t,0)},ha=oe("AsyncFunction"),pa=t=>t&&(ms(t)||se(t))&&se(t.then)&&se(t.catch),wt=((t,e)=>t?setImmediate:e?((r,a)=>(be.addEventListener("message",({source:n,data:o})=>{n===be&&o===r&&a.length&&a.shift()()},!1),n=>{a.push(n),be.postMessage(r,"*")}))(`axios@${Math.random()}`,[]):r=>setTimeout(r))(typeof setImmediate=="function",se(be.postMessage)),fa=typeof queueMicrotask<"u"?queueMicrotask.bind(be):typeof process<"u"&&process.nextTick||wt,xa=t=>t!=null&&se(t[cs]),j={isArray:Te,isArrayBuffer:Nt,isBuffer:kr,isFormData:qr,isArrayBufferView:Dr,isString:Ur,isNumber:jt,isBoolean:$r,isObject:ms,isPlainObject:Qe,isReadableStream:Gr,isRequest:Hr,isResponse:Wr,isHeaders:Kr,isUndefined:Be,isDate:Lr,isFile:Mr,isBlob:Fr,isRegExp:ia,isFunction:se,isStream:Br,isURLSearchParams:Vr,isTypedArray:ta,isFileList:zr,forEach:Ve,merge:ws,extend:Xr,trim:Jr,stripBOM:Yr,inherits:Zr,toFlatObject:Qr,kindOf:ds,kindOfTest:oe,endsWith:ea,toArray:sa,forEachEntry:ra,matchAll:aa,isHTMLForm:na,hasOwnProperty:Xs,hasOwnProp:Xs,reduceDescriptors:Ct,freezeMethods:la,toObjectSet:ca,toCamelCase:oa,noop:da,toFiniteNumber:ua,findKey:St,global:be,isContextDefined:Et,isSpecCompliantForm:ma,toJSONObject:ga,isAsyncFn:ha,isThenable:pa,setImmediate:wt,asap:fa,isIterable:xa};function L(t,e,r,a,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),a&&(this.request=a),n&&(this.response=n,this.status=n.status?n.status:null)}j.inherits(L,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:j.toJSONObject(this.config),code:this.code,status:this.status}}});const At=L.prototype,_t={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{_t[t]={value:t}});Object.defineProperties(L,_t);Object.defineProperty(At,"isAxiosError",{value:!0});L.from=(t,e,r,a,n,o)=>{const i=Object.create(At);return j.toFlatObject(t,i,function(c){return c!==Error.prototype},d=>d!=="isAxiosError"),L.call(i,t.message,e,r,a,n),i.cause=t,i.name=t.name,o&&Object.assign(i,o),i};const ya=null;function As(t){return j.isPlainObject(t)||j.isArray(t)}function Tt(t){return j.endsWith(t,"[]")?t.slice(0,-2):t}function Ys(t,e,r){return t?t.concat(e).map(function(n,o){return n=Tt(n),!r&&o?"["+n+"]":n}).join(r?".":""):e}function ba(t){return j.isArray(t)&&!t.some(As)}const va=j.toFlatObject(j,{},null,function(e){return/^is[A-Z]/.test(e)});function gs(t,e,r){if(!j.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,r=j.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,x){return!j.isUndefined(x[S])});const a=r.metaTokens,n=r.visitor||h,o=r.dots,i=r.indexes,c=(r.Blob||typeof Blob<"u"&&Blob)&&j.isSpecCompliantForm(e);if(!j.isFunction(n))throw new TypeError("visitor must be a function");function p(l){if(l===null)return"";if(j.isDate(l))return l.toISOString();if(!c&&j.isBlob(l))throw new L("Blob is not supported. Use a Buffer instead.");return j.isArrayBuffer(l)||j.isTypedArray(l)?c&&typeof Blob=="function"?new Blob([l]):Buffer.from(l):l}function h(l,S,x){let N=l;if(l&&!x&&typeof l=="object"){if(j.endsWith(S,"{}"))S=a?S:S.slice(0,-2),l=JSON.stringify(l);else if(j.isArray(l)&&ba(l)||(j.isFileList(l)||j.endsWith(S,"[]"))&&(N=j.toArray(l)))return S=Tt(S),N.forEach(function(E,O){!(j.isUndefined(E)||E===null)&&e.append(i===!0?Ys([S],O,o):i===null?S:S+"[]",p(E))}),!1}return As(l)?!0:(e.append(Ys(x,S,o),p(l)),!1)}const v=[],f=Object.assign(va,{defaultVisitor:h,convertValue:p,isVisitable:As});function A(l,S){if(!j.isUndefined(l)){if(v.indexOf(l)!==-1)throw Error("Circular reference detected in "+S.join("."));v.push(l),j.forEach(l,function(N,w){(!(j.isUndefined(N)||N===null)&&n.call(e,N,j.isString(w)?w.trim():w,S,f))===!0&&A(N,S?S.concat(w):[w])}),v.pop()}}if(!j.isObject(t))throw new TypeError("data must be an object");return A(t),e}function Zs(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(a){return e[a]})}function Bs(t,e){this._pairs=[],t&&gs(t,this,e)}const Pt=Bs.prototype;Pt.append=function(e,r){this._pairs.push([e,r])};Pt.toString=function(e){const r=e?function(a){return e.call(this,a,Zs)}:Zs;return this._pairs.map(function(n){return r(n[0])+"="+r(n[1])},"").join("&")};function Na(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Rt(t,e,r){if(!e)return t;const a=r&&r.encode||Na;j.isFunction(r)&&(r={serialize:r});const n=r&&r.serialize;let o;if(n?o=n(e,r):o=j.isURLSearchParams(e)?e.toString():new Bs(e,r).toString(a),o){const i=t.indexOf("#");i!==-1&&(t=t.slice(0,i)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}class Qs{constructor(){this.handlers=[]}use(e,r,a){return this.handlers.push({fulfilled:e,rejected:r,synchronous:a?a.synchronous:!1,runWhen:a?a.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){j.forEach(this.handlers,function(a){a!==null&&e(a)})}}const It={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ja=typeof URLSearchParams<"u"?URLSearchParams:Bs,Sa=typeof FormData<"u"?FormData:null,Ea=typeof Blob<"u"?Blob:null,Ca={isBrowser:!0,classes:{URLSearchParams:ja,FormData:Sa,Blob:Ea},protocols:["http","https","file","blob","url","data"]},qs=typeof window<"u"&&typeof document<"u",_s=typeof navigator=="object"&&navigator||void 0,wa=qs&&(!_s||["ReactNative","NativeScript","NS"].indexOf(_s.product)<0),Aa=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",_a=qs&&window.location.href||"http://localhost",Ta=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:qs,hasStandardBrowserEnv:wa,hasStandardBrowserWebWorkerEnv:Aa,navigator:_s,origin:_a},Symbol.toStringTag,{value:"Module"})),X={...Ta,...Ca};function Pa(t,e){return gs(t,new X.classes.URLSearchParams,Object.assign({visitor:function(r,a,n,o){return X.isNode&&j.isBuffer(r)?(this.append(a,r.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function Ra(t){return j.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Ia(t){const e={},r=Object.keys(t);let a;const n=r.length;let o;for(a=0;a<n;a++)o=r[a],e[o]=t[o];return e}function Ot(t){function e(r,a,n,o){let i=r[o++];if(i==="__proto__")return!0;const d=Number.isFinite(+i),c=o>=r.length;return i=!i&&j.isArray(n)?n.length:i,c?(j.hasOwnProp(n,i)?n[i]=[n[i],a]:n[i]=a,!d):((!n[i]||!j.isObject(n[i]))&&(n[i]=[]),e(r,a,n[i],o)&&j.isArray(n[i])&&(n[i]=Ia(n[i])),!d)}if(j.isFormData(t)&&j.isFunction(t.entries)){const r={};return j.forEachEntry(t,(a,n)=>{e(Ra(a),n,r,0)}),r}return null}function Oa(t,e,r){if(j.isString(t))try{return(e||JSON.parse)(t),j.trim(t)}catch(a){if(a.name!=="SyntaxError")throw a}return(r||JSON.stringify)(t)}const Ge={transitional:It,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){const a=r.getContentType()||"",n=a.indexOf("application/json")>-1,o=j.isObject(e);if(o&&j.isHTMLForm(e)&&(e=new FormData(e)),j.isFormData(e))return n?JSON.stringify(Ot(e)):e;if(j.isArrayBuffer(e)||j.isBuffer(e)||j.isStream(e)||j.isFile(e)||j.isBlob(e)||j.isReadableStream(e))return e;if(j.isArrayBufferView(e))return e.buffer;if(j.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(o){if(a.indexOf("application/x-www-form-urlencoded")>-1)return Pa(e,this.formSerializer).toString();if((d=j.isFileList(e))||a.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return gs(d?{"files[]":e}:e,c&&new c,this.formSerializer)}}return o||n?(r.setContentType("application/json",!1),Oa(e)):e}],transformResponse:[function(e){const r=this.transitional||Ge.transitional,a=r&&r.forcedJSONParsing,n=this.responseType==="json";if(j.isResponse(e)||j.isReadableStream(e))return e;if(e&&j.isString(e)&&(a&&!this.responseType||n)){const i=!(r&&r.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(d){if(i)throw d.name==="SyntaxError"?L.from(d,L.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:X.classes.FormData,Blob:X.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};j.forEach(["delete","get","head","post","put","patch"],t=>{Ge.headers[t]={}});const ka=j.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Da=t=>{const e={};let r,a,n;return t&&t.split(`
`).forEach(function(i){n=i.indexOf(":"),r=i.substring(0,n).trim().toLowerCase(),a=i.substring(n+1).trim(),!(!r||e[r]&&ka[r])&&(r==="set-cookie"?e[r]?e[r].push(a):e[r]=[a]:e[r]=e[r]?e[r]+", "+a:a)}),e},et=Symbol("internals");function Le(t){return t&&String(t).trim().toLowerCase()}function es(t){return t===!1||t==null?t:j.isArray(t)?t.map(es):String(t)}function Ua(t){const e=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let a;for(;a=r.exec(t);)e[a[1]]=a[2];return e}const $a=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function ys(t,e,r,a,n){if(j.isFunction(a))return a.call(this,e,r);if(n&&(e=r),!!j.isString(e)){if(j.isString(a))return e.indexOf(a)!==-1;if(j.isRegExp(a))return a.test(e)}}function La(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,r,a)=>r.toUpperCase()+a)}function Ma(t,e){const r=j.toCamelCase(" "+e);["get","set","has"].forEach(a=>{Object.defineProperty(t,a+r,{value:function(n,o,i){return this[a].call(this,e,n,o,i)},configurable:!0})})}let te=class{constructor(e){e&&this.set(e)}set(e,r,a){const n=this;function o(d,c,p){const h=Le(c);if(!h)throw new Error("header name must be a non-empty string");const v=j.findKey(n,h);(!v||n[v]===void 0||p===!0||p===void 0&&n[v]!==!1)&&(n[v||c]=es(d))}const i=(d,c)=>j.forEach(d,(p,h)=>o(p,h,c));if(j.isPlainObject(e)||e instanceof this.constructor)i(e,r);else if(j.isString(e)&&(e=e.trim())&&!$a(e))i(Da(e),r);else if(j.isObject(e)&&j.isIterable(e)){let d={},c,p;for(const h of e){if(!j.isArray(h))throw TypeError("Object iterator must return a key-value pair");d[p=h[0]]=(c=d[p])?j.isArray(c)?[...c,h[1]]:[c,h[1]]:h[1]}i(d,r)}else e!=null&&o(r,e,a);return this}get(e,r){if(e=Le(e),e){const a=j.findKey(this,e);if(a){const n=this[a];if(!r)return n;if(r===!0)return Ua(n);if(j.isFunction(r))return r.call(this,n,a);if(j.isRegExp(r))return r.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,r){if(e=Le(e),e){const a=j.findKey(this,e);return!!(a&&this[a]!==void 0&&(!r||ys(this,this[a],a,r)))}return!1}delete(e,r){const a=this;let n=!1;function o(i){if(i=Le(i),i){const d=j.findKey(a,i);d&&(!r||ys(a,a[d],d,r))&&(delete a[d],n=!0)}}return j.isArray(e)?e.forEach(o):o(e),n}clear(e){const r=Object.keys(this);let a=r.length,n=!1;for(;a--;){const o=r[a];(!e||ys(this,this[o],o,e,!0))&&(delete this[o],n=!0)}return n}normalize(e){const r=this,a={};return j.forEach(this,(n,o)=>{const i=j.findKey(a,o);if(i){r[i]=es(n),delete r[o];return}const d=e?La(o):String(o).trim();d!==o&&delete r[o],r[d]=es(n),a[d]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const r=Object.create(null);return j.forEach(this,(a,n)=>{a!=null&&a!==!1&&(r[n]=e&&j.isArray(a)?a.join(", "):a)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,r])=>e+": "+r).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...r){const a=new this(e);return r.forEach(n=>a.set(n)),a}static accessor(e){const a=(this[et]=this[et]={accessors:{}}).accessors,n=this.prototype;function o(i){const d=Le(i);a[d]||(Ma(n,i),a[d]=!0)}return j.isArray(e)?e.forEach(o):o(e),this}};te.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);j.reduceDescriptors(te.prototype,({value:t},e)=>{let r=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(a){this[r]=a}}});j.freezeMethods(te);function bs(t,e){const r=this||Ge,a=e||r,n=te.from(a.headers);let o=a.data;return j.forEach(t,function(d){o=d.call(r,o,n.normalize(),e?e.status:void 0)}),n.normalize(),o}function kt(t){return!!(t&&t.__CANCEL__)}function Pe(t,e,r){L.call(this,t??"canceled",L.ERR_CANCELED,e,r),this.name="CanceledError"}j.inherits(Pe,L,{__CANCEL__:!0});function Dt(t,e,r){const a=r.config.validateStatus;!r.status||!a||a(r.status)?t(r):e(new L("Request failed with status code "+r.status,[L.ERR_BAD_REQUEST,L.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}function Fa(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function za(t,e){t=t||10;const r=new Array(t),a=new Array(t);let n=0,o=0,i;return e=e!==void 0?e:1e3,function(c){const p=Date.now(),h=a[o];i||(i=p),r[n]=c,a[n]=p;let v=o,f=0;for(;v!==n;)f+=r[v++],v=v%t;if(n=(n+1)%t,n===o&&(o=(o+1)%t),p-i<e)return;const A=h&&p-h;return A?Math.round(f*1e3/A):void 0}}function Ba(t,e){let r=0,a=1e3/e,n,o;const i=(p,h=Date.now())=>{r=h,n=null,o&&(clearTimeout(o),o=null),t.apply(null,p)};return[(...p)=>{const h=Date.now(),v=h-r;v>=a?i(p,h):(n=p,o||(o=setTimeout(()=>{o=null,i(n)},a-v)))},()=>n&&i(n)]}const as=(t,e,r=3)=>{let a=0;const n=za(50,250);return Ba(o=>{const i=o.loaded,d=o.lengthComputable?o.total:void 0,c=i-a,p=n(c),h=i<=d;a=i;const v={loaded:i,total:d,progress:d?i/d:void 0,bytes:c,rate:p||void 0,estimated:p&&d&&h?(d-i)/p:void 0,event:o,lengthComputable:d!=null,[e?"download":"upload"]:!0};t(v)},r)},st=(t,e)=>{const r=t!=null;return[a=>e[0]({lengthComputable:r,total:t,loaded:a}),e[1]]},tt=t=>(...e)=>j.asap(()=>t(...e)),qa=X.hasStandardBrowserEnv?((t,e)=>r=>(r=new URL(r,X.origin),t.protocol===r.protocol&&t.host===r.host&&(e||t.port===r.port)))(new URL(X.origin),X.navigator&&/(msie|trident)/i.test(X.navigator.userAgent)):()=>!0,Va=X.hasStandardBrowserEnv?{write(t,e,r,a,n,o){const i=[t+"="+encodeURIComponent(e)];j.isNumber(r)&&i.push("expires="+new Date(r).toGMTString()),j.isString(a)&&i.push("path="+a),j.isString(n)&&i.push("domain="+n),o===!0&&i.push("secure"),document.cookie=i.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Ga(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Ha(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Ut(t,e,r){let a=!Ga(e);return t&&(a||r==!1)?Ha(t,e):e}const rt=t=>t instanceof te?{...t}:t;function je(t,e){e=e||{};const r={};function a(p,h,v,f){return j.isPlainObject(p)&&j.isPlainObject(h)?j.merge.call({caseless:f},p,h):j.isPlainObject(h)?j.merge({},h):j.isArray(h)?h.slice():h}function n(p,h,v,f){if(j.isUndefined(h)){if(!j.isUndefined(p))return a(void 0,p,v,f)}else return a(p,h,v,f)}function o(p,h){if(!j.isUndefined(h))return a(void 0,h)}function i(p,h){if(j.isUndefined(h)){if(!j.isUndefined(p))return a(void 0,p)}else return a(void 0,h)}function d(p,h,v){if(v in e)return a(p,h);if(v in t)return a(void 0,p)}const c={url:o,method:o,data:o,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:d,headers:(p,h,v)=>n(rt(p),rt(h),v,!0)};return j.forEach(Object.keys(Object.assign({},t,e)),function(h){const v=c[h]||n,f=v(t[h],e[h],h);j.isUndefined(f)&&v!==d||(r[h]=f)}),r}const $t=t=>{const e=je({},t);let{data:r,withXSRFToken:a,xsrfHeaderName:n,xsrfCookieName:o,headers:i,auth:d}=e;e.headers=i=te.from(i),e.url=Rt(Ut(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),d&&i.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):"")));let c;if(j.isFormData(r)){if(X.hasStandardBrowserEnv||X.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((c=i.getContentType())!==!1){const[p,...h]=c?c.split(";").map(v=>v.trim()).filter(Boolean):[];i.setContentType([p||"multipart/form-data",...h].join("; "))}}if(X.hasStandardBrowserEnv&&(a&&j.isFunction(a)&&(a=a(e)),a||a!==!1&&qa(e.url))){const p=n&&o&&Va.read(o);p&&i.set(n,p)}return e},Wa=typeof XMLHttpRequest<"u",Ka=Wa&&function(t){return new Promise(function(r,a){const n=$t(t);let o=n.data;const i=te.from(n.headers).normalize();let{responseType:d,onUploadProgress:c,onDownloadProgress:p}=n,h,v,f,A,l;function S(){A&&A(),l&&l(),n.cancelToken&&n.cancelToken.unsubscribe(h),n.signal&&n.signal.removeEventListener("abort",h)}let x=new XMLHttpRequest;x.open(n.method.toUpperCase(),n.url,!0),x.timeout=n.timeout;function N(){if(!x)return;const E=te.from("getAllResponseHeaders"in x&&x.getAllResponseHeaders()),b={data:!d||d==="text"||d==="json"?x.responseText:x.response,status:x.status,statusText:x.statusText,headers:E,config:t,request:x};Dt(function(u){r(u),S()},function(u){a(u),S()},b),x=null}"onloadend"in x?x.onloadend=N:x.onreadystatechange=function(){!x||x.readyState!==4||x.status===0&&!(x.responseURL&&x.responseURL.indexOf("file:")===0)||setTimeout(N)},x.onabort=function(){x&&(a(new L("Request aborted",L.ECONNABORTED,t,x)),x=null)},x.onerror=function(){a(new L("Network Error",L.ERR_NETWORK,t,x)),x=null},x.ontimeout=function(){let O=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const b=n.transitional||It;n.timeoutErrorMessage&&(O=n.timeoutErrorMessage),a(new L(O,b.clarifyTimeoutError?L.ETIMEDOUT:L.ECONNABORTED,t,x)),x=null},o===void 0&&i.setContentType(null),"setRequestHeader"in x&&j.forEach(i.toJSON(),function(O,b){x.setRequestHeader(b,O)}),j.isUndefined(n.withCredentials)||(x.withCredentials=!!n.withCredentials),d&&d!=="json"&&(x.responseType=n.responseType),p&&([f,l]=as(p,!0),x.addEventListener("progress",f)),c&&x.upload&&([v,A]=as(c),x.upload.addEventListener("progress",v),x.upload.addEventListener("loadend",A)),(n.cancelToken||n.signal)&&(h=E=>{x&&(a(!E||E.type?new Pe(null,t,x):E),x.abort(),x=null)},n.cancelToken&&n.cancelToken.subscribe(h),n.signal&&(n.signal.aborted?h():n.signal.addEventListener("abort",h)));const w=Fa(n.url);if(w&&X.protocols.indexOf(w)===-1){a(new L("Unsupported protocol "+w+":",L.ERR_BAD_REQUEST,t));return}x.send(o||null)})},Ja=(t,e)=>{const{length:r}=t=t?t.filter(Boolean):[];if(e||r){let a=new AbortController,n;const o=function(p){if(!n){n=!0,d();const h=p instanceof Error?p:this.reason;a.abort(h instanceof L?h:new Pe(h instanceof Error?h.message:h))}};let i=e&&setTimeout(()=>{i=null,o(new L(`timeout ${e} of ms exceeded`,L.ETIMEDOUT))},e);const d=()=>{t&&(i&&clearTimeout(i),i=null,t.forEach(p=>{p.unsubscribe?p.unsubscribe(o):p.removeEventListener("abort",o)}),t=null)};t.forEach(p=>p.addEventListener("abort",o));const{signal:c}=a;return c.unsubscribe=()=>j.asap(d),c}},Xa=function*(t,e){let r=t.byteLength;if(r<e){yield t;return}let a=0,n;for(;a<r;)n=a+e,yield t.slice(a,n),a=n},Ya=async function*(t,e){for await(const r of Za(t))yield*Xa(r,e)},Za=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:r,value:a}=await e.read();if(r)break;yield a}}finally{await e.cancel()}},at=(t,e,r,a)=>{const n=Ya(t,e);let o=0,i,d=c=>{i||(i=!0,a&&a(c))};return new ReadableStream({async pull(c){try{const{done:p,value:h}=await n.next();if(p){d(),c.close();return}let v=h.byteLength;if(r){let f=o+=v;r(f)}c.enqueue(new Uint8Array(h))}catch(p){throw d(p),p}},cancel(c){return d(c),n.return()}},{highWaterMark:2})},hs=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Lt=hs&&typeof ReadableStream=="function",Qa=hs&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),Mt=(t,...e)=>{try{return!!t(...e)}catch{return!1}},en=Lt&&Mt(()=>{let t=!1;const e=new Request(X.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),nt=64*1024,Ts=Lt&&Mt(()=>j.isReadableStream(new Response("").body)),ns={stream:Ts&&(t=>t.body)};hs&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!ns[e]&&(ns[e]=j.isFunction(t[e])?r=>r[e]():(r,a)=>{throw new L(`Response type '${e}' is not supported`,L.ERR_NOT_SUPPORT,a)})})})(new Response);const sn=async t=>{if(t==null)return 0;if(j.isBlob(t))return t.size;if(j.isSpecCompliantForm(t))return(await new Request(X.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(j.isArrayBufferView(t)||j.isArrayBuffer(t))return t.byteLength;if(j.isURLSearchParams(t)&&(t=t+""),j.isString(t))return(await Qa(t)).byteLength},tn=async(t,e)=>{const r=j.toFiniteNumber(t.getContentLength());return r??sn(e)},rn=hs&&(async t=>{let{url:e,method:r,data:a,signal:n,cancelToken:o,timeout:i,onDownloadProgress:d,onUploadProgress:c,responseType:p,headers:h,withCredentials:v="same-origin",fetchOptions:f}=$t(t);p=p?(p+"").toLowerCase():"text";let A=Ja([n,o&&o.toAbortSignal()],i),l;const S=A&&A.unsubscribe&&(()=>{A.unsubscribe()});let x;try{if(c&&en&&r!=="get"&&r!=="head"&&(x=await tn(h,a))!==0){let b=new Request(e,{method:"POST",body:a,duplex:"half"}),_;if(j.isFormData(a)&&(_=b.headers.get("content-type"))&&h.setContentType(_),b.body){const[u,y]=st(x,as(tt(c)));a=at(b.body,nt,u,y)}}j.isString(v)||(v=v?"include":"omit");const N="credentials"in Request.prototype;l=new Request(e,{...f,signal:A,method:r.toUpperCase(),headers:h.normalize().toJSON(),body:a,duplex:"half",credentials:N?v:void 0});let w=await fetch(l);const E=Ts&&(p==="stream"||p==="response");if(Ts&&(d||E&&S)){const b={};["status","statusText","headers"].forEach(m=>{b[m]=w[m]});const _=j.toFiniteNumber(w.headers.get("content-length")),[u,y]=d&&st(_,as(tt(d),!0))||[];w=new Response(at(w.body,nt,u,()=>{y&&y(),S&&S()}),b)}p=p||"text";let O=await ns[j.findKey(ns,p)||"text"](w,t);return!E&&S&&S(),await new Promise((b,_)=>{Dt(b,_,{data:O,headers:te.from(w.headers),status:w.status,statusText:w.statusText,config:t,request:l})})}catch(N){throw S&&S(),N&&N.name==="TypeError"&&/Load failed|fetch/i.test(N.message)?Object.assign(new L("Network Error",L.ERR_NETWORK,t,l),{cause:N.cause||N}):L.from(N,N&&N.code,t,l)}}),Ps={http:ya,xhr:Ka,fetch:rn};j.forEach(Ps,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const ot=t=>`- ${t}`,an=t=>j.isFunction(t)||t===null||t===!1,Ft={getAdapter:t=>{t=j.isArray(t)?t:[t];const{length:e}=t;let r,a;const n={};for(let o=0;o<e;o++){r=t[o];let i;if(a=r,!an(r)&&(a=Ps[(i=String(r)).toLowerCase()],a===void 0))throw new L(`Unknown adapter '${i}'`);if(a)break;n[i||"#"+o]=a}if(!a){const o=Object.entries(n).map(([d,c])=>`adapter ${d} `+(c===!1?"is not supported by the environment":"is not available in the build"));let i=e?o.length>1?`since :
`+o.map(ot).join(`
`):" "+ot(o[0]):"as no adapter specified";throw new L("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return a},adapters:Ps};function vs(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Pe(null,t)}function it(t){return vs(t),t.headers=te.from(t.headers),t.data=bs.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Ft.getAdapter(t.adapter||Ge.adapter)(t).then(function(a){return vs(t),a.data=bs.call(t,t.transformResponse,a),a.headers=te.from(a.headers),a},function(a){return kt(a)||(vs(t),a&&a.response&&(a.response.data=bs.call(t,t.transformResponse,a.response),a.response.headers=te.from(a.response.headers))),Promise.reject(a)})}const zt="1.9.0",ps={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{ps[t]=function(a){return typeof a===t||"a"+(e<1?"n ":" ")+t}});const lt={};ps.transitional=function(e,r,a){function n(o,i){return"[Axios v"+zt+"] Transitional option '"+o+"'"+i+(a?". "+a:"")}return(o,i,d)=>{if(e===!1)throw new L(n(i," has been removed"+(r?" in "+r:"")),L.ERR_DEPRECATED);return r&&!lt[i]&&(lt[i]=!0,console.warn(n(i," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(o,i,d):!0}};ps.spelling=function(e){return(r,a)=>(console.warn(`${a} is likely a misspelling of ${e}`),!0)};function nn(t,e,r){if(typeof t!="object")throw new L("options must be an object",L.ERR_BAD_OPTION_VALUE);const a=Object.keys(t);let n=a.length;for(;n-- >0;){const o=a[n],i=e[o];if(i){const d=t[o],c=d===void 0||i(d,o,t);if(c!==!0)throw new L("option "+o+" must be "+c,L.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new L("Unknown option "+o,L.ERR_BAD_OPTION)}}const ss={assertOptions:nn,validators:ps},ie=ss.validators;let Ne=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Qs,response:new Qs}}async request(e,r){try{return await this._request(e,r)}catch(a){if(a instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const o=n.stack?n.stack.replace(/^.+\n/,""):"";try{a.stack?o&&!String(a.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(a.stack+=`
`+o):a.stack=o}catch{}}throw a}}_request(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=je(this.defaults,r);const{transitional:a,paramsSerializer:n,headers:o}=r;a!==void 0&&ss.assertOptions(a,{silentJSONParsing:ie.transitional(ie.boolean),forcedJSONParsing:ie.transitional(ie.boolean),clarifyTimeoutError:ie.transitional(ie.boolean)},!1),n!=null&&(j.isFunction(n)?r.paramsSerializer={serialize:n}:ss.assertOptions(n,{encode:ie.function,serialize:ie.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),ss.assertOptions(r,{baseUrl:ie.spelling("baseURL"),withXsrfToken:ie.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let i=o&&j.merge(o.common,o[r.method]);o&&j.forEach(["delete","get","head","post","put","patch","common"],l=>{delete o[l]}),r.headers=te.concat(i,o);const d=[];let c=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(r)===!1||(c=c&&S.synchronous,d.unshift(S.fulfilled,S.rejected))});const p=[];this.interceptors.response.forEach(function(S){p.push(S.fulfilled,S.rejected)});let h,v=0,f;if(!c){const l=[it.bind(this),void 0];for(l.unshift.apply(l,d),l.push.apply(l,p),f=l.length,h=Promise.resolve(r);v<f;)h=h.then(l[v++],l[v++]);return h}f=d.length;let A=r;for(v=0;v<f;){const l=d[v++],S=d[v++];try{A=l(A)}catch(x){S.call(this,x);break}}try{h=it.call(this,A)}catch(l){return Promise.reject(l)}for(v=0,f=p.length;v<f;)h=h.then(p[v++],p[v++]);return h}getUri(e){e=je(this.defaults,e);const r=Ut(e.baseURL,e.url,e.allowAbsoluteUrls);return Rt(r,e.params,e.paramsSerializer)}};j.forEach(["delete","get","head","options"],function(e){Ne.prototype[e]=function(r,a){return this.request(je(a||{},{method:e,url:r,data:(a||{}).data}))}});j.forEach(["post","put","patch"],function(e){function r(a){return function(o,i,d){return this.request(je(d||{},{method:e,headers:a?{"Content-Type":"multipart/form-data"}:{},url:o,data:i}))}}Ne.prototype[e]=r(),Ne.prototype[e+"Form"]=r(!0)});let on=class Bt{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(o){r=o});const a=this;this.promise.then(n=>{if(!a._listeners)return;let o=a._listeners.length;for(;o-- >0;)a._listeners[o](n);a._listeners=null}),this.promise.then=n=>{let o;const i=new Promise(d=>{a.subscribe(d),o=d}).then(n);return i.cancel=function(){a.unsubscribe(o)},i},e(function(o,i,d){a.reason||(a.reason=new Pe(o,i,d),r(a.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){const e=new AbortController,r=a=>{e.abort(a)};return this.subscribe(r),e.signal.unsubscribe=()=>this.unsubscribe(r),e.signal}static source(){let e;return{token:new Bt(function(n){e=n}),cancel:e}}};function ln(t){return function(r){return t.apply(null,r)}}function cn(t){return j.isObject(t)&&t.isAxiosError===!0}const Rs={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Rs).forEach(([t,e])=>{Rs[e]=t});function qt(t){const e=new Ne(t),r=bt(Ne.prototype.request,e);return j.extend(r,Ne.prototype,e,{allOwnKeys:!0}),j.extend(r,e,null,{allOwnKeys:!0}),r.create=function(n){return qt(je(t,n))},r}const z=qt(Ge);z.Axios=Ne;z.CanceledError=Pe;z.CancelToken=on;z.isCancel=kt;z.VERSION=zt;z.toFormData=gs;z.AxiosError=L;z.Cancel=z.CanceledError;z.all=function(e){return Promise.all(e)};z.spread=ln;z.isAxiosError=cn;z.mergeConfig=je;z.AxiosHeaders=te;z.formToJSON=t=>Ot(j.isHTMLForm(t)?new FormData(t):t);z.getAdapter=Ft.getAdapter;z.HttpStatusCode=Rs;z.default=z;const{Axios:Vo,AxiosError:Go,CanceledError:Ho,isCancel:Wo,CancelToken:Ko,VERSION:Jo,all:Xo,Cancel:Yo,isAxiosError:Zo,spread:Qo,toFormData:ei,AxiosHeaders:si,HttpStatusCode:ti,formToJSON:ri,getAdapter:ai,mergeConfig:ni}=z;let Ye=!1,Is=[],Fe=null;const oi=t=>{Fe=t},dn=t=>{Is.push(t)},un=t=>{Is.forEach(e=>e(t)),Is=[]},G=z.create({baseURL:q.api.baseUrl,timeout:q.api.timeout,headers:{"Content-Type":"application/json",Accept:"application/json"}});G.interceptors.request.use(t=>{if(t.url?.includes("/auth/refresh")||t.url?.includes("/auth/login"))return t;const e=localStorage.getItem(q.storage.authTokenKey);return e&&t.headers&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));G.interceptors.response.use(t=>{const e=t.headers["x-session-timeout"],r=t.headers["x-session-expires"];return e&&(localStorage.setItem("session_timeout_seconds",e),console.log("🔄 Session timeout actualizado desde headers:",e+"s")),r&&(localStorage.setItem("session_expires_at",r),console.log("🔄 Session expires_at actualizado desde headers:",r)),t},async t=>{const e=t.config;if(t.response?.status===401&&!e._retry&&!0){if(Ye)return new Promise(a=>{dn(n=>{e.headers&&(e.headers.Authorization=`Bearer ${n}`),a(G(e))})});e._retry=!0,Ye=!0;try{const a=localStorage.getItem(q.storage.refreshTokenKey);if(!a)throw new Error("No refresh token available");const n=await z.post(`${q.api.baseUrl}/auth/refresh`,{},{headers:{Authorization:`Bearer ${a}`}});if(n.data?.access_token){const o=n.data.access_token;return localStorage.setItem(q.storage.authTokenKey,o),G.defaults.headers.common.Authorization=`Bearer ${o}`,un(o),e.headers&&(e.headers.Authorization=`Bearer ${o}`),Ye=!1,G(e)}else throw new Error("No access token in refresh response")}catch(a){Ye=!1,Fe?(console.log("🧹 Utilizando limpieza completa de sesión por expiración automática"),Fe()):(console.log("⚠️ Usando limpieza básica de sesión (fallback)"),localStorage.removeItem(q.storage.authTokenKey),localStorage.removeItem(q.storage.refreshTokenKey),localStorage.removeItem(q.storage.userKey),localStorage.removeItem(q.storage.cartKey));const n=`${q.routes.login}?sessionExpired=true`;return console.log("🚪 Redirigiendo a login por sesión expirada:",n),window.location.replace(n),Promise.reject(a)}}else if(t.response?.status===401&&!e._retry){console.log("🚨 Token expired and auto-refresh disabled - clearing session"),Fe?(console.log("🧹 Using complete session cleanup"),Fe()):(console.log("⚠️ Using basic session cleanup (fallback)"),localStorage.removeItem(q.storage.authTokenKey),localStorage.removeItem(q.storage.refreshTokenKey),localStorage.removeItem(q.storage.userKey),localStorage.removeItem(q.storage.cartKey));const a=`${q.routes.login}?sessionExpired=true`;return console.log("🚪 Redirecting to login due to expired session:",a),window.location.replace(a),Promise.reject(t)}return Promise.reject(t)});class ce{static PREFIX="cache_";static MAX_CACHE_SIZE=50;static setItem(e,r,a){try{const n={value:r,expiry:Date.now()+a,created:Date.now()},o=this.PREFIX+e;localStorage.setItem(o,JSON.stringify(n)),this.cleanupIfNeeded(),console.log(`💾 Cache guardado: ${e} (expira en ${Math.round(a/1e3)}s)`)}catch(n){console.error("Error al guardar en caché:",n),this.clearExpired();try{const o=this.PREFIX+e;localStorage.setItem(o,JSON.stringify({value:r,expiry:Date.now()+a,created:Date.now()}))}catch(o){console.error("Error al guardar en caché después de limpiar:",o)}}}static getItem(e){try{const r=this.PREFIX+e,a=localStorage.getItem(r);if(!a)return null;const n=JSON.parse(a);return Date.now()>n.expiry?(console.log(`🗑️ Cache expirado removido: ${e}`),localStorage.removeItem(r),null):(console.log(`✅ Cache hit: ${e}`),n.value)}catch(r){console.error("Error al recuperar de caché:",r);try{const a=this.PREFIX+e;localStorage.removeItem(a)}catch(a){console.error("Error al remover item corrupto:",a)}return null}}static removeItem(e){try{const r=this.PREFIX+e;localStorage.removeItem(r),console.log(`🗑️ Cache removido: ${e}`)}catch(r){console.error("Error al eliminar de caché:",r)}}static hasValidItem(e){return this.getItem(e)!==null}static getMultiple(e){const r={};return e.forEach(a=>{const n=this.getItem(a);n!==null&&(r[a]=n)}),r}static setMultiple(e,r){Object.entries(e).forEach(([a,n])=>{this.setItem(a,n,r)})}static clearExpired(){try{const e=Date.now(),r=[];for(let a=0;a<localStorage.length;a++){const n=localStorage.key(a);if(n&&n.startsWith(this.PREFIX))try{const o=localStorage.getItem(n);if(o){const i=JSON.parse(o);e>i.expiry&&r.push(n)}}catch{r.push(n)}}r.forEach(a=>{localStorage.removeItem(a)}),r.length>0&&console.log(`🗑️ Cache: ${r.length} elementos expirados eliminados`)}catch(e){console.error("Error al limpiar cache expirado:",e)}}static clearAll(){try{const e=[];for(let r=0;r<localStorage.length;r++){const a=localStorage.key(r);a&&a.startsWith(this.PREFIX)&&e.push(a)}e.forEach(r=>{localStorage.removeItem(r)}),console.log(`🗑️ Cache: ${e.length} elementos eliminados completamente`)}catch(e){console.error("Error al limpiar todo el cache:",e)}}static getStats(){try{const e=Date.now();let r=0,a=0,n=0,o=0;for(let i=0;i<localStorage.length;i++){const d=localStorage.key(i);if(d&&d.startsWith(this.PREFIX)){r++;const c=localStorage.getItem(d);if(c){o+=c.length;try{const p=JSON.parse(c);e>p.expiry?a++:n++}catch{a++}}}}return{total:r,expired:a,active:n,totalSize:o}}catch(e){return console.error("Error al obtener estadísticas del cache:",e),{total:0,expired:0,active:0,totalSize:0}}}static cleanupIfNeeded(){try{this.getStats().total>this.MAX_CACHE_SIZE&&(this.clearExpired(),this.getStats().active>this.MAX_CACHE_SIZE*.8&&this.clearOldest(Math.floor(this.MAX_CACHE_SIZE*.2)))}catch(e){console.error("Error en limpieza automática del cache:",e)}}static clearOldest(e){try{const r=[];for(let n=0;n<localStorage.length;n++){const o=localStorage.key(n);if(o&&o.startsWith(this.PREFIX))try{const i=localStorage.getItem(o);if(i){const d=JSON.parse(i);r.push({key:o,created:d.created||0})}}catch{r.push({key:o,created:0})}}r.sort((n,o)=>n.created-o.created);const a=r.slice(0,e);a.forEach(n=>{localStorage.removeItem(n.key)}),a.length>0&&console.log(`🗑️ Cache: ${a.length} elementos antiguos eliminados`)}catch(r){console.error("Error al eliminar elementos antiguos del cache:",r)}}static debug(){const e=this.getStats();console.group("📊 Cache Debug Info"),console.log("Estadísticas:",e);const r=[];for(let a=0;a<localStorage.length;a++){const n=localStorage.key(a);if(n&&n.startsWith(this.PREFIX))try{const o=localStorage.getItem(n);if(o){const i=JSON.parse(o);r.push({key:n.replace(this.PREFIX,""),expiry:i.expiry,size:o.length})}}catch{r.push({key:n.replace(this.PREFIX,""),expiry:0,size:0})}}console.table(r),console.groupEnd()}}const D={AUTH:{LOGIN:"/auth/login",LOGOUT:"/auth/logout",REFRESH:"/auth/refresh",REGISTER:"/auth/register",FORGOT_PASSWORD_EMAIL:"/auth/forgot-password-email",FORGOT_PASSWORD_TOKEN:"/auth/forgot-password-token",RESET_PASSWORD:"/auth/reset-password",VALIDATE_RESET_TOKEN:"/auth/reset-password/validate",ME:"/auth/me",UPDATE_PASSWORD:"/auth/password/update",VERIFY_EMAIL:(t,e)=>`/email/verify/${t}/${e}`,VERIFY_EMAIL_TOKEN:"/email-verification/verify",RESEND_VERIFICATION:"/email-verification/resend",VERIFICATION_STATUS:"/email-verification/status",CHECK_ROLE:"/user/check-role",PASSWORD_VALIDATION_RULES:"/auth/password-validation-rules"},PROFILE:{LIST:"/profile",UPDATE:"/profile",GET:"/profile",CHANGE_PASSWORD:"/profile/change-password",UPLOAD_AVATAR:"/profile/upload-avatar"},USER:{ORDERS:"/user/orders",ORDER_DETAILS:t=>`/user/orders/${t}`,ORDER_STATS:"/user/orders/stats",REORDER:t=>`/user/orders/${t}/reorder`,CONFIRM_RECEPTION:t=>`/user/orders/${t}/confirm-reception`},HEADER_COUNTERS:"/user/header-counters",PRODUCTS:{LIST:"/products",DETAILS:t=>`/products/${t}`,DETAILS_BY_SLUG:t=>`/products/slug/${t}`,FEATURED:"/products/featured",FEATURED_RANDOM:"/products/featured-random",TRENDING_OFFERS:"/products/trending-offers",PERSONALIZED:"/products/personalized",DISCOUNTED:"/products/discounted",NEWEST:"/products/newest",POPULAR:"/products/popular",BY_CATEGORY:t=>`/products/category/${t}`,BY_TAGS:"/products/tags",BY_SELLER:t=>`/products/seller/${t}`,SEARCH:t=>`/products/search/${t||""}`,CREATE:"/products",UPDATE:t=>`/products/${t}`,DELETE:t=>`/products/${t}`,INCREMENT_VIEW:t=>`/products/${t}/view`},CATEGORIES:{LIST:"/categories",MAIN:"/categories/main",FEATURED:"/categories/featured",SUBCATEGORIES:t=>`/categories/${t}/subcategories`,PRODUCTS:t=>`/categories/${t}/products`,SLUG:t=>`/categories/slug/${t}`,DETAILS:t=>`/categories/${t}`,CREATE:"/admin/categories",UPDATE:t=>`/admin/categories/${t}`,DELETE:t=>`/admin/categories/${t}`},CART:{GET:"/cart",ADD_ITEM:"/cart/items",UPDATE_ITEM:t=>`/cart/items/${t}`,REMOVE_ITEM:t=>`/cart/items/${t}`,EMPTY:"/cart/empty",VOLUME_DISCOUNT_INFO:t=>`/cart/volume-discount-info/${t}`,DISCOUNT:{VALIDATE:"/cart/discount/validate",APPLY:"/cart/discount/apply",REMOVE:"/cart/discount/remove"}},VOLUME_DISCOUNTS:{PRODUCT_INFO:t=>`/volume-discounts/product/${t}`,ADMIN:{CONFIGURATION:"/admin/volume-discounts/configuration",STATS:"/admin/volume-discounts/stats",PRODUCT_DISCOUNTS:t=>`/admin/volume-discounts/product/${t}`,APPLY_DEFAULTS:t=>`/admin/volume-discounts/product/${t}/apply-defaults`,REMOVE_PRODUCT:t=>`/admin/volume-discounts/product/${t}`,BULK_APPLY:"/admin/volume-discounts/bulk/apply-defaults"}},CHECKOUT:{PROCESS:"/checkout"},ORDERS:{LIST:"/orders",DETAILS:t=>`/orders/${t}`,CREATE:"/orders",UPDATE:t=>`/orders/${t}`,SELLER_ORDERS:"/seller/orders",SELLER_ORDER_DETAILS:t=>`/seller/orders/${t}`,SELLER_ORDER_ITEMS:t=>`/seller/orders/${t}/items`,STATS:"/seller/orders/stats",UPDATE_STATUS:t=>`/seller/orders/${t}/status`,UPDATE_SHIPPING:t=>`/seller/orders/${t}/shipping`,CANCEL:t=>`/seller/orders/${t}/cancel`,COMPLETE:t=>`/seller/orders/${t}/complete`,AWAITING_SHIPMENT:"/seller/orders/awaiting-shipment",CUSTOMERS:"/seller/orders/customers",WITH_PRODUCT:t=>`/seller/orders/product/${t}`},PAYMENTS:{CREDIT_CARD:"/payments/credit-card",PAYPAL:"/payments/paypal",QR:"/payments/qr"},INVOICES:{LIST:"/invoices",DETAILS:t=>`/invoices/${t}`,GENERATE:"/invoices/generate",CANCEL:t=>`/invoices/${t}/cancel`,DOWNLOAD:t=>`/invoices/${t}/download`},SELLER:{REGISTER:"/seller/register",INFO:"/seller/info",UPDATE_STORE_INFO:"/seller/store-info",DASHBOARD:"/seller/dashboard",TOP_RATING:"/sellers/top/rating",TOP_SALES:"/sellers/top/sales",FEATURED:"/sellers/featured",EARNINGS:{BASE:"/seller/earnings",MONTHLY:"/seller/earnings/monthly",EXPORT_PDF:"/seller/earnings/export-pdf",DOWNLOAD_PDF:"/seller/earnings/download-pdf"}},RATINGS:{PRODUCT:t=>`/ratings/product/${t}`,SELLER:t=>`/ratings/seller/${t}`,RATE_PRODUCT:"/ratings/product",RATE_SELLER:"/ratings/seller",RATE_USER:"/ratings/user",MY_GIVEN:"/ratings/my/given",MY_RECEIVED:"/ratings/my/received",PENDING:"/ratings/pending",REPLY:"/ratings/reply",REPORT:"/ratings/report",REPORT_PROBLEM:"/ratings/report-problem",DETAILS:t=>`/ratings/${t}`,ORDER_RATINGS:t=>`/ratings/order/${t}`},SHIPPING:{TRACK:t=>`/shipping/track/${t}`,HISTORY:t=>`/shipping/${t}/history`,ROUTE:t=>`/shipping/${t}/route`,ESTIMATE:"/shipping/estimate",UPDATE_STATUS:"/shipping/update-status",EXTERNAL_UPDATE:"/shipping/external-status-update",SELLER:{LIST:"/seller/shipping",DETAIL:t=>`/seller/shipping/${t}`,UPDATE_STATUS:t=>`/seller/shipping/${t}/status`,HISTORY:t=>`/api/shipping/track/${t}/history`,ROUTE:t=>`/api/shipping/track/${t}/route`},SIMULATE_EVENTS:t=>`/shipping/${t}/simulate`,SIMULATE_API:"/shipping-api/status-update",SIMULATE_CYCLE:t=>`/shipping-api/${t}/simulate-cycle`},CHAT:{LIST:"/chats",DETAILS:t=>`/chats/${t}`,CREATE:"/chats",SEND_MESSAGE:t=>`/chats/${t}/messages`,UPDATE_STATUS:t=>`/chats/${t}`,DELETE:t=>`/chats/${t}`,GET_MESSAGES:t=>`/chats/${t}/messages`,MARK_ALL_READ:t=>`/chats/${t}/mark-read`,MARK_MESSAGE_READ:(t,e)=>`/chats/${t}/messages/${e}/read`,SELLER:{LIST:"/seller/chats",DETAILS:t=>`/seller/chats/${t}`,LIST_BY_SELLER:t=>`/seller/chats/by-seller/${t}`,SEND_MESSAGE:t=>`/seller/chats/${t}/messages`,UPDATE_STATUS:t=>`/seller/chats/${t}`,GET_MESSAGES:t=>`/seller/chats/${t}/messages`,MARK_ALL_READ:t=>`/seller/chats/${t}/mark-read`}},RECOMMENDATIONS:{GET:"/recommendations",TRACK_INTERACTION:"/recommendations/track-interaction",USER_PROFILE:"/recommendations/user-profile"},FAVORITES:{LIST:"/favorites",TOGGLE:"/favorites/toggle",CHECK:t=>`/favorites/product/${t}`,UPDATE_NOTIFICATIONS:t=>`/favorites/${t}/notifications`},FEEDBACK:{LIST:"/feedback",DETAILS:t=>`/feedback/${t}`,CREATE:"/feedback"},DISCOUNTS:{VALIDATE:"/discounts/validate",APPLY:"/discounts/apply",MY_CODES:"/discounts/my-codes"},NOTIFICATIONS:{LIST:"/notifications",UNREAD:"/notifications/unread",COUNT:"/notifications/count",MARK_AS_READ:t=>`/notifications/${t}/read`,MARK_ALL_AS_READ:"/notifications/read-all",DELETE:t=>`/notifications/${t}`},ACCOUNTING:{BALANCE_SHEET:"/accounting/balance-sheet",INCOME_STATEMENT:"/accounting/income-statement",ACCOUNTS:"/accounting/accounts",ACCOUNT_LEDGER:t=>`/accounting/accounts/${t}/ledger`},ADMIN:{USERS:"/admin/users",USER_DETAIL:t=>`/admin/users/${t}`,BLOCK_USER:t=>`/admin/users/${t}/block`,UNBLOCK_USER:t=>`/admin/users/${t}/unblock`,RESET_PASSWORD:t=>`/admin/users/${t}/reset-password`,CHANGE_USER_ROLE:t=>`/admin/users/${t}/change-role`,DELETE_USER:t=>`/admin/users/${t}`,DASHBOARD:"/admin/dashboard",SELLERS:"/admin/sellers",SELLER_STATUS:t=>`/admin/sellers/${t}/status`,CREATE_SELLER:"/admin/sellers",UPDATE_SELLER:t=>`/admin/sellers/${t}`,PENDING_RATINGS:"/admin/ratings/pending",MODERATE_RATING:t=>`/admin/ratings/${t}/moderate`,DELETE_RATING:t=>`/admin/ratings/${t}`,ORDERS:"/admin/orders",ORDER_DETAIL:t=>`/admin/orders/${t}`,ORDER_STATS:"/admin/orders/stats",UPDATE_ORDER_STATUS:t=>`/admin/orders/${t}/status`,CANCEL_ORDER:t=>`/admin/orders/${t}/cancel`,SHIPPING_LIST:"/admin/shippings",SHIPPING_DETAIL:t=>`/admin/shippings/${t}`,SHIPPING_HISTORY:t=>`/admin/shipping/${t}/history`,UPDATE_SHIPPING:t=>`/admin/orders/${t}/shipping`,UPDATE_SHIPPING_STATUS:t=>`/admin/shipping/${t}/status`,SIMULATE_SHIPPING:t=>`/admin/shipping/${t}/simulate`,SHIPPING_SEND_NOTIFICATION:t=>`/admin/shipping/${t}/notify`,ADMINS:"/admin/admins",MANAGE_ADMIN:"/admin/admins",REMOVE_ADMIN:t=>`/admin/admins/${t}`,PENDING_FEEDBACK:"/admin/feedback/pending",REVIEW_FEEDBACK:t=>`/admin/feedback/${t}/review`,RATINGS:{LIST:"/admin/ratings",STATS:"/admin/ratings/stats",PENDING:"/admin/ratings/pending",MODERATE:t=>`/admin/ratings/${t}/moderate`,APPROVE:t=>`/admin/ratings/${t}/approve`,REJECT:t=>`/admin/ratings/${t}/reject`,FLAG:t=>`/admin/ratings/${t}/flag`,APPROVE_ALL:"/admin/ratings/approve-all",DELETE:t=>`/admin/ratings/${t}`},CONFIGURATIONS:{BASE:"/admin/configurations",INDEX:"/admin/configurations",SHOW:t=>`/admin/configurations/${t}`,UPDATE:"/admin/configurations/update",RATINGS:"/admin/configurations/ratings",SHIPPING:"/admin/configurations/shipping",DEVELOPMENT:"/admin/configurations/development",MAIL:"/admin/configurations/mail",MAIL_TEST:"/admin/configurations/mail/test",MAIL_SEND_CUSTOM:"/admin/configurations/mail/send-custom",PASSWORD_VALIDATION_RULES:"/admin/configurations/password-validation-rules",FINANCIAL:"/admin/configurations/financial"},PUBLIC_CONFIGURATIONS:{PLATFORM_COMMISSION:"/configurations/platform-commission-public",SHIPPING:"/configurations/shipping-public",VOLUME_DISCOUNTS:"/configurations/volume-discounts-public",SHIPPING_DISTRIBUTION:"/configurations/shipping-distribution-public",TAX:"/configurations/tax-public",UNIFIED:"/configurations/unified"},CATEGORIES:{LIST:"/categories",DETAILS:t=>`/categories/${t}`,CREATE:"/admin/categories",UPDATE:t=>`/admin/categories/${t}`,PARTIAL_UPDATE:t=>`/admin/categories/${t}`,DELETE:t=>`/admin/categories/${t}`},PRODUCTS:{LIST:"/admin/products",DETAILS:t=>`/products/${t}`,CREATE:"/admin/products",UPDATE:t=>`/admin/products/${t}`,PARTIAL_UPDATE:t=>`/admin/products/${t}`,DELETE:t=>`/admin/products/${t}`,STATS:"/admin/products/stats"},VOLUME_DISCOUNTS:{CONFIGURATION:"/admin/volume-discounts/configuration",STATS:"/admin/volume-discounts/stats",PRODUCT_DISCOUNTS:t=>`/admin/volume-discounts/product/${t}`,UPDATE_PRODUCT:t=>`/admin/volume-discounts/product/${t}`,APPLY_DEFAULTS:t=>`/admin/volume-discounts/product/${t}/apply-defaults`,REMOVE_PRODUCT:t=>`/admin/volume-discounts/product/${t}`,BULK_APPLY:"/admin/volume-discounts/bulk/apply-defaults"},DISCOUNT_CODES:{LIST:"/admin/discount-codes",STATS:"/admin/discount-codes/stats",GENERATE_CODE:"/admin/discount-codes/generate-code",CREATE:"/admin/discount-codes",DETAILS:t=>`/admin/discount-codes/${t}`,UPDATE:t=>`/admin/discount-codes/${t}`,DELETE:t=>`/admin/discount-codes/${t}`,VALIDATE:"/admin/discount-codes/validate",APPLY:"/admin/discount-codes/apply"},ACCOUNTING:{METRICS:"/admin/accounting/metrics",TRANSACTIONS:"/admin/accounting/transactions",TRANSACTION_DETAIL:t=>`/admin/accounting/transactions/${t}`,POST_TRANSACTION:t=>`/admin/accounting/transactions/${t}/post`,ACCOUNTS:"/admin/accounting/accounts",ACCOUNT_DETAIL:t=>`/admin/accounting/accounts/${t}`,ACCOUNT_LEDGER:t=>`/admin/accounting/accounts/${t}/ledger`,BALANCE_SHEET:"/admin/accounting/balance-sheet",INCOME_STATEMENT:"/admin/accounting/income-statement"}},DEV:{SHIPPING_TRACK:t=>`/simulator/shipping/track/${t}`,SHIPPING_UPDATE:"/simulator/shipping/simulate-update",SHIPPING_CYCLE:t=>`/simulator/shipping/simulate-cycle/${t}`},SELLERS:{BY_USER_ID:t=>`/sellers/by-user/${t}`,ACTIVE:"/sellers/active"},DATAFAST:{STORE_CHECKOUT_DATA:"/datafast/store-checkout-data",CREATE_CHECKOUT:"/datafast/create-checkout",VERIFY_PAYMENT:"/datafast/verify-payment",WEBHOOK:"/datafast/webhook"},EXTERNAL_PAYMENT:{DASHBOARD:"/payment/dashboard",LIST:"/payment/links",CREATE:"/payment/links",SHOW:t=>`/payment/links/${t}`,CANCEL:t=>`/payment/links/${t}/cancel`,ADMIN:{DASHBOARD:"/admin/external-payments/dashboard",LIST:"/admin/external-payments/links",SHOW:t=>`/admin/external-payments/links/${t}`,CANCEL:t=>`/admin/external-payments/links/${t}/cancel`,USERS:"/admin/external-payments/users",STATS:"/admin/external-payments/stats"},PUBLIC:{SHOW:t=>`/pay/${t}`,DATAFAST:t=>`/pay/${t}/datafast`,DEUNA:t=>`/pay/${t}/deuna`,DATAFAST_VERIFY:t=>`/pay/${t}/datafast/verify`,DEUNA_WEBHOOK:t=>`/pay/${t}/deuna/webhook`}}};class ${static async get(e,r,a){try{const n=this.transformParamsToSnakeCase(r),o=await G.get(e,{params:n,...a});return this.handleApiResponse(o)}catch(n){throw this.handleApiError(n,e,"GET"),n}}static async post(e,r,a){try{const n=r instanceof FormData||e.includes("/checkout")||e.includes("/datafast")?r:r?this.transformDataToSnakeCase(r):void 0;e.includes("/deuna/payments")&&console.log("🔍 API CLIENT - DATA TRANSFORMATION:",{original_data:r,transformed_data:n,original_items:r?.items,transformed_items:n?.items,original_first_item:r?.items?.[0],transformed_first_item:n?.items?.[0]}),(e.includes("/checkout")||e.includes("/datafast"))&&console.log("🔍 API CLIENT - CHECKOUT/DATAFAST NO TRANSFORMATION:",{url:e,original_data_keys:r?Object.keys(r):[],has_shippingAddress:r?.shippingAddress?"YES":"NO",has_billingAddress:r?.billingAddress?"YES":"NO",transformation_skipped:n===r,shipping_address_name:r?.shippingAddress?.name,billing_address_name:r?.billingAddress?.name});const o=await G.post(e,n,a);return this.handleApiResponse(o)}catch(n){throw this.handleApiError(n,e,"POST"),n}}static async put(e,r,a){try{const n=r?this.transformDataToSnakeCase(r):void 0,o=await G.put(e,n,a);return this.handleApiResponse(o)}catch(n){throw this.handleApiError(n,e,"PUT"),n}}static async patch(e,r,a){try{const n=r?this.transformDataToSnakeCase(r):void 0,o=await G.patch(e,n,a);return this.handleApiResponse(o)}catch(n){throw this.handleApiError(n,e,"PATCH"),n}}static async delete(e,r){try{const a=await G.delete(e,r);return this.handleApiResponse(a)}catch(a){throw this.handleApiError(a,e,"DELETE"),a}}static async uploadFile(e,r,a){try{const n=await G.post(e,r,{headers:{"Content-Type":"multipart/form-data"},...a});return this.handleApiResponse(n)}catch(n){throw this.handleApiError(n,e,"UPLOAD"),n}}static async updateFile(e,r,a){try{r.append("_method","PUT");const n=await G.post(e,r,{headers:{"Content-Type":"multipart/form-data"},...a});return this.handleApiResponse(n)}catch(n){throw this.handleApiError(n,e,"UPDATE"),n}}static transformParamsToSnakeCase(e){if(!e)return;const r={};return Object.entries(e).forEach(([a,n])=>{const o=a.replace(/([A-Z])/g,"_$1").toLowerCase(),i=a.includes("_")?a:o;r[i]=n}),r}static transformDataToSnakeCase(e){if(!e||typeof e!="object")return e;if(Array.isArray(e))return e.map((n,o)=>{const i=this.transformDataToSnakeCase(n);return typeof n=="object"&&n!==null&&(n.product_id!==void 0||n.name!==void 0)&&console.log(`🔍 TRANSFORM ARRAY ITEM ${o}:`,{original:n,transformed:i,original_keys:Object.keys(n),transformed_keys:Object.keys(i),product_id_preserved:i.product_id===n.product_id}),i});const r={};return Object.entries(e).forEach(([a,n])=>{const o=a.replace(/([A-Z])/g,"_$1").toLowerCase(),i=a.includes("_")?a:o;n!==null&&typeof n=="object"?r[i]=this.transformDataToSnakeCase(n):r[i]=n}),r}static handleApiResponse(e){if(!e)throw new Error("Respuesta vacía de la API");return e.data?(e.data.data&&(Array.isArray(e.data.data)||typeof e.data.data=="object"),e.data):e}static handleApiError(e,r,a){if(z.isAxiosError(e)){const{response:n}=e;console.error(`API Error (${a} ${r}):`,{status:n?.status,statusText:n?.statusText,data:n?.data}),n?.status===401?console.error("Error de autenticación - el token puede ser inválido o estar ausente"):n?.status===422?console.error("Error de validación:",n.data?.errors||n.data):n?.status===404?console.error("Recurso no encontrado"):n?.status===500?console.error("Error del servidor"):e.message.includes("Network Error")&&console.error("Error de red - podría ser un problema de CORS")}else console.error(`Error desconocido (${a} ${r}):`,e)}}var B=(t=>(t.SUCCESS="success",t.ERROR="error",t.INFO="info",t.WARNING="warning",t))(B||{});const mn=({id:t,type:e,message:r,duration:a,showProgress:n,actionButton:o,persistent:i,onClose:d})=>{const[c,p]=g.useState(!0),[h,v]=g.useState(a);g.useEffect(()=>{if(i||a<=0)return;const S=setInterval(()=>{v(x=>x<=100?(p(!1),setTimeout(()=>d(t),300),0):x-100)},100);return()=>clearInterval(S)},[a,t,d,i]);const f=()=>{switch(e){case B.SUCCESS:return s.jsx(re,{size:20,className:"text-green-500"});case B.ERROR:return s.jsx(me,{size:20,className:"text-red-500"});case B.WARNING:return s.jsx(H,{size:20,className:"text-yellow-500"});case B.INFO:return s.jsx(he,{size:20,className:"text-blue-500"});default:return s.jsx(he,{size:20,className:"text-gray-500"})}},A=()=>{const S="border-l-4 shadow-lg";switch(e){case B.SUCCESS:return`${S} bg-green-50 border-green-400 text-green-800`;case B.ERROR:return`${S} bg-red-50 border-red-400 text-red-800`;case B.WARNING:return`${S} bg-yellow-50 border-yellow-400 text-yellow-800`;case B.INFO:return`${S} bg-blue-50 border-blue-400 text-blue-800`;default:return`${S} bg-gray-50 border-gray-400 text-gray-800`}},l=!i&&a>0?h/a*100:0;return s.jsxs("div",{className:`
        mb-3 rounded-lg p-4 transition-all duration-300 max-w-md w-full
        ${A()}
        ${c?"translate-x-0 opacity-100":"translate-x-full opacity-0"}
      `,children:[s.jsxs("div",{className:"flex items-start",children:[s.jsx("div",{className:"flex-shrink-0 mr-3",children:f()}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-sm font-medium leading-5 break-words",children:r}),o&&s.jsx("div",{className:"mt-2",children:s.jsxs("button",{onClick:o.onClick,className:"text-xs font-medium underline hover:no-underline focus:outline-none transition-all duration-200 hover:opacity-80",children:[s.jsx(W,{size:12,className:"inline mr-1"}),o.label]})})]}),s.jsx("button",{onClick:()=>d(t),className:"flex-shrink-0 ml-3 text-gray-400 hover:text-gray-600 focus:outline-none transition-colors duration-200","aria-label":"Cerrar notificación",children:s.jsx(ze,{size:16})})]}),n&&!i&&a>0&&s.jsx("div",{className:"mt-3 w-full bg-gray-200 rounded-full h-1",children:s.jsx("div",{className:`h-1 rounded-full transition-all duration-100 ease-linear ${e===B.SUCCESS?"bg-green-500":e===B.ERROR?"bg-red-500":e===B.WARNING?"bg-yellow-500":"bg-blue-500"}`,style:{width:`${l}%`}})})]})},Vt=g.createContext(null),ii=({children:t,defaultPosition:e="bottom-right",maxToasts:r=5})=>{const[a,n]=g.useState([]),o=g.useCallback(v=>{n(f=>f.filter(A=>A.id!==v))},[]),i=g.useCallback((v,f,A={})=>{const S={id:Date.now().toString()+Math.random().toString(36).substr(2,9),type:v,message:f,duration:A.duration??5e3,position:A.position??e,showProgress:A.showProgress??!0,actionButton:A.actionButton,persistent:A.persistent??!1,onClose:o};n(x=>{const N=[...x,S];return N.length>r?N.slice(-r):N})},[o,e,r]),d=g.useCallback(()=>{n([])},[]),c=a.reduce((v,f)=>(v[f.position]||(v[f.position]=[]),v[f.position].push(f),v),{}),p=v=>{const f="fixed z-50 flex flex-col pointer-events-none";switch(v){case"top-left":return`${f} top-4 left-4`;case"top-center":return`${f} top-4 left-1/2 transform -translate-x-1/2`;case"top-right":return`${f} top-4 right-4`;case"bottom-left":return`${f} bottom-4 left-4`;case"bottom-center":return`${f} bottom-4 left-1/2 transform -translate-x-1/2`;case"bottom-right":return`${f} bottom-4 right-4`;default:return`${f} bottom-4 right-4`}},h={toasts:a,showToast:i,removeToast:o,clearAllToasts:d};return s.jsxs(Vt.Provider,{value:h,children:[t,Object.entries(c).map(([v,f])=>s.jsx("div",{className:p(v),children:s.jsx("div",{className:"space-y-2 pointer-events-auto",children:f.map(A=>s.jsx(mn,{...A},A.id))})},v))]})},Gt=()=>{const t=g.useContext(Vt);if(!t)throw new Error("useToast must be used within a UniversalToastProvider");return t};class ne{static instance;unifiedConfig=null;cacheExpiry=null;CACHE_DURATION=30*1e3;VERSION="1.0.0";cacheHits=0;cacheMisses=0;apiCalls=0;lastCacheHit=null;lastCacheMiss=null;constructor(){}static getInstance(){return ne.instance||(ne.instance=new ne),ne.instance}async getSynchronizedConfig(e=3){let r=0,a=null;for(;r<e;){r++;try{console.log(`🔄 JORDAN - Intento ${r}/${e} de sincronización de configuración`);const n=r===1&&a!==null,o=await this.getUnifiedConfig(n);if(o.source!=="fallback"||o.errors.length===0)return r>1&&console.log(`✅ JORDAN - Sincronización exitosa en intento ${r}`),o;if(r===e)return console.warn("⚠️ JORDAN - Usando configuración fallback después de múltiples intentos"),o}catch(n){if(a=n,console.warn(`⚠️ JORDAN - Error en intento ${r}: ${a.message}`),r===e)return console.error("❌ JORDAN - Todos los intentos fallaron, usando configuración de emergencia"),{config:this.getSecureFallbackConfig(),source:"fallback",is_stale:!0,errors:[`Failed after ${e} attempts: ${a.message}`],warnings:["Using emergency fallback configuration due to repeated failures"]};const o=Math.min(1e3*Math.pow(2,r-1),5e3);await new Promise(i=>setTimeout(i,o))}}throw new Error("Unexpected error in configuration synchronization")}async getUnifiedConfig(e=!1){if(console.log("🔧 JORDAN ConfigurationManager - Obteniendo configuración unificada"),!e&&this.isConfigCacheValid()){const r=this.unifiedConfig.updated_at,a=Date.now()-10*1e3;return new Date(r).getTime()<a?(console.warn("🚨 CRITICAL: Cache potencialmente stale para keys críticos, forzando refresh"),this.getUnifiedConfig(!0)):(this.cacheHits++,this.lastCacheHit=new Date().toISOString(),console.log("✅ JORDAN - Cache HIT - Usando configuración desde cache (validada crítica)"),{config:this.unifiedConfig,source:"cache",is_stale:!1,errors:[],warnings:[]})}this.cacheMisses++,this.apiCalls++,this.lastCacheMiss=new Date().toISOString(),console.log("🔄 JORDAN - Cache MISS - Obteniendo desde API");try{const r=await this.fetchUnifiedConfigFromAPI(),a=this.validateConfiguration(r);if(a.is_valid){this.unifiedConfig=r,this.cacheExpiry=Date.now()+this.CACHE_DURATION,console.log("✅ JORDAN - Configuración unificada cargada y validada");const n=r._failedEndpoints||[],o=n.length>0?[`${n.length} endpoints fallaron: ${n.join(", ")} - usando valores por defecto`]:[];return{config:r,source:"api",is_stale:!1,errors:[],warnings:[...a.warnings,...o]}}else return console.warn("⚠️ Configuración de API inválida, usando fallback"),{config:this.getSecureFallbackConfig(),source:"fallback",is_stale:!0,errors:a.errors,warnings:["Usando configuración de respaldo debido a errores en API"]}}catch(r){console.error("❌ Error obteniendo configuraciones:",r);const a=this.getSecureFallbackConfig(),n=r instanceof Error?r.message:"Unknown",o=["platform-commission endpoint failed","shipping endpoint failed","volume-discounts endpoint failed","shipping-distribution endpoint failed","tax endpoint failed"];return{config:a,source:"fallback",is_stale:!0,errors:n.includes("Todos los endpoints")?o:[`Error crítico: ${n}`],warnings:["Sistema usando valores de emergencia"]}}}getConfigSync(){return this.isConfigCacheValid()?this.unifiedConfig:null}async fetchUnifiedConfigFromAPI(){console.log("🌐 Obteniendo configuraciones desde endpoint unificado...");try{const e=await $.get(D.ADMIN.PUBLIC_CONFIGURATIONS.UNIFIED);if(e&&typeof e=="object"&&"status"in e){const r=e;if(r.status==="success"&&r.data)return console.log("✅ UNIFIED CONFIG: Configuración unificada obtenida exitosamente"),r.data}throw new Error("Invalid unified config response")}catch(e){throw console.error("❌ UNIFIED CONFIG FAILED: Sin fallback - usar valores por defecto",e),e}}validateConfiguration(e){const r=[],a=[];return(e.tax_rate<0||e.tax_rate>1)&&r.push(`tax_rate inválido: ${e.tax_rate}`),(e.platform_commission_rate<0||e.platform_commission_rate>.5)&&r.push(`platform_commission_rate inválido: ${e.platform_commission_rate}`),e.shipping.default_cost<0&&r.push(`shipping.default_cost inválido: ${e.shipping.default_cost}`),e.shipping.free_threshold<0&&r.push(`shipping.free_threshold inválido: ${e.shipping.free_threshold}`),(!Array.isArray(e.volume_discounts)||e.volume_discounts.length===0)&&a.push("No hay descuentos por volumen configurados"),{is_valid:r.length===0,errors:r,warnings:a}}getSecureFallbackConfig(){return{tax_rate:.15,platform_commission_rate:.1,shipping:{enabled:!0,default_cost:5,free_threshold:50,seller_percentage_single:.8,seller_percentage_max_multi:.4},shipping_distribution:{seller_percentage_single:.8,seller_percentage_max_multi:.4},volume_discounts:[{quantity:3,discount:5,label:"3+"},{quantity:5,discount:8,label:"5+"},{quantity:10,discount:15,label:"10+"}],updated_at:new Date().toISOString(),version:this.VERSION+"-fallback",is_valid:!1}}isConfigCacheValid(){return this.unifiedConfig!==null&&this.cacheExpiry!==null&&Date.now()<this.cacheExpiry}invalidateCache(){this.unifiedConfig=null,this.cacheExpiry=null,this.cacheMisses++,this.lastCacheMiss=new Date().toISOString(),console.log("🔄 JORDAN - Cache de configuración invalidado")}getStats(){const e=this.cacheExpiry?(Date.now()-(this.cacheExpiry-this.CACHE_DURATION))/1e3:null,r=this.cacheHits+this.cacheMisses,a=r>0?this.cacheHits/r:0;return{cache_valid:this.isConfigCacheValid(),cache_age_seconds:e,version:this.VERSION,last_config_source:this.unifiedConfig?"loaded":"none",cache_hits:this.cacheHits,cache_misses:this.cacheMisses,cache_hit_rate:Math.round(a*100)/100,api_calls:this.apiCalls,last_cache_hit:this.lastCacheHit,last_cache_miss:this.lastCacheMiss}}resetCacheMetrics(){this.cacheHits=0,this.cacheMisses=0,this.apiCalls=0,this.lastCacheHit=null,this.lastCacheMiss=null,console.log("🔄 JORDAN - Métricas de cache reseteadas")}}function Ae(t){if(typeof t!="number"||isNaN(t))return"$0.00";const e=Number(t.toFixed(2));return new Intl.NumberFormat("es-EC",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}const Os=`data:image/svg+xml,${encodeURIComponent(`
<svg width="300" height="300" xmlns="http://www.w3.org/2000/svg">
  <rect width="300" height="300" fill="#e5e7eb"/>
  <circle cx="150" cy="120" r="30" fill="#9ca3af"/>
  <path d="M90 180L120 150L150 200L180 130L210 200V230H90V180Z" fill="#9ca3af"/>
  <text x="150" y="260" font-family="Arial, sans-serif" font-size="14" fill="#6b7280" text-anchor="middle">
    Sin imagen
  </text>
</svg>
`)}`;function Ze(t){if(!t||t.trim()==="")return Os;const e=t.trim();if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("data:"))return e;{let r=e;return r.startsWith("/storage/")?r=r.substring(9):r.startsWith("storage/")&&(r=r.substring(8)),`${Cs.imageBaseUrl}${r}`}}function Ns(t){if(!t)return Os;if(console.log("🔍 Analizando producto para imagen principal:",{id:t.id,main_image:t.main_image,image:t.image,images:t.images}),t.main_image&&typeof t.main_image=="string")return console.log("✅ Usando main_image:",t.main_image),Ze(t.main_image);if(t.image&&typeof t.image=="string")return console.log("✅ Usando image:",t.image),Ze(t.image);if(t.images&&Array.isArray(t.images)&&t.images.length>0){const e=t.images[0];if(console.log("📋 Primer imagen del array:",e),typeof e=="string"&&e.trim()!=="")return console.log("✅ Usando primera imagen string:",e),Ze(e);if(typeof e=="object"&&e!==null){const r=e.original||e.large||e.medium||e.thumbnail||"";if(r&&typeof r=="string")return console.log("✅ Usando imagen del objeto:",r),Ze(r)}}return console.log("⚠️ No se encontró imagen, usando placeholder"),Os}const Me=(t,e="Ha ocurrido un error")=>{if(t instanceof Error)return t.message;if(t&&typeof t=="object"){if("response"in t&&t.response){const{response:r}=t;if(r.data){if(typeof r.data.message=="string")return r.data.message;if(r.data.errors&&typeof r.data.errors=="object"){const a=Object.values(r.data.errors).flat();if(a.length>0)return Array.isArray(a[0])?a[0].join(". "):a.join(". ")}if(typeof r.data=="string")return r.data}if(r.status)return gn(r.status)}if("message"in t&&typeof t.message=="string")return t.message.includes("network")||t.message.includes("Network")?"Error de conexión. Verifica tu conexión a internet.":t.message.includes("timeout")?"La solicitud ha tardado demasiado tiempo. Intenta de nuevo más tarde.":t.message}return e},gn=t=>{switch(t){case 400:return"Solicitud incorrecta. Verifica los datos enviados.";case 401:return"No estás autorizado. Inicia sesión nuevamente.";case 403:return"No tienes permiso para realizar esta acción.";case 404:return"El recurso solicitado no se ha encontrado.";case 422:return"Error de validación. Verifica los datos enviados.";case 500:return"Error en el servidor. Intenta más tarde o contacta al soporte.";case 503:return"Servicio no disponible. Intenta más tarde.";default:return`Error ${t}. Por favor, intenta de nuevo.`}};class Ce{static instance;listeners=new Map;static getInstance(){return Ce.instance||(Ce.instance=new Ce),Ce.instance}subscribe(e,r){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(r),()=>{const a=this.listeners.get(e);a&&(a.delete(r),a.size===0&&this.listeners.delete(e))}}invalidate(e){console.log(`🔄 Invalidando cache: ${e}`),Object.keys(localStorage).filter(o=>this.matchesPattern(o,e)).forEach(o=>{ce.removeItem(o)});const n=this.listeners.get(e);n&&n.forEach(o=>o()),this.notifyRelatedPatterns(e)}matchesPattern(e,r){const a=r.replace(/\*/g,".*").replace(/\?/g,".");return new RegExp(`^${a}$`).test(e)}notifyRelatedPatterns(e){this.listeners.forEach((r,a)=>{a!==e&&this.areRelatedPatterns(e,a)&&r.forEach(n=>n())})}areRelatedPatterns(e,r){const a=e.split("_")[0],n=r.split("_")[0];return a===n}}function Ht(){const t=g.useRef(Ce.getInstance());return{invalidate:e=>{t.current.invalidate(e)},invalidateMany:e=>{e.forEach(r=>{t.current.invalidate(r)})},invalidateAfterMutation:e=>{setTimeout(()=>{e.forEach(r=>{t.current.invalidate(r)})},0)}}}const hn=({currentPage:t,totalPages:e,onPageChange:r})=>{if(e<=1)return null;const n=(()=>{const o=[];o.push(1),t>3&&o.push("...");for(let i=Math.max(2,t-1);i<=Math.min(e-1,t+1);i++)i>1&&i<e&&o.push(i);return t<e-2&&o.push("..."),e>1&&o.push(e),o})();return s.jsxs("div",{className:"bg-white px-4 py-3 border-t border-gray-200",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("button",{onClick:()=>r(t-1),disabled:t===1,className:"relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[s.jsx(gr,{className:"w-4 h-4 mr-2"}),s.jsx("span",{className:"hidden sm:inline",children:"Anterior"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"flex sm:hidden items-center",children:s.jsxs("span",{className:"text-sm text-gray-700",children:[s.jsx("span",{className:"font-semibold text-primary-600",children:t}),s.jsx("span",{className:"mx-1",children:"de"}),s.jsx("span",{className:"font-semibold",children:e})]})}),s.jsx("div",{className:"hidden sm:flex items-center space-x-1",children:n.map((o,i)=>typeof o=="number"?s.jsx("button",{onClick:()=>r(o),className:`relative inline-flex items-center justify-center w-10 h-10 text-sm font-medium rounded-lg transition-colors ${t===o?"bg-primary-600 text-white shadow-sm":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"}`,children:o},i):s.jsx("span",{className:"relative inline-flex items-center justify-center w-10 h-10 text-sm text-gray-400",children:o},i))})]}),s.jsxs("button",{onClick:()=>r(t+1),disabled:t===e,className:"relative inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[s.jsx("span",{className:"hidden sm:inline",children:"Siguiente"}),s.jsx(ks,{className:"w-4 h-4 ml-2"})]})]}),s.jsx("div",{className:"hidden sm:block mt-3 text-center",children:s.jsxs("p",{className:"text-xs text-gray-500",children:["Mostrando página ",t," de ",e]})})]})};function fs({data:t,columns:e,searchFields:r=[],loading:a=!1,emptyMessage:n="No hay datos disponibles",pagination:o}){const[i,d]=g.useState(""),[c,p]=g.useState(null),h=f=>{let A="ascending";c&&c.key===f&&(A=c.direction==="ascending"?"descending":"ascending"),p({key:f,direction:A})},v=g.useMemo(()=>{let f=[...t];return i&&r.length>0&&(f=t.filter(A=>r.some(l=>{const S=A[l];return S&&String(S).toLowerCase().includes(i.toLowerCase())}))),c&&f.sort((A,l)=>{const S=A[c.key],x=l[c.key];return S<x?c.direction==="ascending"?-1:1:S>x?c.direction==="ascending"?1:-1:0}),f},[t,i,r,c]);return s.jsxs("div",{className:"space-y-4",children:[r.length>0&&s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:"text",placeholder:"Buscar...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:i,onChange:f=>d(f.target.value)}),s.jsx(Ds,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:a?s.jsx("div",{className:"p-8 flex justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})}):v.length===0?s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:n}),s.jsx("p",{className:"text-gray-500",children:"Intente ajustar su búsqueda para encontrar lo que está buscando."})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsx("tr",{children:e.map(f=>s.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("span",{children:f.header}),f.sortable&&s.jsx("button",{onClick:()=>h(f.key),className:"ml-1 focus:outline-none",children:c?.key===f.key?c.direction==="ascending"?s.jsx(ut,{size:14,className:"text-primary-500"}):s.jsx(mt,{size:14,className:"text-primary-500"}):s.jsx("div",{className:"h-3.5 w-3.5"})})]})},f.key))})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v.map((f,A)=>s.jsx("tr",{className:"hover:bg-gray-50",children:e.map(l=>s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:l.render?l.render(f):String(f[l.key]||"")},l.key))},A))})]})}),o&&s.jsxs("div",{className:"px-6 py-3 flex justify-between items-center border-t border-gray-200",children:[s.jsx("div",{children:s.jsxs("p",{className:"text-sm text-gray-700",children:["Mostrando"," ",s.jsx("span",{className:"font-medium",children:(o.currentPage-1)*o.itemsPerPage+1})," ","a"," ",s.jsx("span",{className:"font-medium",children:Math.min(o.currentPage*o.itemsPerPage,o.totalItems)})," ","de"," ",s.jsx("span",{className:"font-medium",children:o.totalItems})," ","elementos"]})}),s.jsx(hn,{currentPage:o.currentPage,totalPages:o.totalPages,onPageChange:o.onPageChange})]})]})})]})}const pn=({title:t,value:e,change:r,text:a=null,icon:n,iconBgColor:o="bg-gray-100",iconColor:i="text-gray-600"})=>{const d=r>0,c=d?"text-green-600":"text-red-600";return s.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-500",children:t}),s.jsx("p",{className:"text-2xl font-bold text-gray-900 mt-1",children:e}),r!==0&&s.jsxs("div",{className:`flex items-center mt-2 ${c}`,children:[d?s.jsx(ut,{size:16}):s.jsx(mt,{size:16}),s.jsxs("span",{className:"ml-1 text-sm font-medium",children:[Math.abs(r),"% respecto al mes anterior"]})]}),a&&s.jsx("span",{className:"text-sm text-gray-500 mt-2",children:a})]}),s.jsx("div",{className:`p-3 rounded-lg ${o}`,children:s.jsx(n,{className:`w-6 h-6 ${i}`})})]})},fn=({cards:t})=>s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:t.map((e,r)=>s.jsx(pn,{...e},r))}),xn=({icon:t,iconBgColor:e,iconColor:r,title:a,color:n=!1,description:o,linkText:i,linkTo:d})=>s.jsxs("div",{className:`${n?"bg-white":"bg-gray-50"} p-4 rounded-lg flex items-start`,children:[s.jsx("div",{className:`p-2 rounded-lg mr-3 ${e}`,children:s.jsx(t,{className:`w-5 h-5 ${r}`})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900",children:a}),s.jsx("p",{className:"text-sm text-gray-500 mb-2",children:o}),s.jsxs(ee,{to:d,className:"text-primary-600 text-sm font-medium hover:underline inline-flex items-center",children:[i," ",s.jsx(ks,{size:16})]})]})]}),yn=({items:t,color:e})=>s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map((r,a)=>s.jsx(xn,{...r,color:e},a))}),bn=({title:t,className:e=""})=>s.jsxs("div",{className:`bg-white rounded-lg shadow-sm ${e}`,children:[s.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:s.jsx("h2",{className:"text-lg font-medium text-gray-900",children:t})}),s.jsx("div",{className:"p-6 text-center text-gray-500",children:"No hay datos disponibles"})]}),Wt=({title:t,viewAllLink:e,viewAllText:r="Ver todo"})=>s.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[s.jsx("h2",{className:"text-lg font-medium text-gray-900",children:t}),e&&s.jsxs(ee,{to:e,className:"text-primary-600 text-sm font-medium hover:underline flex items-center",children:[r," ",s.jsx(ks,{size:16})]})]});function vn({data:t,columns:e,title:r,viewAllLink:a,viewAllText:n,className:o="",onRowClick:i}){const d=(c,p)=>{const h=c[p.key];return p.render?p.render(h,c):typeof h>"u"||h===null?"-":h};return s.jsxs("div",{className:`bg-white rounded-lg shadow-sm ${o}`,children:[s.jsx(Wt,{title:r,viewAllLink:a,viewAllText:n}),s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"min-w-full",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsx("tr",{children:e.map((c,p)=>s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:c.header},p))})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map((c,p)=>s.jsx("tr",{className:`hover:bg-gray-50 ${i?"cursor-pointer":""}`,onClick:i?()=>i(c):void 0,children:e.map((h,v)=>s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:d(c,h)},v))},p))})]})})]})}function Nn({data:t,columns:e,title:r,viewAllLink:a,viewAllText:n,className:o="",onRowClick:i}){const d=(c,p)=>{const h=c[p.key];return p.render?p.render(h,c):typeof h>"u"||h===null?"-":h};return s.jsxs("div",{className:`bg-white rounded-lg shadow-sm ${o}`,children:[s.jsx(Wt,{title:r,viewAllLink:a,viewAllText:n}),s.jsx("div",{className:"divide-y divide-gray-200",children:t.map((c,p)=>s.jsx("div",{className:`px-6 py-3 flex flex-wrap items-center gap-3 hover:bg-gray-50 ${i?"cursor-pointer":""}`,onClick:i?()=>i(c):void 0,children:e.map((h,v)=>s.jsxs("div",{className:"flex items-center",children:[h.showLabelInCompact&&s.jsxs("span",{className:"text-xs text-gray-500 mr-1",children:[h.header,":"]}),s.jsx("span",{className:"text-sm",children:d(c,h)})]},v))},p))})]})}function Kt(t){const{data:e,compact:r=!1}=t;return!e||e.length===0?s.jsx(bn,{title:t.title,className:t.className}):r?s.jsx(Nn,{...t}):s.jsx(vn,{...t})}const jn=({icon:t=H,borderColor:e,bgColor:r,iconColor:a,title:n,description:o,linkText:i,linkTo:d,textColor:c,hoverTextColor:p})=>s.jsx("div",{className:`${r} border-l-4 ${e} p-4 rounded-r-lg`,children:s.jsxs("div",{className:"flex",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx(t,{className:`h-5 w-5 ${a}`})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("h3",{className:`text-sm font-medium ${c}`,children:n}),s.jsx("div",{className:`mt-2 text-sm ${c}`,children:s.jsx("p",{children:o})}),s.jsx("div",{className:"mt-3",children:s.jsx(ee,{to:d,className:`text-sm font-medium ${c} hover:${p}`,children:i})})]})]})}),Sn=({items:t})=>s.jsx("div",{className:"space-y-4",children:t.map((e,r)=>s.jsx(jn,{...e},r))}),En=()=>[{key:"id",header:"ID Pedido",showLabelInCompact:!1,render:t=>s.jsxs(ee,{to:`/admin/orders/${t}`,className:"text-primary-600 hover:underline font-medium",children:["#",t]})},{key:"date",header:"Fecha",showLabelInCompact:!0},{key:"customer",header:"Cliente",showLabelInCompact:!0,render:t=>s.jsx("span",{className:"text-gray-900",children:t})},{key:"total",header:"Total",showLabelInCompact:!0,render:t=>Ae(t)},{key:"status",header:"Estado",showLabelInCompact:!0,render:t=>{let e="bg-yellow-100 text-yellow-800",r="En Proceso";return t==="Completed"?(e="bg-green-100 text-green-800",r="Completado"):t==="Shipped"&&(e="bg-blue-100 text-blue-800",r="Enviado"),s.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${e}`,children:r})}}],Cn=({orders:t,title:e,viewAllLink:r,viewAllText:a,compact:n=!1,className:o="",onOrderClick:i})=>s.jsx(Kt,{data:t,columns:En(),title:e,viewAllLink:r,viewAllText:a,compact:n,className:o,onRowClick:i}),wn=()=>[{key:"name",header:"Vendedor",showLabelInCompact:!1,render:(t,e)=>s.jsx(ee,{to:`/admin/sellers/${e.id}`,className:"text-primary-600 hover:underline font-medium",children:t})},{key:"orderCount",header:"Pedidos",showLabelInCompact:!0},{key:"revenue",header:"Ingresos",showLabelInCompact:!0,render:t=>Ae(t)}],An=({sellers:t,title:e,viewAllLink:r,viewAllText:a,compact:n=!1,className:o="",onSellerClick:i})=>s.jsx(Kt,{data:t,columns:wn(),title:e,viewAllLink:r,viewAllText:a,compact:n,className:o,onRowClick:i});class _n{async getDashboardStats(){try{const e=await $.get("/admin/dashboard");if(!e.success)throw new Error(e.message||"Failed to fetch dashboard statistics");return e.data}catch(e){throw console.error("Error fetching dashboard statistics:",e),e}}transformToLegacyFormat(e){return{cards:[{title:"Ventas Totales",value:e.main_stats.total_sales.formatted_value,change:e.main_stats.total_sales.change,icon:"DollarSign",iconBgColor:"bg-green-50",iconColor:"text-green-600"},{title:"Usuarios Totales",value:e.main_stats.total_users.value,change:e.main_stats.total_users.change,icon:"Users",iconBgColor:"bg-blue-50",iconColor:"text-blue-600"},{title:"Pedidos Totales",value:e.main_stats.total_orders.value,change:e.main_stats.total_orders.change,icon:"ShoppingBag",iconBgColor:"bg-purple-50",iconColor:"text-purple-600"},{title:"Productos Activos",value:e.main_stats.active_products.formatted_value,change:e.main_stats.active_products.change,icon:"Package",iconBgColor:"bg-yellow-50",iconColor:"text-yellow-600"}],pendingCardItems:[{icon:"Star",iconBgColor:"bg-yellow-50",iconColor:"text-yellow-600",title:"Valoraciones y Reseñas",description:e.pending_items.pending_ratings.message,linkText:"Moderar Reseñas",linkTo:"/admin/ratings?status=pending"},{icon:"Briefcase",iconBgColor:"bg-blue-50",iconColor:"text-blue-600",title:"Solicitudes de Vendedores",description:e.pending_items.pending_sellers.message,linkText:"Ver solicitudes",linkTo:"/admin/sellers?status=pending"},{icon:"MessageSquare",iconBgColor:"bg-purple-50",iconColor:"text-purple-600",title:"Customer Feedback",description:e.pending_items.pending_feedback.message,linkText:"Revisar Comentarios",linkTo:"/admin/feedback?status=pending"}],alertItems:e.system_alerts.map(r=>({icon:"AlertTriangle",borderColor:r.type==="error"?"border-red-500":"border-amber-500",bgColor:r.type==="error"?"bg-red-50":"bg-amber-50",iconColor:r.type==="error"?"text-red-500":"text-amber-500",title:r.title,description:r.description,linkText:"Ver detalles",linkTo:r.link_to,textColor:r.type==="error"?"text-red-800":"text-amber-800",hoverTextColor:r.type==="error"?"text-red-600":"text-amber-600"})),recentOrders:e.recent_orders.map(r=>({id:r.id,date:r.date,customer:r.customer,total:r.total,status:this.mapOrderStatus(r.status)})),topSellers:e.top_sellers.map(r=>({id:r.id,name:r.name,orderCount:r.order_count,revenue:r.revenue})),performanceMetrics:e.performance_metrics,lastUpdated:e.last_updated}}mapOrderStatus(e){return{Completado:"Completed",completed:"Completed",Completed:"Completed",Procesando:"Processing",processing:"Processing",Processing:"Processing",Pendiente:"Processing",pending:"Processing",Enviado:"Shipped",shipped:"Shipped",Shipped:"Shipped",delivered:"Shipped",Entregado:"Shipped"}[e]||"Processing"}}const ct=new _n,Tn=(t=!1,e=6e4)=>{const[r,a]=g.useState(null),[n,o]=g.useState(!0),[i,d]=g.useState(null),[c,p]=g.useState(null),h=g.useCallback(async()=>{try{o(!0),d(null);const f=await ct.getDashboardStats();a(f),p(new Date().toISOString())}catch(f){d(f instanceof Error?f.message:"Error fetching dashboard statistics"),console.error("Dashboard stats fetch error:",f)}finally{o(!1)}},[]);g.useEffect(()=>{h()},[h]),g.useEffect(()=>{if(!t)return;const f=setInterval(()=>{h()},e);return()=>clearInterval(f)},[t,e,h]);const v=r?ct.transformToLegacyFormat(r):null;return{stats:r,transformedData:v,loading:n,error:i,refetch:h,lastUpdated:c}},Pn=()=>{const t=ur(),{transformedData:e,loading:r,error:a,refetch:n,lastUpdated:o}=Tn(!0,3e5),i=A=>{t(`/admin/orders/${A.id}`)},d=A=>{t(`/admin/sellers/${A.id}`)},c=async()=>{await n()};if(r&&!e)return s.jsxs("div",{className:"space-y-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard Admin"}),s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx(W,{className:"w-6 h-6 animate-spin text-gray-400 mr-2"}),s.jsx("span",{className:"text-gray-600",children:"Cargando estadísticas del dashboard..."})]})]});if(a&&!e)return s.jsxs("div",{className:"space-y-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard Admin"}),s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(H,{className:"w-5 h-5 text-red-400 mr-2"}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error cargando dashboard"}),s.jsx("p",{className:"text-sm text-red-700 mt-1",children:a}),s.jsx("button",{onClick:c,className:"mt-2 text-sm bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-md transition-colors",children:"Intentar nuevamente"})]})]})})]});if(!e)return null;const p=A=>({DollarSign:is,Users:os,ShoppingBag:Ss,Package:Us,Star:ge,Briefcase:pr,MessageSquare:hr,AlertTriangle:H})[A]||H,h=e.cards.map(A=>({...A,icon:p(A.icon)})),v=e.pendingCardItems.map(A=>({...A,icon:p(A.icon)})),f=e.alertItems.map(A=>({...A,icon:p(A.icon)}));return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard Admin"}),s.jsxs("div",{className:"flex items-center space-x-3",children:[o&&s.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[s.jsx(qe,{className:"w-4 h-4 mr-1"}),"Actualizado: ",new Date(o).toLocaleTimeString()]}),s.jsxs("button",{onClick:c,disabled:r,className:"flex items-center px-3 py-2 text-sm bg-primary-600 hover:bg-primary-700 disabled:bg-primary-400 text-white rounded-md transition-colors",children:[s.jsx(W,{className:`w-4 h-4 mr-1 ${r?"animate-spin":""}`}),"Actualizar"]})]})]}),s.jsx(fn,{cards:h}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[s.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Moderación Pendiente"}),s.jsx(yn,{items:v})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsx(Cn,{orders:e.recentOrders,title:"Pedidos Recientes",viewAllLink:"/admin/orders",onOrderClick:i}),s.jsx(An,{sellers:e.topSellers,title:"Mejores Vendedores",viewAllLink:"/admin/sellers",onSellerClick:d})]}),f.length>0&&s.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[s.jsxs("div",{className:"flex items-center mb-4",children:[s.jsx(H,{className:"w-5 h-5 text-amber-500 mr-2"}),s.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Alertas del Sistema"})]}),s.jsx(Sn,{items:f})]}),e.performanceMetrics&&s.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[s.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Métricas de Rendimiento"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-primary-600",children:[e.performanceMetrics.conversion_rate.toFixed(1),"%"]}),s.jsx("div",{className:"text-sm text-gray-600",children:"Tasa de Conversión"})]}),s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-green-600",children:["$",e.performanceMetrics.average_order_value.toFixed(2)]}),s.jsx("div",{className:"text-sm text-gray-600",children:"Valor Promedio de Orden"})]}),s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[e.performanceMetrics.order_fulfillment_rate.toFixed(1),"%"]}),s.jsx("div",{className:"text-sm text-gray-600",children:"Tasa de Cumplimiento"})]}),s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[e.performanceMetrics.customer_retention_rate.toFixed(1),"%"]}),s.jsx("div",{className:"text-sm text-gray-600",children:"Retención de Clientes"})]})]})]})]})},li=Object.freeze(Object.defineProperty({__proto__:null,default:Pn},Symbol.toStringTag,{value:"Module"}));class Rn{async getUsers(e=1,r=15){return(await G.get(D.ADMIN.USERS,{params:{page:e,per_page:r}})).data}async blockUser(e){return(await G.put(D.ADMIN.BLOCK_USER(e))).data.success}async unblockUser(e){return(await G.put(D.ADMIN.UNBLOCK_USER(e))).data.success}async sendPasswordResetEmail(e){return(await G.post(D.ADMIN.RESET_PASSWORD(e))).data.success}async getUserDetails(e){return(await G.get(D.ADMIN.USER_DETAIL(e))).data}async changeUserRole(e,r,a){return(await G.put(D.ADMIN.CHANGE_USER_ROLE(e),{role:r,...a})).data.success}async deleteUser(e){return(await G.delete(D.ADMIN.DELETE_USER(e))).data.success}}const In=()=>{const[t,e]=g.useState([]),[r,a]=g.useState(!0),[n,o]=g.useState(null),[i,d]=g.useState({currentPage:1,totalPages:5,totalItems:0,itemsPerPage:10}),c=new Rn,p=N=>{let w="customer";N.is_admin?w="admin":N.is_seller?w="seller":N.is_payment_user&&(w="payment");const E=N.is_blocked?"blocked":"active";return{id:N.id,name:N.name,email:N.email,role:w,status:E,lastLogin:N.last_login_at||"N/A",registeredDate:N.created_at,ordersCount:N.orders_count||0}},h=g.useCallback(async(N=1,w=10)=>{a(!0),o(null);try{const E=await c.getUsers(N,w),O=E.data.map(p);return e(O),d({currentPage:E.meta.current_page,totalPages:E.meta.last_page,totalItems:E.meta.total,itemsPerPage:E.meta.per_page}),O}catch(E){const O=Me(E,"Error al obtener la lista de usuarios");return console.error("Error fetching users:",O),o(O),[]}finally{a(!1)}},[]),v=g.useCallback(async(N,w)=>{a(!0),o(null);try{let E;return w?E=await c.unblockUser(N):E=await c.blockUser(N),E?(e(O=>O.map(b=>b.id===N?{...b,status:w?"active":"blocked"}:b)),!0):(o(`No se pudo ${w?"desbloquear":"bloquear"} al usuario`),!1)}catch(E){const O=Me(E,`Error al ${w?"desbloquear":"bloquear"} al usuario`);return console.error("Error toggling user status:",O),o(O),!1}finally{a(!1)}},[]),f=g.useCallback(async N=>{a(!0),o(null);try{const w=await c.sendPasswordResetEmail(N);return w||o("No se pudo enviar el correo de restablecimiento de contraseña"),w}catch(w){const E=Me(w,"Error al enviar correo de restablecimiento");return console.error("Error sending password reset:",E),o(E),!1}finally{a(!1)}},[]),A=g.useCallback(async N=>{a(!0),o(null);try{if(await c.deleteUser(N)){console.log("User deleted successfully, determining optimal page to reload...");const O=t.length===1,b=i.currentPage>1;let _=i.currentPage;O&&b&&(_=i.currentPage-1,console.log(`Last user in page ${i.currentPage}, moving to page ${_}`));try{await h(_,i.itemsPerPage),console.log(`Data successfully reloaded from server after deletion on page ${_}`)}catch(u){if(console.error("Error reloading data after deletion:",u),_>1){console.log("Fallback: trying to load page 1");try{await h(1,i.itemsPerPage)}catch(y){console.error("Fallback failed, updating locally:",y),e(m=>m.filter(T=>T.id!==N)),d(m=>({...m,totalItems:Math.max(0,m.totalItems-1),currentPage:Math.min(m.currentPage,Math.ceil((m.totalItems-1)/m.itemsPerPage)||1)}))}}else e(y=>y.filter(m=>m.id!==N)),d(y=>({...y,totalItems:Math.max(0,y.totalItems-1)}))}return!0}else return o("No se pudo eliminar al usuario"),!1}catch(w){const E=Me(w,"Error al eliminar usuario");return console.error("Error deleting user:",E),o(E),!1}finally{a(!1)}},[h,i.currentPage,i.itemsPerPage,t.length]),l=g.useCallback(async()=>{await h(i.currentPage,i.itemsPerPage)},[h,i.currentPage,i.itemsPerPage]),S=g.useCallback(N=>{const{role:w,status:E,searchTerm:O}=N;return t.filter(b=>{const _=!w||w==="all"||b.role===w,u=!E||E==="all"||b.status===E,y=!O||b.name.toLowerCase().includes(O.toLowerCase())||b.email.toLowerCase().includes(O.toLowerCase());return _&&u&&y})},[t]),x=g.useCallback(async(N,w,E)=>{a(!0),o(null);try{const O=await c.changeUserRole(N,w,E);return O&&await l(),O}catch(O){const b=Me(O);return o(b),console.error("Error al cambiar rol de usuario:",O),!1}finally{a(!1)}},[l]);return{users:t,loading:r,error:n,pagination:i,fetchUsers:h,toggleUserStatus:v,sendPasswordReset:f,changeUserRole:x,deleteUser:A,refreshData:l,filterUsers:S}},On=({isOpen:t,user:e,onClose:r,onConfirm:a,isLoading:n=!1})=>{const[o,i]=g.useState("customer"),[d,c]=g.useState(""),[p,h]=g.useState(""),[v,f]=g.useState({});if(!t)return null;const A=[{value:"customer",label:"Cliente",icon:s.jsx(_e,{className:"w-5 h-5"}),description:"Usuario normal del sistema",color:"text-gray-600"},{value:"seller",label:"Vendedor",icon:s.jsx(fr,{className:"w-5 h-5"}),description:"Puede vender productos en la plataforma",color:"text-blue-600"},{value:"admin",label:"Administrador",icon:s.jsx(Se,{className:"w-5 h-5"}),description:"Acceso completo al panel de administración",color:"text-purple-600"},{value:"payment",label:"Usuario de Pagos",icon:s.jsx(xr,{className:"w-5 h-5"}),description:"Gestión de pagos externos independiente",color:"text-green-600"}],l=w=>{switch(w){case"admin":return"Administrador";case"seller":return"Vendedor";case"customer":return"Cliente";case"payment":return"Usuario de Pagos";default:return"Cliente"}},S=()=>{const w={};return o==="seller"&&(!d||d.trim().length<3)&&(w.storeName="El nombre de la tienda debe tener al menos 3 caracteres"),f(w),Object.keys(w).length===0},x=async()=>{if(!S())return;const w=o==="seller"?{store_name:d.trim(),description:p.trim()}:void 0;await a(o,w)},N=()=>o==="customer"?"Al cambiar a cliente, el usuario perderá acceso a su panel actual, pero los datos se preservarán como inactivos (puede ser reactivado más tarde).":null;return s.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:r}),s.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg relative z-10 max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[s.jsx(os,{className:"mr-2 text-blue-600",size:24}),"Cambiar Rol de Usuario"]}),s.jsx("button",{onClick:r,className:"text-gray-500 hover:text-gray-700",disabled:n,children:s.jsx(ze,{size:20})})]}),s.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:s.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[s.jsx(_e,{className:"mr-2",size:16}),s.jsx("span",{className:"font-medium",children:e.name}),s.jsx("span",{className:"mx-2",children:"•"}),s.jsx("span",{children:e.email}),s.jsx("span",{className:"mx-2",children:"•"}),s.jsxs("span",{className:"capitalize",children:["Actual: ",l(e.role)]})]})}),s.jsxs("div",{className:"space-y-3 mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nuevo Rol"}),A.map(w=>s.jsxs("label",{className:`flex items-center p-3 border rounded-lg cursor-pointer transition-colors ${o===w.value?"border-primary-500 bg-primary-50":"border-gray-300 hover:bg-gray-50"}`,children:[s.jsx("input",{type:"radio",name:"role",value:w.value,checked:o===w.value,onChange:E=>i(E.target.value),className:"sr-only"}),s.jsx("div",{className:`mr-3 ${w.color}`,children:w.icon}),s.jsxs("div",{className:"flex-grow",children:[s.jsx("div",{className:"font-medium text-gray-900",children:w.label}),s.jsx("div",{className:"text-sm text-gray-500",children:w.description})]})]},w.value))]}),o==="seller"&&s.jsxs("div",{className:"space-y-4 mb-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[s.jsx("h3",{className:"font-medium text-blue-900",children:"Datos de la Tienda"}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"store_name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de la Tienda *"}),s.jsx("input",{type:"text",id:"store_name",className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 ${v.storeName?"border-red-500":"border-gray-300"}`,value:d,onChange:w=>c(w.target.value),disabled:n}),v.storeName&&s.jsx("p",{className:"mt-1 text-sm text-red-500",children:v.storeName})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),s.jsx("textarea",{id:"description",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:p,onChange:w=>h(w.target.value),rows:3,disabled:n})]})]}),N()&&s.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:s.jsxs("div",{className:"flex",children:[s.jsx(me,{className:"w-5 h-5 text-yellow-600 mr-2 flex-shrink-0 mt-0.5"}),s.jsx("p",{className:"text-sm text-yellow-800",children:N()})]})}),s.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[s.jsx("button",{onClick:r,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100",disabled:n,children:"Cancelar"}),s.jsx("button",{onClick:x,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",disabled:n,children:n?"Cambiando...":"Cambiar Rol"})]})]})]})},kn=()=>{const{loading:t,error:e,pagination:r,fetchUsers:a,toggleUserStatus:n,sendPasswordReset:o,changeUserRole:i,deleteUser:d,filterUsers:c}=In(),[p,h]=g.useState("all"),[v,f]=g.useState("all"),[A,l]=g.useState(""),[S,x]=g.useState(null),[N,w]=g.useState(!1),[E,O]=g.useState(null),[b,_]=g.useState(""),[u,y]=g.useState(""),[m,T]=g.useState({}),[R,U]=g.useState(!1),[k,Z]=g.useState(null),[K,fe]=g.useState(""),[ae,xe]=g.useState(""),[P,Q]=g.useState("notification"),[J,Re]=g.useState(!1),[Y,ye]=g.useState({}),[Ie,C]=g.useState(!1),[M,F]=g.useState(null),[V,Oe]=g.useState(!1),[ke,De]=g.useState(!1),[Ee,We]=g.useState(null);g.useEffect(()=>{a(r.currentPage,r.itemsPerPage)},[a,r.currentPage,r.itemsPerPage]);const Vs=c({role:p,status:v,searchTerm:A}),Yt=async(I,Ue)=>{const $e=Ue==="blocked";await n(I,$e)&&(x(`Usuario ${$e?"desbloqueado":"bloqueado"} correctamente.`),setTimeout(()=>x(null),3e3))},Zt=async I=>{await o(I)&&(x("Correo de restablecimiento de contraseña enviado correctamente."),setTimeout(()=>x(null),3e3))},Ke=()=>{w(!1),O(null),_(""),y(""),T({})},Qt=()=>{const I={};return(!b||b.trim().length<3)&&(I.storeName="El nombre de la tienda debe tener al menos 3 caracteres"),T(I),Object.keys(I).length===0},er=async()=>{E&&Qt()&&await i(E,"seller",{store_name:b,description:u})&&(x("Usuario convertido en vendedor correctamente."),Ke(),setTimeout(()=>x(null),3e3))},sr=I=>{a(I,r.itemsPerPage)},tr=()=>{a(r.currentPage,r.itemsPerPage)},rr=I=>{Z(I),fe(""),xe(""),Q("notification"),ye({}),U(!0)},Je=()=>{U(!1),Z(null),fe(""),xe(""),Q("notification"),ye({})},ar=()=>{const I={};return(!K||K.trim().length<3)&&(I.subject="El asunto debe tener al menos 3 caracteres"),(!ae||ae.trim().length<10)&&(I.message="El mensaje debe tener al menos 10 caracteres"),ae.length>5e3&&(I.message="El mensaje no puede exceder 5000 caracteres"),ye(I),Object.keys(I).length===0},nr=async()=>{if(k&&ar()){Re(!0);try{const I=await $.post(D.ADMIN.CONFIGURATIONS.MAIL_SEND_CUSTOM,{user_id:k.id,subject:K.trim(),message:ae.trim(),email_type:P});I.status==="success"?(x("Email enviado correctamente."),Je(),setTimeout(()=>x(null),5e3)):ye({general:I.message||"Error al enviar el email"})}catch(I){console.error("Error sending custom email:",I),ye({general:"Error de conexión al enviar el email"})}finally{Re(!1)}}},or=I=>{F(I),C(!0)},Xe=()=>{C(!1),F(null)},ir=async()=>{if(M){Oe(!0);try{console.log("Attempting to delete user:",M.id),await d(M.id)?(console.log("User deleted successfully, hook will handle refresh automatically"),x("Usuario eliminado correctamente."),Xe(),setTimeout(()=>x(null),3e3)):(console.error("Delete operation failed"),x("Error al eliminar el usuario."))}catch(I){console.error("Error deleting user:",I),x("Error al eliminar el usuario.")}finally{Oe(!1)}}},lr=I=>{We(I),De(!0)},Gs=()=>{De(!1),We(null)},cr=async(I,Ue)=>{if(Ee)try{await i(Ee.id,I,Ue)&&(x(`Usuario convertido a ${I==="customer"?"cliente":I==="seller"?"vendedor":I==="admin"?"administrador":"usuario de pagos"} correctamente.`),Gs(),setTimeout(()=>x(null),3e3))}catch($e){console.error("Error changing user role:",$e)}},dr=[{key:"user",header:"Usuario",sortable:!0,render:I=>s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:s.jsx(_e,{className:"h-6 w-6 text-gray-500"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:I.name}),s.jsx("div",{className:"text-sm text-gray-500",children:I.email})]})]})},{key:"role",header:"Rol",sortable:!0,render:I=>s.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${I.role==="admin"?"bg-red-100 text-red-800":I.role==="seller"?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"}`,children:[I.role==="admin"&&"Administrador",I.role==="seller"&&"Vendedor",I.role==="payment"&&"Usuario de Pagos",I.role==="customer"&&"Cliente"]})},{key:"status",header:"Estado",sortable:!0,render:I=>s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${I.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:I.status==="active"?"Activo":"Bloqueado"})},{key:"registeredDate",header:"Registrado",sortable:!0},{key:"ordersCount",header:"Pedidos",sortable:!0},{key:"actions",header:"Acciones",render:I=>s.jsxs("div",{className:"flex justify-end space-x-2",children:[s.jsx("button",{onClick:()=>Yt(I.id,I.status),className:`p-1 rounded-md ${I.status==="active"?"text-red-600 hover:bg-red-100":"text-green-600 hover:bg-green-100"}`,title:I.status==="active"?"Bloquear Usuario":"Desbloquear Usuario",children:I.status==="active"?s.jsx($s,{size:18}):s.jsx(br,{size:18})}),s.jsx("button",{onClick:()=>Zt(I.id),className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Enviar Restablecimiento de Contraseña",children:s.jsx(gt,{size:18})}),s.jsx("button",{onClick:()=>rr(I),className:"p-1 text-orange-600 hover:bg-orange-100 rounded-md",title:"Enviar Email Personalizado",children:s.jsx(Hs,{size:18})}),s.jsx("button",{onClick:()=>lr(I),className:"p-1 text-indigo-600 hover:bg-indigo-100 rounded-md",title:"Cambiar Rol",children:s.jsx(os,{size:18})}),s.jsx("button",{onClick:()=>or(I),className:"p-1 text-red-600 hover:bg-red-100 rounded-md",title:"Eliminar Usuario",children:s.jsx(ve,{size:18})})]})}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Usuarios"}),s.jsx("div",{className:"flex space-x-2",children:s.jsxs("button",{onClick:tr,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",disabled:t,children:[s.jsx(W,{size:18,className:`inline mr-2 ${t?"animate-spin":""}`}),"Actualizar"]})})]}),e&&s.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(me,{className:"h-5 w-5 mr-2"}),s.jsx("span",{children:e})]})}),S&&s.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",children:s.jsx("span",{children:S})}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(ls,{className:"h-5 w-5 text-gray-500"}),s.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:p,onChange:I=>h(I.target.value),children:[s.jsx("option",{value:"all",children:"Todos los Roles"}),s.jsx("option",{value:"customer",children:"Cliente"}),s.jsx("option",{value:"seller",children:"Vendedor"}),s.jsx("option",{value:"admin",children:"Administrador"}),s.jsx("option",{value:"payment",children:"Usuario de Pagos"})]})]}),s.jsx("div",{className:"flex items-center space-x-2",children:s.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:v,onChange:I=>f(I.target.value),children:[s.jsx("option",{value:"all",children:"Todos los Estados"}),s.jsx("option",{value:"active",children:"Activo"}),s.jsx("option",{value:"blocked",children:"Bloqueado"})]})}),s.jsx("div",{className:"flex-grow",children:s.jsx("input",{type:"text",placeholder:"Buscar por nombre o email...",className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:A,onChange:I=>l(I.target.value)})})]})}),s.jsx(fs,{data:Vs,columns:dr,searchFields:["name","email"],loading:t,emptyMessage:"No se encontraron usuarios",pagination:{currentPage:r.currentPage,totalPages:r.totalPages,totalItems:r.totalItems,itemsPerPage:r.itemsPerPage,onPageChange:sr}},`users-table-${Vs.length}`),N&&s.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:Ke}),s.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md relative z-10",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Convertir en Vendedor"}),s.jsx("button",{onClick:Ke,className:"text-gray-500 hover:text-gray-700",children:s.jsx(ze,{size:20})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"store_name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de la Tienda *"}),s.jsx("input",{type:"text",id:"store_name",className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 ${m.storeName?"border-red-500":"border-gray-300"}`,value:b,onChange:I=>_(I.target.value)}),m.storeName&&s.jsx("p",{className:"mt-1 text-sm text-red-500",children:m.storeName})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),s.jsx("textarea",{id:"description",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:u,onChange:I=>y(I.target.value),rows:4})]}),s.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[s.jsx("button",{onClick:Ke,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100",children:"Cancelar"}),s.jsx("button",{onClick:er,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",disabled:t,children:t?"Procesando...":"Guardar"})]})]})]})]}),R&&k&&s.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:Je}),s.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl relative z-10 max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[s.jsx(Hs,{className:"mr-2 text-orange-600",size:24}),"Enviar Email a ",k.name]}),s.jsx("button",{onClick:Je,className:"text-gray-500 hover:text-gray-700",children:s.jsx(ze,{size:20})})]}),s.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:s.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[s.jsx(_e,{className:"mr-2",size:16}),s.jsx("span",{className:"font-medium",children:k.name}),s.jsx("span",{className:"mx-2",children:"•"}),s.jsx("span",{children:k.email}),s.jsx("span",{className:"mx-2",children:"•"}),s.jsx("span",{className:"capitalize",children:k.role})]})}),Y.general&&s.jsx("div",{className:"mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(me,{className:"h-5 w-5 mr-2"}),s.jsx("span",{children:Y.general})]})}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"email_type",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Email"}),s.jsxs("select",{id:"email_type",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:P,onChange:I=>Q(I.target.value),children:[s.jsx("option",{value:"notification",children:"Notificación"}),s.jsx("option",{value:"announcement",children:"Anuncio"}),s.jsx("option",{value:"warning",children:"Advertencia"})]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"email_subject",className:"block text-sm font-medium text-gray-700 mb-1",children:"Asunto *"}),s.jsx("input",{type:"text",id:"email_subject",className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 ${Y.subject?"border-red-500":"border-gray-300"}`,value:K,onChange:I=>fe(I.target.value),placeholder:"Ingresa el asunto del email...",maxLength:255}),Y.subject&&s.jsx("p",{className:"mt-1 text-sm text-red-500",children:Y.subject}),s.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[K.length,"/255 caracteres"]})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"email_message",className:"block text-sm font-medium text-gray-700 mb-1",children:"Mensaje *"}),s.jsx("textarea",{id:"email_message",className:`w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 ${Y.message?"border-red-500":"border-gray-300"}`,value:ae,onChange:I=>xe(I.target.value),placeholder:"Escribe tu mensaje aquí...",rows:8,maxLength:5e3}),Y.message&&s.jsx("p",{className:"mt-1 text-sm text-red-500",children:Y.message}),s.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[ae.length,"/5000 caracteres"]})]}),s.jsxs("div",{className:"flex justify-end space-x-3 mt-6 pt-4 border-t",children:[s.jsx("button",{onClick:Je,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100",disabled:J,children:"Cancelar"}),s.jsx("button",{onClick:nr,className:"px-6 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors flex items-center",disabled:J,children:J?s.jsxs(s.Fragment,{children:[s.jsx(W,{className:"animate-spin -ml-1 mr-2 h-4 w-4"}),"Enviando..."]}):s.jsxs(s.Fragment,{children:[s.jsx(yr,{className:"-ml-1 mr-2 h-4 w-4"}),"Enviar Email"]})})]})]})]})]}),Ie&&M&&s.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:[s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:Xe}),s.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md relative z-10",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[s.jsx(ve,{className:"mr-2 text-red-600",size:24}),"Confirmar Eliminación"]}),s.jsx("button",{onClick:Xe,className:"text-gray-500 hover:text-gray-700",disabled:V,children:s.jsx(ze,{size:20})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("p",{className:"text-gray-700 mb-3",children:["¿Está seguro de que desea eliminar al usuario"," ",s.jsx("strong",{children:M.name}),"?"]}),s.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-3",children:s.jsxs("p",{className:"text-yellow-800 text-sm flex items-center",children:[s.jsx(me,{className:"mr-2",size:16}),"Esta acción no se puede deshacer. El usuario será eliminado permanentemente del sistema."]})}),s.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded",children:[s.jsxs("p",{className:"text-sm text-gray-600",children:[s.jsx("strong",{children:"Email:"})," ",M.email]}),s.jsxs("p",{className:"text-sm text-gray-600",children:[s.jsx("strong",{children:"Rol:"})," ",M.role==="admin"?"Administrador":M.role==="seller"?"Vendedor":M.role==="payment"?"Usuario de Pagos":"Cliente"]}),s.jsxs("p",{className:"text-sm text-gray-600",children:[s.jsx("strong",{children:"Pedidos:"})," ",M.ordersCount]})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx("button",{onClick:Xe,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100",disabled:V,children:"Cancelar"}),s.jsx("button",{onClick:ir,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center",disabled:V,children:V?s.jsxs(s.Fragment,{children:[s.jsx(W,{className:"animate-spin -ml-1 mr-2 h-4 w-4"}),"Eliminando..."]}):s.jsxs(s.Fragment,{children:[s.jsx(ve,{className:"-ml-1 mr-2 h-4 w-4"}),"Eliminar Usuario"]})})]})]})]}),ke&&Ee&&s.jsx(On,{isOpen:ke,user:Ee,onClose:Gs,onConfirm:cr,isLoading:t})]})},ci=Object.freeze(Object.defineProperty({__proto__:null,default:kn},Symbol.toStringTag,{value:"Module"}));class Dn{async getAllProducts(e){try{console.log("📤 AdminProductService: Obteniendo todos los productos como admin:",e);const r={...e};r&&"admin_view"in r&&delete r.admin_view;const a=await $.get(D.ADMIN.PRODUCTS.LIST,r);return console.log("📥 AdminProductService: Respuesta del servidor:",a),a}catch(r){return console.error("❌ Error en AdminProductService.getAllProducts:",r),null}}async getProductById(e){try{return console.log(`📤 AdminProductService: Obteniendo producto ${e} como admin`),(await $.get(D.PRODUCTS.DETAILS(e)))?.data||null}catch(r){return console.error("❌ Error en AdminProductService.getProductById:",r),null}}async createProduct(e,r){try{console.log("📤 AdminProductService: Creando producto como admin:",e);const a=new FormData;if(a.append("name",e.name),a.append("description",e.description),a.append("price",String(e.price)),a.append("stock",String(e.stock)),a.append("category_id",String(e.category_id)),r&&a.append("seller_id",String(r)),e.shortDescription&&a.append("short_description",e.shortDescription),e.weight!==void 0&&a.append("weight",String(e.weight)),e.width!==void 0&&a.append("width",String(e.width)),e.height!==void 0&&a.append("height",String(e.height)),e.depth!==void 0&&a.append("depth",String(e.depth)),e.dimensions&&a.append("dimensions",e.dimensions),e.sku&&a.append("sku",e.sku),e.status&&a.append("status",e.status),e.featured!==void 0&&a.append("featured",String(e.featured)),e.published!==void 0&&a.append("published",String(e.published)),e.discount_percentage!==void 0&&a.append("discount_percentage",String(e.discount_percentage)),e.colors){const o=typeof e.colors=="string"?e.colors:JSON.stringify(e.colors);a.append("colors",o)}if(e.sizes){const o=typeof e.sizes=="string"?e.sizes:JSON.stringify(e.sizes);a.append("sizes",o)}if(e.tags){const o=typeof e.tags=="string"?e.tags:JSON.stringify(e.tags);a.append("tags",o)}e.attributes&&Object.keys(e.attributes).length>0&&a.append("attributes",JSON.stringify(e.attributes)),e.images&&e.images.length>0&&e.images.forEach((o,i)=>{a.append(`images[${i}]`,o)});const n=await $.uploadFile(D.PRODUCTS.CREATE,a);return console.log("✅ AdminProductService: Producto creado:",n),n}catch(a){return console.error("❌ Error en AdminProductService.createProduct:",a),null}}async updateProduct(e){try{console.log(`📤 AdminProductService: Actualizando producto ${e.id} como admin:`,e);const r=new FormData;if(e.name&&r.append("name",e.name),e.description&&r.append("description",e.description),e.shortDescription&&r.append("short_description",e.shortDescription),e.price!==void 0&&r.append("price",String(e.price)),e.stock!==void 0&&r.append("stock",String(e.stock)),e.category_id&&r.append("category_id",String(e.category_id)),e.weight!==void 0&&r.append("weight",String(e.weight)),e.width!==void 0&&r.append("width",String(e.width)),e.height!==void 0&&r.append("height",String(e.height)),e.depth!==void 0&&r.append("depth",String(e.depth)),e.dimensions&&r.append("dimensions",e.dimensions),e.sku&&r.append("sku",e.sku),e.status&&r.append("status",e.status),e.featured!==void 0&&r.append("featured",String(e.featured)),e.published!==void 0&&r.append("published",String(e.published)),e.discount_percentage!==void 0&&r.append("discount_percentage",String(e.discount_percentage)),e.colors){const n=typeof e.colors=="string"?e.colors:JSON.stringify(e.colors);r.append("colors",n)}if(e.sizes){const n=typeof e.sizes=="string"?e.sizes:JSON.stringify(e.sizes);r.append("sizes",n)}if(e.tags){const n=typeof e.tags=="string"?e.tags:JSON.stringify(e.tags);r.append("tags",n)}e.attributes&&Object.keys(e.attributes).length>0&&r.append("attributes",JSON.stringify(e.attributes)),e.replace_images!==void 0&&r.append("replace_images",String(e.replace_images)),e.remove_images&&e.remove_images.length>0&&r.append("remove_images",JSON.stringify(e.remove_images)),e.images&&e.images.length>0&&e.images.forEach((n,o)=>{r.append(`images[${o}]`,n)});const a=await $.updateFile(D.PRODUCTS.UPDATE(e.id),r);return console.log("✅ AdminProductService: Producto actualizado:",a),a}catch(r){return console.error("❌ Error en AdminProductService.updateProduct:",r),null}}async deleteProduct(e){try{console.log(`📤 AdminProductService: Eliminando producto ${e} como admin`);const r=await $.delete(D.ADMIN.PRODUCTS.DELETE(e));return console.log("✅ AdminProductService: Producto eliminado:",r),!0}catch(r){return console.error("❌ Error en AdminProductService.deleteProduct:",r),!1}}async toggleFeatured(e,r){try{console.log(`📤 AdminProductService: Cambiando featured del producto ${e} a ${r}`);const a=await $.patch(D.ADMIN.PRODUCTS.PARTIAL_UPDATE(e),{featured:r});return console.log("✅ AdminProductService: Featured actualizado:",a),!0}catch(a){return console.error("❌ Error en AdminProductService.toggleFeatured:",a),a instanceof Error&&console.error("Error message:",a.message),!1}}async togglePublished(e,r){try{console.log(`📤 AdminProductService: Cambiando published del producto ${e} a ${r}`);const a=await $.patch(D.ADMIN.PRODUCTS.PARTIAL_UPDATE(e),{published:r});return console.log("✅ AdminProductService: Published actualizado:",a),!0}catch(a){return console.error("❌ Error en AdminProductService.togglePublished:",a),a instanceof Error&&console.error("Error message:",a.message),!1}}async updateStatus(e,r){try{console.log(`📤 AdminProductService: Cambiando status del producto ${e} a ${r}`);const a=await $.patch(D.ADMIN.PRODUCTS.PARTIAL_UPDATE(e),{status:r});return console.log("✅ AdminProductService: Status actualizado:",a),!0}catch(a){return console.error("❌ Error en AdminProductService.updateStatus:",a),a instanceof Error&&console.error("Error message:",a.message),!1}}async getProductStats(){try{console.log("📤 AdminProductService: Obteniendo estadísticas de productos");const e=await $.get(D.ADMIN.PRODUCTS.STATS);return console.log("✅ AdminProductService: Estadísticas obtenidas:",e),e}catch(e){return console.error("❌ Error en AdminProductService.getProductStats:",e),null}}async getProductsBySeller(e,r){try{console.log(`📤 AdminProductService: Obteniendo productos del vendedor ${e}`);const a=await $.get(D.PRODUCTS.BY_SELLER(e),r);return console.log("✅ AdminProductService: Productos del vendedor obtenidos:",a),a}catch(a){return console.error("❌ Error en AdminProductService.getProductsBySeller:",a),null}}}class Un{adminProductService;constructor(e){this.adminProductService=e}async execute(e){console.log("GetAllProductsUseCase: Obteniendo todos los productos como admin");try{const r=await this.adminProductService.getAllProducts(e);return console.log("GetAllProductsUseCase: Productos obtenidos correctamente:",r),r}catch(r){throw console.error("GetAllProductsUseCase: Error al obtener productos:",r),r}}}class $n{adminProductService;constructor(e){this.adminProductService=e}async execute(e,r){console.log("CreateProductAsAdminUseCase: Creando producto como admin:",e);try{const a=await this.adminProductService.createProduct(e,r);return console.log("CreateProductAsAdminUseCase: Producto creado correctamente:",a),a}catch(a){throw console.error("CreateProductAsAdminUseCase: Error al crear producto:",a),a}}}class Ln{adminProductService;constructor(e){this.adminProductService=e}async execute(e){console.log(`UpdateAnyProductUseCase: Actualizando producto ${e.id} como admin:`,e);try{const r=await this.adminProductService.updateProduct(e);return console.log("UpdateAnyProductUseCase: Producto actualizado correctamente:",r),r}catch(r){throw console.error("UpdateAnyProductUseCase: Error al actualizar producto:",r),r}}}class Mn{adminProductService;constructor(e){this.adminProductService=e}async execute(e){console.log(`DeleteAnyProductUseCase: Eliminando producto ${e} como admin`);try{const r=await this.adminProductService.deleteProduct(e);return console.log("DeleteAnyProductUseCase: Producto eliminado correctamente:",r),r}catch(r){throw console.error("DeleteAnyProductUseCase: Error al eliminar producto:",r),r}}}class Fn{adminProductService;constructor(e){this.adminProductService=e}async execute(e,r){console.log(`ToggleProductFeaturedUseCase: Cambiando featured del producto ${e} a ${r}`);try{const a=await this.adminProductService.toggleFeatured(e,r);return console.log("ToggleProductFeaturedUseCase: Featured actualizado correctamente:",a),a}catch(a){throw console.error("ToggleProductFeaturedUseCase: Error al cambiar featured:",a),a}}}class zn{adminProductService;constructor(e){this.adminProductService=e}async execute(e,r){console.log(`ToggleProductPublishedUseCase: Cambiando published del producto ${e} a ${r}`);try{const a=await this.adminProductService.togglePublished(e,r);return console.log("ToggleProductPublishedUseCase: Published actualizado correctamente:",a),a}catch(a){throw console.error("ToggleProductPublishedUseCase: Error al cambiar published:",a),a}}}class Bn{adminProductService;constructor(e){this.adminProductService=e}async execute(e,r){console.log(`UpdateProductStatusUseCase: Cambiando status del producto ${e} a ${r}`);try{const a=await this.adminProductService.updateStatus(e,r);return console.log("UpdateProductStatusUseCase: Status actualizado correctamente:",a),a}catch(a){throw console.error("UpdateProductStatusUseCase: Error al cambiar status:",a),a}}}class qn{adminProductService;constructor(e){this.adminProductService=e}async execute(e,r){console.log(`GetProductsBySellerUseCase: Obteniendo productos del vendedor ${e}`);try{const a=await this.adminProductService.getProductsBySeller(e,r);return console.log("GetProductsBySellerUseCase: Productos obtenidos correctamente:",a),a}catch(a){throw console.error("GetProductsBySellerUseCase: Error al obtener productos del vendedor:",a),a}}}class Vn{adminProductService;constructor(e){this.adminProductService=e}async execute(){console.log("GetProductStatsUseCase: Obteniendo estadísticas de productos");try{const e=await this.adminProductService.getProductStats();return console.log("GetProductStatsUseCase: Estadísticas obtenidas correctamente:",e),e}catch(e){throw console.error("GetProductStatsUseCase: Error al obtener estadísticas:",e),e}}}const le=new Dn,Gn=new Un(le),Hn=new $n(le),Wn=new Ln(le),Kn=new Mn(le),Jn=new Fn(le),Xn=new zn(le),Yn=new Bn(le),Zn=new qn(le),Qn=new Vn(le),eo=t=>t?`admin_products_${JSON.stringify(t)}`:"admin_products_default",so=()=>{const[t,e]=g.useState(!1),[r,a]=g.useState(null),[n,o]=g.useState([]),[i,d]=g.useState(null),[c,p]=g.useState(null),[h,v]=g.useState(null),{invalidateAfterMutation:f}=Ht(),A=g.useCallback(m=>{if(!m||typeof m!="object")return console.error("Producto inválido para adaptar:",m),{};let T=[];m.main_image?T=[m.main_image]:Array.isArray(m.images)&&m.images.length>0?T=m.images.map(k=>typeof k=="string"?k:typeof k=="object"&&k!==null&&(k.original||k.large||k.medium||k.url||k.path)||"").filter(Boolean):m.image&&(T=[m.image]);let R=[];return Array.isArray(m.tags)&&m.tags.forEach(k=>{if(typeof k=="string")try{const Z=JSON.parse(k);Array.isArray(Z)?R.push(...Z):R.push(k)}catch{R.push(k)}}),{id:m.id,userId:m.user_id,sellerId:m.seller_id,categoryId:m.category_id,name:m.name,slug:m.slug,description:m.description||"",shortDescription:m.short_description,price:Number(m.price||0),finalPrice:Number(m.final_price||m.price||0),stock:Number(m.stock||0),weight:m.weight,width:m.width,height:m.height,depth:m.depth,dimensions:m.dimensions,colors:m.colors,sizes:m.sizes,tags:R,sku:m.sku,attributes:m.attributes,images:T,featured:!!m.featured,published:!!(m.published??!0),status:m.status||"active",viewCount:m.view_count||0,salesCount:m.sales_count||0,discountPercentage:Number(m.discount_percentage||0),isInStock:!!(m.is_in_stock??m.stock>0),rating:Number(m.rating||0),ratingCount:Number(m.rating_count||0),createdAt:m.created_at,updatedAt:m.updated_at,created_at:m.created_at||m.createdAt||new Date().toISOString(),category_name:m.category?.name||m.category_name||"Sin categoría",category:m.category_name?{id:m.category_id,name:m.category_name}:m.category,seller:m.seller,user:m.user,isNew:void 0}},[]),l=g.useCallback(async(m,T=!1)=>{e(!0),a(null);try{const R=eo(m);if(!T){const k=ce.getItem(R);if(k)return console.log("💾 useAdminProducts: Usando datos en caché"),o(k.data||[]),v(k.meta||null),e(!1),k}console.log("🌐 useAdminProducts: Obteniendo productos desde API"),console.log("📊 useAdminProducts: FilterParams enviados:",m);const U=await Gn.execute(m);if(console.log("📥 useAdminProducts: Respuesta completa recibida:",U),U){let k=[],Z=null;U.data&&Array.isArray(U.data)?(k=U.data.map(A),Z=U.meta):Array.isArray(U)?(k=U.map(A),Z={total:U.length,limit:m?.limit||10,offset:m?.offset||0}):(console.warn("⚠️ Estructura de respuesta no reconocida:",U),k=[],Z={total:0,limit:0,offset:0});const K={data:k,meta:Z||{total:k.length,limit:m?.limit||10,offset:m?.offset||0}};return ce.setItem(R,K,q.cache.productCacheTime),o(k),v(K.meta),K}else return o([]),v({total:0,limit:0,offset:0}),{data:[],meta:{total:0,limit:0,offset:0}}}catch(R){const U=R instanceof Error?R.message:"Error al obtener productos";return console.error("❌ Error obteniendo productos:",R),a(U),o([]),v({total:0,limit:0,offset:0}),null}finally{e(!1)}},[A]),S=g.useCallback(async m=>{e(!0),a(null);try{const T=await le.getProductById(m);return d(T),T}catch(T){const R=T instanceof Error?T.message:"Error al obtener producto";return a(R),d(null),null}finally{e(!1)}},[]),x=g.useCallback(async(m,T)=>{e(!0),a(null);try{const R=await Hn.execute(m,T);return R&&f(["admin_products_*","products_*","products_featured_*"]),R}catch(R){const U=R instanceof Error?R.message:"Error al crear producto";return a(U),null}finally{e(!1)}},[f]),N=g.useCallback(async m=>{e(!0),a(null);try{const T=await Wn.execute(m);return T&&(o(R=>R.map(U=>U.id===m.id?A(T):U)),f(["admin_products_*","products_*",`product_${m.id}`,"products_featured_*"])),T}catch(T){const R=T instanceof Error?T.message:"Error al actualizar producto";return a(R),null}finally{e(!1)}},[A,f]),w=g.useCallback(async m=>{e(!0),a(null);try{const T=await Kn.execute(m);return T&&(o(R=>R.filter(U=>U.id!==m)),f(["admin_products_*","products_*",`product_${m}`,"products_featured_*"])),T}catch(T){const R=T instanceof Error?T.message:"Error al eliminar producto";return a(R),!1}finally{e(!1)}},[f]),E=g.useCallback(async(m,T)=>{a(null);try{const R=await Jn.execute(m,T);return R?(o(U=>U.map(k=>k.id===m?{...k,featured:T}:k)),f(["admin_products_*","products_*",`product_${m}`,"products_featured_*"])):a("Error al cambiar estado destacado del producto"),R}catch(R){const U=R instanceof Error?R.message:"Error al cambiar estado destacado";return console.error("❌ Error en toggleFeatured:",R),a(U),!1}},[f]),O=g.useCallback(async(m,T)=>{a(null);try{const R=await Xn.execute(m,T);return R?(o(U=>U.map(k=>k.id===m?{...k,published:T}:k)),f(["admin_products_*","products_*",`product_${m}`,"products_featured_*"])):a("Error al cambiar estado de publicación del producto"),R}catch(R){const U=R instanceof Error?R.message:"Error al cambiar estado de publicación";return console.error("❌ Error en togglePublished:",R),a(U),!1}},[f]),b=g.useCallback(async(m,T)=>{a(null);try{const R=await Yn.execute(m,T);return R?(o(U=>U.map(k=>k.id===m?{...k,status:T}:k)),f(["admin_products_*","products_*",`product_${m}`,"products_featured_*"])):a("Error al actualizar estado del producto"),R}catch(R){const U=R instanceof Error?R.message:"Error al actualizar estado";return console.error("❌ Error en updateStatus:",R),a(U),!1}},[f]),_=g.useCallback(async(m,T)=>{e(!0),a(null);try{const R=await Zn.execute(m,T);if(R&&Array.isArray(R.data)){const U=R.data.map(A);o(U),v(R.meta||null)}return R}catch(R){const U=R instanceof Error?R.message:"Error al obtener productos del vendedor";return a(U),null}finally{e(!1)}},[A]),u=g.useCallback(async()=>{e(!0),a(null);try{const m=await Qn.execute();return p(m),m}catch(m){const T=m instanceof Error?m.message:"Error al obtener estadísticas";return a(T),null}finally{e(!1)}},[]),y=g.useCallback(m=>{m?(f([`product_${m}`]),console.log(`🗑️ Caché del producto ${m} invalidada`)):(f(["admin_products_*","products_*","product_*"]),console.log("🗑️ Toda la caché de productos invalidada"))},[f]);return{loading:t,error:r,products:n,productDetail:i,stats:c,meta:h,fetchAllProducts:l,fetchProductById:S,createProduct:x,updateProduct:N,deleteProduct:w,toggleFeatured:E,togglePublished:O,updateStatus:b,fetchProductsBySeller:_,fetchProductStats:u,clearProductCache:y,setError:m=>a(m),setLoading:m=>e(m)}};class to{async getAllCategories(e){try{console.log("📤 AdminCategoryService: Obteniendo todas las categorías como admin:",e);const r=await $.get(D.CATEGORIES.LIST,e);return console.log("📥 AdminCategoryService: Respuesta del servidor:",r),r}catch(r){return console.error("❌ Error en AdminCategoryService.getAllCategories:",r),null}}async getCategoryById(e){try{console.log(`📤 AdminCategoryService: Obteniendo categoría ${e} como admin`);const r=await $.get(D.CATEGORIES.DETAILS(e));return console.log("✅ AdminCategoryService: Categoría obtenida:",r),r}catch(r){return console.error("❌ Error en AdminCategoryService.getCategoryById:",r),null}}async createCategory(e){try{console.log("📤 AdminCategoryService: Creando categoría como admin:",e);const r=await $.post(D.ADMIN.CATEGORIES.CREATE,e);return console.log("✅ AdminCategoryService: Categoría creada:",r),r}catch(r){return console.error("❌ Error en AdminCategoryService.createCategory:",r),null}}async updateCategory(e){try{if(console.log(`📤 AdminCategoryService: Actualizando categoría ${e.id} como admin:`,e),!e.id)throw new Error("ID de categoría requerido para actualización");const r=await $.put(D.ADMIN.CATEGORIES.UPDATE(e.id),e);return console.log("✅ AdminCategoryService: Categoría actualizada:",r),r}catch(r){return console.error("❌ Error en AdminCategoryService.updateCategory:",r),null}}async partialUpdateCategory(e,r){try{console.log(`📤 AdminCategoryService: Actualizando parcialmente categoría ${e} como admin:`,r);const a=await $.patch(D.ADMIN.CATEGORIES.PARTIAL_UPDATE(e),r);return console.log("✅ AdminCategoryService: Categoría actualizada parcialmente:",a),a}catch(a){return console.error("❌ Error en AdminCategoryService.partialUpdateCategory:",a),null}}async deleteCategory(e){try{console.log(`📤 AdminCategoryService: Eliminando categoría ${e} como admin`);const r=await $.delete(D.ADMIN.CATEGORIES.DELETE(e));return console.log("✅ AdminCategoryService: Categoría eliminada:",r),!0}catch(r){return console.error("❌ Error en AdminCategoryService.deleteCategory:",r),!1}}async toggleActive(e,r){try{console.log(`📤 AdminCategoryService: Cambiando estado activo de categoría ${e} a ${r}`);const a=await $.patch(D.ADMIN.CATEGORIES.PARTIAL_UPDATE(e),{is_active:r});return console.log("✅ AdminCategoryService: Estado activo actualizado:",a),!0}catch(a){return console.error("❌ Error en AdminCategoryService.toggleActive:",a),a instanceof Error&&console.error("Error message:",a.message),!1}}async toggleFeatured(e,r){try{console.log(`📤 AdminCategoryService: Cambiando estado destacado de categoría ${e} a ${r}`);const a=await $.patch(D.ADMIN.CATEGORIES.PARTIAL_UPDATE(e),{featured:r});return console.log("✅ AdminCategoryService: Estado destacado actualizado:",a),!0}catch(a){return console.error("❌ Error en AdminCategoryService.toggleFeatured:",a),a instanceof Error&&console.error("Error message:",a.message),!1}}async updateOrder(e,r){try{console.log(`📤 AdminCategoryService: Actualizando orden de categoría ${e} a ${r}`);const a=await $.patch(D.ADMIN.CATEGORIES.PARTIAL_UPDATE(e),{order:r});return console.log("✅ AdminCategoryService: Orden actualizado:",a),!0}catch(a){return console.error("❌ Error en AdminCategoryService.updateOrder:",a),a instanceof Error&&console.error("Error message:",a.message),!1}}async getMainCategories(e=!0){try{console.log("📤 AdminCategoryService: Obteniendo categorías principales como admin");const r=await $.get(D.CATEGORIES.MAIN,{with_counts:e});return console.log("✅ AdminCategoryService: Categorías principales obtenidas:",r),r?.data||[]}catch(r){return console.error("❌ Error en AdminCategoryService.getMainCategories:",r),[]}}async getSubcategories(e){try{console.log(`📤 AdminCategoryService: Obteniendo subcategorías de ${e} como admin`);const r=await $.get(D.CATEGORIES.SUBCATEGORIES(e));return console.log("✅ AdminCategoryService: Subcategorías obtenidas:",r),r?.data||[]}catch(r){return console.error("❌ Error en AdminCategoryService.getSubcategories:",r),[]}}}class ro{adminCategoryService;constructor(e){this.adminCategoryService=e}async execute(e){console.log("GetAllCategoriesUseCase: Obteniendo todas las categorías como admin");try{const r=await this.adminCategoryService.getAllCategories(e);return console.log("GetAllCategoriesUseCase: Categorías obtenidas correctamente:",r),r}catch(r){throw console.error("GetAllCategoriesUseCase: Error al obtener categorías:",r),r}}}class ao{adminCategoryService;constructor(e){this.adminCategoryService=e}async execute(e){console.log("CreateCategoryAsAdminUseCase: Creando categoría como admin:",e);try{const r=await this.adminCategoryService.createCategory(e);return console.log("CreateCategoryAsAdminUseCase: Categoría creada correctamente:",r),r}catch(r){throw console.error("CreateCategoryAsAdminUseCase: Error al crear categoría:",r),r}}}class no{adminCategoryService;constructor(e){this.adminCategoryService=e}async execute(e){console.log(`UpdateAnyCategoryUseCase: Actualizando categoría ${e.id} como admin:`,e);try{const r=await this.adminCategoryService.updateCategory(e);return console.log("UpdateAnyCategoryUseCase: Categoría actualizada correctamente:",r),r}catch(r){throw console.error("UpdateAnyCategoryUseCase: Error al actualizar categoría:",r),r}}}class oo{adminCategoryService;constructor(e){this.adminCategoryService=e}async execute(e){console.log(`DeleteAnyCategoryUseCase: Eliminando categoría ${e} como admin`);try{const r=await this.adminCategoryService.deleteCategory(e);return console.log("DeleteAnyCategoryUseCase: Categoría eliminada correctamente:",r),r}catch(r){throw console.error("DeleteAnyCategoryUseCase: Error al eliminar categoría:",r),r}}}class io{adminCategoryService;constructor(e){this.adminCategoryService=e}async execute(e,r){console.log(`ToggleCategoryActiveUseCase: Cambiando estado activo de categoría ${e} a ${r}`);try{const a=await this.adminCategoryService.toggleActive(e,r);return console.log("ToggleCategoryActiveUseCase: Estado activo actualizado correctamente:",a),a}catch(a){throw console.error("ToggleCategoryActiveUseCase: Error al cambiar estado activo:",a),a}}}class lo{adminCategoryService;constructor(e){this.adminCategoryService=e}async execute(e,r){console.log(`ToggleCategoryFeaturedUseCase: Cambiando estado destacado de categoría ${e} a ${r}`);try{const a=await this.adminCategoryService.toggleFeatured(e,r);return console.log("ToggleCategoryFeaturedUseCase: Estado destacado actualizado correctamente:",a),a}catch(a){throw console.error("ToggleCategoryFeaturedUseCase: Error al cambiar estado destacado:",a),a}}}class co{adminCategoryService;constructor(e){this.adminCategoryService=e}async execute(e){console.log(`GetCategoryByIdUseCase: Obteniendo categoría ${e} como admin`);try{const r=await this.adminCategoryService.getCategoryById(e);return console.log("GetCategoryByIdUseCase: Categoría obtenida correctamente:",r),r}catch(r){throw console.error("GetCategoryByIdUseCase: Error al obtener categoría:",r),r}}}const pe=new to,uo=new ro(pe),mo=new ao(pe),go=new no(pe),ho=new oo(pe),po=new io(pe),fo=new lo(pe),xo=new co(pe),Jt=()=>{const[t,e]=g.useState(!1),[r,a]=g.useState(null),[n,o]=g.useState([]),[i,d]=g.useState([]),[c,p]=g.useState(null),{invalidateAfterMutation:h}=Ht(),v=g.useCallback(b=>!b||typeof b!="object"?(console.error("Categoría inválida para adaptar:",b),{}):{id:b.id,name:b.name||"",slug:b.slug||"",description:b.description||"",parent_id:b.parent_id,icon:b.icon,image:b.image,order:b.order,is_active:!!(b.is_active??!0),featured:!!(b.featured??!1),created_at:b.created_at,updated_at:b.updated_at,subcategories:Array.isArray(b.subcategories)?b.subcategories.map(_=>v(_)):void 0,product_count:b.product_count||0,parent:b.parent?v(b.parent):void 0},[]),f=g.useCallback(async(b,_=!1)=>{e(!0),a(null);const u=`admin_categories_${JSON.stringify(b||{})}`;try{if(!_){const m=ce.getItem(u);if(m&&Array.isArray(m.data))return console.log("💾 useAdminCategories: Usando categorías en caché"),o(m.data),e(!1),m}console.log("🌐 useAdminCategories: Obteniendo categorías desde API");const y=await uo.execute({...b});if(y&&typeof y=="object"&&"data"in y&&Array.isArray(y.data)){const m=y.data.map(v),T={data:m,meta:y.meta||{total:m.length}};return ce.setItem(u,T,q.cache.categoryCacheTime),o(m),T}else return console.warn("Respuesta de categorías no tiene el formato esperado:",y),o([]),{data:[],meta:{total:0}}}catch(y){const m=y instanceof Error?y.message:"Error al obtener categorías";return a(m),console.error("Error al obtener categorías:",y),o([]),{data:[],meta:{total:0}}}finally{e(!1)}},[v]),A=g.useCallback(async(b=!0,_=!1)=>{e(!0),a(null);const u=`admin_main_categories_${b?"with_counts":"no_counts"}`;try{if(!_){const R=ce.getItem(u);if(R&&Array.isArray(R))return console.log("💾 useAdminCategories: Usando categorías principales en caché"),d(R),e(!1),R}console.log("🌐 useAdminCategories: Obteniendo categorías principales desde API");const y=await pe.getMainCategories(b);let m=[];if(Array.isArray(y))m=y;else if(y&&typeof y=="object"&&"data"in y&&Array.isArray(y.data))m=y.data;else return console.warn("Respuesta de categorías principales no tiene el formato esperado:",y),d([]),[];const T=m.map(v);return ce.setItem(u,T,q.cache.categoryCacheTime),d(T),T}catch(y){const m=y instanceof Error?y.message:"Error al obtener categorías principales";return a(m),console.error("Error al obtener categorías principales:",y),d([]),[]}finally{e(!1)}},[v]),l=g.useCallback(async b=>{e(!0),a(null);const _=`admin_category_${b}`;try{const u=ce.getItem(_);if(u)return console.log(`💾 useAdminCategories: Usando categoría ${b} en caché`),p(u),e(!1),u;console.log(`🌐 useAdminCategories: Obteniendo categoría ${b} desde API`);const y=await xo.execute(b);if(y&&typeof y=="object"){const m=v(y);return ce.setItem(_,m,q.cache.categoryCacheTime),p(m),m}return p(null),null}catch(u){const y=u instanceof Error?u.message:"Error al obtener categoría";return a(y),console.error("Error al obtener categoría:",u),p(null),null}finally{e(!1)}},[v]),S=g.useCallback(async b=>{e(!0),a(null);try{console.log("🌐 useAdminCategories: Creando nueva categoría:",b);const _=await mo.execute(b);if(_&&typeof _=="object"){const u=v(_);return o(y=>[...y,u]),b.parent_id||d(y=>[...y,u]),h(["admin_categories_*","categories_*","admin_main_categories_*","categories_main_*","categories_featured_*"]),u}return null}catch(_){const u=_ instanceof Error?_.message:"Error al crear categoría";return a(u),console.error("Error al crear categoría:",_),null}finally{e(!1)}},[v,h]),x=g.useCallback(async b=>{e(!0),a(null);try{console.log(`🌐 useAdminCategories: Actualizando categoría ${b.id}:`,b);const _=await go.execute(b);if(_&&typeof _=="object"){const u=v(_);return o(y=>y.map(m=>m.id===b.id?u:m)),d(y=>y.map(m=>m.id===b.id?u:m)),c?.id===b.id&&p(u),h(["admin_categories_*","categories_*",`admin_category_${b.id}`,`category_${b.id}`,"admin_main_categories_*","categories_main_*","categories_featured_*"]),u}return null}catch(_){const u=_ instanceof Error?_.message:"Error al actualizar categoría";return a(u),console.error("Error al actualizar categoría:",_),null}finally{e(!1)}},[v,c,h]),N=g.useCallback(async b=>{e(!0),a(null);try{return console.log(`🌐 useAdminCategories: Eliminando categoría ${b}`),await ho.execute(b)?(o(u=>u.filter(y=>y.id!==b)),d(u=>u.filter(y=>y.id!==b)),c?.id===b&&p(null),h(["admin_categories_*","categories_*",`admin_category_${b}`,`category_${b}`,"admin_main_categories_*","categories_main_*","categories_featured_*"]),!0):!1}catch(_){const u=_ instanceof Error?_.message:"Error al eliminar categoría";return a(u),console.error("Error al eliminar categoría:",_),!1}finally{e(!1)}},[c,h]),w=g.useCallback(async(b,_)=>{e(!0),a(null);try{if(console.log(`🌐 useAdminCategories: Cambiando estado activo de categoría ${b} a ${_}`),await po.execute(b,_)){const y=m=>m.id===b?{...m,is_active:_}:m;return o(m=>m.map(y)),d(m=>m.map(y)),c?.id===b&&p(m=>m&&{...m,is_active:_}),h(["admin_categories_*","categories_*",`admin_category_${b}`,`category_${b}`,"admin_main_categories_*","categories_main_*","categories_featured_*"]),!0}return!1}catch(u){const y=u instanceof Error?u.message:"Error al cambiar estado activo";return a(y),console.error("Error al cambiar estado activo:",u),!1}finally{e(!1)}},[c,h]),E=g.useCallback(async(b,_)=>{e(!0),a(null);try{if(console.log(`🌐 useAdminCategories: Cambiando estado destacado de categoría ${b} a ${_}`),await fo.execute(b,_)){const y=m=>m.id===b?{...m,featured:_}:m;return o(m=>m.map(y)),d(m=>m.map(y)),c?.id===b&&p(m=>m&&{...m,featured:_}),h(["admin_categories_*","categories_*",`admin_category_${b}`,`category_${b}`,"admin_main_categories_*","categories_main_*","categories_featured_*"]),!0}return!1}catch(u){const y=u instanceof Error?u.message:"Error al cambiar estado destacado";return a(y),console.error("Error al cambiar estado destacado:",u),!1}finally{e(!1)}},[c,h]),O=g.useCallback(b=>{b?(h([`admin_category_${b}`,`category_${b}`]),console.log(`🗑️ Caché de la categoría ${b} invalidada`)):(h(["admin_categories_*","categories_*","admin_category_*","category_*","admin_main_categories_*","categories_main_*","categories_featured_*"]),console.log("🗑️ Toda la caché de categorías invalidada"))},[h]);return{loading:t,error:r,categories:n,mainCategories:i,categoryDetail:c,fetchAllCategories:f,fetchMainCategories:A,fetchCategoryById:l,createCategory:S,updateCategory:x,deleteCategory:N,toggleActive:w,toggleFeatured:E,clearCategoryCache:O,setError:b=>a(b),setLoading:b=>e(b)}},yo=()=>{const t=mr(),r=new URLSearchParams(t.search).get("sellerId"),{loading:a,error:n,products:o,meta:i,fetchAllProducts:d,deleteProduct:c,toggleFeatured:p,togglePublished:h,clearProductCache:v}=so(),{loading:f,categories:A,fetchAllCategories:l}=Jt(),[S,x]=g.useState(0),[N,w]=g.useState(r?parseInt(r):0),[E,O]=g.useState("all"),[b,_]=g.useState("all"),[u,y]=g.useState(""),[m,T]=g.useState(1),[R]=g.useState(15),[U,k]=g.useState(null);g.useEffect(()=>{K(),Z()},[]),g.useEffect(()=>{K()},[S,N,E,b,u,m]),g.useEffect(()=>{const M=new URLSearchParams(t.search).get("sellerId"),F=M?parseInt(M):0;F!==N&&(w(F),T(1))},[t.search,N]);const Z=g.useCallback(async()=>{try{await l({with_counts:!0})}catch(C){console.error("Error al cargar categorías:",C)}},[l]),K=g.useCallback(async()=>{console.log("🚀 AdminProductsPage: Iniciando loadData..."),console.log("📍 AdminProductsPage: Página actual:",m),console.log("📍 AdminProductsPage: Items por página:",R);try{const C={limit:R,offset:(m-1)*R};switch(console.log("🔧 AdminProductsPage: FilterParams inicial:",C),u&&(C.term=u),S&&S>0&&(C.categoryId=S),N&&N>0&&(C.sellerId=N),E){case"active":C.status="active",C.published=!0;break;case"draft":C.status="draft";break;case"inactive":C.published=!1;break}switch(b){case"inStock":C.inStock=!0;break;case"lowStock":C.inStock=!0;break;case"outOfStock":C.inStock=!1;break}console.log("🔧 AdminProductsPage: Cargando productos con filtros:",C),await d(C)}catch(C){console.error("Error al cargar productos:",C)}},[d,S,N,E,b,u,m,R]),fe=g.useCallback(async(C,M)=>{if(window.confirm(`¿Estás seguro de que deseas eliminar el producto "${M}"?`)){k(C);try{await c(C)?K():alert("Error al eliminar el producto")}catch(V){console.error("Error al eliminar producto:",V),alert("Error al eliminar el producto")}finally{k(null)}}},[c,K]),ae=g.useCallback(async(C,M)=>{k(C);try{const F=!M;console.log(`🌟 Toggling featured for product ${C}: ${M} -> ${F}`),await p(C,F)||alert("Error al cambiar estado destacado")}catch(F){console.error("Error al cambiar estado destacado:",F),alert("Error al cambiar estado destacado")}finally{k(null)}},[p]),xe=g.useCallback(async(C,M)=>{k(C);try{const F=!M;console.log(`📢 Toggling published for product ${C}: ${M} -> ${F}`),await h(C,F)||alert("Error al cambiar estado de publicación")}catch(F){console.error("Error al cambiar estado de publicación:",F),alert("Error al cambiar estado de publicación")}finally{k(null)}},[h]),P=g.useCallback(()=>{v(),K()},[v,K]),Q=g.useCallback(C=>{T(C)},[]),J=C=>{if(!C)return"Sin categoría";const M=A.find(F=>F.id===C);return M?M.name:"Categoría desconocida"},Re=({product:C})=>{const[M,F]=g.useState(Ns(C)),[V,Oe]=g.useState(!1),[ke,De]=g.useState(0);g.useEffect(()=>{F(Ns(C)),Oe(!1),De(0)},[C]);const Ee=g.useCallback(()=>{if(console.warn(`Error cargando imagen para producto ${C.id}:`,M),ke>=2){console.warn(`Demasiados errores para producto ${C.id}, manteniendo placeholder`);return}De(We=>We+1),V||(Oe(!0),F(Ns(null)))},[M,V,ke,C.id]);return s.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-md bg-gray-200 flex items-center justify-center overflow-hidden",children:s.jsx("img",{src:M,alt:C.name,className:"h-10 w-10 object-cover",onError:Ee,loading:"lazy"})})},Y=o.filter(C=>b==="lowStock"?C.stock>0&&C.stock<=10:!0),ye=[{key:"product",header:"Producto",sortable:!0,render:C=>s.jsxs("div",{className:"flex items-center",children:[s.jsx(Re,{product:C}),s.jsxs("div",{className:"ml-4",children:[s.jsxs("div",{className:"text-sm font-medium text-gray-900 flex items-center",children:[C.name,C.featured&&s.jsx("span",{className:"ml-2",children:s.jsx(ge,{className:"h-4 w-4 text-yellow-500 inline"})})]}),s.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",C.id]})]})]})},{key:"category",header:"Categoría",sortable:!0,render:C=>s.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[s.jsx(vr,{className:"w-3 h-3 mr-1"}),J(C.categoryId)]})},{key:"seller",header:"Vendedor",sortable:!0,render:C=>{const M=C.seller?.name||"Tienda desconocida",F=C.user?.name||"Usuario desconocido",V=C.seller_id||C.seller?.id;return s.jsxs("div",{className:"text-sm",children:[s.jsx("div",{className:"font-medium text-gray-900",children:M}),s.jsxs("div",{className:"text-xs text-gray-500",children:["Vendedor ID: ",V||"N/A"," - ",F]})]})}},{key:"price",header:"Precio",sortable:!0,render:C=>s.jsx("div",{children:C.discountPercentage&&C.discountPercentage>0?s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-500 line-through text-xs mr-1",children:Ae(C.price)}),s.jsx("span",{className:"font-semibold text-green-600",children:Ae(C.finalPrice||C.price*(1-C.discountPercentage/100))}),s.jsxs("span",{className:"ml-1 bg-green-100 text-green-800 text-xs font-semibold px-1.5 py-0.5 rounded",children:["-",C.discountPercentage,"%"]})]}):s.jsx("span",{className:"font-semibold",children:Ae(C.price)})})},{key:"stock",header:"Stock",sortable:!0,render:C=>s.jsx("div",{children:C.stock===0?s.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"Agotado"}):C.stock<=10?s.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[C.stock," unidades"]}):s.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[C.stock," unidades"]})})},{key:"status",header:"Estado",sortable:!0,render:C=>{let M="",F="",V=re;return C.published?C.status==="draft"?(M="bg-gray-100 text-gray-800",F="Borrador",V=Ws):C.status==="active"?(M="bg-green-100 text-green-800",F="Activo",V=re):(M="bg-red-100 text-red-800",F="Inactivo",V=Ws):(M="bg-yellow-100 text-yellow-800",F="No publicado",V=qe),s.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${M}`,children:[s.jsx(V,{className:"w-3 h-3 mr-1"}),F]})}},{key:"rating",header:"Valoración",sortable:!0,render:C=>{const M=C.calculated_rating??C.rating??0,F=C.calculated_rating_count??C.ratingCount??C.rating_count??0;return s.jsx("div",{className:"flex items-center",children:M>0?s.jsxs(s.Fragment,{children:[s.jsx(ge,{className:"h-4 w-4 text-yellow-500 mr-1"}),s.jsx("span",{children:parseFloat(M).toFixed(1)}),s.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",F,")"]})]}):s.jsx("span",{className:"text-xs text-gray-500",children:"Sin valoraciones"})})}},{key:"sales",header:"Ventas",sortable:!0,render:C=>{const M=C.sales_count??0,F=C.total_quantity_sold??0;return s.jsxs("div",{className:"text-sm",children:[s.jsxs("div",{className:"font-medium",children:[M," órdenes"]}),s.jsxs("div",{className:"text-xs text-gray-500",children:[F," uds."]})]})}},{key:"actions",header:"Acciones",render:C=>s.jsxs("div",{className:"flex justify-end space-x-1",children:[s.jsx(ee,{to:`/products/${C.id}`,target:"_blank",className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Ver en tienda",children:s.jsx(ts,{size:16})}),s.jsx(ee,{to:`/admin/products/edit/${C.id}`,className:"p-1 text-yellow-600 hover:bg-yellow-100 rounded-md",title:"Editar producto",children:s.jsx(ht,{size:16})}),s.jsx("button",{onClick:()=>ae(C.id,C.featured||!1),disabled:U===C.id,className:`p-1 rounded-md transition-colors ${C.featured?"text-yellow-500 hover:bg-yellow-100":"text-gray-600 hover:bg-gray-100"} ${U===C.id?"opacity-50 cursor-not-allowed":""}`,title:C.featured?"Quitar destacado":"Destacar producto",children:s.jsx(ge,{size:16,className:C.featured?"fill-current":""})}),s.jsx("button",{onClick:()=>xe(C.id,C.published||!1),disabled:U===C.id,className:`p-1 rounded-md transition-colors ${C.published?"text-green-600 hover:bg-green-100":"text-gray-600 hover:bg-gray-100"} ${U===C.id?"opacity-50 cursor-not-allowed":""}`,title:C.published?"Despublicar":"Publicar",children:s.jsx(re,{size:16})}),s.jsx("button",{onClick:()=>fe(C.id,C.name),disabled:U===C.id,className:`p-1 text-red-600 hover:bg-red-100 rounded-md transition-colors ${U===C.id?"opacity-50 cursor-not-allowed":""}`,title:"Eliminar producto",children:s.jsx(ve,{size:16})})]})}],Ie=a||f;return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Gestión de Productos",N>0&&s.jsxs("span",{className:"ml-2 text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-md",children:["Vendedor ID: ",N]})]}),i&&s.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[i.total," productos encontrados",N>0&&" para este vendedor"]})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs(ee,{to:"/admin/products/create",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[s.jsx(Ls,{className:"w-4 h-4 mr-2"}),"Nuevo Producto"]}),s.jsxs("button",{onClick:P,disabled:Ie,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center disabled:opacity-50",children:[s.jsx(W,{size:16,className:`mr-2 ${Ie?"animate-spin":""}`}),"Actualizar"]})]})]}),n&&s.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:["Error: ",n]}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Ds,{className:"h-5 w-5 text-gray-500"}),s.jsx("input",{type:"text",placeholder:"Buscar productos...",value:u,onChange:C=>y(C.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(ls,{className:"h-5 w-5 text-gray-500"}),s.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1",value:S,onChange:C=>x(Number(C.target.value)),children:[s.jsx("option",{value:0,children:"Todas las categorías"}),A.map(C=>s.jsxs("option",{value:C.id,children:[C.name," (",C.product_count||0,")"]},C.id))]})]}),s.jsx("div",{className:"flex items-center space-x-2",children:s.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1",value:E,onChange:C=>O(C.target.value),children:[s.jsx("option",{value:"all",children:"Todos los Estados"}),s.jsx("option",{value:"active",children:"Activos"}),s.jsx("option",{value:"draft",children:"Borrador"}),s.jsx("option",{value:"inactive",children:"Inactivos"})]})}),s.jsx("div",{className:"flex items-center space-x-2",children:s.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1",value:b,onChange:C=>_(C.target.value),children:[s.jsx("option",{value:"all",children:"Todo el Stock"}),s.jsx("option",{value:"inStock",children:"En stock"}),s.jsx("option",{value:"lowStock",children:"Stock bajo (≤10)"}),s.jsx("option",{value:"outOfStock",children:"Sin stock"})]})})]})}),s.jsx(fs,{data:Y,columns:ye,searchFields:[],loading:Ie,emptyMessage:"No se encontraron productos",pagination:{currentPage:m,totalPages:Math.ceil((i?.total||0)/R),totalItems:i?.total||0,itemsPerPage:R,onPageChange:Q}})]})},di=Object.freeze(Object.defineProperty({__proto__:null,default:yo},Symbol.toStringTag,{value:"Module"})),bo=()=>{const{loading:t,error:e,categories:r,mainCategories:a,fetchAllCategories:n,fetchMainCategories:o,deleteCategory:i,toggleActive:d,toggleFeatured:c,clearCategoryCache:p}=Jt(),[h,v]=g.useState(null),[f,A]=g.useState("all"),[l,S]=g.useState(""),[x,N]=g.useState("all"),[w,E]=g.useState(1),[O]=g.useState(15),[b,_]=g.useState(null);g.useEffect(()=>{u()},[]),g.useEffect(()=>{u()},[h,f,l]);const u=g.useCallback(async()=>{try{const P={};h!==null&&(P.parent_id=h),f!=="all"&&(P.is_active=f==="active"),l&&(P.term=l),await n(P),a.length===0&&await o(!0)}catch(P){console.error("Error al cargar categorías:",P)}},[n,o,h,f,l,a.length]),y=r.filter(P=>!(l&&!P.name.toLowerCase().includes(l.toLowerCase()))),m=g.useCallback(async(P,Q)=>{_(P);try{await c(P,!Q)?await u():alert("Error al cambiar estado destacado de la categoría")}catch(J){console.error("Error al cambiar estado destacado:",J),alert("Error al cambiar estado destacado de la categoría")}finally{_(null)}},[c,u]),T=g.useCallback(async(P,Q)=>{_(P);try{await d(P,!Q)?await u():alert("Error al cambiar estado activo de la categoría")}catch(J){console.error("Error al cambiar estado activo:",J),alert("Error al cambiar estado activo de la categoría")}finally{_(null)}},[d,u]),R=g.useCallback(async(P,Q)=>{if(r.some(Y=>Y.parent_id===P)){alert("Esta categoría tiene subcategorías. Debes eliminar primero las subcategorías.");return}if(window.confirm(`¿Estás seguro de que deseas eliminar la categoría "${Q}"?`)){_(P);try{await i(P)?u():alert("Error al eliminar la categoría")}catch(Y){console.error("Error al eliminar categoría:",Y),alert("Error al eliminar la categoría")}finally{_(null)}}},[i,r,u]),U=g.useCallback(()=>{p(),u()},[p,u]),k=g.useCallback(P=>{E(P)},[]),Z=P=>{if(!P)return"Sin categoría padre";const Q=r.find(J=>J.id===P)||a.find(J=>J.id===P);return Q?Q.name:"Categoría padre desconocida"},K=[{key:"category",header:"Categoría",sortable:!0,render:P=>s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-md bg-blue-100 flex items-center justify-center",children:s.jsx(jr,{className:"h-6 w-6 text-blue-600"})}),s.jsxs("div",{className:"ml-4",children:[s.jsxs("div",{className:"text-sm font-medium text-gray-900 flex items-center",children:[P.name,P.featured&&s.jsx("span",{className:"ml-2",children:s.jsx(ge,{className:"h-4 w-4 text-yellow-500 inline"})})]}),s.jsxs("div",{className:"text-xs text-gray-500 flex items-center",children:["ID: ",P.id,P.parent_id&&s.jsxs("span",{className:"ml-2",children:["Padre: ",Z(P.parent_id)]})]})]})]})},{key:"slug",header:"Slug",sortable:!0,render:P=>s.jsx("div",{className:"text-sm text-gray-500 font-mono",children:P.slug})},{key:"description",header:"Descripción",render:P=>s.jsx("div",{className:"text-sm text-gray-600 max-w-xs truncate",children:P.description||"Sin descripción"})},{key:"products",header:"Productos",sortable:!0,render:P=>s.jsx("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-sm font-medium bg-blue-100 text-blue-800",children:P.product_count||0})},{key:"status",header:"Estado",sortable:!0,render:P=>s.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${P.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:P.is_active?s.jsxs(s.Fragment,{children:[s.jsx(ts,{className:"w-3 h-3 mr-1"}),"Activa"]}):s.jsxs(s.Fragment,{children:[s.jsx(Ks,{className:"w-3 h-3 mr-1"}),"Inactiva"]})})},{key:"children",header:"Subcategorías",render:P=>s.jsx("div",{children:P.has_children?s.jsxs("button",{onClick:()=>v(P.id||null),className:"text-primary-600 hover:text-primary-800 underline flex items-center",children:[s.jsx(Sr,{className:"h-4 w-4 mr-1"}),"Ver subcategorías"]}):s.jsx("span",{className:"text-gray-500 text-sm",children:"Sin subcategorías"})})},{key:"order",header:"Orden",sortable:!0,render:P=>s.jsx("div",{className:"text-center",children:P.order||"-"})},{key:"actions",header:"Acciones",render:P=>s.jsxs("div",{className:"flex justify-end space-x-1",children:[s.jsx(ee,{to:`/categories/${P.slug}`,target:"_blank",className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Ver en tienda",children:s.jsx(Er,{size:16})}),s.jsx(ee,{to:`/admin/categories/edit/${P.id}`,className:"p-1 text-yellow-600 hover:bg-yellow-100 rounded-md",title:"Editar categoría",children:s.jsx(ht,{size:16})}),s.jsx("button",{onClick:()=>m(P.id,P.featured),disabled:b===P.id,className:`p-1 rounded-md transition-colors ${P.featured?"text-yellow-600 hover:bg-yellow-100":"text-gray-600 hover:bg-gray-100"} ${b===P.id?"opacity-50 cursor-not-allowed":""}`,title:P.featured?"Quitar destacado":"Destacar categoría",children:s.jsx(ge,{size:16})}),s.jsx("button",{onClick:()=>T(P.id,P.is_active),disabled:b===P.id,className:`p-1 rounded-md transition-colors ${P.is_active?"text-green-600 hover:bg-green-100":"text-red-600 hover:bg-red-100"} ${b===P.id?"opacity-50 cursor-not-allowed":""}`,title:P.is_active?"Desactivar":"Activar",children:P.is_active?s.jsx(ts,{size:16}):s.jsx(Ks,{size:16})}),s.jsx(ee,{to:`/admin/categories/create?parent=${P.id}`,className:"p-1 text-green-600 hover:bg-green-100 rounded-md",title:"Añadir subcategoría",children:s.jsx(Ls,{size:16})}),s.jsx("button",{onClick:()=>R(P.id,P.name),disabled:b===P.id,className:`p-1 text-red-600 hover:bg-red-100 rounded-md transition-colors ${b===P.id?"opacity-50 cursor-not-allowed":""}`,title:"Eliminar categoría",children:s.jsx(ve,{size:16})})]})}],fe=Math.ceil(y.length/O),ae=(w-1)*O,xe=y.slice(ae,ae+O);return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Categorías"}),s.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[y.length," categorías encontradas"]})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs(ee,{to:"/admin/categories/create",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[s.jsx(Nr,{className:"w-4 h-4 mr-2"}),"Nueva Categoría"]}),s.jsxs("button",{onClick:U,disabled:t,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center disabled:opacity-50",children:[s.jsx(W,{size:16,className:`mr-2 ${t?"animate-spin":""}`}),"Actualizar"]})]})]}),e&&s.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:["Error: ",e]}),s.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Ds,{className:"h-5 w-5 text-gray-500"}),s.jsx("input",{type:"text",placeholder:"Buscar categorías...",value:l,onChange:P=>S(P.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(ls,{className:"h-5 w-5 text-gray-500"}),s.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1",value:h===null?"null":h,onChange:P=>v(P.target.value==="null"?null:Number(P.target.value)),children:[s.jsx("option",{value:"null",children:"Todas las categorías"}),s.jsx("option",{value:0,children:"Categorías principales"}),a.map(P=>s.jsxs("option",{value:P.id,children:["Subcategorías de ",P.name]},P.id))]})]}),s.jsx("div",{className:"flex items-center space-x-2",children:s.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1",value:f,onChange:P=>A(P.target.value),children:[s.jsx("option",{value:"all",children:"Todos los Estados"}),s.jsx("option",{value:"active",children:"Activas"}),s.jsx("option",{value:"inactive",children:"Inactivas"})]})}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{className:"text-sm text-gray-600 whitespace-nowrap",children:"Vista:"}),s.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[s.jsx("button",{className:`px-3 py-1 text-sm ${x==="all"?"bg-primary-600 text-white":"bg-white text-gray-700"}`,onClick:()=>N("all"),children:"Tabla"}),s.jsx("button",{className:`px-3 py-1 text-sm ${x==="tree"?"bg-primary-600 text-white":"bg-white text-gray-700"}`,onClick:()=>N("tree"),children:"Árbol"})]})]})]})}),x==="tree"?s.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[s.jsx("h3",{className:"text-lg font-medium mb-4",children:"Vista de árbol de categorías"}),s.jsx("p",{className:"text-gray-500",children:"Esta vista está en desarrollo. Por favor, utilice la vista de tabla."})]}):s.jsx(fs,{data:xe,columns:K,searchFields:[],loading:t,emptyMessage:"No se encontraron categorías",pagination:{currentPage:w,totalPages:fe,totalItems:y.length,itemsPerPage:O,onPageChange:k}})]})},ui=Object.freeze(Object.defineProperty({__proto__:null,default:bo},Symbol.toStringTag,{value:"Module"}));class vo{async getAdminOrders(e){try{console.log("AdminOrderService: Obteniendo órdenes con filtros:",e);const r=await $.get(D.ADMIN.ORDERS,e);console.log("AdminOrderService: Respuesta de órdenes:",r);const a=r?.data||[],n=r?.pagination||{currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10};return{data:a,meta:{total:n.totalItems,per_page:n.itemsPerPage,current_page:n.currentPage,last_page:n.totalPages}}}catch(r){return console.error("AdminOrderService: Error al obtener órdenes:",r),{data:[],meta:{total:0,per_page:10,current_page:1,last_page:1}}}}async getOrderDetails(e){try{console.log(`AdminOrderService: Obteniendo detalle de orden ${e}`);const r=await $.get(D.ADMIN.ORDER_DETAIL(e));if(console.log(`AdminOrderService: Respuesta para orden ${e}:`,r),!r||!r.data)throw new Error("Respuesta vacía al obtener detalle de orden");return r.data}catch(r){throw console.error(`AdminOrderService: Error al obtener detalle de orden ${e}:`,r),r}}async updateOrderStatus(e,r){try{console.log(`AdminOrderService: Actualizando estado de orden ${e} a ${r.status}`);const a=await $.put(D.ADMIN.UPDATE_ORDER_STATUS(e),r);if(console.log(`AdminOrderService: Respuesta de actualización para orden ${e}:`,a),!a||!a.data)throw new Error("Respuesta vacía al actualizar estado de orden");return a.data}catch(a){throw console.error(`AdminOrderService: Error al actualizar estado de orden ${e}:`,a),a}}async cancelOrder(e,r=""){try{console.log(`AdminOrderService: Cancelando orden ${e}`);const a=await $.post(D.ADMIN.CANCEL_ORDER(e),{reason:r});return console.log(`AdminOrderService: Respuesta de cancelar orden ${e}:`,a),a?.success||!1}catch(a){return console.error(`AdminOrderService: Error al cancelar orden ${e}:`,a),!1}}async updateShippingInfo(e,r){try{console.log(`AdminOrderService: Actualizando información de envío para orden ${e}`);const a=await $.patch(D.ADMIN.UPDATE_SHIPPING(e),r);return console.log(`AdminOrderService: Respuesta de actualización de envío para ${e}:`,a),a?.success||!1}catch(a){return console.error(`AdminOrderService: Error al actualizar envío de orden ${e}:`,a),!1}}async getOrderStats(){try{console.log("AdminOrderService: Obteniendo estadísticas de órdenes");const e=await $.get(D.ADMIN.ORDER_STATS);if(console.log("AdminOrderService: Respuesta de estadísticas:",e),!e||!e.data)throw new Error("Respuesta vacía al obtener estadísticas");return e.data}catch(e){return console.error("AdminOrderService: Error al obtener estadísticas:",e),{totalOrders:0,pendingOrders:0,processingOrders:0,shippedOrders:0,deliveredOrders:0,cancelledOrders:0,totalSales:0}}}}class No{adminOrderService;constructor(){this.adminOrderService=new vo}async getAdminOrders(e){try{const r={...e};e?.status==="all"&&delete r.status,e?.paymentStatus==="all"&&delete r.paymentStatus,e?.sellerId===null&&delete r.sellerId;const a=await this.adminOrderService.getAdminOrders(r),n=a.data.map(i=>this.adaptOrderToUI(i)),o={currentPage:a.meta.current_page,totalPages:a.meta.last_page,totalItems:a.meta.total,itemsPerPage:a.meta.per_page};return{orders:n,pagination:o}}catch(r){return console.error("Error en AdminOrderServiceAdapter.getAdminOrders:",r),{orders:[],pagination:{currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}}}}async getSellerInfo(e){try{const a=(await $.get(`/admin/sellers/${e}`)).data;return{name:a?.name||a?.store_name||"Vendedor",email:a?.email,store_name:a?.store_name}}catch(r){return console.log(`No se pudo obtener info del seller ${e}:`,r),null}}async getOrderDetails(e){try{const r=await this.adminOrderService.getOrderDetails(e);if(r?.seller_id){const a=await this.getSellerInfo(r.seller_id);a&&(r.seller_name=a.name,r.seller_email=a.email,r.seller_store_name=a.store_name)}return this.adaptOrderToUI(r)}catch(r){return console.error(`Error al obtener detalles de la orden ${e}:`,r),null}}async updateOrderStatus(e,r){try{return await this.adminOrderService.updateOrderStatus(e,{status:r}),!0}catch(a){return console.error(`Error al actualizar estado de la orden ${e}:`,a),!1}}async cancelOrder(e,r=""){try{return await this.adminOrderService.cancelOrder(e,r)}catch(a){return console.error(`Error al cancelar la orden ${e}:`,a),!1}}async getOrderStats(){try{const e=await this.adminOrderService.getOrderStats();return[{label:"Total Pedidos",value:e.totalOrders,color:"blue",isCurrency:!1},{label:"Pendientes",value:e.pendingOrders,color:"yellow",isCurrency:!1},{label:"En Proceso",value:e.processingOrders,color:"blue",isCurrency:!1},{label:"Enviados",value:e.shippedOrders,color:"indigo",isCurrency:!1},{label:"Entregados",value:e.deliveredOrders,color:"purple",isCurrency:!1},{label:"Completados",value:e.completedOrders,color:"green",isCurrency:!1},{label:"Cancelados",value:e.cancelledOrders,color:"red",isCurrency:!1},{label:"Total Ventas",value:e.totalSales,color:"green",isCurrency:!0}]}catch(e){return console.error("Error en AdminOrderServiceAdapter.getOrderStats:",e),[]}}adaptOrderToUI(e){const r=e.user_name||(e.user?e.user.name:"Cliente")||(e.customer?e.customer.name:"Cliente"),a=e.user_email||(e.user?e.user.email:"")||(e.customer?e.customer.email:""),n=e.seller_name||(e.seller?e.seller.name:"Vendedor")||"Vendedor",o=Array.isArray(e.items)?e.items.map(d=>({id:d.id||0,productId:d.product_id||d.productId||0,name:d.product_name||(d.product?d.product.name:"Producto"),quantity:d.quantity||0,price:d.price||0,subtotal:d.subtotal||0,image:d.product_image?`${q.imageBaseUrl}/${d.product_image}`:void 0})):[];let i=null;if(e.shipping_data)if(typeof e.shipping_data=="string")try{i=JSON.parse(e.shipping_data)}catch(d){console.error("Error al parsear shipping_data:",d),i={}}else i=e.shipping_data;return{id:e.id||0,orderNumber:e.order_number||e.orderNumber||`#${e.id}`,date:e.created_at||e.createdAt||e.date||new Date().toISOString(),updatedAt:e.updated_at||e.updatedAt||e.date,customer:{id:e.user_id||(e.user?e.user.id:0)||0,name:r,email:a},seller:{id:e.seller_id||(e.seller?e.seller.id:0)||0,name:n},total:e.total||0,status:e.status||"pending",paymentStatus:e.payment_status||e.paymentStatus||"pending",paymentMethod:e.payment_method||e.paymentMethod||"N/A",items:o,shippingData:i,subtotal_products:e.subtotal_products||0,iva_amount:e.iva_amount||0,shipping_cost:e.shipping_cost||0,feedback_discount_amount:e.feedback_discount_amount||0,volume_discount_savings:e.volume_discount_savings||0,seller_discount_savings:e.seller_discount_savings||0}}}const jo=()=>{const[t,e]=g.useState([]),[r,a]=g.useState(!0),[n,o]=g.useState({status:"all",paymentStatus:"all",sellerId:null}),[i,d]=g.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),c=new No;g.useEffect(()=>{p()},[n,i.currentPage]);const p=async()=>{a(!0);try{const u={status:n.status!=="all"?n.status:void 0,paymentStatus:n.paymentStatus!=="all"?n.paymentStatus:void 0,sellerId:n.sellerId,dateFrom:n.dateFrom,dateTo:n.dateTo,search:n.search,page:i.currentPage,limit:i.itemsPerPage},y=await c.getAdminOrders(u);e(y.orders),d({currentPage:y.pagination.currentPage,totalPages:y.pagination.totalPages,totalItems:y.pagination.totalItems,itemsPerPage:y.pagination.itemsPerPage})}catch(u){console.error("Error al cargar órdenes:",u)}finally{a(!1)}},h={pending:{label:"Pendiente",color:"bg-yellow-100 text-yellow-800",icon:s.jsx(qe,{className:"w-3 h-3 mr-1"})},processing:{label:"En proceso",color:"bg-blue-100 text-blue-800",icon:s.jsx(W,{className:"w-3 h-3 mr-1"})},paid:{label:"Pagado",color:"bg-teal-100 text-teal-800",icon:s.jsx(re,{className:"w-3 h-3 mr-1"})},shipped:{label:"Enviado",color:"bg-indigo-100 text-indigo-800",icon:s.jsx(Ms,{className:"w-3 h-3 mr-1"})},delivered:{label:"Entregado",color:"bg-purple-100 text-purple-800",icon:s.jsx(Us,{className:"w-3 h-3 mr-1"})},completed:{label:"Completado",color:"bg-emerald-100 text-emerald-800",icon:s.jsx(re,{className:"w-3 h-3 mr-1"})},cancelled:{label:"Cancelado",color:"bg-red-100 text-red-800",icon:s.jsx(Js,{className:"w-3 h-3 mr-1"})},returned:{label:"Devuelto",color:"bg-orange-100 text-orange-800",icon:s.jsx(Cr,{className:"w-3 h-3 mr-1"})},ready_for_pickup:{label:"Listo para recoger",color:"bg-purple-100 text-purple-800",icon:s.jsx(Ss,{className:"w-3 h-3 mr-1"})}},v={paid:{label:"Pagado",color:"bg-green-100 text-green-800"},completed:{label:"Completado",color:"bg-green-100 text-green-800"},pending:{label:"Pendiente",color:"bg-yellow-100 text-yellow-800"},refunded:{label:"Reembolsado",color:"bg-red-100 text-red-800"},failed:{label:"Fallido",color:"bg-gray-100 text-gray-800"}},f={credit_card:"Tarjeta de crédito",paypal:"PayPal",bank_transfer:"Transferencia bancaria",cash_on_delivery:"Contra reembolso"},A=u=>({pending:"processing",processing:"shipped",shipped:"delivered",delivered:"completed"})[u]||u,l=async(u,y)=>{a(!0);try{await c.updateOrderStatus(u,y)?e(T=>T.map(R=>R.id===u?{...R,status:y,updatedAt:new Date().toISOString()}:R)):alert("Error al actualizar el estado de la orden")}catch(m){console.error("Error al actualizar estado:",m),alert("Error al actualizar el estado de la orden")}finally{a(!1)}},S=(u,y)=>{const m=A(y);m!==y&&l(u,m)},x=async u=>{if(window.confirm("¿Estás seguro de que deseas cancelar este pedido?")){a(!0);try{await c.cancelOrder(u)?e(m=>m.map(T=>T.id===u?{...T,status:"cancelled",updatedAt:new Date().toISOString()}:T)):alert("Error al cancelar la orden")}catch(y){console.error("Error al cancelar orden:",y),alert("Error al cancelar la orden")}finally{a(!1)}}},N=u=>{if(!u)return"N/A";const y=new Date(u);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(y)},w=u=>{d(y=>({...y,currentPage:u}))},E=()=>{p()},O=(u,y)=>{o(m=>({...m,[u]:y})),d(m=>({...m,currentPage:1}))},b=()=>{o({status:"all",paymentStatus:"all",sellerId:null,dateFrom:void 0,dateTo:void 0,search:void 0})},_=[{key:"orderNumber",header:"Pedido",sortable:!0,render:u=>s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-lg bg-primary-100 flex items-center justify-center",children:s.jsx(Ss,{className:"h-6 w-6 text-primary-600"})}),s.jsxs("div",{className:"ml-4",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:u.orderNumber}),s.jsxs("div",{className:"text-xs text-gray-500 flex items-center",children:[s.jsx(pt,{className:"w-3 h-3 mr-1"}),N(u.date)]})]})]})},{key:"customer",header:"Cliente",sortable:!0,render:u=>{const y=u.customer.name||`Usuario ${u.customer.id}`;return s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center",children:s.jsx(_e,{className:"h-4 w-4 text-gray-500"})}),s.jsxs("div",{className:"ml-3",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:y}),s.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",u.customer.id]})]})]})}},{key:"items",header:"Productos",render:u=>s.jsxs("div",{className:"text-sm",children:[s.jsx("span",{className:"font-medium",children:u.items.length})," producto(s)",u.items.length>0&&s.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[u.items.slice(0,2).map(y=>s.jsxs("div",{children:[y.quantity,"x ",y.name||`Producto ${y.productId}`]},y.id)),u.items.length>2&&s.jsxs("div",{children:["+ ",u.items.length-2," más..."]})]})]})},{key:"total",header:"Total",sortable:!0,render:u=>s.jsx("div",{className:"font-medium text-gray-900",children:Ae(u.total)})},{key:"status",header:"Estado",sortable:!0,render:u=>{const y=h[u.status]||{label:u.status,color:"bg-gray-100 text-gray-800",icon:s.jsx(H,{className:"w-3 h-3 mr-1"})};return s.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${y.color}`,children:[y.icon,y.label]})}},{key:"payment",header:"Pago",sortable:!0,render:u=>{const y=f[u.paymentMethod||""]||u.paymentMethod,m=v[u.paymentStatus||"pending"]||{label:u.paymentStatus,color:"bg-gray-100 text-gray-800"};return s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-gray-500",children:y}),s.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${m.color}`,children:m.label})]})}},{key:"actions",header:"Acciones",render:u=>{const y=["pending","processing","shipped","delivered"].includes(u.status),m=["pending","processing"].includes(u.status);return s.jsxs("div",{className:"flex justify-end space-x-2",children:[s.jsx(ee,{to:`/admin/orders/${u.id}`,className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Ver detalles del pedido",children:s.jsx(ts,{size:18})}),["completed","delivered"].includes(u.status)&&s.jsx(ee,{to:`/admin/invoices?orderId=${u.id}`,className:"p-1 text-indigo-600 hover:bg-indigo-100 rounded-md",title:"Ver factura",children:s.jsx(Fs,{size:18})}),y&&s.jsx("button",{onClick:()=>S(u.id,u.status),className:"p-1 text-green-600 hover:bg-green-100 rounded-md",title:`Avanzar a ${h[A(u.status)]?.label||"siguiente estado"}`,children:s.jsx(re,{size:18})}),m&&s.jsx("button",{onClick:()=>x(u.id),className:"p-1 text-red-600 hover:bg-red-100 rounded-md",title:"Cancelar pedido",children:s.jsx(Js,{size:18})})]})}}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Pedidos"}),s.jsx("div",{className:"flex space-x-2",children:s.jsxs("button",{onClick:E,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[s.jsx(W,{size:18,className:"inline mr-2"}),"Actualizar"]})})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{className:"text-sm text-gray-600",children:"Estado del pedido"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx(ls,{className:"h-5 w-5 text-gray-500 mr-2"}),s.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:n.status,onChange:u=>O("status",u.target.value),children:[s.jsx("option",{value:"all",children:"Todos los Estados"}),Object.entries(h).map(([u,{label:y}])=>s.jsx("option",{value:u,children:y},u))]})]})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{className:"text-sm text-gray-600",children:"Estado de pago"}),s.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:n.paymentStatus,onChange:u=>O("paymentStatus",u.target.value),children:[s.jsx("option",{value:"all",children:"Todos los Estados"}),Object.entries(v).map(([u,{label:y}])=>s.jsx("option",{value:u,children:y},u))]})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{className:"text-sm text-gray-600",children:"Vendedor"}),s.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:n.sellerId===null?"null":n.sellerId,onChange:u=>O("sellerId",u.target.value==="null"?null:Number(u.target.value)),children:[s.jsx("option",{value:"null",children:"Todos los Vendedores"}),[1,2,3,4,5].map(u=>s.jsxs("option",{value:u,children:["Vendedor ",u]},u))]})]}),s.jsxs("div",{className:"flex flex-col space-y-1",children:[s.jsx("label",{className:"text-sm text-gray-600",children:"Rango de fechas"}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:n.dateFrom||"",onChange:u=>O("dateFrom",u.target.value),placeholder:"Desde"}),s.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:n.dateTo||"",onChange:u=>O("dateTo",u.target.value),placeholder:"Hasta"})]})]})]}),s.jsx("div",{className:"mt-4 flex justify-end",children:s.jsx("button",{onClick:b,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Limpiar filtros"})})]}),s.jsx(fs,{data:t,columns:_,searchFields:["orderNumber","customer"],loading:r,emptyMessage:"No se encontraron pedidos",pagination:{currentPage:i.currentPage,totalPages:i.totalPages,totalItems:i.totalItems,itemsPerPage:i.itemsPerPage,onPageChange:w}})]})},mi=Object.freeze(Object.defineProperty({__proto__:null,default:jo},Symbol.toStringTag,{value:"Module"}));class He{constructor(){}async getDevelopmentConfigs(){try{const e=await $.get(D.ADMIN.CONFIGURATIONS.DEVELOPMENT);return e?.data?{status:"success",data:{mode:e.data.mode||!1,allowAdminOnlyAccess:e.data.allowAdminOnlyAccess||!1,bypassEmailVerification:e.data.bypassEmailVerification||!0,requireEmailVerification:e.data.requireEmailVerification||!1,emailVerificationTimeout:e.data.emailVerificationTimeout||24}}:{status:"success",data:{mode:!1,allowAdminOnlyAccess:!1,bypassEmailVerification:!0,requireEmailVerification:!1,emailVerificationTimeout:24}}}catch(e){return console.error("Error getting development configs:",e),{status:"error",message:"Error al obtener configuraciones de desarrollo"}}}async updateDevelopmentConfigs(e){try{return await $.post(D.ADMIN.CONFIGURATIONS.UPDATE,{type:"development",config:e}),ne.getInstance().invalidateCache(),{status:"success",data:e,message:"Configuración actualizada correctamente"}}catch(r){return console.error("Error updating development configs:",r),{status:"error",message:"Error al actualizar configuraciones"}}}async getModerationConfigs(){try{const r=(await $.get(D.ADMIN.CONFIGURATIONS.INDEX))?.data?.moderation;return{status:"success",data:{auto_approval:r?.auto_approval||!0,review_threshold:r?.review_threshold||3,enable_user_reports:r?.enable_user_reports||!0,auto_suspend_threshold:r?.auto_suspend_threshold||5,manual_review_required:r?.manual_review_required||!1,userStrikesThreshold:r?.userStrikesThreshold||3,lowStockThreshold:r?.lowStockThreshold||5,contactScorePenalty:r?.contactScorePenalty||10,businessScoreBonus:r?.businessScoreBonus||5,contactPenaltyHeavy:r?.contactPenaltyHeavy||20,minimumContactScore:r?.minimumContactScore||50,scoreDifferenceThreshold:r?.scoreDifferenceThreshold||30,consecutiveNumbersLimit:r?.consecutiveNumbersLimit||3,numbersWithContextLimit:r?.numbersWithContextLimit||5}}}catch(e){return console.error("Error getting moderation configs:",e),{status:"error",message:"Error al obtener configuraciones de moderación"}}}async updateModerationConfigs(e){try{return await $.post(D.ADMIN.CONFIGURATIONS.UPDATE,{type:"moderation",config:e}),ne.getInstance().invalidateCache(),{status:"success",data:e,message:"Configuración de moderación actualizada"}}catch(r){return console.error("Error updating moderation configs:",r),{status:"error",message:"Error al actualizar configuraciones de moderación"}}}async getSecurityConfigs(){try{const e=await $.get(D.ADMIN.CONFIGURATIONS.PASSWORD_VALIDATION_RULES);return{status:"success",data:{password_rules:{min_length:e?.data?.min_length||8,require_uppercase:e?.data?.require_uppercase||!0,require_lowercase:e?.data?.require_lowercase||!0,require_numbers:e?.data?.require_numbers||!0,require_special_chars:e?.data?.require_special_chars||!1},max_login_attempts:e?.data?.max_login_attempts||5,lockout_duration:e?.data?.lockout_duration||900,passwordMinLength:e?.data?.min_length||8,passwordRequireSpecial:e?.data?.require_special_chars||!1,passwordRequireUppercase:e?.data?.require_uppercase||!0,passwordRequireNumbers:e?.data?.require_numbers||!0,accountLockAttempts:e?.data?.max_login_attempts||5,sessionTimeout:e?.data?.session_timeout||parseInt("15"),requireEmailVerification:e?.data?.require_email_verification||!0,enableTwoFactor:e?.data?.enable_two_factor||!1,adminIpRestriction:e?.data?.admin_ip_restriction||!1}}}catch(e){return console.error("Error getting security configs:",e),{status:"error",message:"Error al obtener configuraciones de seguridad"}}}async updateSecurityConfigs(e){try{return await $.post(D.ADMIN.CONFIGURATIONS.PASSWORD_VALIDATION_RULES,e.password_rules),ne.getInstance().invalidateCache(),{status:"success",data:e,message:"Configuración de seguridad actualizada"}}catch(r){return console.error("Error updating security configs:",r),{status:"error",message:"Error al actualizar configuraciones de seguridad"}}}async getRatingConfigs(){try{const e=await $.get(D.ADMIN.CONFIGURATIONS.RATINGS);return{status:"success",data:{min_rating:e?.data?.min_rating||1,max_rating:e?.data?.max_rating||5,allow_anonymous:e?.data?.allow_anonymous||!1,require_purchase:e?.data?.require_purchase||!0,enable_reviews:e?.data?.enable_reviews||!0,auto_publish_reviews:e?.data?.auto_publish_reviews||!1,auto_approve_all:e?.data?.auto_approve_all||!1,auto_approve_threshold:e?.data?.auto_approve_threshold||4,"ratings.auto_approve_all":e?.data?.auto_approve_all||!1,"ratings.auto_approve_threshold":e?.data?.auto_approve_threshold||4}}}catch(e){return console.error("Error getting rating configs:",e),{status:"error",message:"Error al obtener configuraciones de calificaciones"}}}async updateRatingConfigs(e){try{return await $.post(D.ADMIN.CONFIGURATIONS.RATINGS,e),ne.getInstance().invalidateCache(),{status:"success",data:e,message:"Configuración de calificaciones actualizada"}}catch(r){return console.error("Error updating rating configs:",r),{status:"error",message:"Error al actualizar configuraciones de calificaciones"}}}async getVolumeDiscountConfigs(){try{const e=await $.get(D.ADMIN.VOLUME_DISCOUNTS.CONFIGURATION);return{status:"success",data:{enabled:e?.data?.enabled||!0,stackable:e?.data?.stackable||!1,default_tiers:e?.data?.default_tiers||[{quantity:3,discount:5,label:"3+"},{quantity:5,discount:8,label:"5+"},{quantity:10,discount:15,label:"10+"}]}}}catch(e){return console.error("Error getting volume discount configs:",e),{status:"error",message:"Error al obtener configuraciones de descuentos por volumen"}}}async updateVolumeDiscountConfigs(e){try{return await $.post(D.ADMIN.VOLUME_DISCOUNTS.CONFIGURATION,e),ne.getInstance().invalidateCache(),{status:"success",data:e,message:"Configuración de descuentos por volumen actualizada"}}catch(r){return console.error("Error updating volume discount configs:",r),{status:"error",message:"Error al actualizar configuraciones de descuentos por volumen"}}}async getRatingStats(){try{return{status:"success",data:(await $.get(`${D.ADMIN.CONFIGURATIONS.RATINGS}/stats`))?.data||{}}}catch(e){return console.error("Error getting rating stats:",e),{status:"error",message:"Error al obtener estadísticas de calificaciones"}}}async approveAllPendingRatings(){try{return{status:"success",data:(await $.post(`${D.ADMIN.CONFIGURATIONS.RATINGS}/approve-all`))?.data||{},message:"Todas las calificaciones pendientes han sido aprobadas"}}catch(e){return console.error("Error approving pending ratings:",e),{status:"error",message:"Error al aprobar calificaciones pendientes"}}}}const So=()=>{const[t,e]=g.useState(!0),[r,a]=g.useState(!1),[n,o]=g.useState(null),[i,d]=g.useState(null),[c,p]=g.useState({password_rules:{min_length:8,require_uppercase:!0,require_lowercase:!0,require_numbers:!0,require_special_chars:!0},max_login_attempts:5,lockout_duration:900,passwordMinLength:8,passwordRequireSpecial:!0,passwordRequireUppercase:!0,passwordRequireNumbers:!0,accountLockAttempts:5,sessionTimeout:parseInt("15"),enableTwoFactor:!1,requireEmailVerification:!0,adminIpRestriction:!1}),h=new He;g.useEffect(()=>{v()},[]);const v=async()=>{e(!0),o(null);try{const x=await h.getSecurityConfigs();x?.status==="success"&&x.data?p(x.data):o(x?.message||"No se pudieron cargar las configuraciones")}catch(x){console.error("Error al cargar configuraciones de seguridad:",x),o("No se pudieron cargar las configuraciones. Por favor, inténtalo de nuevo.")}finally{e(!1)}},f=(x,N)=>{p(w=>({...w,[x]:N}))},A=async()=>{a(!0),o(null),d(null);try{const x=await h.updateSecurityConfigs(c);x?.status==="success"?(d("Configuración de seguridad guardada correctamente"),setTimeout(()=>d(null),3e3)):o(x?.message||"Error al guardar la configuración")}catch(x){console.error("Error al guardar configuraciones de seguridad:",x),o("No se pudo guardar la configuración. Por favor, inténtalo de nuevo.")}finally{a(!1)}},S=(()=>{let x=0;return Number(c.passwordMinLength)>=8&&x++,c.passwordRequireSpecial&&x++,c.passwordRequireUppercase&&x++,c.passwordRequireNumbers&&x++,x>=4?{level:"Fuerte",color:"text-green-600",bg:"bg-green-100"}:x>=3?{level:"Moderada",color:"text-yellow-600",bg:"bg-yellow-100"}:{level:"Débil",color:"text-red-600",bg:"bg-red-100"}})();return t?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[s.jsx($s,{className:"w-6 h-6 mr-2"}),"Configuración de Seguridad"]}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Configure las políticas de seguridad, autenticación y protección del sistema"})]}),s.jsxs("button",{onClick:v,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 flex items-center",disabled:t,children:[s.jsx(W,{size:18,className:`mr-2 ${t?"animate-spin":""}`}),"Actualizar"]})]}),n&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(H,{className:"h-5 w-5 text-red-500 mr-2"}),s.jsx("p",{className:"text-red-700",children:n})]})}),i&&s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-5 h-5 bg-green-500 rounded-full flex items-center justify-center mr-2",children:s.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),s.jsx("p",{className:"text-green-700",children:i})]})}),s.jsx("div",{className:"bg-primary-50 border border-primary-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(he,{className:"w-5 h-5 text-primary-500 mr-3 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-primary-900",children:"Configuración de Seguridad"}),s.jsx("p",{className:"mt-1 text-primary-800",children:"Estas configuraciones afectan la seguridad de toda la plataforma. Cambios muy restrictivos pueden impactar la experiencia del usuario, mientras que configuraciones muy permisivas pueden comprometer la seguridad."})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[s.jsx(Es,{className:"w-5 h-5 mr-2"}),"Políticas de Contraseña"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Longitud mínima de contraseña"}),s.jsx("input",{type:"text",value:c.passwordMinLength,onChange:x=>{const N=x.target.value;(N===""||/^\d+$/.test(N))&&f("passwordMinLength",N===""?"":parseInt(N))},onBlur:x=>{const N=x.target.value;if(N==="")f("passwordMinLength",6);else{const w=parseInt(N);w<6?f("passwordMinLength",6):w>50&&f("passwordMinLength",50)}},className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"6-50"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Número mínimo de caracteres requeridos (recomendado: 8+)"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.passwordRequireSpecial,onChange:x=>f("passwordRequireSpecial",x.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Requerir caracteres especiales (!@#$%^&*)"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.passwordRequireUppercase,onChange:x=>f("passwordRequireUppercase",x.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Requerir letras mayúsculas (A-Z)"})]}),s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.passwordRequireNumbers,onChange:x=>f("passwordRequireNumbers",x.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Requerir números (0-9)"})]})]}),s.jsx("div",{className:`p-3 rounded-lg ${S.bg}`,children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(Se,{className:`w-4 h-4 mr-2 ${S.color}`}),s.jsxs("span",{className:`text-sm font-medium ${S.color}`,children:["Seguridad de contraseña: ",S.level]})]})})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[s.jsx(qe,{className:"w-5 h-5 mr-2"}),"Autenticación y Sesiones"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Intentos fallidos antes de bloqueo"}),s.jsx("input",{type:"text",value:c.accountLockAttempts,onChange:x=>{const N=x.target.value;(N===""||/^\d+$/.test(N))&&f("accountLockAttempts",N===""?"":parseInt(N))},onBlur:x=>{const N=x.target.value;if(N==="")f("accountLockAttempts",3);else{const w=parseInt(N);w<3?f("accountLockAttempts",3):w>10&&f("accountLockAttempts",10)}},className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"3-10"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Número de intentos de login fallidos antes de bloquear temporalmente la cuenta"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tiempo de sesión (minutos)"}),s.jsx("input",{type:"text",value:c.sessionTimeout,onChange:x=>{const N=x.target.value;(N===""||/^\d+$/.test(N))&&f("sessionTimeout",N===""?"":parseInt(N))},onBlur:x=>{const N=x.target.value;if(N==="")f("sessionTimeout",30);else{const w=parseInt(N);w<30?f("sessionTimeout",30):w>480&&f("sessionTimeout",480)}},className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"30-480"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Tiempo de inactividad antes de cerrar sesión automáticamente"})]}),s.jsx("div",{className:"space-y-3",children:s.jsxs("label",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",checked:c.requireEmailVerification,onChange:x=>f("requireEmailVerification",x.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Requerir verificación de email"})]})})]})]})]}),s.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Recomendaciones de Seguridad"}),s.jsxs("ul",{className:"text-sm text-yellow-800 space-y-1",children:[s.jsx("li",{children:"• Use contraseñas de al menos 8 caracteres con caracteres especiales, mayúsculas y números"}),s.jsx("li",{children:"• Limite los intentos de login a 5 o menos para prevenir ataques de fuerza bruta"}),s.jsx("li",{children:"• Configure sesiones de máximo 240 minutos (4 horas) para cuentas administrativas"}),s.jsx("li",{children:"• Habilite la verificación de email para prevenir registros con emails falsos"}),s.jsx("li",{children:"• Use restricciones de IP solo si su organización tiene IPs fijas"})]})]}),s.jsx("div",{className:"flex justify-end",children:s.jsxs("button",{onClick:A,disabled:r,className:"flex items-center px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:[s.jsx(de,{size:16,className:"mr-2"}),r?"Guardando...":"Guardar Configuración"]})})]})},Eo=()=>{const[t,e]=g.useState(!0),[r,a]=g.useState(!1),[n,o]=g.useState(null),[i,d]=g.useState(null),[c,p]=g.useState({auto_approval:!0,review_threshold:3,enable_user_reports:!0,auto_suspend_threshold:5,manual_review_required:!1,userStrikesThreshold:3,contactScorePenalty:3,businessScoreBonus:15,contactPenaltyHeavy:20,minimumContactScore:8,scoreDifferenceThreshold:5,consecutiveNumbersLimit:7,numbersWithContextLimit:3,lowStockThreshold:5}),h=new He;g.useEffect(()=>{v()},[]);const v=async()=>{e(!0),o(null);try{const l=await h.getModerationConfigs();l?.status==="success"&&l.data?p(l.data):o(l?.message||"No se pudieron cargar las configuraciones")}catch(l){console.error("Error al cargar configuraciones de moderación:",l),o("No se pudieron cargar las configuraciones. Por favor, inténtalo de nuevo.")}finally{e(!1)}},f=(l,S)=>{p(x=>({...x,[l]:S}))},A=async()=>{a(!0),o(null),d(null);try{const l=await h.updateModerationConfigs(c);l?.status==="success"?(d("Configuración de moderación guardada correctamente"),setTimeout(()=>d(null),3e3)):o(l?.message||"Error al guardar la configuración")}catch(l){console.error("Error al guardar configuraciones de moderación:",l),o("No se pudo guardar la configuración. Por favor, inténtalo de nuevo.")}finally{a(!1)}};return t?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[s.jsx(Se,{className:"w-6 h-6 mr-2"}),"Configuración de Moderación"]}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Configure los parámetros para la moderación automática de mensajes y contenido"})]}),s.jsxs("button",{onClick:v,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 flex items-center",disabled:t,children:[s.jsx(W,{size:18,className:`mr-2 ${t?"animate-spin":""}`}),"Actualizar"]})]}),n&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(H,{className:"h-5 w-5 text-red-500 mr-2"}),s.jsx("p",{className:"text-red-700",children:n})]})}),i&&s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-5 h-5 bg-green-500 rounded-full flex items-center justify-center mr-2",children:s.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),s.jsx("p",{className:"text-green-700",children:i})]})}),s.jsx("div",{className:"bg-primary-50 border border-primary-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(he,{className:"w-5 h-5 text-primary-500 mr-3 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-primary-900",children:"Acerca de la Moderación Automática"}),s.jsx("p",{className:"mt-1 text-primary-800",children:"El sistema analiza automáticamente los mensajes entre usuarios para detectar patrones sospechosos como intercambio de información de contacto fuera de la plataforma. Los valores aquí configurados determinan la sensibilidad de la detección."})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[s.jsx(os,{className:"w-5 h-5 mr-2"}),"Sistema de Strikes de Usuario"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Strikes antes de bloqueo"}),s.jsx("input",{type:"number",onWheel:l=>l.currentTarget.blur(),value:c.userStrikesThreshold,onChange:l=>f("userStrikesThreshold",parseInt(l.target.value)),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",min:"1",max:"10"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Número de strikes que puede acumular un usuario antes de ser bloqueado automáticamente"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Umbral de stock bajo"}),s.jsx("input",{type:"number",onWheel:l=>l.currentTarget.blur(),value:c.lowStockThreshold,onChange:l=>f("lowStockThreshold",parseInt(l.target.value)),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",min:"1",max:"50"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Cantidad mínima de productos en stock antes de mostrar aviso de stock bajo"})]})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[s.jsx(wr,{className:"w-5 h-5 mr-2"}),"Detección de Información de Contacto"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Penalización por patrones sospechosos"}),s.jsx("input",{type:"number",onWheel:l=>l.currentTarget.blur(),value:c.contactScorePenalty,onChange:l=>f("contactScorePenalty",parseInt(l.target.value)),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",min:"1",max:"20"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Puntos añadidos al score de contacto por patrones sospechosos"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bonus por indicadores de negocio"}),s.jsx("input",{type:"number",onWheel:l=>l.currentTarget.blur(),value:c.businessScoreBonus,onChange:l=>f("businessScoreBonus",parseInt(l.target.value)),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",min:"5",max:"50"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Puntos añadidos al score de negocio cuando se detectan términos comerciales legítimos"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Penalización fuerte por contacto"}),s.jsx("input",{type:"number",onWheel:l=>l.currentTarget.blur(),value:c.contactPenaltyHeavy,onChange:l=>f("contactPenaltyHeavy",parseInt(l.target.value)),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",min:"10",max:"50"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Penalización severa aplicada cuando se detectan indicadores claros de contacto"})]})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Umbrales de Score"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Score mínimo de contacto"}),s.jsx("input",{type:"number",onWheel:l=>l.currentTarget.blur(),value:c.minimumContactScore,onChange:l=>f("minimumContactScore",parseInt(l.target.value)),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",min:"5",max:"20"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Score mínimo para considerar que un mensaje contiene información de contacto"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Diferencia de score requerida"}),s.jsx("input",{type:"number",onWheel:l=>l.currentTarget.blur(),value:c.scoreDifferenceThreshold,onChange:l=>f("scoreDifferenceThreshold",parseInt(l.target.value)),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",min:"3",max:"15"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Diferencia mínima entre score de contacto y negocio para activar moderación"})]})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Detección de Números"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Límite de números consecutivos"}),s.jsx("input",{type:"number",onWheel:l=>l.currentTarget.blur(),value:c.consecutiveNumbersLimit,onChange:l=>f("consecutiveNumbersLimit",parseInt(l.target.value)),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",min:"5",max:"15"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Número de dígitos consecutivos que activan la detección de teléfonos"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Números con contexto de contacto"}),s.jsx("input",{type:"number",onWheel:l=>l.currentTarget.blur(),value:c.numbersWithContextLimit,onChange:l=>f("numbersWithContextLimit",parseInt(l.target.value)),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",min:"2",max:"8"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Número de dígitos que, junto con palabras de contacto, activan la detección"})]})]})]})]}),s.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Recomendaciones"}),s.jsxs("ul",{className:"text-sm text-yellow-800 space-y-1",children:[s.jsx("li",{children:"• Un número bajo de strikes (1-2) puede ser muy restrictivo para usuarios legítimos"}),s.jsx("li",{children:"• Scores altos de penalización pueden generar falsos positivos"}),s.jsx("li",{children:"• El bonus de negocio debe ser significativamente mayor que las penalizaciones"}),s.jsx("li",{children:"• Ajusta los límites de números según el tipo de productos vendidos"})]})]}),s.jsx("div",{className:"flex justify-end",children:s.jsxs("button",{onClick:A,disabled:r,className:"flex items-center px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:[s.jsx(de,{size:16,className:"mr-2"}),r?"Guardando...":"Guardar Configuración"]})})]})},Co=()=>{const[t,e]=g.useState(!0),[r,a]=g.useState(!1),[n,o]=g.useState(null),[i,d]=g.useState(null),[c,p]=g.useState(!1),[h,v]=g.useState(2),[f,A]=g.useState({totalCount:0,approvedCount:0,pendingCount:0,rejectedCount:0}),l=new He;g.useEffect(()=>{S(),x()},[]);const S=async()=>{e(!0),o(null);try{const E=await l.getRatingConfigs();if(E?.status==="success"&&E.data){const O=E.data;p(!!(O["ratings.auto_approve_all"]||O.auto_approve_all)||!1),v(Number(O["ratings.auto_approve_threshold"]||O.auto_approve_threshold)||2)}else o(E?.message||"No se pudieron cargar las configuraciones"),console.warn("Respuesta de configuraciones inválida:",E)}catch(E){console.error("Error al cargar configuraciones:",E),o("No se pudieron cargar las configuraciones. Por favor, inténtalo de nuevo.")}finally{e(!1)}},x=async()=>{try{const E=await l.getRatingStats();E?.status==="success"&&E.data?A(E.data):console.warn("Error al cargar estadísticas:",E?.message)}catch(E){console.error("Error al cargar estadísticas de valoraciones:",E)}},N=async()=>{a(!0),o(null),d(null);try{const E=await l.updateRatingConfigs({min_rating:1,max_rating:5,allow_anonymous:!1,require_purchase:!0,enable_reviews:!0,auto_publish_reviews:!0,auto_approve_all:c,auto_approve_threshold:h,"ratings.auto_approve_all":c,"ratings.auto_approve_threshold":h});E?.status==="success"?(d("Configuraciones guardadas correctamente"),x()):o(E?.message||"Error al guardar las configuraciones")}catch(E){console.error("Error al guardar configuraciones:",E),o("No se pudieron guardar las configuraciones. Por favor, inténtalo de nuevo.")}finally{a(!1)}},w=async()=>{if(confirm("¿Estás seguro de que deseas aprobar todas las valoraciones pendientes? Esta acción no se puede deshacer.")){e(!0),o(null),d(null);try{const E=await l.approveAllPendingRatings();E?.status==="success"?(d(`Se han aprobado ${E.data?.count||0} valoraciones pendientes`),x()):o(E?.message||"Error al aprobar valoraciones pendientes")}catch(E){console.error("Error al aprobar valoraciones pendientes:",E),o("No se pudieron aprobar las valoraciones pendientes. Por favor, inténtalo de nuevo.")}finally{e(!1)}}};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Configuración de Valoraciones"}),s.jsxs("button",{onClick:S,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 flex items-center",disabled:t,children:[s.jsx(W,{size:18,className:`mr-2 ${t?"animate-spin":""}`}),"Actualizar"]})]}),s.jsxs("div",{className:"bg-primary-50 text-primary-800 p-4 rounded-lg flex items-start",children:[s.jsx(he,{className:"w-5 h-5 mr-3 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium",children:"Acerca de las valoraciones"}),s.jsx("p",{className:"mt-1",children:"Configura cómo se gestionan las valoraciones de usuarios en la plataforma. Puedes establecer aprobaciones automáticas basadas en umbrales de calificación o realizar moderación manual."})]})]}),n&&s.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:s.jsx("span",{className:"block sm:inline",children:n})}),i&&s.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative",children:s.jsx("span",{className:"block sm:inline",children:i})}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Total de valoraciones"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:f.totalCount})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Aprobadas"}),s.jsx("p",{className:"text-2xl font-bold text-green-600",children:f.approvedCount})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Pendientes"}),s.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:f.pendingCount})]}),s.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Rechazadas"}),s.jsx("p",{className:"text-2xl font-bold text-red-600",children:f.rejectedCount})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[s.jsxs("div",{className:"p-6",children:[s.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Configuración de Aprobación Automática"}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("label",{className:"flex items-center space-x-3 mb-3",children:[s.jsx("input",{type:"checkbox",checked:c,onChange:E=>p(E.target.checked),className:"form-checkbox h-5 w-5 text-primary-600 rounded focus:ring-primary-500",disabled:r}),s.jsx("span",{className:"text-gray-900 font-medium",children:"Aprobar automáticamente todas las valoraciones"})]}),s.jsx("p",{className:"text-sm text-gray-500 ml-8",children:"Cuando está activado, todas las valoraciones se aprobarán automáticamente sin moderación. No recomendado para sitios con alto tráfico o riesgo de spam."})]}),s.jsxs("div",{className:c?"opacity-50":"",children:[s.jsx("label",{className:"block text-gray-700 font-medium mb-2",children:"Umbral de aprobación automática"}),s.jsxs("div",{className:"flex items-center mb-3",children:[s.jsx("div",{className:"flex-1",children:s.jsx("input",{type:"range",min:"1",max:"5",step:"1",value:h,onChange:E=>v(Number(E.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer",disabled:c||r})}),s.jsx("div",{className:"w-16 ml-4 flex space-x-0.5",children:[1,2,3,4,5].map(E=>s.jsx(ge,{size:16,className:`${E<=h?"text-yellow-400 fill-current":"text-gray-400"}`},E))})]}),s.jsxs("div",{className:"flex justify-between text-xs text-gray-500 px-1",children:[s.jsxs("span",{children:["Se requiere moderación: 1-",h]}),s.jsxs("span",{children:["Aprobación automática: >",h]})]}),s.jsxs("p",{className:"text-sm text-gray-500 mt-3",children:["Las valoraciones con ",h," estrellas o menos requerirán aprobación manual. Las valoraciones con más de"," ",h," estrellas se aprobarán automáticamente."]}),h<2&&s.jsxs("div",{className:"mt-3 flex items-start bg-yellow-50 p-3 rounded-md",children:[s.jsx(H,{className:"w-5 h-5 text-yellow-600 mr-2 mt-0.5 flex-shrink-0"}),s.jsx("p",{className:"text-sm text-yellow-700",children:"Un umbral muy bajo puede permitir valoraciones negativas automáticamente. Considera usar un valor de 2 o superior para una mejor moderación."})]})]})]}),s.jsxs("div",{className:"px-6 py-3 bg-gray-50 border-t border-gray-200 rounded-b-lg flex flex-col sm:flex-row gap-3 justify-end",children:[f.pendingCount>0&&s.jsxs("button",{type:"button",onClick:w,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center",disabled:t||r,children:["Aprobar las ",f.pendingCount," valoraciones pendientes"]}),s.jsxs("button",{type:"button",onClick:N,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 flex items-center",disabled:t||r,children:[s.jsx(de,{size:18,className:"mr-2"}),r?"Guardando...":"Guardar configuración"]})]})]})]})},wo=()=>{const[t,e]=g.useState(!1),[r,a]=g.useState(null),[n,o]=g.useState(null),[i,d]=g.useState({enabled:!0,stackable:!1,show_savings_message:!0,default_tiers:[{quantity:3,discount:5,label:"Descuento 3+"},{quantity:6,discount:10,label:"Descuento 6+"},{quantity:12,discount:15,label:"Descuento 12+"}]}),c=new He;g.useEffect(()=>{p()},[]);const p=async()=>{try{e(!0),o(null);const l=await c.getVolumeDiscountConfigs();l.status==="success"&&l.data?d(l.data):console.warn("No se pudo cargar configuración, usando valores por defecto")}catch(l){console.error("Error cargando configuración:",l),o("No se pudo cargar la configuración")}finally{e(!1)}},h=(l,S,x)=>{const N=[...i.default_tiers];N[l]={...N[l],[S]:x},d(w=>({...w,default_tiers:N}))},v=()=>{d(l=>({...l,default_tiers:[...l.default_tiers,{quantity:1,discount:0,label:"Nuevo descuento"}]}))},f=l=>{d(S=>({...S,default_tiers:S.default_tiers.filter((x,N)=>N!==l)}))},A=async()=>{try{e(!0),o(null),a(null);const l=await c.updateVolumeDiscountConfigs(i);if(l.status==="success")a("Configuración guardada exitosamente"),setTimeout(()=>a(null),3e3);else throw new Error(l.message||"No se pudo guardar la configuración")}catch(l){console.error("Error guardando configuración:",l),o("Error al guardar la configuración")}finally{e(!1)}};return t&&i.default_tiers.length===3&&i.default_tiers[0].quantity===3?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})}):s.jsxs("div",{className:"space-y-6",children:[n&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(H,{className:"h-5 w-5 text-red-500 mr-2"}),s.jsx("p",{className:"text-red-700",children:n})]})}),r&&s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-5 h-5 bg-green-500 rounded-full flex items-center justify-center mr-2",children:s.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),s.jsx("p",{className:"text-green-700",children:r})]})}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-semibold flex items-center",children:[s.jsx(ft,{className:"w-5 h-5 mr-2"}),"Configuración de Descuentos por Volumen"]}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Configure los descuentos automáticos por cantidad de productos"})]}),s.jsxs("button",{onClick:p,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 flex items-center",disabled:t,children:[s.jsx(W,{size:18,className:`mr-2 ${t?"animate-spin":""}`}),"Actualizar"]})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-lg font-medium",children:"Niveles de Descuento por Defecto"}),s.jsxs("button",{onClick:v,className:"flex items-center px-3 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 text-sm",children:[s.jsx(Ls,{size:16,className:"mr-1"}),"Agregar Nivel"]})]}),s.jsx("div",{className:"space-y-3",children:i.default_tiers.map((l,S)=>s.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cantidad Mínima"}),s.jsx("input",{type:"number",value:l.quantity,onChange:x=>h(S,"quantity",parseInt(x.target.value)),onWheel:x=>x.currentTarget.blur(),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",min:"1"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descuento (%)"}),s.jsx("input",{type:"number",value:l.discount,onChange:x=>h(S,"discount",parseFloat(x.target.value)),onWheel:x=>x.currentTarget.blur(),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",min:"0",max:"100",step:"0.1"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Etiqueta"}),s.jsx("input",{type:"text",value:l.label,onChange:x=>h(S,"label",x.target.value),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Ej: Descuento 3+"})]}),s.jsx("div",{className:"flex items-end",children:s.jsx("button",{onClick:()=>f(S),className:"w-full text-red-600 hover:text-red-800 flex items-center justify-center p-2 border border-red-300 rounded-md hover:bg-red-50",children:s.jsx(ve,{size:16})})})]}),s.jsx("div",{className:"mt-3 p-3 bg-white rounded border",children:s.jsxs("div",{className:"text-sm text-gray-600",children:[s.jsx("span",{className:"font-medium",children:"Vista previa:"})," ","Al comprar ",l.quantity,"+ unidades, el cliente obtiene ",l.discount,"% de descuento",l.label&&s.jsx("span",{className:"ml-2 px-2 py-1 bg-green-100 text-green-800 rounded text-xs",children:l.label})]})})]},S))}),i.default_tiers.length===0&&s.jsxs("div",{className:"text-center py-8 text-gray-500 border border-dashed border-gray-300 rounded-lg",children:["No hay niveles de descuento configurados.",s.jsx("br",{}),s.jsx("button",{onClick:v,className:"mt-2 text-primary-600 hover:text-primary-700 underline",children:"Agregar el primer nivel de descuento"})]})]}),s.jsxs("div",{className:"bg-primary-50 border border-primary-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-primary-900 mb-2",children:"Información Importante"}),s.jsxs("ul",{className:"text-sm text-primary-800 space-y-1",children:[s.jsx("li",{children:"• Los descuentos se aplican automáticamente cuando el cliente alcanza la cantidad mínima"}),s.jsx("li",{children:"• Solo se aplica el descuento del nivel más alto alcanzado"}),s.jsx("li",{children:"• Los descuentos se calculan sobre el precio base del producto"}),s.jsx("li",{children:"• Las configuraciones se aplican a todos los productos de la tienda"})]})]}),s.jsx("div",{className:"flex justify-end",children:s.jsxs("button",{onClick:A,disabled:t,className:"flex items-center px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:[s.jsx(de,{size:16,className:"mr-2"}),t?"Guardando...":"Guardar Configuración"]})})]})]})]})},Ao=()=>{const[t,e]=g.useState(!0),[r,a]=g.useState(!1),[n,o]=g.useState(null),[i,d]=g.useState(null),[c,p]=g.useState({enabled:!0,freeThreshold:50,defaultCost:5}),h=ne.getInstance();g.useEffect(()=>{v()},[]);const v=async()=>{e(!0),o(null);try{const l=await h.getUnifiedConfig(),S={enabled:l.config.shipping.enabled,freeThreshold:l.config.shipping.free_threshold,defaultCost:l.config.shipping.default_cost};p(S)}catch(l){console.error("Error al cargar configuraciones de envío:",l),o("No se pudieron cargar las configuraciones. Por favor, inténtalo de nuevo.")}finally{e(!1)}},f=(l,S)=>{p(x=>l==="enabled"&&S===!1?{enabled:!1,freeThreshold:0,defaultCost:0}:l==="enabled"&&S===!0?{enabled:!0,freeThreshold:50,defaultCost:5}:{...x,[l]:S})},A=async()=>{a(!0),o(null),d(null);try{const l=await $.post(D.ADMIN.CONFIGURATIONS.SHIPPING,c);l?.status==="success"?(d("Configuración de envío guardada correctamente"),h.invalidateCache(),localStorage.setItem("shipping_config_updated",Date.now().toString()),setTimeout(()=>d(null),3e3)):o(l?.message||"Error al guardar la configuración")}catch(l){console.error("Error al guardar configuraciones de envío:",l),o("No se pudo guardar la configuración. Por favor, inténtalo de nuevo.")}finally{a(!1)}};return t?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[s.jsx(Ms,{className:"w-6 h-6 mr-2"}),"Configuración de Envíos"]}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Configure los parámetros para el cálculo de costos de envío"})]}),s.jsxs("button",{onClick:v,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 flex items-center",disabled:t,children:[s.jsx(W,{size:18,className:`mr-2 ${t?"animate-spin":""}`}),"Actualizar"]})]}),n&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(H,{className:"h-5 w-5 text-red-500 mr-2"}),s.jsx("p",{className:"text-red-700",children:n})]})}),i&&s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-5 h-5 bg-green-500 rounded-full flex items-center justify-center mr-2",children:s.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),s.jsx("p",{className:"text-green-700",children:i})]})}),s.jsx("div",{className:"bg-primary-50 border border-primary-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(he,{className:"w-5 h-5 text-primary-500 mr-3 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-primary-900",children:"Acerca de la Configuración de Envíos"}),s.jsx("p",{className:"mt-1 text-primary-800",children:"Estas configuraciones controlan cómo se calculan los costos de envío en la plataforma. El umbral de envío gratis determina el monto mínimo de compra para obtener envío gratuito, mientras que el costo por defecto se aplica a todas las compras por debajo de ese umbral."})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[s.jsx(Us,{className:"w-5 h-5 mr-2"}),"Configuración General"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",id:"shippingEnabled",checked:c.enabled,onChange:l=>f("enabled",l.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("label",{htmlFor:"shippingEnabled",className:"ml-2 block text-sm text-gray-900",children:"Habilitar cálculo de costos de envío"})]}),s.jsx("p",{className:"text-xs text-gray-500",children:"Cuando está deshabilitado, el envío será GRATIS para todas las compras (promoción temporal)"})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[s.jsx(is,{className:"w-5 h-5 mr-2"}),"Costos de Envío"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Umbral para envío gratis (USD)"}),s.jsx("input",{type:"text",value:c.freeThreshold===0||c.freeThreshold===null||c.freeThreshold===void 0?"":c.freeThreshold,onChange:l=>{const S=l.target.value;(S===""||/^\d*\.?\d*$/.test(S))&&f("freeThreshold",S===""?0:parseFloat(S)||0)},disabled:!c.enabled,className:`w-full border rounded-md px-3 py-2 ${c.enabled?"border-gray-300 focus:ring-primary-500 focus:border-primary-500":"border-gray-200 bg-gray-100 cursor-not-allowed"}`,placeholder:"50.00"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Monto mínimo de compra para obtener envío gratuito"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Costo de envío por defecto (USD)"}),s.jsx("input",{type:"text",value:c.defaultCost===0||c.defaultCost===null||c.defaultCost===void 0?"":c.defaultCost,onChange:l=>{const S=l.target.value;(S===""||/^\d*\.?\d*$/.test(S))&&f("defaultCost",S===""?0:parseFloat(S)||0)},disabled:!c.enabled,className:`w-full border rounded-md px-3 py-2 ${c.enabled?"border-gray-300 focus:ring-primary-500 focus:border-primary-500":"border-gray-200 bg-gray-100 cursor-not-allowed"}`,placeholder:"5.00"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Costo aplicado cuando no se alcanza el umbral de envío gratis"})]})]})]})]}),s.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-yellow-900 mb-2",children:"Información Importante"}),s.jsxs("ul",{className:"text-sm text-yellow-800 space-y-1",children:[s.jsx("li",{children:"• Los precios están configurados en dólares estadounidenses (USD)"}),s.jsx("li",{children:"• El cálculo de envío gratis se basa en el subtotal de la compra (sin impuestos)"}),s.jsx("li",{children:"• Si el envío está deshabilitado, no se mostrará información de costos de envío"}),s.jsx("li",{children:"• Los cambios se aplicarán inmediatamente a todas las nuevas compras"})]})]}),s.jsx("div",{className:"flex justify-end",children:s.jsxs("button",{onClick:A,disabled:r,className:"flex items-center px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:[s.jsx(de,{size:16,className:"mr-2"}),r?"Guardando...":"Guardar Configuración"]})})]})},_o=()=>{const[t,e]=g.useState(!0),[r,a]=g.useState(!1),[n,o]=g.useState(null),[i,d]=g.useState(null),[c,p]=g.useState({mode:!1,allowAdminOnlyAccess:!1,bypassEmailVerification:!0,requireEmailVerification:!1,emailVerificationTimeout:24}),h=new He;g.useEffect(()=>{v()},[]);const v=async()=>{e(!0),o(null);try{const l=await h.getDevelopmentConfigs();l?.status==="success"&&l.data?p(l.data):o(l?.message||"No se pudieron cargar las configuraciones")}catch(l){console.error("Error al cargar configuraciones de desarrollo:",l),o("No se pudieron cargar las configuraciones. Por favor, inténtalo de nuevo.")}finally{e(!1)}},f=(l,S)=>{p(x=>({...x,[l]:S}))},A=async()=>{a(!0),o(null),d(null);try{const l=await h.updateDevelopmentConfigs(c);l?.status==="success"?(d("Configuración de desarrollo guardada correctamente"),setTimeout(()=>d(null),3e3)):o(l?.message||"Error al guardar la configuración")}catch(l){console.error("Error al guardar configuraciones de desarrollo:",l),o("No se pudo guardar la configuración. Por favor, inténtalo de nuevo.")}finally{a(!1)}};return t?s.jsx("div",{className:"flex justify-center items-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[s.jsx(xt,{className:"w-6 h-6 mr-2"}),"Configuración de Desarrollo"]}),s.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Configure parámetros para desarrollo, mantenimiento y verificación de email"})]}),s.jsxs("button",{onClick:v,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 flex items-center",disabled:t,children:[s.jsx(W,{size:18,className:`mr-2 ${t?"animate-spin":""}`}),"Actualizar"]})]}),n&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(H,{className:"h-5 w-5 text-red-500 mr-2"}),s.jsx("p",{className:"text-red-700",children:n})]})}),i&&s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-5 h-5 bg-green-500 rounded-full flex items-center justify-center mr-2",children:s.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})}),s.jsx("p",{className:"text-green-700",children:i})]})}),s.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(H,{className:"w-5 h-5 text-amber-500 mr-3 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-amber-900",children:"¡Configuraciones Críticas!"}),s.jsx("p",{className:"mt-1 text-amber-800",children:"Estas configuraciones afectan la seguridad y funcionalidad del sistema. Solo modifícalas durante actualizaciones, mantenimiento o desarrollo."})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[s.jsx(ft,{className:"w-5 h-5 mr-2"}),"Modo Desarrollo"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",id:"developmentMode",checked:c.mode,onChange:l=>f("mode",l.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("label",{htmlFor:"developmentMode",className:"ml-2 block text-sm text-gray-900",children:"Activar modo desarrollo"})]}),s.jsx("p",{className:"text-xs text-gray-500",children:"Habilita funciones especiales para desarrolladores y actualizaciones del sistema"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",id:"adminOnlyAccess",checked:c.allowAdminOnlyAccess,onChange:l=>f("allowAdminOnlyAccess",l.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("label",{htmlFor:"adminOnlyAccess",className:"ml-2 block text-sm text-gray-900",children:"Restringir acceso solo a administradores"})]}),s.jsx("p",{className:"text-xs text-gray-500",children:"Cuando está activo, solo los administradores pueden acceder al sistema"})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[s.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[s.jsx(gt,{className:"w-5 h-5 mr-2"}),"Verificación de Email"]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",id:"bypassEmailVerification",checked:c.bypassEmailVerification,onChange:l=>f("bypassEmailVerification",l.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("label",{htmlFor:"bypassEmailVerification",className:"ml-2 block text-sm text-gray-900",children:"Bypass verificación de email (Desarrollo)"})]}),s.jsx("p",{className:"text-xs text-gray-500",children:"Los usuarios se activan automáticamente sin verificar email"}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("input",{type:"checkbox",id:"requireEmailVerification",checked:c.requireEmailVerification,onChange:l=>f("requireEmailVerification",l.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),s.jsx("label",{htmlFor:"requireEmailVerification",className:"ml-2 block text-sm text-gray-900",children:"Requerir verificación de email"})]}),s.jsx("p",{className:"text-xs text-gray-500",children:"Los usuarios deben verificar su email antes de acceder al sistema"}),s.jsxs("div",{children:[s.jsxs("label",{className:" text-sm font-medium text-gray-700 mb-2 flex items-center",children:[s.jsx(qe,{className:"w-4 h-4 mr-1"}),"Timeout de verificación (horas)"]}),s.jsx("input",{type:"number",onWheel:l=>l.currentTarget.blur(),value:c.emailVerificationTimeout,onChange:l=>f("emailVerificationTimeout",parseInt(l.target.value)),className:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500",min:"1",max:"168"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Tiempo límite para que el usuario verifique su email"})]})]})]})]}),s.jsx("div",{className:"bg-primary-50 border border-primary-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(he,{className:"w-5 h-5 text-primary-500 mr-3 mt-1 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-primary-900 mb-2",children:"Configuraciones Recomendadas"}),s.jsxs("ul",{className:"text-sm text-primary-800 space-y-1",children:[s.jsxs("li",{children:[s.jsx("strong",{children:"Desarrollo:"})," Bypass email ON, Verificación OFF"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Testing:"})," Bypass email ON, Verificación ON (para probar flujo)"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Producción:"})," Bypass email OFF, Verificación ON"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"Mantenimiento:"})," Admin Only Access ON"]})]})]})]})}),s.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[s.jsxs("h4",{className:"font-medium text-gray-900 mb-3 flex items-center",children:[s.jsx(Se,{className:"w-4 h-4 mr-2"}),"Estado Actual del Sistema"]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Modo Desarrollo:"}),s.jsx("span",{className:`ml-2 px-2 py-1 rounded text-xs ${c.mode?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"}`,children:c.mode?"Activo":"Inactivo"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Solo Administradores:"}),s.jsx("span",{className:`ml-2 px-2 py-1 rounded text-xs ${c.allowAdminOnlyAccess?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:c.allowAdminOnlyAccess?"Activo":"Inactivo"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Bypass Email:"}),s.jsx("span",{className:`ml-2 px-2 py-1 rounded text-xs ${c.bypassEmailVerification?"bg-yellow-100 text-yellow-800":"bg-primary-100 text-primary-800"}`,children:c.bypassEmailVerification?"Activo":"Inactivo"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"Verificación Requerida:"}),s.jsx("span",{className:`ml-2 px-2 py-1 rounded text-xs ${c.requireEmailVerification?"bg-primary-100 text-primary-800":"bg-gray-100 text-gray-800"}`,children:c.requireEmailVerification?"Sí":"No"})]})]})]}),s.jsx("div",{className:"flex justify-end",children:s.jsxs("button",{onClick:A,disabled:r,className:"flex items-center px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:[s.jsx(de,{size:16,className:"mr-2"}),r?"Guardando...":"Guardar Configuración"]})})]})},To=()=>{const[t,e]=g.useState(!0),[r,a]=g.useState(!1),[n,o]=g.useState(null),[i,d]=g.useState(null),[c,p]=g.useState({platform_commission_rate:"10.0",shipping_seller_percentage:"80.0",shipping_max_seller_percentage:"40.0"}),[h,v]=g.useState({platform_commission_rate:"10.0",shipping_seller_percentage:"80.0",shipping_max_seller_percentage:"40.0"});g.useEffect(()=>{f()},[]);const f=async()=>{e(!0),o(null);try{console.log("📊 Cargando configuraciones financieras...");const N=await $.get(D.ADMIN.CONFIGURATIONS.FINANCIAL);if(console.log("✅ Respuesta del servidor:",N),N&&typeof N=="object"){const w=N,E={platform_commission_rate:String(w.platform_commission_rate||"10.0"),shipping_seller_percentage:String(w.shipping_seller_percentage||"80.0"),shipping_max_seller_percentage:String(w.shipping_max_seller_percentage||"40.0")};p(E),v(E),console.log("✅ Configuraciones cargadas:",E)}else throw new Error("Respuesta inválida del servidor")}catch(N){console.error("❌ Error loading financial configurations:",N),o("No se pudieron cargar las configuraciones financieras. Usando valores por defecto.");const w={platform_commission_rate:"10.0",shipping_seller_percentage:"80.0",shipping_max_seller_percentage:"40.0"};p(w),v(w)}finally{e(!1)}},A=(N,w)=>{const E=w.replace(/[^0-9.]/g,""),O=E.split(".");O.length>2||O.length===2&&O[1].length>2||(p(b=>({...b,[N]:E})),o(null))},l=()=>{const N=parseFloat(c.platform_commission_rate),w=parseFloat(c.shipping_seller_percentage),E=parseFloat(c.shipping_max_seller_percentage);return isNaN(N)||isNaN(w)||isNaN(E)?"Todos los campos deben contener números válidos":N<0||N>50?"La comisión de plataforma debe estar entre 0% y 50%":w<0||w>100?"El porcentaje de envío para un vendedor debe estar entre 0% y 100%":E<0||E>100?"El porcentaje máximo de envío debe estar entre 0% y 100%":E>=w?"El porcentaje máximo debe ser menor al porcentaje para un vendedor":null},S=async()=>{const N=l();if(N){o(N);return}a(!0),o(null),d(null);try{console.log("💾 Guardando configuraciones financieras...");const w={platform_commission_rate:parseFloat(c.platform_commission_rate),shipping_seller_percentage:parseFloat(c.shipping_seller_percentage),shipping_max_seller_percentage:parseFloat(c.shipping_max_seller_percentage)},E=await $.put(D.ADMIN.CONFIGURATIONS.FINANCIAL,w);console.log("✅ Configuraciones guardadas:",E),v(c),d("Configuraciones guardadas exitosamente"),setTimeout(()=>d(null),3e3)}catch(w){console.error("❌ Error al guardar configuraciones:",w),o("Error al guardar las configuraciones. Por favor, inténtalo de nuevo.")}finally{a(!1)}},x=()=>JSON.stringify(c)!==JSON.stringify(h);return t?s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx(W,{className:"animate-spin h-8 w-8 text-primary-600 mr-3"}),s.jsx("span",{className:"text-gray-600",children:"Cargando configuraciones financieras..."})]}):s.jsx("div",{className:"space-y-6",children:s.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm p-6",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"p-2 bg-primary-100 rounded-lg",children:s.jsx(is,{className:"h-6 w-6 text-primary-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Configuraciones Financieras"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Gestiona las comisiones de la plataforma y distribución de envíos"})]})]}),n&&s.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(H,{className:"h-5 w-5 text-red-500 mr-2"}),s.jsx("p",{className:"text-red-700 text-sm",children:n})]})}),i&&s.jsx("div",{className:"mb-4 bg-green-50 border border-green-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(xs,{className:"h-5 w-5 text-green-500 mr-2"}),s.jsx("p",{className:"text-green-700 text-sm font-medium",children:i})]})}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"platform_commission_rate",className:"flex items-center text-sm font-medium text-gray-700 mb-2",children:[s.jsx(Se,{className:"h-4 w-4 text-primary-600 mr-2"}),"Comisión de Plataforma (%)"]}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{id:"platform_commission_rate",type:"text",value:c.platform_commission_rate,onChange:N=>A("platform_commission_rate",N.target.value),className:"w-full px-3 py-2 pr-8 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"10.0"}),s.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:s.jsx("span",{className:"text-gray-500 text-sm",children:"%"})})]}),s.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Porcentaje que la plataforma retiene de cada venta (0% - 50%)"})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"shipping_seller_percentage",className:"flex items-center text-sm font-medium text-gray-700 mb-2",children:[s.jsx(xs,{className:"h-4 w-4 text-blue-600 mr-2"}),"Envío Vendedor Único (%)"]}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{id:"shipping_seller_percentage",type:"text",value:c.shipping_seller_percentage,onChange:N=>A("shipping_seller_percentage",N.target.value),className:"w-full px-3 py-2 pr-8 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"80.0"}),s.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:s.jsx("span",{className:"text-gray-500 text-sm",children:"%"})})]}),s.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Porcentaje del envío que recibe el vendedor cuando es el único (0% - 100%)"})]}),s.jsxs("div",{children:[s.jsxs("label",{htmlFor:"shipping_max_seller_percentage",className:"flex items-center text-sm font-medium text-gray-700 mb-2",children:[s.jsx(xs,{className:"h-4 w-4 text-orange-600 mr-2"}),"Envío Máximo Múltiples Vendedores (%)"]}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{id:"shipping_max_seller_percentage",type:"text",value:c.shipping_max_seller_percentage,onChange:N=>A("shipping_max_seller_percentage",N.target.value),className:"w-full px-3 py-2 pr-8 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"40.0"}),s.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:s.jsx("span",{className:"text-gray-500 text-sm",children:"%"})})]}),s.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Porcentaje máximo del envío por vendedor con múltiples vendedores (0% - 100%)"})]}),s.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(H,{className:"h-5 w-5 text-amber-600 mt-0.5 flex-shrink-0"}),s.jsxs("div",{className:"text-sm text-amber-800",children:[s.jsx("p",{className:"font-medium mb-2",children:"⚠️ Configuraciones Críticas"}),s.jsxs("ul",{className:"list-disc list-inside space-y-1 text-xs",children:[s.jsx("li",{children:"Estos cambios afectan todos los cálculos financieros de la plataforma"}),s.jsx("li",{children:"Recomendamos hacer cambios gradualmente y monitorear los resultados"})]})]})]})})]}),s.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[s.jsx("button",{type:"button",onClick:()=>p(h),disabled:!x()||r,className:"px-4 py-2 border border-gray-300 text-gray-700 bg-white hover:bg-gray-50 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancelar"}),s.jsx("button",{type:"button",onClick:S,disabled:!x()||r,className:"px-6 py-2 bg-primary-600 text-white hover:bg-primary-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:r?s.jsxs(s.Fragment,{children:[s.jsx(W,{className:"animate-spin h-4 w-4 mr-2"}),"Guardando..."]}):s.jsxs(s.Fragment,{children:[s.jsx(de,{className:"h-4 w-4 mr-2"}),"Guardar Cambios"]})})]})]})})};class we{static instance;axiosInstance;authToken=null;apiUrl;email;password;constructor(){this.apiUrl="http://localhost:3100",this.email="businessconnect@businessconnect.com.ec",this.password="dalcroze77aA@",this.axiosInstance=z.create({baseURL:this.apiUrl,timeout:3e4,headers:{Accept:"application/json"},withCredentials:!1}),this.axiosInstance.interceptors.response.use(e=>e,e=>(console.error("SriApiClient Error:",{status:e.response?.status,statusText:e.response?.statusText,data:e.response?.data,url:e.config?.url,method:e.config?.method}),Promise.reject(e)))}static getInstance(){return we.instance||(we.instance=new we),we.instance}async executeWithRetry(e,r=2){let a=null;for(let n=1;n<=r;n++)try{let o=await this.authenticate();try{return await e(o)}catch(i){if(a=i,i.response?.status===401){console.log(`🔄 Token expirado (intento ${n}/${r}), reautenticando...`),this.authToken=null;continue}if(this.isConnectionError(i)){console.log(`🔄 Error de conexión (intento ${n}/${r}), reintentando...`),this.authToken=null,await this.delay(1e3*n);continue}throw i}}catch(o){if(a=o,this.isConnectionError(o)){console.log(`🔄 Error de conexión en autenticación (intento ${n}/${r}), reintentando...`),this.authToken=null,await this.delay(1e3*n);continue}throw o}throw a}isConnectionError(e){return e.code==="ERR_NETWORK"||e.code==="ERR_CONNECTION_REFUSED"||e.code==="ECONNREFUSED"||e.message?.includes("Network Error")||e.message?.includes("connect ECONNREFUSED")}delay(e){return new Promise(r=>setTimeout(r,e))}async authenticate(){try{console.log("🔐 Autenticando con API SRI...",{email:this.email,apiUrl:this.apiUrl});const e=await this.axiosInstance.post("/api/auth/login",{email:this.email,password:this.password},{headers:{"Content-Type":"application/json"}});if(!e.data.token)throw new Error("No se recibió token de autenticación");return this.authToken=e.data.token,console.log("✅ Autenticación exitosa con API SRI"),this.authToken}catch(e){throw console.error("❌ Error en autenticación SRI:",e),this.authToken=null,new Error("Error de autenticación con API SRI: "+e.message)}}async authenticatedGet(e){return this.executeWithRetry(async r=>(await this.axiosInstance.get(e,{headers:{Authorization:`Bearer ${r}`}})).data)}async authenticatedPut(e,r){return this.executeWithRetry(async a=>(await this.axiosInstance.put(e,r,{headers:{Authorization:`Bearer ${a}`}})).data)}async authenticatedPost(e,r,a){return this.executeWithRetry(async n=>{const o={Authorization:`Bearer ${n}`,...a?.headers};console.log("🔗 Realizando POST a:",e),console.log("🎫 Token:",n.substring(0,20)+"...");const i={headers:o,...a};r instanceof FormData&&(console.log("🔧 Configurando petición FormData con headers CORS seguros"),i.withCredentials=!1,i.headers={...i.headers,Authorization:o.Authorization});const d=await this.axiosInstance.post(e,r,i);return console.log("✅ POST exitoso:",d.status),d.data})}async authenticatedDelete(e){return this.executeWithRetry(async r=>(await this.axiosInstance.delete(e,{headers:{Authorization:`Bearer ${r}`}})).data)}async getProfile(){try{console.log("📋 Obteniendo perfil de empresa desde API SRI...");const e=await this.authenticatedGet("/api/auth/profile");return console.log("✅ Perfil obtenido exitosamente:",e),e}catch(e){throw console.error("❌ Error obteniendo perfil:",e),e}}async updateProfile(e){try{console.log("💾 Actualizando perfil de empresa en API SRI...",e);const r=await this.authenticatedPut("/api/users/profile",e);return console.log("✅ Perfil actualizado exitosamente:",r),r}catch(r){throw console.error("❌ Error actualizando perfil:",r),r}}async uploadCertificate(e,r,a){try{console.log("📤 INICIANDO UPLOAD DE CERTIFICADO:",{fileName:e.name,fileSize:e.size,alias:a,authToken:this.authToken?"PRESENTE":"AUSENTE",apiUrl:this.apiUrl});const n=new FormData;n.append("certificate",e),n.append("password",r),a&&n.append("alias",a);const o=await this.authenticatedPost("/api/certificates/upload",n,{headers:{}});return console.log("✅ Certificado subido exitosamente:",o),o}catch(n){throw console.error("❌ Error subiendo certificado:",n),n}}async deleteCertificate(e){try{console.log("🗑️ Eliminando certificado de API SRI...",{certificateId:e});const r=await this.authenticatedDelete(`/api/certificates/${e}`);return console.log("✅ Certificado eliminado exitosamente:",r),r}catch(r){throw console.error("❌ Error eliminando certificado:",r),r}}async getActiveCertificate(){try{console.log("📋 Obteniendo certificado activo desde API SRI...");const e=await this.authenticatedGet("/api/certificates/active");return console.log("✅ Certificado activo obtenido:",e),e}catch(e){throw console.error("❌ Error obteniendo certificado activo:",e),e}}async testConnection(){try{console.log("🔗 Probando conexión con API SRI...");const e=await this.authenticate(),r=await this.axiosInstance.get("/health",{headers:{Authorization:`Bearer ${e}`},timeout:1e4}),a={success:r.status>=200&&r.status<300,message:r.status>=200&&r.status<300?"Conexión exitosa con API SRI":`Error de conexión: HTTP ${r.status}`};return console.log("📊 Resultado de prueba de conexión:",a),a}catch(e){const r={success:!1,message:"Error de conexión con API SRI: "+e.message};return console.log("❌ Error en prueba de conexión:",r),r}}async listCertificates(e=1,r=50){try{console.log("📋 Obteniendo lista de certificados desde API SRI...",{page:e,limit:r});const a=await this.authenticatedGet(`/api/certificates?page=${e}&limit=${r}`);return console.log("✅ Lista de certificados obtenida:",a),a}catch(a){throw console.error("❌ Error obteniendo lista de certificados:",a),a}}async activateCertificate(e){try{console.log("⚡ Activando certificado...",{certificateId:e});const r=await this.authenticatedPut(`/api/certificates/${e}/activate`,{});return console.log("✅ Certificado activado exitosamente:",r),r}catch(r){throw console.error("❌ Error activando certificado:",r),r}}async getCertificateLimits(){try{console.log("📊 Obteniendo límites de certificados desde API SRI...");const e=await this.authenticatedGet("/api/certificates/limits");return console.log("✅ Límites de certificados obtenidos:",e),e}catch(e){throw console.error("❌ Error obteniendo límites de certificados:",e),e}}clearAuth(){this.authToken=null,console.log("Token de autenticación SRI limpiado")}}const ue=we.getInstance(),Xt=t=>{if(!t)return"Sin nombre";const e=t.match(/CN=([^,]+)/);if(e)return e[1].trim();const r=t.split(",")[0].trim(),a=r.match(/[A-Z]+=(.+)/);return a?a[1].trim():r||"Sin nombre"},Po=t=>{if(!t)return"Sin empresa";const e=t.match(/O=([^,]+)/);if(e)return e[1].trim();const r=t.match(/OU=([^,]+)/);return r?r[1].trim():Xt(t)},Ro=t=>{if(!t)return"Desconocido";const e=t.match(/CN=([^,]+)/);return e?e[1].trim():t.split(",")[0].trim()||"Desconocido"},Io=t=>new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}),Oo=({certificate:t,isSelected:e,onSelect:r,onDelete:a,loading:n=!1})=>{const o=Xt(t.subject),i=Po(t.subject),d=Ro(t.issuer),c=t.status==="vencido",p=t.status==="proximo_vencer",h=`
    relative p-4 border-2 rounded-lg cursor-pointer transition-all duration-200
    ${t.isActive?"border-green-500 bg-green-50 shadow-lg":e?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 bg-white hover:border-gray-300 hover:shadow-sm"}
    ${n?"opacity-50 pointer-events-none":""}
    ${c?"border-red-200 bg-red-50":""}
  `.trim(),v=()=>{!n&&!c&&r(t.id)},f=A=>{A.stopPropagation(),n||a(t.id)};return s.jsxs("div",{className:h,onClick:v,children:[s.jsx("button",{onClick:f,disabled:n,className:"absolute top-2 right-2 p-1 text-red-500 hover:text-red-700 hover:bg-red-100 rounded-full transition-colors duration-200 disabled:opacity-50",title:"Eliminar certificado",children:s.jsx(ve,{className:"h-4 w-4"})}),t.isActive&&s.jsxs("div",{className:"absolute top-2 left-2 flex items-center space-x-1 bg-green-600 text-white px-2 py-1 rounded-full text-xs font-medium",children:[s.jsx(re,{className:"h-3 w-3"}),s.jsx("span",{children:"ACTIVO"})]}),p&&!t.isActive&&s.jsxs("div",{className:"absolute top-2 left-2 flex items-center space-x-1 bg-yellow-500 text-white px-2 py-1 rounded-full text-xs font-medium",children:[s.jsx(H,{className:"h-3 w-3"}),s.jsx("span",{children:"PRÓXIMO A VENCER"})]}),c&&s.jsxs("div",{className:"absolute top-2 left-2 flex items-center space-x-1 bg-red-600 text-white px-2 py-1 rounded-full text-xs font-medium",children:[s.jsx(H,{className:"h-3 w-3"}),s.jsx("span",{children:"EXPIRADO"})]}),s.jsxs("div",{className:`mt-6 space-y-3 ${t.isActive||p||c?"mt-8":""}`,children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(_e,{className:"h-4 w-4 text-gray-600 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:o,children:o}),s.jsx("p",{className:"text-xs text-gray-500",children:"Firmante"})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(yt,{className:"h-4 w-4 text-gray-600 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:i,children:i}),s.jsx("p",{className:"text-xs text-gray-500",children:"Empresa"})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Se,{className:"h-4 w-4 text-gray-600 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",title:d,children:d}),s.jsx("p",{className:"text-xs text-gray-500",children:"Firmadora"})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(pt,{className:"h-4 w-4 text-gray-600 flex-shrink-0"}),s.jsxs("div",{children:[s.jsx("p",{className:`text-sm font-medium ${c?"text-red-600":p?"text-yellow-600":"text-gray-900"}`,children:Io(t.validTo)}),s.jsx("p",{className:"text-xs text-gray-500",children:c?"Expirado":`${t.daysUntilExpiry} días restantes`})]})]})]}),s.jsx("div",{className:"absolute bottom-2 right-2",children:e?s.jsx(re,{className:"h-5 w-5 text-blue-600"}):s.jsx(Ar,{className:"h-5 w-5 text-gray-400"})}),t.alias&&s.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:s.jsx("p",{className:"text-xs text-gray-500 truncate",title:t.alias,children:t.alias})})]})},ko=({onCertificateChange:t})=>{const{showToast:e}=Gt(),[r,a]=g.useState([]),[n,o]=g.useState(null),[i,d]=g.useState(null),[c,p]=g.useState(!1),[h,v]=g.useState(!0),[f,A]=g.useState(null),[l,S]=g.useState(null);g.useEffect(()=>{x()},[]),g.useEffect(()=>{if(f||l){const b=setTimeout(()=>{A(null),S(null)},5e3);return()=>clearTimeout(b)}},[f,l]);const x=async()=>{try{v(!0),S(null);const[b,_]=await Promise.all([ue.listCertificates(),ue.getCertificateLimits()]);if(b.success&&b.data){const y=(b.data.certificates||[]).map(T=>({id:T.id,alias:T.alias||`Certificado ${T.subject}`,subject:T.subject,issuer:T.issuer,validFrom:T.valid_from,validTo:T.valid_to,isActive:T.is_active,daysUntilExpiry:T.status?.daysRemaining||0,status:T.status?.valid?T.status.daysRemaining<=30?"proximo_vencer":"vigente":"vencido"}));a(y);const m=y.find(T=>T.isActive);m&&d(m.id)}else a([]);_.success&&_.data&&o(_.data.limits)}catch(b){console.error("Error cargando certificados:",b);const _="Error al cargar los certificados: "+(b?.response?.data?.message||b?.message||"Error desconocido");S(_),e(B.ERROR,_)}finally{v(!1)}},N=()=>{x()},w=b=>{d(b),A(null),S(null)},E=async()=>{if(!i){const _="Selecciona un certificado para activar";S(_),e(B.WARNING,_);return}const b=r.find(_=>_.id===i);if(!b){const _="Certificado seleccionado no válido";S(_),e(B.ERROR,_);return}if(b.status==="vencido"){const _="No puedes activar un certificado expirado";S(_),e(B.ERROR,_);return}p(!0),S(null),A(null);try{if((await ue.activateCertificate(i)).success){const u="Certificado activado correctamente. Todas las facturas usarán este certificado.";A(u),e(B.SUCCESS,u),await x(),t&&t()}}catch(_){console.error("Error activando certificado:",_);const u="Error al activar el certificado: "+(_?.response?.data?.message||_?.message||"Error desconocido");S(u),e(B.ERROR,u)}finally{p(!1)}},O=async b=>{const _=r.find(m=>m.id===b);if(!_)return;const y=`¿Seguro que quieres borrar el certificado de "${_.subject.split(",")[0]||"certificado"}"? Esta acción no se puede deshacer.`;if(confirm(y)){p(!0),S(null),A(null);try{if((await ue.deleteCertificate(b)).success){const T="Certificado eliminado correctamente";A(T),e(B.SUCCESS,T),i===b&&d(null),await x(),t&&t()}}catch(m){console.error("Error eliminando certificado:",m);const T="Error al eliminar el certificado: "+(m?.response?.data?.message||m?.message||"Error desconocido");S(T),e(B.ERROR,T)}finally{p(!1)}}};return h?s.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:s.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[s.jsx(rs,{className:"h-5 w-5 text-blue-600 animate-spin"}),s.jsx("span",{className:"text-gray-600",children:"Cargando certificados..."})]})}):s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Gestión de Certificados Digitales"}),s.jsx("button",{onClick:N,disabled:c,className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-full transition-colors duration-200 disabled:opacity-50",title:"Actualizar lista",children:s.jsx(W,{className:`h-5 w-5 ${c?"animate-spin":""}`})})]}),n&&s.jsxs("div",{className:"mb-6 flex items-center space-x-2 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[s.jsx(he,{className:"h-5 w-5 text-blue-600 flex-shrink-0"}),s.jsxs("span",{className:"text-sm text-blue-800",children:[s.jsxs("strong",{children:[n.currentCount,"/",n.maxAllowed]})," certificados utilizados",n.remainingSlots>0&&s.jsxs("span",{className:"ml-2",children:["(",n.remainingSlots," espacios disponibles)"]}),n.limitReached&&s.jsx("span",{className:"ml-2 text-blue-900 font-medium",children:"- Límite alcanzado"})]})]}),f&&s.jsx("div",{className:"mb-6 bg-green-50 border border-green-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(re,{className:"h-5 w-5 text-green-500 mr-2"}),s.jsx("p",{className:"text-green-700",children:f})]})}),l&&s.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(me,{className:"h-5 w-5 text-red-500 mr-2"}),s.jsx("p",{className:"text-red-700",children:l})]})}),!r||r.length===0?s.jsxs("div",{className:"text-center py-12",children:[s.jsx(_r,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),s.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"No has subido aún certificados"}),s.jsx("p",{className:"text-gray-600 mb-6",children:"Sube tu primer certificado digital para poder emitir facturas electrónicas"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Usa el formulario de abajo para subir un archivo .p12"})]}):s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:r.map(b=>s.jsx(Oo,{certificate:b,isSelected:i===b.id,onSelect:w,onDelete:O,loading:c},b.id))}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"text-sm text-gray-600",children:i?s.jsx("span",{children:'Certificado seleccionado. Haz click en "Guardar Selección" para activarlo.'}):s.jsx("span",{children:"Selecciona un certificado para activarlo como certificado de firma."})}),s.jsxs("button",{onClick:E,disabled:!i||c,className:"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2 transition-colors duration-200",children:[c?s.jsx(rs,{className:"h-4 w-4 animate-spin"}):s.jsx(de,{className:"h-4 w-4"}),s.jsx("span",{children:c?"Guardando...":"Guardar Selección"})]})]}),r&&r.some(b=>b.status==="proximo_vencer")&&s.jsx("div",{className:"mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start",children:[s.jsx(H,{className:"h-5 w-5 text-yellow-500 mr-2 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-sm font-medium text-yellow-800 mb-1",children:"Certificados próximos a vencer"}),s.jsx("p",{className:"text-sm text-yellow-700",children:"Tienes certificados que vencerán pronto. Considera renovarlos o subir nuevos certificados para evitar interrupciones en la facturación."})]})]})})]})]})},Do=t=>{if(!t)return"Sin nombre";const e=t.match(/CN=([^,]+)/);if(e)return e[1].trim();const r=t.split(",")[0].trim(),a=r.match(/[A-Z]+=(.+)/);return a?a[1].trim():r||"Sin nombre"},Uo=t=>{if(!t)return"Desconocido";const e=t.match(/CN=([^,]+)/);return e?e[1].trim():t.split(",")[0].trim()||"Desconocido"},js=t=>{const e=new Date,a=new Date(t).getTime()-e.getTime();return Math.ceil(a/(1e3*60*60*24))},dt=t=>new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),$o=()=>{const{showToast:t}=Gt(),[e,r]=g.useState({ruc:"",razon_social:"",nombre_comercial:"",direccion_matriz:"",telefono:"",email_facturacion:"",establecimiento:"001",punto_emision:"001",obligado_contabilidad:"SI"}),[a,n]=g.useState({file:null,password:"",alias:""}),[o,i]=g.useState(null),[d,c]=g.useState(!1),[p,h]=g.useState(!0),[v,f]=g.useState(null),[A,l]=g.useState(null),[S,x]=g.useState(0);g.useEffect(()=>{w()},[]);const N=async()=>{try{const u=await ue.getActiveCertificate();u.success&&u.data?.certificate?i(u.data.certificate):i(null)}catch{console.log("No hay certificado activo disponible"),i(null)}},w=async()=>{try{h(!0);const u=await ue.getProfile();if(u.success&&u.data){const y=u.data.company;r({ruc:y.ruc||"",razon_social:y.razon_social||"",nombre_comercial:y.nombre_comercial||"",direccion_matriz:y.direccion_matriz||"",telefono:y.telefono||"",email_facturacion:y.email_facturacion||"",establecimiento:y.establecimiento||"001",punto_emision:y.punto_emision||"001",obligado_contabilidad:y.obligado_contabilidad||"SI"})}await N()}catch(u){console.error("Error cargando perfil SRI:",u),l("Error al cargar los datos del perfil: "+(u?.message||"Error desconocido"))}finally{h(!1)}},E=(u,y)=>{r(m=>({...m,[u]:y}))},O=u=>{const y=u.target.files?.[0];y&&y.name.endsWith(".p12")?(n(m=>({...m,file:y})),l(null)):l("Solo se permiten archivos .p12")},b=async()=>{c(!0),l(null),f(null);try{const u=await ue.updateProfile(e);if(u.success&&(f("Información de empresa actualizada correctamente"),u.data?.company)){const y=u.data.company;r({ruc:y.ruc||"",razon_social:y.razon_social||"",nombre_comercial:y.nombre_comercial||"",direccion_matriz:y.direccion_matriz||"",telefono:y.telefono||"",email_facturacion:y.email_facturacion||"",establecimiento:y.establecimiento||"001",punto_emision:y.punto_emision||"001",obligado_contabilidad:y.obligado_contabilidad||"SI"})}}catch(u){console.error("Error guardando perfil SRI:",u);const y=u?.response?.data?.message||u?.message||"Error al guardar la información de empresa";l(y)}finally{c(!1)}},_=async()=>{if(!a.file||!a.password){const u="Selecciona un archivo .p12 y proporciona la contraseña";l(u),t(B.WARNING,u);return}c(!0),l(null),f(null);try{if((await ue.uploadCertificate(a.file,a.password,a.alias||void 0)).success){const y="Certificado digital subido correctamente";f(y),t(B.SUCCESS,y),n({file:null,password:"",alias:""}),await N(),x(m=>m+1)}}catch(u){console.error("Error subiendo certificado SRI:",u);const y=u?.response?.data?.message||u?.message||"Error al subir el certificado digital";l(y),t(B.ERROR,y)}finally{c(!1)}};return p?s.jsx("div",{className:"max-w-4xl mx-auto",children:s.jsx("div",{className:"bg-white p-8 rounded-lg shadow-sm border border-gray-200",children:s.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[s.jsx(rs,{className:"h-6 w-6 text-blue-600 animate-spin"}),s.jsx("span",{className:"text-gray-600",children:"Cargando información del SRI..."})]})})}):s.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[s.jsx(yt,{className:"h-6 w-6 text-blue-600"}),s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Configuración SRI - Facturación Electrónica"})]}),s.jsx("p",{className:"text-gray-600",children:"Gestiona la información de tu empresa y certificados digitales para la facturación electrónica en Ecuador."})]}),v&&s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(re,{className:"h-5 w-5 text-green-500 mr-2"}),s.jsx("p",{className:"text-green-700",children:v})]})}),A&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(me,{className:"h-5 w-5 text-red-500 mr-2"}),s.jsx("p",{className:"text-red-700",children:A})]})}),s.jsx(ko,{onCertificateChange:()=>{N(),f(null),l(null)}},S),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[s.jsx(Es,{className:"h-5 w-5 text-green-600"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Certificado Digital Activo"})]}),o?s.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-green-800 mb-2",children:"Información del Certificado"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[o.alias&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-700",children:"Alias:"}),s.jsx("span",{className:"ml-2 text-green-600",children:o.alias})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-700",children:"Sujeto:"}),s.jsx("span",{className:"ml-2 text-green-600",children:Do(o.subject)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-700",children:"Emisor:"}),s.jsx("span",{className:"ml-2 text-green-600",children:Uo(o.issuer)})]})]})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium text-green-800 mb-2",children:"Validez"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-700",children:"Válido desde:"}),s.jsx("span",{className:"ml-2 text-green-600",children:dt(o.valid_from)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-700",children:"Válido hasta:"}),s.jsx("span",{className:"ml-2 text-green-600",children:dt(o.valid_to)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-700",children:"Días restantes:"}),s.jsxs("span",{className:`ml-2 font-medium ${js(o.valid_to)>30?"text-green-600":js(o.valid_to)>7?"text-yellow-600":"text-red-600"}`,children:[js(o.valid_to)," días"]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-green-700",children:"Estado:"}),s.jsx("span",{className:"ml-2",children:s.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"✓ Activo"})})]})]})]})]})}):s.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-center",children:[s.jsx(me,{className:"h-5 w-5 text-yellow-500 mr-2"}),s.jsx("p",{className:"text-yellow-700",children:"No hay certificado digital activo. Sube un certificado para poder emitir facturas electrónicas."})]})})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[s.jsx(Fs,{className:"h-5 w-5 text-gray-600"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Información de la Empresa"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"RUC *"}),s.jsx("input",{type:"text",value:e.ruc,onChange:u=>E("ruc",u.target.value),placeholder:"1793204144001",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email de Facturación *"}),s.jsx("input",{type:"email",value:e.email_facturacion,onChange:u=>E("email_facturacion",u.target.value),placeholder:"facturacion@empresa.com",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Razón Social *"}),s.jsx("input",{type:"text",value:e.razon_social,onChange:u=>E("razon_social",u.target.value),placeholder:"EMPRESA S.A.S.",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre Comercial"}),s.jsx("input",{type:"text",value:e.nombre_comercial,onChange:u=>E("nombre_comercial",u.target.value),placeholder:"EMPRESA",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Teléfono"}),s.jsx("input",{type:"text",value:e.telefono,onChange:u=>E("telefono",u.target.value),placeholder:"0999999999",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{className:"md:col-span-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Dirección *"}),s.jsx("textarea",{value:e.direccion_matriz,onChange:u=>E("direccion_matriz",u.target.value),placeholder:"Dirección completa de la empresa",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Establecimiento"}),s.jsx("input",{type:"text",value:e.establecimiento,onChange:u=>E("establecimiento",u.target.value),placeholder:"001",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Punto de Emisión"}),s.jsx("input",{type:"text",value:e.punto_emision,onChange:u=>E("punto_emision",u.target.value),placeholder:"001",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Obligado a llevar Contabilidad"}),s.jsxs("select",{value:e.obligado_contabilidad,onChange:u=>E("obligado_contabilidad",u.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"SI",children:"SI"}),s.jsx("option",{value:"NO",children:"NO"})]})]})]}),s.jsx("div",{className:"mt-6 flex justify-end",children:s.jsxs("button",{onClick:b,disabled:d,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[s.jsx(de,{className:"h-4 w-4"}),s.jsx("span",{children:d?"Guardando...":"Guardar Información"})]})})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:[s.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[s.jsx(Es,{className:"h-5 w-5 text-gray-600"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Certificado Digital (.p12)"})]}),s.jsxs("div",{className:"mb-6 bg-gray-50 border border-gray-200 rounded-lg p-4",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Subir Nuevo Certificado"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Usa este formulario para agregar un nuevo certificado digital. Una vez subido, podrás gestionarlo desde la sección de arriba."})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre del Certificado (Alias)"}),s.jsx("input",{type:"text",value:a.alias,onChange:u=>n(y=>({...y,alias:u.target.value})),placeholder:"Ej: Certificado UANATACA 2025",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Archivo de Certificado (.p12) *"}),s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("input",{type:"file",accept:".p12",onChange:O,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),a.file&&s.jsxs("span",{className:"text-sm text-green-600 flex items-center",children:[s.jsx(re,{className:"h-4 w-4 mr-1"}),a.file.name]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contraseña del Certificado *"}),s.jsx("input",{type:"password",value:a.password,onChange:u=>n(y=>({...y,password:u.target.value})),placeholder:"Contraseña del archivo .p12",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),s.jsx("div",{className:"flex justify-end",children:s.jsxs("button",{onClick:_,disabled:d||!a.file||!a.password,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[d?s.jsx(rs,{className:"h-4 w-4 animate-spin"}):s.jsx(Tr,{className:"h-4 w-4"}),s.jsx("span",{children:d?"Subiendo...":"Subir Certificado"})]})})]}),s.jsxs("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4",children:[s.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Información importante sobre certificados digitales:"}),s.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[s.jsx("li",{children:"• El certificado debe ser válido y estar emitido por una entidad certificadora autorizada por el SRI"}),s.jsx("li",{children:"• Solo se aceptan archivos con extensión .p12"}),s.jsx("li",{children:"• La contraseña es necesaria para validar el certificado"}),s.jsx("li",{children:"• El certificado se utilizará para firmar digitalmente las facturas electrónicas"})]})]})]})]})},Lo=()=>{const[t,e]=g.useState("security");return s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Configuración del Sistema"}),s.jsx("div",{className:"mb-6",children:s.jsx("div",{className:"border-b border-gray-200",children:s.jsxs("nav",{className:"-mb-px flex space-x-8 overflow-x-auto",children:[s.jsxs("button",{onClick:()=>e("security"),className:`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${t==="security"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[s.jsx($s,{className:"w-5 h-5 inline-block mr-1"}),"Seguridad"]}),s.jsxs("button",{onClick:()=>e("moderation"),className:`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${t==="moderation"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[s.jsx(Se,{className:"w-5 h-5 inline-block mr-1"}),"Moderación"]}),s.jsxs("button",{onClick:()=>e("rating"),className:`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${t==="rating"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[s.jsx(ge,{className:"w-5 h-5 inline-block mr-1"}),"Calificaciones"]}),s.jsxs("button",{onClick:()=>e("volume_discount"),className:`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${t==="volume_discount"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[s.jsx(Pr,{className:"w-5 h-5 inline-block mr-1"}),"Descuentos por Volumen"]}),s.jsxs("button",{onClick:()=>e("shipping"),className:`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${t==="shipping"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[s.jsx(Ms,{className:"w-5 h-5 inline-block mr-1"}),"Envíos"]}),s.jsxs("button",{onClick:()=>e("development"),className:`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${t==="development"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[s.jsx(xt,{className:"w-5 h-5 inline-block mr-1"}),"Desarrollo"]}),s.jsxs("button",{onClick:()=>e("financial"),className:`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${t==="financial"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[s.jsx(is,{className:"w-5 h-5 inline-block mr-1"}),"Financiero"]}),s.jsxs("button",{onClick:()=>e("sri"),className:`py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap ${t==="sri"?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[s.jsx(Fs,{className:"w-5 h-5 inline-block mr-1"}),"SRI / Facturación"]})]})})}),s.jsxs("div",{className:"bg-white rounded-lg shadow-sm",children:[t==="security"&&s.jsx("div",{className:"p-6",children:s.jsx(So,{})}),t==="moderation"&&s.jsx("div",{className:"p-6",children:s.jsx(Eo,{})}),t==="rating"&&s.jsx("div",{className:"p-6",children:s.jsx(Co,{})}),t==="volume_discount"&&s.jsx("div",{className:"p-6",children:s.jsx(wo,{})}),t==="shipping"&&s.jsx("div",{className:"p-6",children:s.jsx(Ao,{})}),t==="development"&&s.jsx("div",{className:"p-6",children:s.jsx(_o,{})}),t==="financial"&&s.jsx("div",{className:"p-6",children:s.jsx(To,{})}),t==="sri"&&s.jsx("div",{className:"p-6",children:s.jsx($o,{})})]})]})},gi=Object.freeze(Object.defineProperty({__proto__:null,default:Lo},Symbol.toStringTag,{value:"Module"}));export{D as A,ce as C,Kt as D,B as N,yn as P,fs as T,ii as U,G as a,q as b,$ as c,fn as d,z as e,Ae as f,Gt as g,ne as h,Me as i,Ze as j,Ns as k,No as l,so as m,Jt as n,li as o,ci as p,di as q,ui as r,oi as s,mi as t,Ht as u,gi as v};
//# sourceMappingURL=admin-chunk-C7Ad4l4I.js.map
