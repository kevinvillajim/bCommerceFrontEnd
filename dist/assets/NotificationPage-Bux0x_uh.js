import{j as e,a9 as H,ar as E,a1 as I,ag as M,T as w,o as L,am as V,J as G,au as J,d as O,Y as Q,H as Y,P as K,Q as W,ac as X,k as Z}from"./ui-vendor-BUNMIuFe.js";import{r as i,u as ee}from"./react-vendor-Cy458wKG.js";import{b as re,a as se}from"./index-C7ooKqFU.js";import{u as ae,f as T}from"./chat-chunk-BRsdDZXf.js";import{C as P}from"./admin-chunk-BNcFjXlJ.js";import"./seller-chunk-6swISJwY.js";import"./utils-vendor-DeGC_a19.js";import"./checkout-chunk-DAros4Zm.js";const te=a=>{switch(a){case"new_message":return e.jsx(W,{className:"text-blue-500",size:20});case"order_status":return e.jsx(K,{className:"text-green-500",size:20});case"shipping_update":return e.jsx(Y,{className:"text-purple-500",size:20});case"product_update":return e.jsx(Q,{className:"text-orange-500",size:20});case"rating_received":case"seller_rated":return e.jsx(O,{className:"text-yellow-500",size:20});case"new_order":return e.jsx(J,{className:"text-green-600",size:20});case"low_stock":return e.jsx(w,{className:"text-red-500",size:20});case"feedback_response":return e.jsx(G,{className:"text-indigo-500",size:20});case"promotion":case"discount":return e.jsx(V,{className:"text-pink-500",size:20});case"seller_strike":return e.jsx(L,{className:"text-orange-500",size:20});case"account_blocked":return e.jsx(M,{className:"text-red-500",size:20});case"seller_status_warning":return e.jsx(w,{className:"text-orange-600",size:20});case"seller_suspended":return e.jsx(w,{className:"text-yellow-600",size:20});case"seller_inactive":return e.jsx(M,{className:"text-red-600",size:20});default:return e.jsx(E,{className:"text-gray-500",size:20})}},le=a=>{switch(a){case"new_message":return"bg-blue-50 border-blue-200";case"order_status":return"bg-green-50 border-green-200";case"shipping_update":return"bg-purple-50 border-purple-200";case"product_update":return"bg-orange-50 border-orange-200";case"rating_received":case"seller_rated":return"bg-yellow-50 border-yellow-200";case"new_order":return"bg-emerald-50 border-emerald-200";case"low_stock":return"bg-red-50 border-red-200";case"feedback_response":return"bg-indigo-50 border-indigo-200";case"promotion":case"discount":return"bg-pink-50 border-pink-200";case"seller_strike":return"bg-orange-50 border-orange-200";case"account_blocked":return"bg-red-50 border-red-200";case"seller_status_warning":return"bg-orange-50 border-orange-300";case"seller_suspended":return"bg-yellow-50 border-yellow-300";case"seller_inactive":return"bg-red-50 border-red-300";default:return"bg-gray-50 border-gray-200/50"}},ie=({notification:a,onMarkAsRead:N,onDelete:h,isOpen:b,onToggle:d})=>e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),d()},className:"p-1 rounded-full hover:bg-gray-200 transition-colors",children:e.jsx(X,{size:16,className:"text-gray-500"})}),b&&e.jsxs("div",{className:"absolute right-0 top-8 bg-white rounded-lg shadow-lg border border-gray-200 z-10 min-w-[150px]",children:[!a.read&&e.jsxs("button",{onClick:o=>{o.stopPropagation(),N(a.id),d()},className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center",children:[e.jsx(I,{size:14,className:"mr-2"}),"Marcar como leída"]}),e.jsxs("button",{onClick:o=>{o.stopPropagation(),h(a.id),d()},className:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center",children:[e.jsx(Z,{size:14,className:"mr-2"}),"Eliminar"]})]})]}),be=()=>{const[a,N]=i.useState("all"),[h,b]=i.useState(null),d=ee(),{isAuthenticated:o,roleInfo:y}=ae(),{optimisticNotificationRead:u,forceRefresh:m}=re(),{notifications:n,loading:x,error:k,unreadCount:p,hasMore:j,currentPage:C,totalNotifications:_,fetchNotifications:g,markAsRead:f,markAllAsRead:$,deleteNotification:z}=se(),c=i.useCallback(()=>{console.log("🗑️ Invalidando cache de notificaciones"),P.removeItem("notifications_data"),P.removeItem("notifications_unread_count")},[]),A=i.useCallback(()=>{console.log("🔄 Forzando refresh de notificaciones"),c(),g(1,a==="unread")},[c,g,a]);i.useEffect(()=>{o||d("/login",{state:{from:"/notifications"}})},[o,d]),i.useEffect(()=>{o&&(console.log(`📋 Cargando notificaciones (filtro: ${a})`),g(1,a==="unread"))},[o,a,g]),i.useEffect(()=>{n.length>0&&console.log("📊 Notificaciones recibidas:",n.slice(0,2))},[n]);const R=r=>{const{type:t,data:s}=r,l=y.isSeller;switch(console.log(`🔀 Procesando notificación tipo: ${t}, isSeller: ${l}`,s),t){case"new_message":if(s.chat_id){const S=l?`/seller/messages/${s.chat_id}`:`/chats/${s.chat_id}`;return console.log(`📧 Redirigiendo a chat: ${S}`),S}return l?"/seller/messages":"/chats";case"feedback_response":return s.feedback_id?`/feedback/${s.feedback_id}`:"/feedback";case"order_status":return s.order_id?l?`/seller/orders/${s.order_id}`:`/orders/${s.order_id}`:l?"/seller/orders":"/orders";case"product_update":return s.product_id?l?`/seller/products/edit/${s.product_id}`:`/products/${s.product_id}`:l?"/seller/products":null;case"shipping_update":return s.tracking_number?`/tracking/${s.tracking_number}`:s.order_id?l?`/seller/orders/${s.order_id}`:`/orders/${s.order_id}`:null;case"rating_received":case"seller_rated":return s.rating_id?`/ratings/${s.rating_id}`:l?"/seller/ratings":"/profile";case"new_order":return s.order_id?l?`/seller/orders/${s.order_id}`:null:l?"/seller/orders":null;case"low_stock":return s.product_id?l?`/seller/products/edit/${s.product_id}`:null:l?"/seller/products":null;case"seller_strike":case"account_blocked":return l?"/seller/profile":"/profile";case"rating_request":return r.data.action_url||"/pending-rating";default:return console.log(`❓ Tipo de notificación no reconocido: ${t}`),null}},U=i.useCallback(async r=>{console.log(`🖱️ Click en notificación ${r.id} (tipo: ${r.type})`),b(null),r.read||(u(),await f(r.id),c(),m());const t=R(r);t?(console.log(`🔀 Navegando a: ${t} (usuario ${y.isSeller?"seller":"normal"})`),d(t)):console.log("⚠️ No hay URL de destino para esta notificación")},[f,c,R,y.isSeller,d,u,m]),F=i.useCallback(async r=>{const t=n.find(l=>l.id===r);t&&!t.read&&u(),await z(r),c(),m()},[z,c,n,u,m]),q=i.useCallback(async r=>{u(),await f(r),c(),m()},[f,c,u,m]),B=i.useCallback(async()=>{const r=n.filter(t=>!t.read);for(let t=0;t<r.length;t++)u();await $(),c(),m()},[$,c,n,u,m]),D=i.useCallback(()=>{j&&!x&&g(C+1,a==="unread")},[j,x,C,a,g]),v=i.useCallback(r=>{N(r),b(null),g(1,r==="unread")},[g]);return o?e.jsx("div",{className:"min-h-screen bg-gray-50 transition-colors",children:e.jsxs("div",{className:"container mx-auto px-4 lg:px-8 py-10 max-w-4xl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 space-y-4 sm:space-y-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Notificaciones"}),e.jsx("p",{className:"text-gray-600 mt-1",children:_>0&&e.jsxs(e.Fragment,{children:[_," ",_===1?"notificación":"notificaciones",p>0&&e.jsxs("span",{className:"text-primary-600 font-medium",children:[", ",p," sin leer"]})]})})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>v("all"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${a==="all"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Todas"}),e.jsxs("button",{onClick:()=>v("unread"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors relative ${a==="unread"?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:["No leídas",p>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:p>99?"99":p})]})]}),p>0&&e.jsxs("button",{onClick:B,disabled:x,className:"px-4 py-2 bg-primary-600  text-white text-sm font-medium rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 flex items-center",children:[e.jsx(H,{size:16,className:"mr-2"}),"Marcar todas"]}),n.length>0&&e.jsx("button",{onClick:A,disabled:x,className:"px-3 py-2 text-sm text-blue-600 hover:text-blue-700 disabled:opacity-50 border border-blue-200 rounded-lg hover:bg-blue-50 transition-colors",children:x?"Actualizando...":"Actualizar"})]})]}),k&&e.jsxs("div",{className:"bg-red-50 border border-red-200  text-red-700 px-4 py-3 rounded-lg mb-6",children:[k,e.jsx("button",{className:"ml-2 underline",onClick:A,children:"Reintentar"})]}),x&&n.length===0?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})}):n.length===0?e.jsxs("div",{className:"text-center py-20 bg-gradient-to-b from-gray-50 to-white rounded-xl shadow-md",children:[e.jsx(E,{className:"mx-auto h-16 w-16 text-gray-300 mb-6"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-700 mb-3",children:a==="unread"?"No tienes notificaciones sin leer":"No tienes notificaciones"}),e.jsx("p",{className:"text-gray-500 mb-8 max-w-md mx-auto",children:a==="unread"?"Todas tus notificaciones están al día. Te avisaremos cuando tengas algo nuevo.":"Cuando tengas actualizaciones importantes, aparecerán aquí."}),a==="unread"&&e.jsx("button",{onClick:()=>v("all"),className:"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-primary-600  hover:bg-primary-700 shadow-sm hover:shadow transition-all",children:"Ver todas las notificaciones"})]}):e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[n.map((r,t)=>e.jsx("div",{onClick:()=>U(r),className:`
	                relative border-l-4 cursor-pointer transition-all duration-200 hover:shadow-sm
	                ${r.read?"bg-white border-l-gray-200 hover:bg-gray-50":"bg-primary-50 border-l-primary-500 hover:bg-primary-100"}
	                ${t!==n.length-1?"border-b border-gray-100":""}
	              `,children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-4 flex-1",children:[e.jsx("div",{className:`
	                      flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center
	                      ${le(r.type)}
	                    `,children:te(r.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h3",{className:`text-base font-medium ${r.read?"text-gray-700":"text-gray-900"}`,children:r.title}),!r.read&&e.jsx("div",{className:"w-2 h-2 bg-primary-500rounded-full"})]}),e.jsx("p",{className:`text-sm ${r.read?"text-gray-600":"text-gray-700"} mb-2`,children:r.message}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx("span",{children:T(r.createdAt)}),r.readAt&&e.jsxs("span",{className:"ml-2 flex items-center",children:[e.jsx(I,{size:12,className:"mr-1"}),"Leída el ",T(r.readAt)]})]})]})]}),e.jsx(ie,{notification:r,onMarkAsRead:q,onDelete:F,isOpen:h===r.id,onToggle:()=>b(h===r.id?null:r.id)})]})})},r.id)),j&&e.jsx("div",{className:"p-6 bg-gray-50/50 border-t",children:e.jsx("button",{onClick:D,disabled:x,className:"w-full px-4 py-3 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 font-medium",children:x?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-gray-400 mr-2"}),"Cargando..."]}):"Cargar más notificaciones"})})]}),h!==null&&e.jsx("div",{className:"fixed inset-0 z-0",onClick:()=>b(null)})]})}):null};export{be as default};
//# sourceMappingURL=NotificationPage-Bux0x_uh.js.map
