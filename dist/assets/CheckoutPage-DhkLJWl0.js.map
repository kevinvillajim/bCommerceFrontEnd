{"version":3,"file":"CheckoutPage-DhkLJWl0.js","sources":["../../src/core/services/CheckoutService.ts","../../src/presentation/components/checkout/CreditCardForm.tsx","../../src/presentation/components/checkout/QRPaymentForm.tsx","../../src/presentation/components/checkout/OrderSummary.tsx","../../src/presentation/components/checkout/ShippingForm.tsx","../../src/presentation/components/checkout/TestCheckoutButton.tsx","../../src/presentation/components/checkout/DatafastPaymentButtonProps.tsx","../../src/presentation/pages/CheckoutPage.tsx"],"sourcesContent":["import ApiClient from \"../../infrastructure/api/apiClient\";\r\nimport {API_ENDPOINTS} from \"../../constants/apiEndpoints\";\r\nimport { extractErrorMessage } from \"../../utils/errorHandler\";\r\nimport type {ShoppingCart} from \"../domain/entities/ShoppingCart\";\r\n\r\nexport type PaymentMethod = \"credit_card\" | \"paypal\" | \"transfer\" | \"qr\";\r\n\r\nexport interface ShippingInfo {\r\n\taddress: string;\r\n\tcity: string;\r\n\tstate: string;\r\n\tcountry: string;\r\n\tpostal_code: string;\r\n\tphone: string;\r\n}\r\n\r\nexport interface PaymentInfo {\r\n\tmethod: PaymentMethod;\r\n\tcard_number?: string;\r\n\tcard_expiry?: string;\r\n\tcard_cvc?: string;\r\n\tpaypal_email?: string;\r\n}\r\n\r\nexport interface CheckoutRequest {\r\n\tpayment: PaymentInfo;\r\n\tshipping: ShippingInfo;\r\n\t// Eliminado el campo seller_id que causaba el error\r\n}\r\n\r\nexport interface CheckoutResponse {\r\n\tstatus: string;\r\n\tmessage: string;\r\n\tdata: {\r\n\t\torder_id: string;\r\n\t\torder_number: string;\r\n\t\ttotal: string;\r\n\t\tpayment_status: string;\r\n\t};\r\n}\r\n\r\nexport class CheckoutService {\r\n\t/**\r\n\t * Obtiene el seller ID del carrito de compras\r\n\t * @param cart Carrito de compras\r\n\t * @returns seller ID o null si no se encuentra\r\n\t */\r\n\tstatic getSellerIdFromCart(cart: ShoppingCart | null): number | null {\r\n\t\tif (!cart || !cart.items || cart.items.length === 0) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\t// Buscar el seller ID en el primer item del carrito\r\n\t\tconst firstItem = cart.items[0];\r\n\r\n\t\tif (firstItem.product) {\r\n\t\t\t// Prioridad 1: sellerId en el producto\r\n\t\t\tif (firstItem.product.sellerId) {\r\n\t\t\t\treturn firstItem.product.sellerId;\r\n\t\t\t}\r\n\r\n\t\t\t// Prioridad 2: seller_id en el producto\r\n\t\t\tif (firstItem.product.seller_id) {\r\n\t\t\t\treturn firstItem.product.seller_id;\r\n\t\t\t}\r\n\r\n\t\t\t// Prioridad 3: seller.id en el producto\r\n\t\t\tif (firstItem.product.seller && firstItem.product.seller.id) {\r\n\t\t\t\treturn firstItem.product.seller.id;\r\n\t\t\t}\r\n\r\n\t\t\t// Prioridad 4: user_id como fallback\r\n\t\t\tif (firstItem.product.user_id) {\r\n\t\t\t\treturn firstItem.product.user_id;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconsole.warn(\"No se pudo obtener seller ID del carrito:\", cart);\r\n\t\treturn null;\r\n\t}\r\n\t/**\r\n\t * Procesar el pago y finalizar la compra\r\n\t */\r\n\tasync processCheckout(\r\n\t\tcheckoutData: CheckoutRequest\r\n\t): Promise<CheckoutResponse> {\r\n\t\ttry {\r\n\t\t\tconsole.log(\"CheckoutService: Procesando checkout\", checkoutData);\r\n\r\n\t\t\tconst response = await ApiClient.post<CheckoutResponse>(\r\n\t\t\t\tAPI_ENDPOINTS.CHECKOUT.PROCESS,\r\n\t\t\t\tcheckoutData\r\n\t\t\t);\r\n\r\n\t\t\tconsole.log(\"CheckoutService: Respuesta de checkout\", response);\r\n\r\n\t\t\treturn response;\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"CheckoutService: Error al procesar checkout:\", error);\r\n\r\n\t\t\t// Extraer un mensaje de error amigable del error\r\n\t\t\tconst errorMessage = extractErrorMessage(\r\n\t\t\t\terror,\r\n\t\t\t\t\"Error al procesar el pago. Por favor, intenta de nuevo más tarde.\"\r\n\t\t\t);\r\n\r\n\t\t\tthrow new Error(errorMessage);\r\n\t\t}\r\n\t}\r\n}\r\n","// src/presentation/components/checkout/CreditCardForm.tsx\r\nimport type { PaymentInfo } from \"../../../core/services/CheckoutService\";\r\nimport React from \"react\";\r\n\r\ninterface CreditCardFormProps {\r\n\t// CORREGIDO: Agregar paymentInfo a las props\r\n\tpaymentInfo: PaymentInfo;\r\n\terrors: Record<string, string>;\r\n\tonChange: (field: keyof PaymentInfo, value: string) => void;\r\n\tcontent?: React.ReactNode; // AGREGADO para el content\r\n}\r\n\r\nconst CreditCardForm: React.FC<CreditCardFormProps> = ({content}) => {\r\n\tconst deunaInitiated = false; // Simulación de estado, reemplazar con lógica real\r\n\treturn (\r\n\t\t<div className=\"space-y-4\">\r\n\t\t\t<div className=\"text-center\">\r\n      <p className=\"mb-4 text-gray-600\">\r\n        Paga con Datafast!, ingresa los datos personales para pagar\r\n        de forma rápida y segura.\r\n      </p>\r\n\r\n      {deunaInitiated ? (\r\n        <div className=\"mb-4 mx-auto\">\r\n          <div className=\"bg-gradient-to-r from-[#2fd8a8] to-[#4d1d81] p-6 rounded-lg text-white\">\r\n            {/* Logo de DeUna placeholder */}\r\n            <div className=\"w-24 h-24 mx-auto mb-4 bg-white rounded-full flex items-center justify-center\">\r\n              <div className=\"text-2xl font-bold text-purple-600\">DeUna!</div>\r\n            </div>\r\n\r\n            <h3 className=\"text-xl font-bold mb-2\">Pago con DeUna!</h3>\r\n            <p className=\"text-purple-100 mb-4\">\r\n            </p>\r\n\r\n            <div className=\"bg-white/20 rounded-lg p-4 mb-4\">\r\n              <div className=\"animate-pulse\">\r\n                <div className=\"text-sm text-purple-100\">\r\n                  Conectando con DeUna!...\r\n                </div>\r\n                <div className=\"w-full bg-white/30 rounded-full h-2 mt-2\">\r\n                  <div className=\"bg-white h-2 rounded-full w-3/4 animate-pulse\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <button\r\n              className=\"bg-white/20 hover:bg-white/30 text-white font-medium py-2 px-4 rounded-md transition-colors\"\r\n            >\r\n              Cancelar\r\n            </button>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-4\">\r\n          {/* Información sobre DeUna */}\r\n          <div className=\"bg-[linear-gradient(to_right,_rgba(0,184,110,1)_0%,_rgba(0,77,112,1)_46%,_rgba(0,77,112,1)_100%)] border-purple-200 rounded-lg p-6\">\r\n            <div className=\"flex items-center justify-center mb-4 h-50\">\r\n              <img\r\n                src=\"https://www.datafast.com.ec/images/logo.png\"\r\n                alt=\"DeUna Logo\"\r\n                className=\"h-20\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          {content}\r\n        </div>\r\n      )}\r\n      <div className=\"mt-4 text-sm text-gray-500\">\r\n        <p>\r\n          <strong>1.</strong> Haz clic en \"Pagar con Datafast!\"\r\n        </p>\r\n        <p>\r\n          <strong>2.</strong> Completa los datos de tu tarjeta de crédito o débito.\r\n        </p>\r\n        <p>\r\n          <strong>3.</strong> Confirma tu compra al finalizar.\r\n        </p>\r\n      </div>\r\n    </div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default CreditCardForm;\r\n","// src/presentation/components/checkout/QRPaymentForm.tsx\r\n// ✅ CAMBIAR A \"PAGO CON DEUNA!\"\r\nimport React, { useState } from \"react\";\r\nimport { useCart } from \"../../hooks/useCart\";\r\nimport { formatCurrency } from \"../../../utils/formatters/formatCurrency\";\r\n\r\nconst QRPaymentForm: React.FC = () => {\r\n  const [deunaInitiated, setDeunaInitiated] = useState(false);\r\n  const { cart } = useCart();\r\n\r\n  // Calcular el total para mostrar\r\n  const total = cart?.total || 0;\r\n\r\n  return (\r\n    <div className=\"text-center\">\r\n      <p className=\"mb-4 text-gray-600\">\r\n        Paga con DeUna!, Genera el código qr y escanealo desde tu app para pagar\r\n        de forma rápida y segura.\r\n      </p>\r\n\r\n      {deunaInitiated ? (\r\n        <div className=\"mb-4 mx-auto\">\r\n          <div className=\"bg-gradient-to-r from-[#2fd8a8] to-[#4d1d81] p-6 rounded-lg text-white\">\r\n            {/* Logo de DeUna placeholder */}\r\n            <div className=\"w-24 h-24 mx-auto mb-4 bg-white rounded-full flex items-center justify-center\">\r\n              <div className=\"text-2xl font-bold text-purple-600\">DeUna!</div>\r\n            </div>\r\n\r\n            <h3 className=\"text-xl font-bold mb-2\">Pago con DeUna!</h3>\r\n            <p className=\"text-purple-100 mb-4\">\r\n              Monto a pagar: {formatCurrency(total)}\r\n            </p>\r\n\r\n            <div className=\"bg-white/20 rounded-lg p-4 mb-4\">\r\n              <div className=\"animate-pulse\">\r\n                <div className=\"text-sm text-purple-100\">\r\n                  Conectando con DeUna!...\r\n                </div>\r\n                <div className=\"w-full bg-white/30 rounded-full h-2 mt-2\">\r\n                  <div className=\"bg-white h-2 rounded-full w-3/4 animate-pulse\"></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <button\r\n              onClick={() => setDeunaInitiated(false)}\r\n              className=\"bg-white/20 hover:bg-white/30 text-white font-medium py-2 px-4 rounded-md transition-colors\"\r\n            >\r\n              Cancelar\r\n            </button>\r\n          </div>\r\n        </div>\r\n      ) : (\r\n        <div className=\"space-y-4\">\r\n          {/* Información sobre DeUna */}\r\n          <div className=\"bg-[rgba(47,216,168)] border-purple-200 rounded-lg p-6\">\r\n            <div className=\"flex items-center justify-center mb-4\">\r\n              <img\r\n                src=\"https://deuna.app/assets/img/brand/logo-deuna.svg\"\r\n                alt=\"DeUna Logo\"\r\n                className=\"w-50 h-50\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => setDeunaInitiated(true)}\r\n            className=\"w-full bg-[#3f2b57] hover:bg-[#342843] text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-101 flex items-center justify-center\"\r\n          >\r\n            Pagar con DeUna! - {formatCurrency(total)}\r\n          </button>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"mt-4 text-sm text-gray-500\">\r\n        <p>\r\n          <strong>1.</strong> Haz clic en \"Pagar con DeUna!\"\r\n        </p>\r\n        <p>\r\n          <strong>2.</strong> Completa el pago con el QR\r\n        </p>\r\n        <p>\r\n          <strong>3.</strong> Confirma tu compra al finalizar.\r\n        </p>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default QRPaymentForm;\r\n","import React from \"react\";\r\nimport type {ShoppingCart} from \"../../../core/domain/entities/ShoppingCart\";\r\nimport {formatCurrency} from \"../../../utils/formatters/formatCurrency\";\r\n\r\ninterface OrderSummaryProps {\r\n\tcart: ShoppingCart | null;\r\n}\r\n\r\nconst OrderSummary: React.FC<OrderSummaryProps> = ({cart}) => {\r\n\t// Si no hay carrito o está vacío\r\n\tif (!cart || cart.items.length === 0) {\r\n\t\treturn (\r\n\t\t\t<div className=\"text-center py-6\">\r\n\t\t\t\t<p className=\"text-gray-500\">No hay productos en el carrito</p>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\t// ✅ CALCULAR SUBTOTAL CORRECTAMENTE CON DESCUENTOS\r\n\tconst calculateSubtotal = () => {\r\n\t\treturn cart.items.reduce((total, item) => {\r\n\t\t\t// Usar final_price si está disponible, sino usar price\r\n\t\t\tconst finalPrice = item.product?.final_price ?? item.product?.price ?? item.price;\r\n\t\t\treturn total + (finalPrice * item.quantity);\r\n\t\t}, 0);\r\n\t};\r\n\r\n\tconst subtotal = calculateSubtotal();\r\n\tconst taxRate = 0.15; // 15% IVA\r\n\tconst shipping = subtotal > 50 ? 0 : 5.99; // Envío gratis para compras superiores a $50\r\n\tconst tax = subtotal * taxRate;\r\n\tconst total = subtotal + tax + shipping;\r\n\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<h2 className=\"text-xl font-bold text-gray-800 mb-4\">\r\n\t\t\t\tResumen del pedido\r\n\t\t\t</h2>\r\n\r\n\t\t\t{/* Lista de productos */}\r\n\t\t\t<div className=\"space-y-3 mb-4\">\r\n\t\t\t\t{cart.items.map((item) => {\r\n\t\t\t\t\t// ✅ MOSTRAR PRECIO CON DESCUENTO\r\n\t\t\t\t\tconst finalPrice = item.product?.final_price ?? item.product?.price ?? item.price;\r\n\t\t\t\t\tconst originalPrice = item.product?.price;\r\n\t\t\t\t\tconst hasDiscount = originalPrice && finalPrice < originalPrice;\r\n\t\t\t\t\t\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tkey={item.id}\r\n\t\t\t\t\t\t\tclassName=\"flex justify-between pb-3 border-b border-gray-100\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div className=\"flex items-center\">\r\n\t\t\t\t\t\t\t\t<span className=\"font-medium text-gray-800 mr-2\">\r\n\t\t\t\t\t\t\t\t\t{item.quantity}x\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t<div className=\"flex flex-col\">\r\n\t\t\t\t\t\t\t\t\t<span className=\"text-sm line-clamp-1\">\r\n\t\t\t\t\t\t\t\t\t\t{item.product?.name || `Producto ${item.productId}`}\r\n\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t{hasDiscount && (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center space-x-2 text-xs\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-400 line-through\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(originalPrice!)}\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-green-600 font-medium\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t{item.product?.discount_percentage}% off\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"text-right\">\r\n\t\t\t\t\t\t\t\t<div className=\"font-medium text-gray-800\">\r\n\t\t\t\t\t\t\t\t\t{formatCurrency(finalPrice * item.quantity)}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t{hasDiscount && (\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-gray-400 line-through\">\r\n\t\t\t\t\t\t\t\t\t\t{formatCurrency(originalPrice! * item.quantity)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t);\r\n\t\t\t\t})}\r\n\t\t\t</div>\r\n\r\n\t\t\t{/* Cálculos */}\r\n\t\t\t<div className=\"space-y-2 pt-2\">\r\n\t\t\t\t<div className=\"flex justify-between text-gray-600\">\r\n\t\t\t\t\t<span>Subtotal</span>\r\n\t\t\t\t\t<span>{formatCurrency(subtotal)}</span>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"flex justify-between text-gray-600\">\r\n\t\t\t\t\t<span>IVA (15%)</span>\r\n\t\t\t\t\t<span>{formatCurrency(tax)}</span>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"flex justify-between text-gray-600\">\r\n\t\t\t\t\t<span>Envío</span>\r\n\t\t\t\t\t<span>{shipping === 0 ? \"Gratis\" : formatCurrency(shipping)}</span>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className=\"flex justify-between pt-3 border-t border-gray-200 font-bold text-lg text-gray-800\">\r\n\t\t\t\t\t<span>Total</span>\r\n\t\t\t\t\t<span>{formatCurrency(total)}</span>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default OrderSummary;","import React from \"react\";\r\nimport type {ShippingInfo} from \"../../../core/services/CheckoutService\";\r\n\r\ninterface ShippingFormProps {\r\n\tshippingInfo: ShippingInfo;\r\n\terrors: Record<string, string>;\r\n\tonChange: (field: keyof ShippingInfo, value: string) => void;\r\n}\r\n\r\nconst ShippingForm: React.FC<ShippingFormProps> = ({\r\n\tshippingInfo,\r\n\terrors,\r\n\tonChange,\r\n}) => {\r\n\treturn (\r\n\t\t<div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n\t\t\t<div className=\"md:col-span-2\">\r\n\t\t\t\t<label\r\n\t\t\t\t\thtmlFor=\"address\"\r\n\t\t\t\t\tclassName=\"block text-sm font-medium text-gray-700 mb-1\"\r\n\t\t\t\t>\r\n\t\t\t\t\tDirección *\r\n\t\t\t\t</label>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tid=\"address\"\r\n\t\t\t\t\tvalue={shippingInfo.address}\r\n\t\t\t\t\tonChange={(e) => onChange(\"address\", e.target.value)}\r\n\t\t\t\t\tclassName={`w-full px-4 py-2 border rounded-md focus:ring-primary-500 focus:border-primary-500 ${\r\n\t\t\t\t\t\terrors.address ? \"border-red-500\" : \"border-gray-300\"\r\n\t\t\t\t\t}`}\r\n\t\t\t\t\tplaceholder=\"Calle, número, piso, etc.\"\r\n\t\t\t\t/>\r\n\t\t\t\t{errors.address && (\r\n\t\t\t\t\t<p className=\"mt-1 text-sm text-red-500\">{errors.address}</p>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div>\r\n\t\t\t\t<label\r\n\t\t\t\t\thtmlFor=\"city\"\r\n\t\t\t\t\tclassName=\"block text-sm font-medium text-gray-700 mb-1\"\r\n\t\t\t\t>\r\n\t\t\t\t\tCiudad *\r\n\t\t\t\t</label>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tid=\"city\"\r\n\t\t\t\t\tvalue={shippingInfo.city}\r\n\t\t\t\t\tonChange={(e) => onChange(\"city\", e.target.value)}\r\n\t\t\t\t\tclassName={`w-full px-4 py-2 border rounded-md focus:ring-primary-500 focus:border-primary-500 ${\r\n\t\t\t\t\t\terrors.city ? \"border-red-500\" : \"border-gray-300\"\r\n\t\t\t\t\t}`}\r\n\t\t\t\t\tplaceholder=\"Ciudad\"\r\n\t\t\t\t/>\r\n\t\t\t\t{errors.city && (\r\n\t\t\t\t\t<p className=\"mt-1 text-sm text-red-500\">{errors.city}</p>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div>\r\n\t\t\t\t<label\r\n\t\t\t\t\thtmlFor=\"state\"\r\n\t\t\t\t\tclassName=\"block text-sm font-medium text-gray-700 mb-1\"\r\n\t\t\t\t>\r\n\t\t\t\t\tProvincia/Estado *\r\n\t\t\t\t</label>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tid=\"state\"\r\n\t\t\t\t\tvalue={shippingInfo.state}\r\n\t\t\t\t\tonChange={(e) => onChange(\"state\", e.target.value)}\r\n\t\t\t\t\tclassName={`w-full px-4 py-2 border rounded-md focus:ring-primary-500 focus:border-primary-500 ${\r\n\t\t\t\t\t\terrors.state ? \"border-red-500\" : \"border-gray-300\"\r\n\t\t\t\t\t}`}\r\n\t\t\t\t\tplaceholder=\"Provincia o Estado\"\r\n\t\t\t\t/>\r\n\t\t\t\t{errors.state && (\r\n\t\t\t\t\t<p className=\"mt-1 text-sm text-red-500\">{errors.state}</p>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div>\r\n\t\t\t\t<label\r\n\t\t\t\t\thtmlFor=\"postal_code\"\r\n\t\t\t\t\tclassName=\"block text-sm font-medium text-gray-700 mb-1\"\r\n\t\t\t\t>\r\n\t\t\t\t\tCódigo Postal *\r\n\t\t\t\t</label>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tid=\"postal_code\"\r\n\t\t\t\t\tvalue={shippingInfo.postal_code}\r\n\t\t\t\t\tonChange={(e) => onChange(\"postal_code\", e.target.value)}\r\n\t\t\t\t\tclassName={`w-full px-4 py-2 border rounded-md focus:ring-primary-500 focus:border-primary-500 ${\r\n\t\t\t\t\t\terrors.postal_code ? \"border-red-500\" : \"border-gray-300\"\r\n\t\t\t\t\t}`}\r\n\t\t\t\t\tplaceholder=\"Código Postal\"\r\n\t\t\t\t/>\r\n\t\t\t\t{errors.postal_code && (\r\n\t\t\t\t\t<p className=\"mt-1 text-sm text-red-500\">{errors.postal_code}</p>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div>\r\n\t\t\t\t<label\r\n\t\t\t\t\thtmlFor=\"country\"\r\n\t\t\t\t\tclassName=\"block text-sm font-medium text-gray-700 mb-1\"\r\n\t\t\t\t>\r\n\t\t\t\t\tPaís *\r\n\t\t\t\t</label>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\tid=\"country\"\r\n\t\t\t\t\tvalue={shippingInfo.country}\r\n\t\t\t\t\tonChange={(e) => onChange(\"country\", e.target.value)}\r\n\t\t\t\t\tclassName={`w-full px-4 py-2 border rounded-md focus:ring-primary-500 focus:border-primary-500 ${\r\n\t\t\t\t\t\terrors.country ? \"border-red-500\" : \"border-gray-300\"\r\n\t\t\t\t\t}`}\r\n\t\t\t\t\tplaceholder=\"País\"\r\n\t\t\t\t/>\r\n\t\t\t\t{errors.country && (\r\n\t\t\t\t\t<p className=\"mt-1 text-sm text-red-500\">{errors.country}</p>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div>\r\n\t\t\t\t<label\r\n\t\t\t\t\thtmlFor=\"phone\"\r\n\t\t\t\t\tclassName=\"block text-sm font-medium text-gray-700 mb-1\"\r\n\t\t\t\t>\r\n\t\t\t\t\tTeléfono *\r\n\t\t\t\t</label>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype=\"tel\"\r\n\t\t\t\t\tid=\"phone\"\r\n\t\t\t\t\tvalue={shippingInfo.phone}\r\n\t\t\t\t\tonChange={(e) => onChange(\"phone\", e.target.value)}\r\n\t\t\t\t\tclassName={`w-full px-4 py-2 border rounded-md focus:ring-primary-500 focus:border-primary-500 ${\r\n\t\t\t\t\t\terrors.phone ? \"border-red-500\" : \"border-gray-300\"\r\n\t\t\t\t\t}`}\r\n\t\t\t\t\tplaceholder=\"Número de teléfono\"\r\n\t\t\t\t/>\r\n\t\t\t\t{errors.phone && (\r\n\t\t\t\t\t<p className=\"mt-1 text-sm text-red-500\">{errors.phone}</p>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default ShippingForm;\r\n","import React, {useState} from \"react\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {useCart} from \"../../hooks/useCart\";\r\nimport {CheckoutService} from \"../../../core/services/CheckoutService\";\r\nimport type {PaymentMethod} from \"../../../core/services/CheckoutService\";\r\nimport {NotificationType} from \"../../contexts/CartContext\";\r\nimport {extractErrorMessage} from \"../../../utils/errorHandler\";\r\n\r\ninterface TestCheckoutButtonProps {}\r\n\r\nconst TestCheckoutButton: React.FC<TestCheckoutButtonProps> = () => {\r\n\tconst navigate = useNavigate();\r\n\tconst {cart, clearCart, showNotification} = useCart();\r\n\tconst checkoutService = new CheckoutService();\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\r\n\tconst handleTestCheckout = async () => {\r\n\t\tif (!cart || cart.items.length === 0) {\r\n\t\t\tshowNotification(NotificationType.ERROR, \"El carrito está vacío\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetIsLoading(true);\r\n\t\ttry {\r\n\t\t\t// ✅ OBTENER SELLER_ID DEL CARRITO\r\n\t\t\tconst sellerId = CheckoutService.getSellerIdFromCart(cart);\r\n\t\t\tconsole.log(\"Seller ID obtenido para test:\", sellerId);\r\n\r\n\t\t\t// Datos de prueba - agregado seller_id de vuelta\r\n\t\t\tconst testData = {\r\n\t\t\t\tpayment: {\r\n\t\t\t\t\tmethod: \"credit_card\" as PaymentMethod,\r\n\t\t\t\t\tcard_number: \"4111111111111111\",\r\n\t\t\t\t\tcard_expiry: \"12/25\",\r\n\t\t\t\t\tcard_cvc: \"123\",\r\n\t\t\t\t},\r\n\t\t\t\tshipping: {\r\n\t\t\t\t\taddress: \"Calle de Prueba 123\",\r\n\t\t\t\t\tcity: \"Ciudad de Prueba\",\r\n\t\t\t\t\tstate: \"Estado de Prueba\",\r\n\t\t\t\t\tcountry: \"País de Prueba\",\r\n\t\t\t\t\tpostal_code: \"12345\",\r\n\t\t\t\t\tphone: \"123456789\",\r\n\t\t\t\t},\r\n\t\t\t\tseller_id: sellerId, // ✅ AGREGAR SELLER_ID DE VUELTA\r\n\t\t\t};\r\n\r\n\t\t\tconsole.log(\"Procesando checkout de prueba con datos:\", testData);\r\n\r\n\t\t\tconst response = await checkoutService.processCheckout(testData);\r\n\r\n\t\t\tif (response.status === \"success\") {\r\n\t\t\t\tclearCart();\r\n\t\t\t\tshowNotification(\r\n\t\t\t\t\tNotificationType.SUCCESS,\r\n\t\t\t\t\t\"¡Pedido de prueba completado con éxito!\"\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Mostrar los detalles de la orden por consola\r\n\t\t\t\tconsole.log(\"Detalles de la orden:\", response.data);\r\n\r\n\t\t\t\t// Navegar a una página de confirmación o dashboard\r\n\t\t\t\tnavigate(\"/orders\");\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(response.message || \"Error en el checkout de prueba\");\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error en el checkout de prueba:\", error);\r\n\r\n\t\t\t// Usar el extractor de mensajes de error\r\n\t\t\tconst errorMessage = extractErrorMessage(\r\n\t\t\t\terror,\r\n\t\t\t\t\"Error en el checkout de prueba. Por favor, intenta de nuevo más tarde.\"\r\n\t\t\t);\r\n\r\n\t\t\tshowNotification(NotificationType.ERROR, errorMessage);\r\n\t\t} finally {\r\n\t\t\tsetIsLoading(false);\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<button\r\n\t\t\tonClick={handleTestCheckout}\r\n\t\t\tdisabled={isLoading}\r\n\t\t\tclassName=\"px-4 py-2 bg-yellow-500 text-white rounded-md hover:bg-yellow-600 transition-colors flex items-center disabled:opacity-50\"\r\n\t\t>\r\n\t\t\t{isLoading ? (\r\n\t\t\t\t<span className=\"inline-block h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2\"></span>\r\n\t\t\t) : null}\r\n\t\t\tPrueba rápida de checkout\r\n\t\t</button>\r\n\t);\r\n};\r\n\r\nexport default TestCheckoutButton;","import React, {useState, useEffect} from \"react\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {useCart} from \"../../hooks/useCart\";\r\nimport {DatafastService} from \"../../../core/services/DatafastService\";\r\nimport {CheckoutService} from \"../../../core/services/CheckoutService\";\r\nimport type {DatafastCheckoutRequest} from \"../../../core/services/DatafastService\";\r\nimport type {PaymentMethod, ShippingInfo, PaymentInfo} from \"../../../core/services/CheckoutService\";\r\nimport {NotificationType} from \"../../contexts/CartContext\";\r\n\r\ninterface DatafastPaymentButtonProps {\r\n\tonSuccess?: (orderData: any) => void;\r\n\tonError?: (error: string) => void;\r\n}\r\n\r\ninterface FormData {\r\n\taddress: string;\r\n\tcity: string;\r\n\tcountry: string;\r\n\tgiven_name: string;\r\n\tmiddle_name: string;\r\n\tsurname: string;\r\n\tphone: string;\r\n\tdoc_id: string;\r\n}\r\n\r\nconst DatafastPaymentButton: React.FC<DatafastPaymentButtonProps> = ({\r\n\tonSuccess,\r\n\tonError,\r\n}) => {\r\n\tconst navigate = useNavigate();\r\n\tconst {cart, clearCart, showNotification} = useCart();\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\tconst [showWidget, setShowWidget] = useState(false);\r\n\tconst [checkoutData, setCheckoutData] = useState<any>(null);\r\n\tconst [showForm, setShowForm] = useState(false);\r\n\tconst [widgetLoaded, setWidgetLoaded] = useState(false);\r\n\r\n\t// Datos del formulario básico\r\n\tconst [formData, setFormData] = useState<FormData>({\r\n\t\taddress: \"Av. Test 123\",\r\n\t\tcity: \"Quito\",\r\n\t\tcountry: \"EC\",\r\n\t\tgiven_name: \"Juan\",\r\n\t\tmiddle_name: \"Carlos\",\r\n\t\tsurname: \"Pérez\",\r\n\t\tphone: \"0999999999\",\r\n\t\tdoc_id: \"1234567890\",\r\n\t});\r\n\r\n\tconst datafastService = new DatafastService();\r\n\tconst checkoutService = new CheckoutService(); // ✅ AGREGAR CHECKOUT SERVICE\r\n\r\n\t// Limpiar al desmontar componente\r\n\tuseEffect(() => {\r\n\t\treturn () => {\r\n\t\t\t// Limpiar scripts de Datafast al desmontar\r\n\t\t\tconst script = document.getElementById(\"datafast-widget-script\");\r\n\t\t\tif (script) {\r\n\t\t\t\tscript.remove();\r\n\t\t\t}\r\n\t\t};\r\n\t}, []);\r\n\r\n\t// Manejar cambios en el formulario\r\n\tconst handleInputChange = (field: keyof FormData, value: string) => {\r\n\t\tsetFormData((prev) => ({...prev, [field]: value}));\r\n\t};\r\n\r\n\t// Validar datos del formulario\r\n\tconst validateFormData = (): boolean => {\r\n\t\tconst requiredFields: (keyof FormData)[] = [\r\n\t\t\t\"address\",\r\n\t\t\t\"city\",\r\n\t\t\t\"country\",\r\n\t\t\t\"given_name\",\r\n\t\t\t\"surname\",\r\n\t\t\t\"phone\",\r\n\t\t\t\"doc_id\",\r\n\t\t];\r\n\r\n\t\tfor (const field of requiredFields) {\r\n\t\t\tif (!formData[field] || formData[field].trim() === \"\") {\r\n\t\t\t\tshowNotification(\r\n\t\t\t\t\tNotificationType.ERROR,\r\n\t\t\t\t\t`El campo ${field.replace(\"_\", \" \")} es obligatorio`\r\n\t\t\t\t);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Validar formato de cédula (10 dígitos)\r\n\t\tif (formData.doc_id.length !== 10 || !/^\\d+$/.test(formData.doc_id)) {\r\n\t\t\tshowNotification(\r\n\t\t\t\tNotificationType.ERROR,\r\n\t\t\t\t\"La cédula debe tener exactamente 10 dígitos\"\r\n\t\t\t);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t};\r\n\r\n\t// Iniciar proceso de pago con Datafast\r\n\tconst handleStartPayment = async () => {\r\n\t\tif (!cart || cart.items.length === 0) {\r\n\t\t\tshowNotification(NotificationType.ERROR, \"El carrito está vacío\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!validateFormData()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetIsLoading(true);\r\n\r\n\t\ttry {\r\n\t\t\t// Preparar datos para Datafast\r\n\t\t\tconst requestData: DatafastCheckoutRequest = {\r\n\t\t\t\tshipping: {\r\n\t\t\t\t\taddress: formData.address,\r\n\t\t\t\t\tcity: formData.city,\r\n\t\t\t\t\tcountry: formData.country.toUpperCase(),\r\n\t\t\t\t},\r\n\t\t\t\tcustomer: {\r\n\t\t\t\t\tgiven_name: formData.given_name,\r\n\t\t\t\t\tmiddle_name: formData.middle_name,\r\n\t\t\t\t\tsurname: formData.surname,\r\n\t\t\t\t\tphone: formData.phone,\r\n\t\t\t\t\tdoc_id: formData.doc_id,\r\n\t\t\t\t},\r\n\t\t\t};\r\n\r\n\t\t\tconsole.log(\"Iniciando checkout con Datafast...\", requestData);\r\n\r\n\t\t\t// Crear checkout en backend\r\n\t\t\tconst response = await datafastService.createCheckout(requestData);\r\n\t\t\tconsole.log(\"Respuesta del checkout:\", response);\r\n\r\n\t\t\tif (response.success && response.data) {\r\n\t\t\t\tsetCheckoutData(response.data);\r\n\t\t\t\tsetShowForm(false);\r\n\t\t\t\tsetShowWidget(true);\r\n\r\n\t\t\t\t// Guardar transaction_id en localStorage para el resultado\r\n\t\t\t\tlocalStorage.setItem(\r\n\t\t\t\t\t\"datafast_transaction_id\",\r\n\t\t\t\t\tresponse.data.transaction_id\r\n\t\t\t\t);\r\n\r\n\t\t\t\tshowNotification(\r\n\t\t\t\t\tNotificationType.SUCCESS,\r\n\t\t\t\t\t\"Checkout creado. Preparando formulario de pago...\"\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Cargar widget después de que el DOM esté listo\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tif (response.data) {\r\n\t\t\t\t\t\tloadDatafastWidget(response.data.checkout_id);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tshowNotification(\r\n\t\t\t\t\t\t\tNotificationType.ERROR,\r\n\t\t\t\t\t\t\t\"Datos de checkout no disponibles\"\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}, 100);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(response.message || \"Error al crear checkout\");\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error al iniciar pago con Datafast:\", error);\r\n\t\t\tconst errorMessage =\r\n\t\t\t\terror instanceof Error ? error.message : \"Error desconocido\";\r\n\t\t\tshowNotification(NotificationType.ERROR, errorMessage);\r\n\t\t\tonError?.(errorMessage);\r\n\t\t} finally {\r\n\t\t\tsetIsLoading(false);\r\n\t\t}\r\n\t};\r\n\r\n\t// Cargar widget de Datafast de forma más simple\r\n\tconst loadDatafastWidget = (checkoutId: string) => {\r\n\t\ttry {\r\n\t\t\tconsole.log(\"Cargando widget de Datafast...\", checkoutId);\r\n\r\n\t\t\t// Remover script anterior si existe\r\n\t\t\tconst existingScript = document.getElementById(\"datafast-widget-script\");\r\n\t\t\tif (existingScript) {\r\n\t\t\t\texistingScript.remove();\r\n\t\t\t}\r\n\r\n\t\t\t// Configurar opciones globales ANTES de cargar el script\r\n\t\t\t(window as any).wpwlOptions = {\r\n\t\t\t\tonReady: function () {\r\n\t\t\t\t\tconsole.log(\"Widget de Datafast listo!\");\r\n\t\t\t\t\tsetWidgetLoaded(true);\r\n\t\t\t\t\tshowNotification(\r\n\t\t\t\t\t\tNotificationType.SUCCESS,\r\n\t\t\t\t\t\t\"Formulario de pago cargado correctamente.\"\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t\tstyle: \"card\",\r\n\t\t\t\tlocale: \"es\",\r\n\t\t\t\tlabels: {\r\n\t\t\t\t\tcvv: \"CVV\",\r\n\t\t\t\t\tcardHolder: \"Nombre (igual que en la tarjeta)\",\r\n\t\t\t\t},\r\n\t\t\t};\r\n\r\n\t\t\t// Crear y cargar script\r\n\t\t\tconst script = document.createElement(\"script\");\r\n\t\t\tscript.id = \"datafast-widget-script\";\r\n\t\t\tscript.src = `https://eu-test.oppwa.com/v1/paymentWidgets.js?checkoutId=${checkoutId}`;\r\n\t\t\tscript.async = true;\r\n\r\n\t\t\tscript.onload = () => {\r\n\t\t\t\tconsole.log(\"Script de widget cargado\");\r\n\t\t\t};\r\n\r\n\t\t\tscript.onerror = () => {\r\n\t\t\t\tconsole.error(\"Error al cargar script del widget\");\r\n\t\t\t\tshowNotification(\r\n\t\t\t\t\tNotificationType.ERROR,\r\n\t\t\t\t\t\"Error al cargar el formulario de pago\"\r\n\t\t\t\t);\r\n\t\t\t};\r\n\r\n\t\t\tdocument.head.appendChild(script);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error al configurar widget:\", error);\r\n\t\t\tshowNotification(\r\n\t\t\t\tNotificationType.ERROR,\r\n\t\t\t\t\"Error al configurar el formulario de pago\"\r\n\t\t\t);\r\n\t\t}\r\n\t};\r\n\r\n\t// ✅ NUEVO: Prueba completa de checkout (como TestCheckoutButton)\r\n\tconst handleCompleteTestCheckout = async () => {\r\n\t\tif (!cart || cart.items.length === 0) {\r\n\t\t\tshowNotification(NotificationType.ERROR, \"El carrito está vacío\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!validateFormData()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetIsLoading(true);\r\n\r\n\t\ttry {\r\n\t\t\tconsole.log(\"Iniciando checkout de prueba completo...\");\r\n\r\n\t\t\t// ✅ OBTENER SELLER_ID DEL CARRITO\r\n\t\t\tconst sellerId = CheckoutService.getSellerIdFromCart(cart);\r\n\t\t\tconsole.log(\"Seller ID obtenido:\", sellerId);\r\n\r\n\t\t\t// Datos de prueba completos (similar al TestCheckoutButton original)\r\n\t\t\tconst testCheckoutData = {\r\n\t\t\t\tpayment: {\r\n\t\t\t\t\tmethod: \"transfer\" as PaymentMethod, // Datafast usa transfer\r\n\t\t\t\t} as PaymentInfo,\r\n\t\t\t\tshipping: {\r\n\t\t\t\t\taddress: formData.address || \"Calle de Prueba 123\",\r\n\t\t\t\t\tcity: formData.city || \"Quito\", \r\n\t\t\t\t\tstate: formData.country || \"Pichincha\",\r\n\t\t\t\t\tcountry: formData.country || \"Ecuador\",\r\n\t\t\t\t\tpostal_code: \"170000\",\r\n\t\t\t\t\tphone: formData.phone || \"0999999999\",\r\n\t\t\t\t} as ShippingInfo,\r\n\t\t\t\tseller_id: sellerId, // ✅ AGREGAR SELLER_ID\r\n\t\t\t};\r\n\r\n\t\t\tconsole.log(\"Procesando checkout de prueba:\", testCheckoutData);\r\n\r\n\t\t\t// Procesar directamente con CheckoutService (saltándose Datafast para la prueba)\r\n\t\t\tconst response = await checkoutService.processCheckout(testCheckoutData);\r\n\r\n\t\t\tif (response.status === \"success\") {\r\n\t\t\t\tclearCart();\r\n\t\t\t\tsetShowWidget(false);\r\n\t\t\t\tsetShowForm(false);\r\n\r\n\t\t\t\tshowNotification(\r\n\t\t\t\t\tNotificationType.SUCCESS,\r\n\t\t\t\t\t\"¡Pedido de prueba completado con éxito!\"\r\n\t\t\t\t);\r\n\r\n\t\t\t\t// Mostrar los detalles de la orden\r\n\t\t\t\tconsole.log(\"Detalles de la orden de prueba:\", response.data);\r\n\r\n\t\t\t\tonSuccess?.(response.data);\r\n\t\t\t\tnavigate(\"/orders\");\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(response.message || \"Error en el checkout de prueba\");\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error en el checkout de prueba completo:\", error);\r\n\t\t\tconst errorMessage =\r\n\t\t\t\terror instanceof Error ? error.message : \"Error al procesar el checkout de prueba\";\r\n\t\t\tshowNotification(NotificationType.ERROR, errorMessage);\r\n\t\t\tonError?.(errorMessage);\r\n\t\t} finally {\r\n\t\t\tsetIsLoading(false);\r\n\t\t}\r\n\t};\r\n\r\n\t// ✅ ACTUALIZADO: Verificar pago con proceso completo\r\n\tconst handleSimulatePaymentResult = async () => {\r\n\t\tif (!checkoutData) {\r\n\t\t\tshowNotification(NotificationType.ERROR, \"No hay datos de checkout\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetIsLoading(true);\r\n\t\ttry {\r\n\t\t\tconsole.log(\"Simulando pago exitoso completo...\");\r\n\r\n\t\t\t// PASO 1: Simular el pago exitoso con Datafast\r\n\t\t\tconst verifyResponse = await datafastService.simulateSuccessfulPayment(\r\n\t\t\t\tcheckoutData.checkout_id,\r\n\t\t\t\tcheckoutData.transaction_id\r\n\t\t\t);\r\n\r\n\t\t\tconsole.log(\"Respuesta de verificación Datafast:\", verifyResponse);\r\n\r\n\t\t\tif (verifyResponse.success && verifyResponse.data) {\r\n\t\t\t\t// PASO 2: Procesar el checkout completo en el sistema\r\n\t\t\t\tconsole.log(\"Procesando checkout completo en el sistema...\");\r\n\t\t\t\t\r\n\t\t\t\t// ✅ OBTENER SELLER_ID DEL CARRITO\r\n\t\t\t\tconst sellerId = CheckoutService.getSellerIdFromCart(cart);\r\n\t\t\t\tconsole.log(\"Seller ID obtenido:\", sellerId);\r\n\t\t\t\t\r\n\t\t\t\t// Preparar datos completos para el checkout\r\n\t\t\t\tconst checkoutRequestData = {\r\n\t\t\t\t\tpayment: {\r\n\t\t\t\t\t\tmethod: \"transfer\" as PaymentMethod, // Datafast usa transfer\r\n\t\t\t\t\t} as PaymentInfo,\r\n\t\t\t\t\tshipping: {\r\n\t\t\t\t\t\taddress: formData.address,\r\n\t\t\t\t\t\tcity: formData.city,\r\n\t\t\t\t\t\tstate: formData.country, // Usar country como state para simplificar\r\n\t\t\t\t\t\tcountry: formData.country,\r\n\t\t\t\t\t\tpostal_code: \"00000\", // Código postal por defecto\r\n\t\t\t\t\t\tphone: formData.phone,\r\n\t\t\t\t\t} as ShippingInfo,\r\n\t\t\t\t\tseller_id: sellerId, // ✅ AGREGAR SELLER_ID\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Procesar el checkout completo\r\n\t\t\t\tconst checkoutResponse = await checkoutService.processCheckout(checkoutRequestData);\r\n\t\t\t\t\r\n\t\t\t\tconsole.log(\"Respuesta del checkout completo:\", checkoutResponse);\r\n\r\n\t\t\t\tif (checkoutResponse.status === \"success\") {\r\n\t\t\t\t\t// PASO 3: Completar el proceso (limpiar carrito, notificar, navegar)\r\n\t\t\t\t\tclearCart();\r\n\t\t\t\t\tsetShowWidget(false);\r\n\r\n\t\t\t\t\tshowNotification(\r\n\t\t\t\t\t\tNotificationType.SUCCESS,\r\n\t\t\t\t\t\t\"¡Pago y pedido completados exitosamente!\"\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t// Mostrar detalles de la orden\r\n\t\t\t\t\tconsole.log(\"Detalles completos de la orden:\", {\r\n\t\t\t\t\t\tdatafast: verifyResponse.data,\r\n\t\t\t\t\t\tcheckout: checkoutResponse.data\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tonSuccess?.(checkoutResponse.data); // Usar datos del checkout completo\r\n\t\t\t\t\tnavigate(\"/orders\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(checkoutResponse.message || \"Error al procesar el checkout completo\");\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(verifyResponse.message || \"Error en la simulación de Datafast\");\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error en la simulación completa:\", error);\r\n\t\t\tconst errorMessage =\r\n\t\t\t\terror instanceof Error ? error.message : \"Error al procesar la simulación completa\";\r\n\t\t\tshowNotification(NotificationType.ERROR, errorMessage);\r\n\t\t\tonError?.(errorMessage);\r\n\t\t} finally {\r\n\t\t\tsetIsLoading(false);\r\n\t\t}\r\n\t};\r\n\r\n\t// Procesar pago real (cuando el usuario complete el formulario)\r\n\tconst handleRealPayment = () => {\r\n\t\tshowNotification(\r\n\t\t\tNotificationType.INFO,\r\n\t\t\t\"Complete los datos de su tarjeta en el formulario y haga clic en 'Pagar'. Nota: En Fase 1, las transacciones son simuladas.\"\r\n\t\t);\r\n\t};\r\n\r\n\tif (showWidget) {\r\n\t\treturn (\r\n\t\t\t<div className=\"datafast-payment-widget\">\r\n\t\t\t\t<div className=\"bg-white rounded-lg shadow-lg p-6\">\r\n\t\t\t\t\t<h3 className=\"text-xl font-bold mb-4\">Pagar con Datafast</h3>\r\n\r\n\t\t\t\t\t<div className=\"mb-4 p-4 bg-blue-50 rounded-lg\">\r\n\t\t\t\t\t\t<h4 className=\"font-semibold text-blue-800\">\r\n\t\t\t\t\t\t\tInformación del pedido:\r\n\t\t\t\t\t\t</h4>\r\n\t\t\t\t\t\t<p className=\"text-blue-700\">Monto: ${checkoutData?.amount}</p>\r\n\t\t\t\t\t\t<p className=\"text-blue-700\">ID: {checkoutData?.transaction_id}</p>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Container para el widget - MUY SIMPLE */}\r\n\t\t\t\t\t<div className=\"min-h-[400px] border border-gray-200 rounded-lg p-4\">\r\n\t\t\t\t\t\t{/* El formulario de Datafast aparecerá aquí automáticamente */}\r\n\t\t\t\t\t\t<form\r\n\t\t\t\t\t\t\taction={`${window.location.origin}/datafast-result`}\r\n\t\t\t\t\t\t\tclassName=\"paymentWidgets\"\r\n\t\t\t\t\t\t\tdata-brands=\"VISA MASTER AMEX DINERS DISCOVER\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{!widgetLoaded && (\r\n\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center h-64\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-center\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-2\"></div>\r\n\t\t\t\t\t\t\t\t\t\t<p className=\"text-gray-600\">\r\n\t\t\t\t\t\t\t\t\t\t\tCargando formulario de pago...\r\n\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</form>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Información de prueba */}\r\n\t\t\t\t\t<div className=\"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\r\n\t\t\t\t\t\t<h4 className=\"font-semibold text-yellow-800 mb-2\">\r\n\t\t\t\t\t\t\tDatos de prueba para usar:\r\n\t\t\t\t\t\t</h4>\r\n\t\t\t\t\t\t<div className=\"text-sm text-yellow-700 space-y-1\">\r\n\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t<strong>Tarjeta:</strong> 4200 0000 0000 0000\r\n\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t<strong>Fecha:</strong> 12/25\r\n\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t<strong>CVV:</strong> 123\r\n\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t<strong>Titular:</strong> {formData.given_name}{\" \"}\r\n\t\t\t\t\t\t\t\t{formData.surname}\r\n\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* ✅ BOTONES ACTUALIZADOS */}\r\n\t\t\t\t\t<div className=\"mt-6 space-y-4\">\r\n\t\t\t\t\t\t{/* Botones principales */}\r\n\t\t\t\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={handleRealPayment}\r\n\t\t\t\t\t\t\t\tdisabled={!widgetLoaded}\r\n\t\t\t\t\t\t\t\tclassName=\"bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-md transition-colors disabled:opacity-50\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tPago Real\r\n\t\t\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={handleSimulatePaymentResult}\r\n\t\t\t\t\t\t\t\tdisabled={isLoading}\r\n\t\t\t\t\t\t\t\tclassName=\"bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition-colors disabled:opacity-50\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{isLoading ? \"Verificando...\" : \"Simular Pago Exitoso\"}\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t{/* Botón de prueba completa */}\r\n\t\t\t\t\t\t<div className=\"border-t pt-4\">\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={handleCompleteTestCheckout}\r\n\t\t\t\t\t\t\t\tdisabled={isLoading}\r\n\t\t\t\t\t\t\t\tclassName=\"w-full bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-3 px-4 rounded-md transition-colors disabled:opacity-50 flex items-center justify-center\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{isLoading ? (\r\n\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\r\n\t\t\t\t\t\t\t\t\t\tProcesando...\r\n\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t<svg className=\"w-4 h-4 mr-2\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n\t\t\t\t\t\t\t\t\t\t\t<path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t\tPrueba Completa de Checkout\r\n\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t<p className=\"text-xs text-gray-500 text-center mt-2\">\r\n\t\t\t\t\t\t\t\tSimula el proceso completo de checkout como el botón de prueba original\r\n\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t{/* Botón volver */}\r\n\t\t\t\t\t\t<div className=\"flex justify-center\">\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\tsetShowWidget(false);\r\n\t\t\t\t\t\t\t\t\tsetShowForm(true);\r\n\t\t\t\t\t\t\t\t\tsetWidgetLoaded(false);\r\n\t\t\t\t\t\t\t\t\t// Limpiar script\r\n\t\t\t\t\t\t\t\t\tconst script = document.getElementById(\"datafast-widget-script\");\r\n\t\t\t\t\t\t\t\t\tif (script) script.remove();\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\tdisabled={isLoading}\r\n\t\t\t\t\t\t\t\tclassName=\"px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tVolver\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\tif (showForm) {\r\n\t\treturn (\r\n\t\t\t<div className=\"datafast-form\">\r\n\t\t\t\t<div className=\"bg-white rounded-lg shadow-lg p-6\">\r\n\t\t\t\t\t<h3 className=\"text-xl font-bold mb-4\">Información para Datafast</h3>\r\n\r\n\t\t\t\t\t<div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n\t\t\t\t\t\t\t\tNombre *\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\tvalue={formData.given_name}\r\n\t\t\t\t\t\t\t\tonChange={(e) =>\r\n\t\t\t\t\t\t\t\t\thandleInputChange(\"given_name\", e.target.value)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tclassName=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n\t\t\t\t\t\t\t\tSegundo Nombre\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\tvalue={formData.middle_name}\r\n\t\t\t\t\t\t\t\tonChange={(e) =>\r\n\t\t\t\t\t\t\t\t\thandleInputChange(\"middle_name\", e.target.value)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tclassName=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n\t\t\t\t\t\t\t\tApellido *\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\tvalue={formData.surname}\r\n\t\t\t\t\t\t\t\tonChange={(e) => handleInputChange(\"surname\", e.target.value)}\r\n\t\t\t\t\t\t\t\tclassName=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n\t\t\t\t\t\t\t\tTeléfono *\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\tvalue={formData.phone}\r\n\t\t\t\t\t\t\t\tonChange={(e) => handleInputChange(\"phone\", e.target.value)}\r\n\t\t\t\t\t\t\t\tclassName=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\t\t\tplaceholder=\"0999999999\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n\t\t\t\t\t\t\t\tCédula/ID * (10 dígitos)\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\tvalue={formData.doc_id}\r\n\t\t\t\t\t\t\t\tonChange={(e) => {\r\n\t\t\t\t\t\t\t\t\tconst value = e.target.value.replace(/\\D/g, \"\").slice(0, 10);\r\n\t\t\t\t\t\t\t\t\thandleInputChange(\"doc_id\", value);\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\tclassName=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\t\t\tplaceholder=\"1234567890\"\r\n\t\t\t\t\t\t\t\tmaxLength={10}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div className=\"md:col-span-2\">\r\n\t\t\t\t\t\t\t<label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n\t\t\t\t\t\t\t\tDirección *\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\tvalue={formData.address}\r\n\t\t\t\t\t\t\t\tonChange={(e) => handleInputChange(\"address\", e.target.value)}\r\n\t\t\t\t\t\t\t\tclassName=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n\t\t\t\t\t\t\t\tCiudad *\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\tvalue={formData.city}\r\n\t\t\t\t\t\t\t\tonChange={(e) => handleInputChange(\"city\", e.target.value)}\r\n\t\t\t\t\t\t\t\tclassName=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<label className=\"block text-sm font-medium text-gray-700 mb-1\">\r\n\t\t\t\t\t\t\t\tPaís *\r\n\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t<select\r\n\t\t\t\t\t\t\t\tvalue={formData.country}\r\n\t\t\t\t\t\t\t\tonChange={(e) => handleInputChange(\"country\", e.target.value)}\r\n\t\t\t\t\t\t\t\tclassName=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<option value=\"EC\">Ecuador</option>\r\n\t\t\t\t\t\t\t\t<option value=\"CO\">Colombia</option>\r\n\t\t\t\t\t\t\t\t<option value=\"PE\">Perú</option>\r\n\t\t\t\t\t\t\t\t<option value=\"US\">Estados Unidos</option>\r\n\t\t\t\t\t\t\t</select>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"mt-6 flex gap-4\">\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tonClick={handleStartPayment}\r\n\t\t\t\t\t\t\tdisabled={isLoading}\r\n\t\t\t\t\t\t\tclassName=\"flex-1 bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-md transition-colors disabled:opacity-50 flex items-center justify-center\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{isLoading ? (\r\n\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t<div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\r\n\t\t\t\t\t\t\t\t\tCreando checkout...\r\n\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\"Continuar con Datafast\"\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tonClick={() => setShowForm(false)}\r\n\t\t\t\t\t\t\tdisabled={isLoading}\r\n\t\t\t\t\t\t\tclassName=\"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tCancelar\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"datafast-payment-button\">\r\n\t\t\t<button\r\n\t\t\t\tonClick={() => setShowForm(true)}\r\n\t\t\t\tdisabled={isLoading || !cart || cart.items.length === 0}\r\n\t\t\t\tclassName=\"w-full transition-all duration-200 transform hover:scale-101 bg-[#003c58] border-1 hover:bg-[#00B86E] text-white font-medium py-3 px-4 rounded-md disabled:opacity-50 flex items-center justify-center\"\r\n\t\t\t>\r\n\t\t\t\t<svg\r\n\t\t\t\t\tclassName=\"w-5 h-5 mr-2\"\r\n\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<path\r\n\t\t\t\t\t\tstrokeLinecap=\"round\"\r\n\t\t\t\t\t\tstrokeLinejoin=\"round\"\r\n\t\t\t\t\t\tstrokeWidth={2}\r\n\t\t\t\t\t\td=\"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z\"\r\n\t\t\t\t\t/>\r\n\t\t\t\t</svg>\r\n\t\t\t\tPagar con Datafast\r\n\t\t\t</button>\r\n\r\n\t\t\t{(!cart || cart.items.length === 0) && (\r\n\t\t\t\t<p className=\"mt-2 text-sm text-gray-500 text-center\">\r\n\t\t\t\t\tAgrega productos al carrito para continuar\r\n\t\t\t\t</p>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default DatafastPaymentButton;","// src/presentation/pages/CheckoutPage.tsx\r\nimport {useState, useEffect} from \"react\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {useCart} from \"../hooks/useCart\";\r\nimport {useAuth} from \"../hooks/useAuth\"; // ✅ AGREGAR PARA OBTENER DATOS DEL USUARIO\r\nimport {CheckoutService} from \"../../core/services/CheckoutService\";\r\nimport type {\r\n\tShippingInfo,\r\n\tPaymentInfo,\r\n\tPaymentMethod,\r\n} from \"../../core/services/CheckoutService\";\r\nimport {NotificationType} from \"../contexts/CartContext\";\r\nimport CreditCardForm from \"../components/checkout/CreditCardForm\";\r\nimport QRPaymentForm from \"../components/checkout/QRPaymentForm\"; \r\nimport OrderSummary from \"../components/checkout/OrderSummary\";\r\nimport ShippingForm from \"../components/checkout/ShippingForm\";\r\nimport TestCheckoutButton from \"../components/checkout/TestCheckoutButton\";\r\nimport { extractErrorMessage } from \"../../utils/errorHandler\";\r\nimport DatafastPaymentButton from \"../components/checkout/DatafastPaymentButtonProps\";\r\n\r\nconst CheckoutPage: React.FC = () => {\r\n\tconst navigate = useNavigate();\r\n\tconst {cart, clearCart, showNotification} = useCart();\r\n\tconst {user} = useAuth(); // ✅ OBTENER DATOS DEL USUARIO\r\n\tconst [isLoading, setIsLoading] = useState(false);\r\n\t\r\n\t// ✅ SOLO TARJETA DE CRÉDITO Y DEUNA (antes QR)\r\n\tconst [paymentMethod, setPaymentMethod] = useState<\r\n\t\t\"credit_card\" | \"deuna\"\r\n\t>(\"credit_card\");\r\n\t\r\n\t// ✅ INICIALIZAR CON DATOS DEL USUARIO\r\n\tconst [shippingInfo, setShippingInfo] = useState<ShippingInfo>({\r\n\t\taddress: \"\",\r\n\t\tcity: \"\",\r\n\t\tstate: \"\",\r\n\t\tcountry: \"\",\r\n\t\tpostal_code: \"\",\r\n\t\tphone: \"\",\r\n\t});\r\n\t\r\n\tconst [paymentInfo, setPaymentInfo] = useState<PaymentInfo>({\r\n\t\tmethod: \"credit_card\",\r\n\t\tcard_number: \"\",\r\n\t\tcard_expiry: \"\",\r\n\t\tcard_cvc: \"\",\r\n\t});\r\n\t\r\n\tconst [formErrors, setFormErrors] = useState<Record<string, string>>({});\r\n\tconst [orderComplete, setOrderComplete] = useState(false);\r\n\tconst [orderDetails, setOrderDetails] = useState<any>(null);\r\n\r\n\tconst checkoutService = new CheckoutService();\r\n\r\n\t// ✅ CARGAR DATOS DEL USUARIO AL MONTAR EL COMPONENTE\r\n\tuseEffect(() => {\r\n\t\tif (user) {\r\n\t\t\tsetShippingInfo({\r\n\t\t\t\taddress: user.address || \"\",\r\n\t\t\t\tcity: user.city || \"\",\r\n\t\t\t\tstate: user.state || user.province || \"\",\r\n\t\t\t\tcountry: user.country || \"Ecuador\",\r\n\t\t\t\tpostal_code: user.postal_code || user.zip_code || \"\",\r\n\t\t\t\tphone: user.phone || \"\",\r\n\t\t\t});\r\n\t\t}\r\n\t}, [user]);\r\n\r\n\tconst handleSuccess = (orderData: any) => {\r\n\t\tconsole.log(\"Pago exitoso:\", orderData);\r\n\t};\r\n\r\n\tconst handleError = (error: string) => {\r\n\t\tconsole.error(\"Error:\", error);\r\n\t};\r\n\r\n\t// Verificar si el carrito está vacío\r\n\tuseEffect(() => {\r\n\t\tif (!cart || cart.items.length === 0) {\r\n\t\t\tshowNotification(NotificationType.ERROR, \"El carrito está vacío\");\r\n\t\t\tnavigate(\"/cart\");\r\n\t\t}\r\n\t}, [cart, navigate, showNotification]);\r\n\r\n\t// ✅ ACTUALIZAR TIPOS DE MÉTODO DE PAGO\r\n\tconst handlePaymentMethodChange = (method: \"credit_card\" | \"deuna\") => {\r\n\t\tsetPaymentMethod(method);\r\n\t\tsetPaymentInfo({\r\n\t\t\t...paymentInfo, \r\n\t\t\tmethod: method === \"deuna\" ? \"transfer\" : method\r\n\t\t});\r\n\t};\r\n\r\n\t// Actualizar información de envío\r\n\tconst handleShippingChange = (field: keyof ShippingInfo, value: string) => {\r\n\t\tsetShippingInfo({...shippingInfo, [field]: value});\r\n\t\t// Limpiar error si el campo tiene valor\r\n\t\tif (value.trim() && formErrors[field]) {\r\n\t\t\tconst newErrors = {...formErrors};\r\n\t\t\tdelete newErrors[field];\r\n\t\t\tsetFormErrors(newErrors);\r\n\t\t}\r\n\t};\r\n\r\n\t// Actualizar información de pago\r\n\tconst handlePaymentChange = (field: keyof PaymentInfo, value: string) => {\r\n\t\tsetPaymentInfo({...paymentInfo, [field]: value});\r\n\t\t// Limpiar error si el campo tiene valor\r\n\t\tif (value.trim() && formErrors[field]) {\r\n\t\t\tconst newErrors = {...formErrors};\r\n\t\t\tdelete newErrors[field];\r\n\t\t\tsetFormErrors(newErrors);\r\n\t\t}\r\n\t};\r\n\r\n\t// Validar el formulario\r\n\tconst validateForm = (): boolean => {\r\n\t\tconst errors: Record<string, string> = {};\r\n\r\n\t\t// Validar información de envío\r\n\t\tconst requiredShippingFields: (keyof ShippingInfo)[] = [\r\n\t\t\t\"address\",\r\n\t\t\t\"city\",\r\n\t\t\t\"state\",\r\n\t\t\t\"country\",\r\n\t\t\t\"postal_code\",\r\n\t\t\t\"phone\",\r\n\t\t];\r\n\t\trequiredShippingFields.forEach((field) => {\r\n\t\t\tif (!shippingInfo[field]) {\r\n\t\t\t\terrors[field] = `El campo ${field.replace(\"_\", \" \")} es obligatorio`;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// ✅ VALIDAR SOLO TARJETA DE CRÉDITO (DeUna no necesita validación de campos)\r\n\t\tif (paymentMethod === \"credit_card\") {\r\n\t\t\tif (!paymentInfo.card_number) {\r\n\t\t\t\terrors.card_number = \"El número de tarjeta es obligatorio\";\r\n\t\t\t} else if (!/^\\d{16}$/.test(paymentInfo.card_number || \"\")) {\r\n\t\t\t\terrors.card_number = \"El número de tarjeta debe tener 16 dígitos\";\r\n\t\t\t}\r\n\r\n\t\t\tif (!paymentInfo.card_expiry) {\r\n\t\t\t\terrors.card_expiry = \"La fecha de expiración es obligatoria\";\r\n\t\t\t} else if (!/^\\d{2}\\/\\d{2}$/.test(paymentInfo.card_expiry || \"\")) {\r\n\t\t\t\terrors.card_expiry = \"El formato debe ser MM/YY\";\r\n\t\t\t}\r\n\r\n\t\t\tif (!paymentInfo.card_cvc) {\r\n\t\t\t\terrors.card_cvc = \"El código de seguridad es obligatorio\";\r\n\t\t\t} else if (!/^\\d{3,4}$/.test(paymentInfo.card_cvc || \"\")) {\r\n\t\t\t\terrors.card_cvc = \"El código debe tener 3 o 4 dígitos\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tsetFormErrors(errors);\r\n\t\treturn Object.keys(errors).length === 0;\r\n\t};\r\n\r\n\t// Procesar el checkout\r\n\tconst processCheckout = async () => {\r\n\t\tif (!validateForm()) {\r\n\t\t\tshowNotification(\r\n\t\t\t\tNotificationType.ERROR,\r\n\t\t\t\t\"Por favor, completa todos los campos obligatorios\"\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetIsLoading(true);\r\n\r\n\t\ttry {\r\n\t\t\tconst checkoutData = {\r\n\t\t\t\tpayment: {\r\n\t\t\t\t\t...paymentInfo,\r\n\t\t\t\t\tmethod: paymentMethod === \"deuna\" ? (\"transfer\" as PaymentMethod) : paymentMethod,\r\n\t\t\t\t},\r\n\t\t\t\tshipping: shippingInfo,\r\n\t\t\t\t// ✅ NO ENVIAR seller_id - el backend lo obtiene de los productos\r\n\t\t\t};\r\n\r\n\t\t\tconsole.log(\"Procesando checkout con datos:\", checkoutData);\r\n\r\n\t\t\tconst response = await checkoutService.processCheckout(checkoutData);\r\n\r\n\t\t\tif (response.status === \"success\") {\r\n\t\t\t\tsetOrderComplete(true);\r\n\t\t\t\tsetOrderDetails(response.data);\r\n\t\t\t\tshowNotification(\r\n\t\t\t\t\tNotificationType.SUCCESS,\r\n\t\t\t\t\t\"¡Pedido completado con éxito!\"\r\n\t\t\t\t);\r\n\t\t\t\tclearCart();\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(response.message || \"Error al procesar el pedido\");\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"Error al procesar checkout:\", error);\r\n\r\n\t\t\tconst errorMessage = extractErrorMessage(\r\n\t\t\t\terror,\r\n\t\t\t\t\"Error al procesar el pago. Por favor, intenta de nuevo más tarde.\"\r\n\t\t\t);\r\n\r\n\t\t\tshowNotification(NotificationType.ERROR, errorMessage);\r\n\t\t} finally {\r\n\t\t\tsetIsLoading(false);\r\n\t\t}\r\n\t};\r\n\r\n\t// Si el pedido está completo, mostrar pantalla de éxito\r\n\tif (orderComplete && orderDetails) {\r\n\t\treturn (\r\n\t\t\t<div className=\"container mx-auto px-4 py-10\">\r\n\t\t\t\t<div className=\"bg-white rounded-lg shadow-lg p-8 max-w-3xl mx-auto\">\r\n\t\t\t\t\t<div className=\"text-center\">\r\n\t\t\t\t\t\t<div className=\"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\tclassName=\"h-10 w-10 text-green-500\"\r\n\t\t\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\tstrokeLinecap=\"round\"\r\n\t\t\t\t\t\t\t\t\tstrokeLinejoin=\"round\"\r\n\t\t\t\t\t\t\t\t\tstrokeWidth={2}\r\n\t\t\t\t\t\t\t\t\td=\"M5 13l4 4L19 7\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<h2 className=\"text-3xl font-bold text-gray-800 mb-4\">\r\n\t\t\t\t\t\t\t¡Pedido realizado con éxito!\r\n\t\t\t\t\t\t</h2>\r\n\t\t\t\t\t\t<p className=\"text-gray-600 mb-6\">\r\n\t\t\t\t\t\t\tTu pedido ha sido procesado correctamente. Hemos enviado un correo\r\n\t\t\t\t\t\t\telectrónico con los detalles.\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"border-t border-gray-200 pt-4 pb-2 mb-4\">\r\n\t\t\t\t\t\t<h3 className=\"text-lg font-semibold mb-2\">Detalles del pedido:</h3>\r\n\t\t\t\t\t\t<div className=\"flex justify-between py-2\">\r\n\t\t\t\t\t\t\t<span className=\"text-gray-600\">Número de orden:</span>\r\n\t\t\t\t\t\t\t<span className=\"font-medium\">{orderDetails.order_number}</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"flex justify-between py-2\">\r\n\t\t\t\t\t\t\t<span className=\"text-gray-600\">Total:</span>\r\n\t\t\t\t\t\t\t<span className=\"font-medium\">{orderDetails.total}</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"flex justify-between py-2\">\r\n\t\t\t\t\t\t\t<span className=\"text-gray-600\">Estado del pago:</span>\r\n\t\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\t\tclassName={`font-medium ${orderDetails.payment_status === \"paid\" ? \"text-green-600\" : \"text-yellow-600\"}`}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{orderDetails.payment_status === \"paid\"\r\n\t\t\t\t\t\t\t\t\t? \"Pagado\"\r\n\t\t\t\t\t\t\t\t\t: orderDetails.payment_status}\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"flex justify-center space-x-4 mt-6\">\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tonClick={() => navigate(\"/\")}\r\n\t\t\t\t\t\t\tclassName=\"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tVolver a la tienda\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tonClick={() => navigate(\"/orders\")}\r\n\t\t\t\t\t\t\tclassName=\"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\tVer mis pedidos\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\t// Mostrar página de checkout\r\n\treturn (\r\n\t\t<div className=\"container mx-auto px-4 py-10\">\r\n\t\t\t<div className=\"flex justify-between items-center mb-8\">\r\n\t\t\t\t<h1 className=\"text-3xl font-bold\">Finalizar compra</h1>\r\n\t\t\t\t<TestCheckoutButton />\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"flex flex-col lg:flex-row gap-8\">\r\n\t\t\t\t{/* Formulario de checkout */}\r\n\t\t\t\t<div className=\"lg:w-2/3\">\r\n\t\t\t\t\t{/* Información de envío/facturación */}\r\n\t\t\t\t\t<div className=\"bg-white rounded-lg shadow-lg p-6 mb-6\">\r\n\t\t\t\t\t\t<h2 className=\"text-xl font-bold mb-4\">Información de facturación y envío</h2>\r\n\t\t\t\t\t\t<ShippingForm\r\n\t\t\t\t\t\t\tshippingInfo={shippingInfo}\r\n\t\t\t\t\t\t\terrors={formErrors}\r\n\t\t\t\t\t\t\tonChange={handleShippingChange}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* Métodos de pago */}\r\n\t\t\t\t\t<div className=\"bg-white rounded-lg shadow-lg p-6 mb-6\">\r\n\t\t\t\t\t\t<h2 className=\"text-xl font-bold mb-4\">Método de pago</h2>\r\n\r\n\t\t\t\t\t\t{/* ✅ SOLO OPCIONES DE TARJETA DE CRÉDITO Y DEUNA */}\r\n\t\t\t\t\t\t<div className=\"flex flex-wrap gap-4 mb-6\">\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\tonClick={() => handlePaymentMethodChange(\"credit_card\")}\r\n\t\t\t\t\t\t\t\tclassName={`flex items-center border rounded-lg px-4 py-3 ${\r\n\t\t\t\t\t\t\t\t\tpaymentMethod === \"credit_card\"\r\n\t\t\t\t\t\t\t\t\t\t? \"border-primary-600 bg-primary-50 text-primary-600\"\r\n\t\t\t\t\t\t\t\t\t\t: \"border-gray-300 hover:bg-gray-50\"\r\n\t\t\t\t\t\t\t\t}`}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<span className=\"mr-2\">💳</span>\r\n\t\t\t\t\t\t\t\t<span>Tarjeta de crédito</span>\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\tonClick={() => handlePaymentMethodChange(\"deuna\")}\r\n\t\t\t\t\t\t\t\tclassName={`flex items-center border rounded-lg px-4 py-3 ${\r\n\t\t\t\t\t\t\t\t\tpaymentMethod === \"deuna\"\r\n\t\t\t\t\t\t\t\t\t\t? \"border-primary-600 bg-primary-50 text-primary-600\"\r\n\t\t\t\t\t\t\t\t\t\t: \"border-gray-300 hover:bg-gray-50\"\r\n\t\t\t\t\t\t\t\t}`}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<span className=\"mr-2\">🚀</span>\r\n\t\t\t\t\t\t\t\t<span>Pago con DeUna!</span>\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t{/* Formulario según método de pago seleccionado */}\r\n\t\t\t\t\t\t{paymentMethod === \"credit_card\" && (\r\n\t\t\t\t\t\t\t<CreditCardForm\r\n\t\t\t\t\t\t\t\tpaymentInfo={paymentInfo}\r\n\t\t\t\t\t\t\t\terrors={formErrors}\r\n\t\t\t\t\t\t\t\tonChange={handlePaymentChange}\r\n\t\t\t\t\t\t\t\tcontent={<DatafastPaymentButton\r\n\t\t\t\t\t\t\t\t\tonSuccess={handleSuccess}\r\n\t\t\t\t\t\t\t\t\tonError={handleError}\r\n\t\t\t\t\t\t\t\t/>}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t{paymentMethod === \"deuna\" && <QRPaymentForm />}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t{/* Resumen del pedido */}\r\n\t\t\t\t<div className=\"lg:w-1/3\">\r\n\t\t\t\t\t<div className=\"bg-white rounded-lg shadow-lg p-6 sticky top-24\">\r\n\t\t\t\t\t\t<OrderSummary cart={cart} />\r\n\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tonClick={processCheckout}\r\n\t\t\t\t\t\t\tdisabled={isLoading}\r\n\t\t\t\t\t\t\tclassName=\"mt-6 w-full bg-primary-600 hover:bg-primary-700 text-white font-medium py-3 px-4 rounded-md transition-colors disabled:opacity-50 flex items-center justify-center\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{isLoading ? (\r\n\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t<svg\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\"\r\n\t\t\t\t\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\r\n\t\t\t\t\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\t\t\t\t\tviewBox=\"0 0 24 24\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<circle\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"opacity-25\"\r\n\t\t\t\t\t\t\t\t\t\t\tcx=\"12\"\r\n\t\t\t\t\t\t\t\t\t\t\tcy=\"12\"\r\n\t\t\t\t\t\t\t\t\t\t\tr=\"10\"\r\n\t\t\t\t\t\t\t\t\t\t\tstroke=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\tstrokeWidth=\"4\"\r\n\t\t\t\t\t\t\t\t\t\t></circle>\r\n\t\t\t\t\t\t\t\t\t\t<path\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"opacity-75\"\r\n\t\t\t\t\t\t\t\t\t\t\tfill=\"currentColor\"\r\n\t\t\t\t\t\t\t\t\t\t\td=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\r\n\t\t\t\t\t\t\t\t\t\t></path>\r\n\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\tProcesando...\r\n\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\"Finalizar compra\"\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t\t<p className=\"mt-4 text-xs text-gray-500 text-center\">\r\n\t\t\t\t\t\t\tAl hacer clic en \"Finalizar compra\", aceptas nuestros{\" \"}\r\n\t\t\t\t\t\t\t<a href=\"/terms\" className=\"text-primary-600 hover:underline\">\r\n\t\t\t\t\t\t\t\tTérminos y condiciones\r\n\t\t\t\t\t\t\t</a>{\" \"}\r\n\t\t\t\t\t\t\ty{\" \"}\r\n\t\t\t\t\t\t\t<a href=\"/privacy\" className=\"text-primary-600 hover:underline\">\r\n\t\t\t\t\t\t\t\tPolítica de privacidad\r\n\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t.\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default CheckoutPage;"],"names":["CheckoutService","cart","firstItem","checkoutData","response","ApiClient","API_ENDPOINTS","error","errorMessage","extractErrorMessage","CreditCardForm","content","jsxs","jsx","QRPaymentForm","deunaInitiated","setDeunaInitiated","useState","useCart","total","formatCurrency","OrderSummary","subtotal","item","finalPrice","taxRate","shipping","tax","originalPrice","hasDiscount","ShippingForm","shippingInfo","errors","onChange","e","TestCheckoutButton","navigate","useNavigate","clearCart","showNotification","checkoutService","isLoading","setIsLoading","handleTestCheckout","NotificationType","sellerId","testData","DatafastPaymentButton","onSuccess","onError","showWidget","setShowWidget","setCheckoutData","showForm","setShowForm","widgetLoaded","setWidgetLoaded","formData","setFormData","datafastService","DatafastService","useEffect","script","handleInputChange","field","value","prev","validateFormData","requiredFields","handleStartPayment","requestData","loadDatafastWidget","checkoutId","existingScript","handleCompleteTestCheckout","testCheckoutData","handleSimulatePaymentResult","verifyResponse","checkoutRequestData","checkoutResponse","handleRealPayment","Fragment","CheckoutPage","user","useAuth","paymentMethod","setPaymentMethod","setShippingInfo","paymentInfo","setPaymentInfo","formErrors","setFormErrors","orderComplete","setOrderComplete","orderDetails","setOrderDetails","handleSuccess","orderData","handleError","handlePaymentMethodChange","method","handleShippingChange","newErrors","handlePaymentChange","validateForm","processCheckout"],"mappings":"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"}