import{j as e,aI as U,a0 as V,v as B,q as G,b1 as R,b2 as H,J,E as M,d as X,X as K,O as Q}from"./ui-vendor-BUNMIuFe.js";import{u as W,d as Y,r as l,L as S}from"./react-vendor-Cy458wKG.js";import{m as Z}from"./admin-chunk-BNcFjXlJ.js";const se=()=>{const u=W(),{id:k}=Y(),i=Number(k),{loading:h,error:y,categoryDetail:s,mainCategories:j,fetchCategoryById:N,fetchMainCategories:v,updateCategory:L,setError:c}=Z(),[r,x]=l.useState({id:i,name:"",slug:"",description:"",parent_id:void 0,icon:"",order:0,is_active:!0,featured:!1}),[o,w]=l.useState({}),[C,E]=l.useState(!1),[F,f]=l.useState(!0),[D,P]=l.useState(""),[m,_]=l.useState(!1),z=l.useCallback(async()=>{if(!i||isNaN(i)){c("ID de categor√≠a inv√°lido"),u("/admin/categories");return}if(!(m&&s)){f(!0);try{console.log("üîÑ AdminEditCategoryPage: Cargando datos para categor√≠a",i);const[a]=await Promise.all([N(i),v(!0)]);if(!a){c("Categor√≠a no encontrada"),u("/admin/categories");return}console.log("üì• AdminEditCategoryPage: Categor√≠a cargada:",a),_(!0)}catch(a){console.error("Error al cargar datos de categor√≠a:",a),c("Error al cargar los datos de la categor√≠a")}finally{f(!1)}}},[i,m,s,N,v,u,c]);l.useEffect(()=>{i&&!m&&!h&&z()},[i,m,h]),l.useEffect(()=>{i&&(_(!1),f(!0),x({id:i,name:"",slug:"",description:"",parent_id:void 0,icon:"",order:0,is_active:!0,featured:!1}))},[i]),l.useEffect(()=>{if(s&&s.id===i&&!m){console.log("üì• AdminEditCategoryPage: Llenando formulario con datos de categor√≠a:",s);const a={id:s.id,name:s.name||"",slug:s.slug||"",description:s.description||"",parent_id:s.parent_id||void 0,icon:s.icon||"",order:s.order||0,is_active:s.is_active??!0,featured:s.featured??!1};x(a),P(s.slug||""),console.log("‚úÖ AdminEditCategoryPage: Datos del formulario establecidos:",a)}},[s,i,m]);const I=a=>a.toLowerCase().trim().replace(/[√°√†√§√¢]/g,"a").replace(/[√©√®√´√™]/g,"e").replace(/[√≠√¨√Ø√Æ]/g,"i").replace(/[√≥√≤√∂√¥]/g,"o").replace(/[√∫√π√º√ª]/g,"u").replace(/[√±]/g,"n").replace(/[√ß]/g,"c").replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),d=a=>{const{name:t,value:n,type:p}=a.target;let b=n;if(p==="checkbox"&&(b=a.target.checked),(t==="order"||t==="parent_id")&&(b=n===""?0:Number(n)),x(g=>({...g,[t]:b})),t==="name"&&n&&(r.slug||"")===D){const g=I(n);x(T=>({...T,slug:g}))}o[t]&&w(g=>({...g,[t]:""}))},A=()=>{const a={},t=r.name||"";t.trim()?t.length<2?a.name="El nombre debe tener al menos 2 caracteres":t.length>100&&(a.name="El nombre no puede tener m√°s de 100 caracteres"):a.name="El nombre es obligatorio";const n=r.slug||"";n.trim()?/^[a-z0-9-]+$/.test(n)?n.length>150&&(a.slug="El slug no puede tener m√°s de 150 caracteres"):a.slug="El slug solo puede contener letras min√∫sculas, n√∫meros y guiones":a.slug="El slug es obligatorio";const p=r.description||"";return p&&p.length>500&&(a.description="La descripci√≥n no puede tener m√°s de 500 caracteres"),r.order!==void 0&&(r.order<0||r.order>999)&&(a.order="El orden debe estar entre 0 y 999"),r.parent_id===i&&(a.parent_id="Una categor√≠a no puede ser padre de s√≠ misma"),w(a),Object.keys(a).length===0},$=async a=>{if(a.preventDefault(),!!A()){E(!0),c(null);try{const t={...r,name:(r.name||"").trim(),slug:(r.slug||"").trim(),description:(r.description||"").trim()||void 0,icon:(r.icon||"").trim()||void 0,parent_id:r.parent_id===0?void 0:r.parent_id};console.log("üì§ Enviando datos de categor√≠a:",t);const n=await L(t);n?(console.log("‚úÖ Categor√≠a actualizada exitosamente:",n),u("/admin/categories",{state:{message:`Categor√≠a "${n.name}" actualizada exitosamente`}})):c("Error al actualizar la categor√≠a. Int√©ntalo de nuevo.")}catch(t){console.error("‚ùå Error al actualizar categor√≠a:",t),c(t instanceof Error?t.message:"Error inesperado al actualizar la categor√≠a")}finally{E(!1)}}},O=a=>{if(!a)return"Sin categor√≠a padre";const t=j.find(n=>n.id===a);return t?t.name:"Categor√≠a padre desconocida"},q=j.filter(a=>a.id!==i);return F?e.jsx("div",{className:"flex items-center justify-center min-h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(U,{className:"h-8 w-8 animate-spin text-primary-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando datos de la categor√≠a..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(S,{to:"/admin/categories",className:"p-2 text-gray-600 hover:bg-gray-100 rounded-md",title:"Volver a categor√≠as",children:e.jsx(V,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Editar Categor√≠a"}),s&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Editando: ",s.name,s.parent_id&&e.jsxs("span",{className:"ml-2",children:["(Subcategor√≠a de:"," ",O(s.parent_id),")"]})]})]})]})}),y&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:y}),e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 mb-6 flex items-center",children:[e.jsx(B,{className:"h-5 w-5 mr-2"}),"Informaci√≥n B√°sica"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre *"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",id:"name",name:"name",value:r.name||"",onChange:d,className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${o.name?"border-red-300":"border-gray-300"}`,placeholder:"Nombre de la categor√≠a",maxLength:100,required:!0})]}),o.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"slug",className:"block text-sm font-medium text-gray-700 mb-2",children:"Slug *"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",id:"slug",name:"slug",value:r.slug||"",onChange:d,className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${o.slug?"border-red-300":"border-gray-300"}`,placeholder:"slug-de-la-categoria",maxLength:150,pattern:"[a-z0-9-]+",required:!0})]}),o.slug&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.slug}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Solo letras min√∫sculas, n√∫meros y guiones. Cambiar el slug puede afectar URLs existentes."})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"parent_id",className:"block text-sm font-medium text-gray-700 mb-2",children:"Categor√≠a Padre"}),e.jsxs("select",{id:"parent_id",name:"parent_id",value:r.parent_id||0,onChange:d,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${o.parent_id?"border-red-300":"border-gray-300"}`,children:[e.jsx("option",{value:0,children:"Sin categor√≠a padre (principal)"}),q.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),o.parent_id&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.parent_id})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"order",className:"block text-sm font-medium text-gray-700 mb-2",children:"Orden"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"number",id:"order",name:"order",value:r.order||0,onChange:d,className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${o.order?"border-red-300":"border-gray-300"}`,placeholder:"0",min:"0",max:"999"})]}),o.order&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.order}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Orden de aparici√≥n (0 = primero)"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-2",children:"Descripci√≥n"}),e.jsxs("div",{className:"relative",children:[e.jsx(J,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx("textarea",{id:"description",name:"description",value:r.description||"",onChange:d,rows:4,className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 ${o.description?"border-red-300":"border-gray-300"}`,placeholder:"Descripci√≥n de la categor√≠a (opcional)",maxLength:500})]}),o.description&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.description}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[(r.description||"").length,"/500 caracteres"]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{htmlFor:"icon",className:"block text-sm font-medium text-gray-700 mb-2",children:"Icono (opcional)"}),e.jsx("input",{type:"text",id:"icon",name:"icon",value:r.icon||"",onChange:d,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"Ej: fas fa-laptop, lucide:computer, etc."}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Clase CSS del icono o nombre del icono a mostrar"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:"Estados"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",name:"is_active",checked:r.is_active??!0,onChange:d,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsxs("label",{htmlFor:"is_active",className:"ml-2 text-sm text-gray-900 flex items-center",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Categor√≠a activa"]})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"Las categor√≠as inactivas no aparecen en la tienda"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"featured",name:"featured",checked:r.featured??!1,onChange:d,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsxs("label",{htmlFor:"featured",className:"ml-2 text-sm text-gray-900 flex items-center",children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),"Categor√≠a destacada"]})]}),e.jsx("p",{className:"text-xs text-gray-500 ml-6",children:"Las categor√≠as destacadas aparecen en secciones especiales"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6",children:e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsxs(S,{to:"/admin/categories",className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors flex items-center",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),e.jsxs("button",{type:"submit",disabled:C||h,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),C?"Guardando...":"Guardar Cambios"]})]})})]})]})};export{se as default};
//# sourceMappingURL=AdminEditCategoryPage-Dy8rdN1p.js.map
