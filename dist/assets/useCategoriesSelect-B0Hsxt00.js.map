{"version":3,"file":"useCategoriesSelect-B0Hsxt00.js","sources":["../../src/presentation/hooks/useCategoriesSelect.ts"],"sourcesContent":["import {useState, useEffect, useMemo} from \"react\";\r\nimport useCategories from \"./useCategories\";\r\n\r\n// Estructura para el menú desplegable de categorías\r\nexport interface CategoryOption {\r\n\tvalue: number;\r\n\tlabel: string;\r\n\tisSubcategory?: boolean;\r\n\tparentId?: number;\r\n}\r\n\r\n/**\r\n * Hook para obtener categorías formateadas para selectores\r\n * Con soporte para selección jerárquica de categorías y subcategorías\r\n */\r\nexport const useCategoriesSelect = () => {\r\n\tconst {categories, mainCategories, fetchCategories, fetchMainCategories} =\r\n\t\tuseCategories();\r\n\tconst [loading, setLoading] = useState<boolean>(true);\r\n\tconst [error, setError] = useState<string | null>(null);\r\n\tconst [selectedParentId, setSelectedParentId] = useState<number | null>(null);\r\n\r\n\t// Cargar categorías al inicializar\r\n\tuseEffect(() => {\r\n\t\tconst loadCategories = async () => {\r\n\t\t\tsetLoading(true);\r\n\t\t\ttry {\r\n\t\t\t\t// Cargar categorías principales con subcategorías\r\n\t\t\t\tawait fetchMainCategories(true);\r\n\t\t\t\t// También cargar todas las categorías para tener el listado completo\r\n\t\t\t\tawait fetchCategories(true);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tsetError(\r\n\t\t\t\t\terr instanceof Error ? err.message : \"Error al cargar categorías\"\r\n\t\t\t\t);\r\n\t\t\t} finally {\r\n\t\t\t\tsetLoading(false);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tloadCategories();\r\n\t}, [fetchCategories, fetchMainCategories]);\r\n\r\n\t// Opciones de categorías principales\r\n\tconst parentCategoryOptions = useMemo(() => {\r\n\t\tconst options: CategoryOption[] = [];\r\n\r\n\t\tmainCategories.forEach((category) => {\r\n\t\t\tif (category.id) {\r\n\t\t\t\toptions.push({\r\n\t\t\t\t\tvalue: category.id,\r\n\t\t\t\t\tlabel: category.name,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Agregar categorías que no tienen parent_id\r\n\t\tcategories.forEach((category) => {\r\n\t\t\tif (\r\n\t\t\t\tcategory.id &&\r\n\t\t\t\t!category.parent_id &&\r\n\t\t\t\t!options.some((option) => option.value === category.id)\r\n\t\t\t) {\r\n\t\t\t\toptions.push({\r\n\t\t\t\t\tvalue: category.id,\r\n\t\t\t\t\tlabel: category.name,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn options;\r\n\t}, [mainCategories, categories]);\r\n\r\n\t// Opciones de subcategorías filtradas por la categoría principal seleccionada\r\n\tconst subcategoryOptions = useMemo(() => {\r\n\t\tif (!selectedParentId) return [];\r\n\r\n\t\tconst options: CategoryOption[] = [];\r\n\r\n\t\t// Buscar en categorías principales para encontrar subcategorías\r\n\t\tconst parentCategory = mainCategories.find(\r\n\t\t\t(category) => category.id === selectedParentId\r\n\t\t);\r\n\r\n\t\tif (parentCategory && parentCategory.subcategories) {\r\n\t\t\tparentCategory.subcategories.forEach((subcategory) => {\r\n\t\t\t\tif (subcategory.id) {\r\n\t\t\t\t\toptions.push({\r\n\t\t\t\t\t\tvalue: subcategory.id,\r\n\t\t\t\t\t\tlabel: subcategory.name,\r\n\t\t\t\t\t\tisSubcategory: true,\r\n\t\t\t\t\t\tparentId: selectedParentId,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// También buscar en todas las categorías para asegurar\r\n\t\tcategories.forEach((category) => {\r\n\t\t\tif (\r\n\t\t\t\tcategory.id &&\r\n\t\t\t\tcategory.parent_id === selectedParentId &&\r\n\t\t\t\t!options.some((option) => option.value === category.id)\r\n\t\t\t) {\r\n\t\t\t\toptions.push({\r\n\t\t\t\t\tvalue: category.id,\r\n\t\t\t\t\tlabel: category.name,\r\n\t\t\t\t\tisSubcategory: true,\r\n\t\t\t\t\tparentId: selectedParentId,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn options;\r\n\t}, [selectedParentId, mainCategories, categories]);\r\n\r\n\t// Todas las opciones disponibles (para compatibilidad hacia atrás)\r\n\tconst allCategoryOptions = useMemo(() => {\r\n\t\treturn [...parentCategoryOptions, ...subcategoryOptions];\r\n\t}, [parentCategoryOptions, subcategoryOptions]);\r\n\r\n\treturn {\r\n\t\tloading,\r\n\t\terror,\r\n\t\tcategoryOptions: allCategoryOptions, // Para compatibilidad\r\n\t\tparentCategoryOptions,\r\n\t\tsubcategoryOptions,\r\n\t\tselectedParentId,\r\n\t\tsetSelectedParentId,\r\n\t};\r\n};\r\n\r\nexport default useCategoriesSelect;\r\n"],"names":["useCategoriesSelect","categories","mainCategories","fetchCategories","fetchMainCategories","useCategories","loading","setLoading","useState","error","setError","selectedParentId","setSelectedParentId","useEffect","err","parentCategoryOptions","useMemo","options","category","option","subcategoryOptions","parentCategory","subcategory","allCategoryOptions"],"mappings":"yFAeO,MAAMA,EAAsB,IAAM,CACxC,KAAM,CAAC,WAAAC,EAAY,eAAAC,EAAgB,gBAAAC,EAAiB,oBAAAC,CAAA,EACnDC,EAAc,EACT,CAACC,EAASC,CAAU,EAAIC,EAAAA,SAAkB,EAAI,EAC9C,CAACC,EAAOC,CAAQ,EAAIF,EAAAA,SAAwB,IAAI,EAChD,CAACG,EAAkBC,CAAmB,EAAIJ,EAAAA,SAAwB,IAAI,EAG5EK,EAAAA,UAAU,IAAM,EACQ,SAAY,CAClCN,EAAW,EAAI,EACX,GAAA,CAEH,MAAMH,EAAoB,EAAI,EAE9B,MAAMD,EAAgB,EAAI,QAClBW,EAAK,CACbJ,EACCI,aAAe,MAAQA,EAAI,QAAU,4BACtC,CAAA,QACC,CACDP,EAAW,EAAK,CAAA,CAElB,GAEe,CAAA,EACb,CAACJ,EAAiBC,CAAmB,CAAC,EAGnC,MAAAW,EAAwBC,EAAAA,QAAQ,IAAM,CAC3C,MAAMC,EAA4B,CAAC,EAEpB,OAAAf,EAAA,QAASgB,GAAa,CAChCA,EAAS,IACZD,EAAQ,KAAK,CACZ,MAAOC,EAAS,GAChB,MAAOA,EAAS,IAAA,CAChB,CACF,CACA,EAGUjB,EAAA,QAASiB,GAAa,CAE/BA,EAAS,IACT,CAACA,EAAS,WACV,CAACD,EAAQ,KAAME,GAAWA,EAAO,QAAUD,EAAS,EAAE,GAEtDD,EAAQ,KAAK,CACZ,MAAOC,EAAS,GAChB,MAAOA,EAAS,IAAA,CAChB,CACF,CACA,EAEMD,CAAA,EACL,CAACf,EAAgBD,CAAU,CAAC,EAGzBmB,EAAqBJ,EAAAA,QAAQ,IAAM,CACpC,GAAA,CAACL,EAAkB,MAAO,CAAC,EAE/B,MAAMM,EAA4B,CAAC,EAG7BI,EAAiBnB,EAAe,KACpCgB,GAAaA,EAAS,KAAOP,CAC/B,EAEI,OAAAU,GAAkBA,EAAe,eACrBA,EAAA,cAAc,QAASC,GAAgB,CACjDA,EAAY,IACfL,EAAQ,KAAK,CACZ,MAAOK,EAAY,GACnB,MAAOA,EAAY,KACnB,cAAe,GACf,SAAUX,CAAA,CACV,CACF,CACA,EAISV,EAAA,QAASiB,GAAa,CAE/BA,EAAS,IACTA,EAAS,YAAcP,GACvB,CAACM,EAAQ,KAAME,GAAWA,EAAO,QAAUD,EAAS,EAAE,GAEtDD,EAAQ,KAAK,CACZ,MAAOC,EAAS,GAChB,MAAOA,EAAS,KAChB,cAAe,GACf,SAAUP,CAAA,CACV,CACF,CACA,EAEMM,CACL,EAAA,CAACN,EAAkBT,EAAgBD,CAAU,CAAC,EAG3CsB,EAAqBP,EAAAA,QAAQ,IAC3B,CAAC,GAAGD,EAAuB,GAAGK,CAAkB,EACrD,CAACL,EAAuBK,CAAkB,CAAC,EAEvC,MAAA,CACN,QAAAd,EACA,MAAAG,EACA,gBAAiBc,EACjB,sBAAAR,EACA,mBAAAK,EACA,iBAAAT,EACA,oBAAAC,CACD,CACD"}