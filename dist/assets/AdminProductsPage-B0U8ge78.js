import{l as b,t as P,r as d,m as G,n as ne,v as ce,j as a,L as V,p as J,q as ie}from"./index-DmNDOrWy.js";import{T as le}from"./Table-BdEePeKQ.js";import{u as de}from"./useAdminCategories-D_zTNu7p.js";import{f as W}from"./formatCurrency-CXuiUHwQ.js";import{P as ue}from"./plus--kIPDPVf.js";import{R as ge}from"./refresh-cw-BOPCg90x.js";import{S as me}from"./search-CbEKe7UQ.js";import{F as pe}from"./funnel-CAFb7hhq.js";import{S as K}from"./star-DFFyFcok.js";import{T as he}from"./tag-z784mohN.js";import{E as fe}from"./eye-CldZNoIz.js";import{S as ye}from"./square-pen-CTS0gMbb.js";import{T as xe}from"./trash-2-DifnXJFx.js";import{A as X}from"./archive-kwnQLKWh.js";import"./chevron-left-Dl3DF2OO.js";import"./arrow-up-DQySjn32.js";class be{async getAllProducts(e){try{console.log("ðŸ“¤ AdminProductService: Obteniendo todos los productos como admin:",e);const o={...e};o&&"admin_view"in o&&delete o.admin_view;const r=await b.get(P.PRODUCTS.LIST,o);return console.log("ðŸ“¥ AdminProductService: Respuesta del servidor:",r),r}catch(o){return console.error("âŒ Error en AdminProductService.getAllProducts:",o),null}}async getProductById(e){try{return console.log(`ðŸ“¤ AdminProductService: Obteniendo producto ${e} como admin`),(await b.get(P.PRODUCTS.DETAILS(e)))?.data||null}catch(o){return console.error("âŒ Error en AdminProductService.getProductById:",o),null}}async createProduct(e,o){try{console.log("ðŸ“¤ AdminProductService: Creando producto como admin:",e);const r=new FormData;if(r.append("name",e.name),r.append("description",e.description),r.append("price",String(e.price)),r.append("stock",String(e.stock)),r.append("category_id",String(e.category_id)),o&&r.append("seller_id",String(o)),e.shortDescription&&r.append("short_description",e.shortDescription),e.weight!==void 0&&r.append("weight",String(e.weight)),e.width!==void 0&&r.append("width",String(e.width)),e.height!==void 0&&r.append("height",String(e.height)),e.depth!==void 0&&r.append("depth",String(e.depth)),e.dimensions&&r.append("dimensions",e.dimensions),e.sku&&r.append("sku",e.sku),e.status&&r.append("status",e.status),e.featured!==void 0&&r.append("featured",String(e.featured)),e.published!==void 0&&r.append("published",String(e.published)),e.discount_percentage!==void 0&&r.append("discount_percentage",String(e.discount_percentage)),e.colors){const g=typeof e.colors=="string"?e.colors:JSON.stringify(e.colors);r.append("colors",g)}if(e.sizes){const g=typeof e.sizes=="string"?e.sizes:JSON.stringify(e.sizes);r.append("sizes",g)}if(e.tags){const g=typeof e.tags=="string"?e.tags:JSON.stringify(e.tags);r.append("tags",g)}e.attributes&&Object.keys(e.attributes).length>0&&r.append("attributes",JSON.stringify(e.attributes)),e.images&&e.images.length>0&&e.images.forEach((g,j)=>{r.append(`images[${j}]`,g)});const h=await b.uploadFile(P.PRODUCTS.CREATE,r);return console.log("âœ… AdminProductService: Producto creado:",h),h}catch(r){return console.error("âŒ Error en AdminProductService.createProduct:",r),null}}async updateProduct(e){try{console.log(`ðŸ“¤ AdminProductService: Actualizando producto ${e.id} como admin:`,e);const o=new FormData;if(e.name&&o.append("name",e.name),e.description&&o.append("description",e.description),e.shortDescription&&o.append("short_description",e.shortDescription),e.price!==void 0&&o.append("price",String(e.price)),e.stock!==void 0&&o.append("stock",String(e.stock)),e.category_id&&o.append("category_id",String(e.category_id)),e.weight!==void 0&&o.append("weight",String(e.weight)),e.width!==void 0&&o.append("width",String(e.width)),e.height!==void 0&&o.append("height",String(e.height)),e.depth!==void 0&&o.append("depth",String(e.depth)),e.dimensions&&o.append("dimensions",e.dimensions),e.sku&&o.append("sku",e.sku),e.status&&o.append("status",e.status),e.featured!==void 0&&o.append("featured",String(e.featured)),e.published!==void 0&&o.append("published",String(e.published)),e.discount_percentage!==void 0&&o.append("discount_percentage",String(e.discount_percentage)),e.colors){const h=typeof e.colors=="string"?e.colors:JSON.stringify(e.colors);o.append("colors",h)}if(e.sizes){const h=typeof e.sizes=="string"?e.sizes:JSON.stringify(e.sizes);o.append("sizes",h)}if(e.tags){const h=typeof e.tags=="string"?e.tags:JSON.stringify(e.tags);o.append("tags",h)}e.attributes&&Object.keys(e.attributes).length>0&&o.append("attributes",JSON.stringify(e.attributes)),e.replace_images!==void 0&&o.append("replace_images",String(e.replace_images)),e.remove_images&&e.remove_images.length>0&&o.append("remove_images",JSON.stringify(e.remove_images)),e.images&&e.images.length>0&&e.images.forEach((h,g)=>{o.append(`images[${g}]`,h)});const r=await b.updateFile(P.PRODUCTS.UPDATE(e.id),o);return console.log("âœ… AdminProductService: Producto actualizado:",r),r}catch(o){return console.error("âŒ Error en AdminProductService.updateProduct:",o),null}}async deleteProduct(e){try{console.log(`ðŸ“¤ AdminProductService: Eliminando producto ${e} como admin`);const o=await b.delete(P.PRODUCTS.DELETE(e));return console.log("âœ… AdminProductService: Producto eliminado:",o),!0}catch(o){return console.error("âŒ Error en AdminProductService.deleteProduct:",o),!1}}async toggleFeatured(e,o){try{console.log(`ðŸ“¤ AdminProductService: Cambiando featured del producto ${e} a ${o}`);const r=await b.patch(P.PRODUCTS.UPDATE(e),{featured:o});return console.log("âœ… AdminProductService: Featured actualizado:",r),!0}catch(r){return console.error("âŒ Error en AdminProductService.toggleFeatured:",r),r instanceof Error&&console.error("Error message:",r.message),!1}}async togglePublished(e,o){try{console.log(`ðŸ“¤ AdminProductService: Cambiando published del producto ${e} a ${o}`);const r=await b.patch(P.PRODUCTS.UPDATE(e),{published:o});return console.log("âœ… AdminProductService: Published actualizado:",r),!0}catch(r){return console.error("âŒ Error en AdminProductService.togglePublished:",r),r instanceof Error&&console.error("Error message:",r.message),!1}}async updateStatus(e,o){try{console.log(`ðŸ“¤ AdminProductService: Cambiando status del producto ${e} a ${o}`);const r=await b.patch(P.PRODUCTS.UPDATE(e),{status:o});return console.log("âœ… AdminProductService: Status actualizado:",r),!0}catch(r){return console.error("âŒ Error en AdminProductService.updateStatus:",r),r instanceof Error&&console.error("Error message:",r.message),!1}}async getProductStats(){try{console.log("ðŸ“¤ AdminProductService: Obteniendo estadÃ­sticas de productos");const e=await b.get("/admin/products/stats");return console.log("âœ… AdminProductService: EstadÃ­sticas obtenidas:",e),e}catch(e){return console.error("âŒ Error en AdminProductService.getProductStats:",e),null}}async getProductsBySeller(e,o){try{console.log(`ðŸ“¤ AdminProductService: Obteniendo productos del vendedor ${e}`);const r=await b.get(P.PRODUCTS.BY_SELLER(e),o);return console.log("âœ… AdminProductService: Productos del vendedor obtenidos:",r),r}catch(r){return console.error("âŒ Error en AdminProductService.getProductsBySeller:",r),null}}}class Se{adminProductService;constructor(e){this.adminProductService=e}async execute(e){console.log("GetAllProductsUseCase: Obteniendo todos los productos como admin");try{const o=await this.adminProductService.getAllProducts(e);return console.log("GetAllProductsUseCase: Productos obtenidos correctamente:",o),o}catch(o){throw console.error("GetAllProductsUseCase: Error al obtener productos:",o),o}}}class ve{adminProductService;constructor(e){this.adminProductService=e}async execute(e,o){console.log("CreateProductAsAdminUseCase: Creando producto como admin:",e);try{const r=await this.adminProductService.createProduct(e,o);return console.log("CreateProductAsAdminUseCase: Producto creado correctamente:",r),r}catch(r){throw console.error("CreateProductAsAdminUseCase: Error al crear producto:",r),r}}}class Pe{adminProductService;constructor(e){this.adminProductService=e}async execute(e){console.log(`UpdateAnyProductUseCase: Actualizando producto ${e.id} como admin:`,e);try{const o=await this.adminProductService.updateProduct(e);return console.log("UpdateAnyProductUseCase: Producto actualizado correctamente:",o),o}catch(o){throw console.error("UpdateAnyProductUseCase: Error al actualizar producto:",o),o}}}class Ce{adminProductService;constructor(e){this.adminProductService=e}async execute(e){console.log(`DeleteAnyProductUseCase: Eliminando producto ${e} como admin`);try{const o=await this.adminProductService.deleteProduct(e);return console.log("DeleteAnyProductUseCase: Producto eliminado correctamente:",o),o}catch(o){throw console.error("DeleteAnyProductUseCase: Error al eliminar producto:",o),o}}}class we{adminProductService;constructor(e){this.adminProductService=e}async execute(e,o){console.log(`ToggleProductFeaturedUseCase: Cambiando featured del producto ${e} a ${o}`);try{const r=await this.adminProductService.toggleFeatured(e,o);return console.log("ToggleProductFeaturedUseCase: Featured actualizado correctamente:",r),r}catch(r){throw console.error("ToggleProductFeaturedUseCase: Error al cambiar featured:",r),r}}}class Ae{adminProductService;constructor(e){this.adminProductService=e}async execute(e,o){console.log(`ToggleProductPublishedUseCase: Cambiando published del producto ${e} a ${o}`);try{const r=await this.adminProductService.togglePublished(e,o);return console.log("ToggleProductPublishedUseCase: Published actualizado correctamente:",r),r}catch(r){throw console.error("ToggleProductPublishedUseCase: Error al cambiar published:",r),r}}}class Ee{adminProductService;constructor(e){this.adminProductService=e}async execute(e,o){console.log(`UpdateProductStatusUseCase: Cambiando status del producto ${e} a ${o}`);try{const r=await this.adminProductService.updateStatus(e,o);return console.log("UpdateProductStatusUseCase: Status actualizado correctamente:",r),r}catch(r){throw console.error("UpdateProductStatusUseCase: Error al cambiar status:",r),r}}}class je{adminProductService;constructor(e){this.adminProductService=e}async execute(e,o){console.log(`GetProductsBySellerUseCase: Obteniendo productos del vendedor ${e}`);try{const r=await this.adminProductService.getProductsBySeller(e,o);return console.log("GetProductsBySellerUseCase: Productos obtenidos correctamente:",r),r}catch(r){throw console.error("GetProductsBySellerUseCase: Error al obtener productos del vendedor:",r),r}}}class ke{adminProductService;constructor(e){this.adminProductService=e}async execute(){console.log("GetProductStatsUseCase: Obteniendo estadÃ­sticas de productos");try{const e=await this.adminProductService.getProductStats();return console.log("GetProductStatsUseCase: EstadÃ­sticas obtenidas correctamente:",e),e}catch(e){throw console.error("GetProductStatsUseCase: Error al obtener estadÃ­sticas:",e),e}}}const S=new be,Ne=new Se(S),Ue=new ve(S),_e=new Pe(S),$e=new Ce(S),De=new we(S),Te=new Ae(S),ze=new Ee(S),Oe=new je(S),Ie=new ke(S),Fe=u=>u?`admin_products_${JSON.stringify(u)}`:"admin_products_default",Re=()=>{const[u,e]=d.useState(!1),[o,r]=d.useState(null),[h,g]=d.useState([]),[j,$]=d.useState(null),[D,O]=d.useState(null),[T,C]=d.useState(null),f=d.useCallback(s=>{if(!s||typeof s!="object")return console.error("Producto invÃ¡lido para adaptar:",s),{};console.log("ðŸ”„ Adaptando producto desde API:",s);let c=[];s.main_image?c=[s.main_image]:Array.isArray(s.images)&&s.images.length>0?c=s.images.map(i=>typeof i=="string"?i:typeof i=="object"&&i!==null&&(i.original||i.large||i.medium||i.url||i.path)||"").filter(Boolean):s.image&&(c=[s.image]);let n=[];Array.isArray(s.tags)&&s.tags.forEach(i=>{if(typeof i=="string")try{const v=JSON.parse(i);Array.isArray(v)?n.push(...v):n.push(i)}catch{n.push(i)}});const l={id:s.id,userId:s.user_id,sellerId:s.seller_id,categoryId:s.category_id,name:s.name,slug:s.slug,description:s.description||"",shortDescription:s.short_description,price:Number(s.price||0),finalPrice:Number(s.final_price||s.price||0),stock:Number(s.stock||0),weight:s.weight,width:s.width,height:s.height,depth:s.depth,dimensions:s.dimensions,colors:s.colors,sizes:s.sizes,tags:n,sku:s.sku,attributes:s.attributes,images:c,featured:!!s.featured,published:!!(s.published??!0),status:s.status||"active",viewCount:s.view_count||0,salesCount:s.sales_count||0,discountPercentage:Number(s.discount_percentage||0),isInStock:!!(s.is_in_stock??s.stock>0),rating:Number(s.rating||0),ratingCount:Number(s.rating_count||0),createdAt:s.created_at,updatedAt:s.updated_at,category:s.category_name?{id:s.category_id,name:s.category_name}:s.category,seller:s.seller,user:s.user};return console.log("âœ… Producto adaptado:",{id:l.id,name:l.name,published:l.published,featured:l.featured,status:l.status,images:l.images,tags:l.tags}),l},[]),I=d.useCallback(async(s,c=!1)=>{e(!0),r(null);try{const n=Fe(s);if(!c){const i=G.getItem(n);if(i)return console.log("ðŸ’¾ useAdminProducts: Usando datos en cachÃ©"),g(i.data||[]),C(i.meta||null),e(!1),i}console.log("ðŸŒ useAdminProducts: Obteniendo productos desde API con filtros:",s);const l=await Ne.execute(s);if(console.log("ðŸ” RESPUESTA RAW DE LA API:",l),l){let i=[],v=null;l.data&&Array.isArray(l.data)?(console.log("ðŸ“¦ Respuesta contiene array en data, procesando productos..."),i=l.data.map(z=>(console.log("ðŸ”„ Procesando producto:",z),f(z))),v=l.meta):Array.isArray(l)?(console.log("ðŸ“¦ Respuesta es directamente un array"),i=l.map(f),v={total:l.length,limit:s?.limit||10,offset:s?.offset||0}):(console.warn("âš ï¸ Estructura de respuesta no reconocida:",l),i=[],v={total:0,limit:0,offset:0});const U={data:i,meta:v||{total:i.length,limit:s?.limit||10,offset:s?.offset||0}};return console.log("ðŸ’« Datos procesados:",{productCount:i.length,meta:U.meta,firstProductSample:i[0]?{id:i[0].id,name:i[0].name,published:i[0].published,featured:i[0].featured,images:i[0].images}:null}),G.setItem(n,U,ne.cache.productCacheTime),g(i),C(U.meta),U}else return console.warn("âš ï¸ Respuesta vacÃ­a de la API"),g([]),C({total:0,limit:0,offset:0}),{data:[],meta:{total:0,limit:0,offset:0}}}catch(n){const l=n instanceof Error?n.message:"Error al obtener productos";return console.error("âŒ Error obteniendo productos:",n),r(l),g([]),C({total:0,limit:0,offset:0}),null}finally{e(!1)}},[f]),k=d.useCallback(async s=>{e(!0),r(null);try{const c=await S.getProductById(s);return $(c),c}catch(c){const n=c instanceof Error?c.message:"Error al obtener producto";return r(n),$(null),null}finally{e(!1)}},[]),F=d.useCallback(async(s,c)=>{e(!0),r(null);try{const n=await Ue.execute(s,c);return n&&y(),n}catch(n){const l=n instanceof Error?n.message:"Error al crear producto";return r(l),null}finally{e(!1)}},[]),w=d.useCallback(async s=>{e(!0),r(null);try{const c=await _e.execute(s);return c&&(g(n=>n.map(l=>l.id===s.id?f(c):l)),y()),c}catch(c){const n=c instanceof Error?c.message:"Error al actualizar producto";return r(n),null}finally{e(!1)}},[f]),R=d.useCallback(async s=>{e(!0),r(null);try{const c=await $e.execute(s);return c&&(g(n=>n.filter(l=>l.id!==s)),y()),c}catch(c){const n=c instanceof Error?c.message:"Error al eliminar producto";return r(n),!1}finally{e(!1)}},[]),A=d.useCallback(async(s,c)=>{r(null);try{console.log(`ðŸŒŸ Cambiando featured del producto ${s} a ${c}`);const n=await De.execute(s,c);return n?(g(l=>l.map(i=>i.id===s?{...i,featured:c}:i)),y(),console.log(`âœ… Featured actualizado correctamente para producto ${s}`)):(console.error(`âŒ Error al actualizar featured para producto ${s}`),r("Error al cambiar estado destacado del producto")),n}catch(n){const l=n instanceof Error?n.message:"Error al cambiar estado destacado";return console.error("âŒ Error en toggleFeatured:",n),r(l),!1}},[]),B=d.useCallback(async(s,c)=>{r(null);try{console.log(`ðŸ“¢ Cambiando published del producto ${s} a ${c}`);const n=await Te.execute(s,c);return n?(g(l=>l.map(i=>i.id===s?{...i,published:c}:i)),y(),console.log(`âœ… Published actualizado correctamente para producto ${s}`)):(console.error(`âŒ Error al actualizar published para producto ${s}`),r("Error al cambiar estado de publicaciÃ³n del producto")),n}catch(n){const l=n instanceof Error?n.message:"Error al cambiar estado de publicaciÃ³n";return console.error("âŒ Error en togglePublished:",n),r(l),!1}},[]),N=d.useCallback(async(s,c)=>{r(null);try{console.log(`ðŸ”„ Cambiando status del producto ${s} a ${c}`);const n=await ze.execute(s,c);return n?(g(l=>l.map(i=>i.id===s?{...i,status:c}:i)),y(),console.log(`âœ… Status actualizado correctamente para producto ${s}`)):(console.error(`âŒ Error al actualizar status para producto ${s}`),r("Error al actualizar estado del producto")),n}catch(n){const l=n instanceof Error?n.message:"Error al actualizar estado";return console.error("âŒ Error en updateStatus:",n),r(l),!1}},[]),L=d.useCallback(async(s,c)=>{e(!0),r(null);try{const n=await Oe.execute(s,c);if(n&&Array.isArray(n.data)){const l=n.data.map(f);g(l),C(n.meta||null)}return n}catch(n){const l=n instanceof Error?n.message:"Error al obtener productos del vendedor";return r(l),null}finally{e(!1)}},[f]),E=d.useCallback(async()=>{e(!0),r(null);try{const s=await Ie.execute();return O(s),s}catch(s){const c=s instanceof Error?s.message:"Error al obtener estadÃ­sticas";return r(c),null}finally{e(!1)}},[]),y=d.useCallback(()=>{const c=Object.keys(localStorage).filter(n=>n.startsWith("admin_products_")||n.startsWith("product_")||n.startsWith("products_"));c.forEach(n=>{G.removeItem(n)}),console.log(`ðŸ—‘ï¸ ${c.length} claves de cachÃ© de productos de admin eliminadas`)},[]);return{loading:u,error:o,products:h,productDetail:j,stats:D,meta:T,fetchAllProducts:I,fetchProductById:k,createProduct:F,updateProduct:w,deleteProduct:R,toggleFeatured:A,togglePublished:B,updateStatus:N,fetchProductsBySeller:L,fetchProductStats:E,clearProductCache:y,setError:s=>r(s),setLoading:s=>e(s)}},Be=`data:image/svg+xml,${encodeURIComponent(`
<svg width="300" height="300" xmlns="http://www.w3.org/2000/svg">
  <rect width="300" height="300" fill="#e5e7eb"/>
  <text x="150" y="150" font-family="Arial, sans-serif" font-size="16" fill="#6b7280" text-anchor="middle" dy="0.3em">
    Sin imagen
  </text>
</svg>
`)}`,Le=`data:image/svg+xml,${encodeURIComponent(`
<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg">
  <rect width="100" height="100" fill="#f3f4f6"/>
  <text x="50" y="50" font-family="Arial, sans-serif" font-size="12" fill="#9ca3af" text-anchor="middle" dy="0.3em">
    Sin img
  </text>
</svg>
`)}`,Z={placeholder:Be,smallPlaceholder:Le};function _(u,e=!1){if(!u||u.trim()==="")return e?Z.smallPlaceholder:Z.placeholder;const o=u.trim();if(o.startsWith("http://")||o.startsWith("https://")||o.startsWith("data:"))return o;{let r=o;return r.startsWith("/storage/")?r=r.substring(9):r.startsWith("storage/")&&(r=r.substring(8)),`${ce.imageBaseUrl}${r}`}}function q(u,e=!1){if(!u)return _(null,e);if(u.main_image)return _(u.main_image,e);if(u.image)return _(u.image,e);if(u.images&&Array.isArray(u.images)&&u.images.length>0){const o=u.images[0];if(typeof o=="string")return _(o,e);if(typeof o=="object"&&o!==null){const r=o.original||o.large||o.medium||o.thumbnail||"";return _(r,e)}}return _(null,e)}const or=()=>{const{loading:u,error:e,products:o,meta:r,fetchAllProducts:h,deleteProduct:g,toggleFeatured:j,togglePublished:$,clearProductCache:D}=Re(),{loading:O,categories:T,fetchAllCategories:C}=de(),[f,I]=d.useState(0),[k,F]=d.useState("all"),[w,R]=d.useState("all"),[A,B]=d.useState(""),[N,L]=d.useState(1),[E]=d.useState(15),[y,s]=d.useState(null);d.useEffect(()=>{n(),c()},[]),d.useEffect(()=>{n()},[f,k,w,A,N]);const c=d.useCallback(async()=>{try{await C({with_counts:!0})}catch(t){console.error("Error al cargar categorÃ­as:",t)}},[C]),n=d.useCallback(async()=>{try{const t={limit:E,offset:(N-1)*E};switch(A&&(t.term=A),f&&f>0&&(t.categoryId=f),k){case"active":t.status="active",t.published=!0;break;case"draft":t.status="draft";break;case"inactive":t.published=!1;break}switch(w){case"inStock":t.inStock=!0;break;case"lowStock":t.inStock=!0;break;case"outOfStock":t.inStock=!1;break}console.log("ðŸ”§ AdminProductsPage: Cargando productos con filtros:",t),await h(t)}catch(t){console.error("Error al cargar productos:",t)}},[h,f,k,w,A,N,E]),l=d.useCallback(async(t,p)=>{if(window.confirm(`Â¿EstÃ¡s seguro de que deseas eliminar el producto "${p}"?`)){s(t);try{await g(t)?n():alert("Error al eliminar el producto")}catch(x){console.error("Error al eliminar producto:",x),alert("Error al eliminar el producto")}finally{s(null)}}},[g,n]),i=d.useCallback(async(t,p)=>{s(t);try{const m=!p;console.log(`ðŸŒŸ Toggling featured for product ${t}: ${p} -> ${m}`),await j(t,m)||alert("Error al cambiar estado destacado")}catch(m){console.error("Error al cambiar estado destacado:",m),alert("Error al cambiar estado destacado")}finally{s(null)}},[j]),v=d.useCallback(async(t,p)=>{s(t);try{const m=!p;console.log(`ðŸ“¢ Toggling published for product ${t}: ${p} -> ${m}`),await $(t,m)||alert("Error al cambiar estado de publicaciÃ³n")}catch(m){console.error("Error al cambiar estado de publicaciÃ³n:",m),alert("Error al cambiar estado de publicaciÃ³n")}finally{s(null)}},[$]),U=d.useCallback(()=>{D(),n()},[D,n]),z=d.useCallback(t=>{L(t)},[]),ee=t=>{if(!t)return"Sin categorÃ­a";const p=T.find(m=>m.id===t);return p?p.name:"CategorÃ­a desconocida"},re=({product:t})=>{const[p,m]=d.useState(q(t,!0)),[x,H]=d.useState(!1),[Q,Y]=d.useState(0);d.useEffect(()=>{m(q(t,!0)),H(!1),Y(0)},[t]);const oe=d.useCallback(()=>{if(console.warn(`Error cargando imagen para producto ${t.id}:`,p),Q>=2){console.warn(`Demasiados errores para producto ${t.id}, manteniendo placeholder`);return}Y(ae=>ae+1),x||(H(!0),m(q(null,!0)))},[p,x,Q,t.id]);return a.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-md bg-gray-200 flex items-center justify-center overflow-hidden",children:a.jsx("img",{src:p,alt:t.name,className:"h-10 w-10 object-cover",onError:oe,loading:"lazy"})})},te=o.filter(t=>w==="lowStock"?t.stock>0&&t.stock<=10:!0),se=[{key:"product",header:"Producto",sortable:!0,render:t=>a.jsxs("div",{className:"flex items-center",children:[a.jsx(re,{product:t}),a.jsxs("div",{className:"ml-4",children:[a.jsxs("div",{className:"text-sm font-medium text-gray-900 flex items-center",children:[t.name,t.featured&&a.jsx("span",{className:"ml-2",children:a.jsx(K,{className:"h-4 w-4 text-yellow-500 inline"})})]}),a.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",t.id," - SKU: ",t.sku||"N/A"]})]})]})},{key:"category",header:"CategorÃ­a",sortable:!0,render:t=>a.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[a.jsx(he,{className:"w-3 h-3 mr-1"}),ee(t.categoryId)]})},{key:"seller",header:"Vendedor",sortable:!0,render:t=>a.jsxs("div",{className:"text-sm",children:[a.jsx("div",{className:"font-medium text-gray-900",children:t.seller?.name||t.user?.name||"Usuario desconocido"}),a.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",t.sellerId||t.userId||"N/A"]})]})},{key:"price",header:"Precio",sortable:!0,render:t=>a.jsx("div",{children:t.discountPercentage&&t.discountPercentage>0?a.jsxs("div",{children:[a.jsx("span",{className:"text-gray-500 line-through text-xs mr-1",children:W(t.price)}),a.jsx("span",{className:"font-semibold text-green-600",children:W(t.finalPrice||t.price*(1-t.discountPercentage/100))}),a.jsxs("span",{className:"ml-1 bg-green-100 text-green-800 text-xs font-semibold px-1.5 py-0.5 rounded",children:["-",t.discountPercentage,"%"]})]}):a.jsx("span",{className:"font-semibold",children:W(t.price)})})},{key:"stock",header:"Stock",sortable:!0,render:t=>a.jsx("div",{children:t.stock===0?a.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:"Agotado"}):t.stock<=10?a.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[t.stock," unidades"]}):a.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[t.stock," unidades"]})})},{key:"status",header:"Estado",sortable:!0,render:t=>{let p="",m="",x=J;return t.published?t.status==="draft"?(p="bg-gray-100 text-gray-800",m="Borrador",x=X):t.status==="active"?(p="bg-green-100 text-green-800",m="Activo",x=J):(p="bg-red-100 text-red-800",m="Inactivo",x=X):(p="bg-yellow-100 text-yellow-800",m="No publicado",x=ie),a.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${p}`,children:[a.jsx(x,{className:"w-3 h-3 mr-1"}),m]})}},{key:"rating",header:"ValoraciÃ³n",sortable:!0,render:t=>a.jsx("div",{className:"flex items-center",children:(t.rating??0)>0?a.jsxs(a.Fragment,{children:[a.jsx(K,{className:"h-4 w-4 text-yellow-500 mr-1"}),a.jsx("span",{children:(t.rating??0).toFixed(1)}),a.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",t.ratingCount??0,")"]})]}):a.jsx("span",{className:"text-xs text-gray-500",children:"Sin valoraciones"})})},{key:"sales",header:"Ventas",sortable:!0,render:t=>a.jsxs("span",{children:[t.salesCount||0," uds."]})},{key:"actions",header:"Acciones",render:t=>a.jsxs("div",{className:"flex justify-end space-x-1",children:[a.jsx(V,{to:`/products/${t.id}`,target:"_blank",className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Ver en tienda",children:a.jsx(fe,{size:16})}),a.jsx(V,{to:`/admin/products/edit/${t.id}`,className:"p-1 text-yellow-600 hover:bg-yellow-100 rounded-md",title:"Editar producto",children:a.jsx(ye,{size:16})}),a.jsx("button",{onClick:()=>i(t.id,t.featured||!1),disabled:y===t.id,className:`p-1 rounded-md transition-colors ${t.featured?"text-yellow-500 hover:bg-yellow-100":"text-gray-600 hover:bg-gray-100"} ${y===t.id?"opacity-50 cursor-not-allowed":""}`,title:t.featured?"Quitar destacado":"Destacar producto",children:a.jsx(K,{size:16,className:t.featured?"fill-current":""})}),a.jsx("button",{onClick:()=>v(t.id,t.published||!1),disabled:y===t.id,className:`p-1 rounded-md transition-colors ${t.published?"text-green-600 hover:bg-green-100":"text-gray-600 hover:bg-gray-100"} ${y===t.id?"opacity-50 cursor-not-allowed":""}`,title:t.published?"Despublicar":"Publicar",children:a.jsx(J,{size:16})}),a.jsx("button",{onClick:()=>l(t.id,t.name),disabled:y===t.id,className:`p-1 text-red-600 hover:bg-red-100 rounded-md transition-colors ${y===t.id?"opacity-50 cursor-not-allowed":""}`,title:"Eliminar producto",children:a.jsx(xe,{size:16})})]})}],M=u||O;return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"GestiÃ³n de Productos"}),r&&a.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[r.total," productos encontrados"]})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsxs(V,{to:"/admin/products/create",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center",children:[a.jsx(ue,{className:"w-4 h-4 mr-2"}),"Nuevo Producto"]}),a.jsxs("button",{onClick:U,disabled:M,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center disabled:opacity-50",children:[a.jsx(ge,{size:16,className:`mr-2 ${M?"animate-spin":""}`}),"Actualizar"]})]})]}),e&&a.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:["Error: ",e]}),a.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(me,{className:"h-5 w-5 text-gray-500"}),a.jsx("input",{type:"text",placeholder:"Buscar productos...",value:A,onChange:t=>B(t.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1"})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(pe,{className:"h-5 w-5 text-gray-500"}),a.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1",value:f,onChange:t=>I(Number(t.target.value)),children:[a.jsx("option",{value:0,children:"Todas las categorÃ­as"}),T.map(t=>a.jsxs("option",{value:t.id,children:[t.name," (",t.product_count||0,")"]},t.id))]})]}),a.jsx("div",{className:"flex items-center space-x-2",children:a.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1",value:k,onChange:t=>F(t.target.value),children:[a.jsx("option",{value:"all",children:"Todos los Estados"}),a.jsx("option",{value:"active",children:"Activos"}),a.jsx("option",{value:"draft",children:"Borrador"}),a.jsx("option",{value:"inactive",children:"Inactivos"})]})}),a.jsx("div",{className:"flex items-center space-x-2",children:a.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500 flex-1",value:w,onChange:t=>R(t.target.value),children:[a.jsx("option",{value:"all",children:"Todo el Stock"}),a.jsx("option",{value:"inStock",children:"En stock"}),a.jsx("option",{value:"lowStock",children:"Stock bajo (â‰¤10)"}),a.jsx("option",{value:"outOfStock",children:"Sin stock"})]})})]})}),a.jsx(le,{data:te,columns:se,searchFields:[],loading:M,emptyMessage:"No se encontraron productos",pagination:{currentPage:N,totalPages:Math.ceil((r?.total||0)/E),totalItems:r?.total||0,itemsPerPage:E,onPageChange:z}})]})};export{or as default};
//# sourceMappingURL=AdminProductsPage-B0U8ge78.js.map
