import{l as T,t as z,j as e,r as x,d as U,k as m,u as V}from"./index-DmNDOrWy.js";import{u as I}from"./useCart-DylEmA2w.js";import{e as $}from"./errorHandler-ugMJT1nb.js";import{f as v}from"./formatCurrency-CXuiUHwQ.js";import{D as A}from"./DatafastService-mqZFUM13.js";class C{static getSellerIdFromCart(t){if(!t||!t.items||t.items.length===0)return null;const o=t.items[0];if(o.product){if(o.product.sellerId)return o.product.sellerId;if(o.product.seller_id)return o.product.seller_id;if(o.product.seller&&o.product.seller.id)return o.product.seller.id;if(o.product.user_id)return o.product.user_id}return console.warn("No se pudo obtener seller ID del carrito:",t),null}async processCheckout(t){try{console.log("CheckoutService: Procesando checkout",t);const o=await T.post(z.CHECKOUT.PROCESS,t);return console.log("CheckoutService: Respuesta de checkout",o),o}catch(o){console.error("CheckoutService: Error al procesar checkout:",o);const a=$(o,"Error al procesar el pago. Por favor, intenta de nuevo más tarde.");throw new Error(a)}}}const q=({content:n})=>e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"mb-4 text-gray-600",children:"Paga con Datafast!, ingresa los datos personales para pagar de forma rápida y segura."}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-[linear-gradient(to_right,_rgba(0,184,110,1)_0%,_rgba(0,77,112,1)_46%,_rgba(0,77,112,1)_100%)] border-purple-200 rounded-lg p-6",children:e.jsx("div",{className:"flex items-center justify-center mb-4 h-50",children:e.jsx("img",{src:"https://www.datafast.com.ec/images/logo.png",alt:"DeUna Logo",className:"h-20"})})}),n]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"1."}),' Haz clic en "Pagar con Datafast!"']}),e.jsxs("p",{children:[e.jsx("strong",{children:"2."})," Completa los datos de tu tarjeta de crédito o débito."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"3."})," Confirma tu compra al finalizar."]})]})]})}),W=()=>{const[n,t]=x.useState(!1),{cart:o}=I(),a=o?.total||0;return e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"mb-4 text-gray-600",children:"Paga con DeUna!, Genera el código qr y escanealo desde tu app para pagar de forma rápida y segura."}),n?e.jsx("div",{className:"mb-4 mx-auto",children:e.jsxs("div",{className:"bg-gradient-to-r from-[#2fd8a8] to-[#4d1d81] p-6 rounded-lg text-white",children:[e.jsx("div",{className:"w-24 h-24 mx-auto mb-4 bg-white rounded-full flex items-center justify-center",children:e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"DeUna!"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Pago con DeUna!"}),e.jsxs("p",{className:"text-purple-100 mb-4",children:["Monto a pagar: ",v(a)]}),e.jsx("div",{className:"bg-white/20 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"text-sm text-purple-100",children:"Conectando con DeUna!..."}),e.jsx("div",{className:"w-full bg-white/30 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-white h-2 rounded-full w-3/4 animate-pulse"})})]})}),e.jsx("button",{onClick:()=>t(!1),className:"bg-white/20 hover:bg-white/30 text-white font-medium py-2 px-4 rounded-md transition-colors",children:"Cancelar"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-[rgba(47,216,168)] border-purple-200 rounded-lg p-6",children:e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("img",{src:"https://deuna.app/assets/img/brand/logo-deuna.svg",alt:"DeUna Logo",className:"w-50 h-50"})})}),e.jsxs("button",{type:"button",onClick:()=>t(!0),className:"w-full bg-[#3f2b57] hover:bg-[#342843] text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-101 flex items-center justify-center",children:["Pagar con DeUna! - ",v(a)]})]}),e.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"1."}),' Haz clic en "Pagar con DeUna!"']}),e.jsxs("p",{children:[e.jsx("strong",{children:"2."})," Completa el pago con el QR"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"3."})," Confirma tu compra al finalizar."]})]})]})},B=({cart:n})=>{if(!n||n.items.length===0)return e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-gray-500",children:"No hay productos en el carrito"})});const o=n.items.reduce((l,g)=>{const u=g.product?.final_price??g.product?.price??g.price;return l+u*g.quantity},0),a=.15,p=o>50?0:5.99,d=o*a,h=o+d+p;return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Resumen del pedido"}),e.jsx("div",{className:"space-y-3 mb-4",children:n.items.map(l=>{const g=l.product?.final_price??l.product?.price??l.price,u=l.product?.price,y=u&&g<u;return e.jsxs("div",{className:"flex justify-between pb-3 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"font-medium text-gray-800 mr-2",children:[l.quantity,"x"]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm line-clamp-1",children:l.product?.name||`Producto ${l.productId}`}),y&&e.jsxs("div",{className:"flex items-center space-x-2 text-xs",children:[e.jsx("span",{className:"text-gray-400 line-through",children:v(u)}),e.jsxs("span",{className:"text-green-600 font-medium",children:[l.product?.discount_percentage,"% off"]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-medium text-gray-800",children:v(g*l.quantity)}),y&&e.jsx("div",{className:"text-xs text-gray-400 line-through",children:v(u*l.quantity)})]})]},l.id)})}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{children:v(o)})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"IVA (15%)"}),e.jsx("span",{children:v(d)})]}),e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Envío"}),e.jsx("span",{children:p===0?"Gratis":v(p)})]}),e.jsxs("div",{className:"flex justify-between pt-3 border-t border-gray-200 font-bold text-lg text-gray-800",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:v(h)})]})]})]})},H=({shippingInfo:n,errors:t,onChange:o})=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 mb-1",children:"Dirección *"}),e.jsx("input",{type:"text",id:"address",value:n.address,onChange:a=>o("address",a.target.value),className:`w-full px-4 py-2 border rounded-md focus:ring-primary-500 focus:border-primary-500 ${t.address?"border-red-500":"border-gray-300"}`,placeholder:"Calle, número, piso, etc."}),t.address&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:t.address})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700 mb-1",children:"Ciudad *"}),e.jsx("input",{type:"text",id:"city",value:n.city,onChange:a=>o("city",a.target.value),className:`w-full px-4 py-2 border rounded-md focus:ring-primary-500 focus:border-primary-500 ${t.city?"border-red-500":"border-gray-300"}`,placeholder:"Ciudad"}),t.city&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:t.city})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"state",className:"block text-sm font-medium text-gray-700 mb-1",children:"Provincia/Estado *"}),e.jsx("input",{type:"text",id:"state",value:n.state,onChange:a=>o("state",a.target.value),className:`w-full px-4 py-2 border rounded-md focus:ring-primary-500 focus:border-primary-500 ${t.state?"border-red-500":"border-gray-300"}`,placeholder:"Provincia o Estado"}),t.state&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:t.state})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"postal_code",className:"block text-sm font-medium text-gray-700 mb-1",children:"Código Postal *"}),e.jsx("input",{type:"text",id:"postal_code",value:n.postal_code,onChange:a=>o("postal_code",a.target.value),className:`w-full px-4 py-2 border rounded-md focus:ring-primary-500 focus:border-primary-500 ${t.postal_code?"border-red-500":"border-gray-300"}`,placeholder:"Código Postal"}),t.postal_code&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:t.postal_code})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"country",className:"block text-sm font-medium text-gray-700 mb-1",children:"País *"}),e.jsx("input",{type:"text",id:"country",value:n.country,onChange:a=>o("country",a.target.value),className:`w-full px-4 py-2 border rounded-md focus:ring-primary-500 focus:border-primary-500 ${t.country?"border-red-500":"border-gray-300"}`,placeholder:"País"}),t.country&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:t.country})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Teléfono *"}),e.jsx("input",{type:"tel",id:"phone",value:n.phone,onChange:a=>o("phone",a.target.value),className:`w-full px-4 py-2 border rounded-md focus:ring-primary-500 focus:border-primary-500 ${t.phone?"border-red-500":"border-gray-300"}`,placeholder:"Número de teléfono"}),t.phone&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:t.phone})]})]}),Q=()=>{const n=U(),{cart:t,clearCart:o,showNotification:a}=I(),p=new C,[d,h]=x.useState(!1),l=async()=>{if(!t||t.items.length===0){a(m.ERROR,"El carrito está vacío");return}h(!0);try{const g=C.getSellerIdFromCart(t);console.log("Seller ID obtenido para test:",g);const u={payment:{method:"credit_card",card_number:"4111111111111111",card_expiry:"12/25",card_cvc:"123"},shipping:{address:"Calle de Prueba 123",city:"Ciudad de Prueba",state:"Estado de Prueba",country:"País de Prueba",postal_code:"12345",phone:"123456789"},seller_id:g};console.log("Procesando checkout de prueba con datos:",u);const y=await p.processCheckout(u);if(y.status==="success")o(),a(m.SUCCESS,"¡Pedido de prueba completado con éxito!"),console.log("Detalles de la orden:",y.data),n("/orders");else throw new Error(y.message||"Error en el checkout de prueba")}catch(g){console.error("Error en el checkout de prueba:",g);const u=$(g,"Error en el checkout de prueba. Por favor, intenta de nuevo más tarde.");a(m.ERROR,u)}finally{h(!1)}};return e.jsxs("button",{onClick:l,disabled:d,className:"px-4 py-2 bg-yellow-500 text-white rounded-md hover:bg-yellow-600 transition-colors flex items-center disabled:opacity-50",children:[d?e.jsx("span",{className:"inline-block h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):null,"Prueba rápida de checkout"]})},G=({onSuccess:n,onError:t})=>{const o=U(),{cart:a,clearCart:p,showNotification:d}=I(),[h,l]=x.useState(!1),[g,u]=x.useState(!1),[y,b]=x.useState(null),[k,f]=x.useState(!1),[w,_]=x.useState(!1),[c,N]=x.useState({address:"Av. Test 123",city:"Quito",country:"EC",given_name:"Juan",middle_name:"Carlos",surname:"Pérez",phone:"0999999999",doc_id:"1234567890"}),S=new A,P=new C;x.useEffect(()=>()=>{const r=document.getElementById("datafast-widget-script");r&&r.remove()},[]);const j=(r,s)=>{N(i=>({...i,[r]:s}))},R=()=>{const r=["address","city","country","given_name","surname","phone","doc_id"];for(const s of r)if(!c[s]||c[s].trim()==="")return d(m.ERROR,`El campo ${s.replace("_"," ")} es obligatorio`),!1;return c.doc_id.length!==10||!/^\d+$/.test(c.doc_id)?(d(m.ERROR,"La cédula debe tener exactamente 10 dígitos"),!1):!0},D=async()=>{if(!a||a.items.length===0){d(m.ERROR,"El carrito está vacío");return}if(R()){l(!0);try{const r={shipping:{address:c.address,city:c.city,country:c.country.toUpperCase()},customer:{given_name:c.given_name,middle_name:c.middle_name,surname:c.surname,phone:c.phone,doc_id:c.doc_id}};console.log("Iniciando checkout con Datafast...",r);const s=await S.createCheckout(r);if(console.log("Respuesta del checkout:",s),s.success&&s.data)b(s.data),f(!1),u(!0),localStorage.setItem("datafast_transaction_id",s.data.transaction_id),d(m.SUCCESS,"Checkout creado. Preparando formulario de pago..."),setTimeout(()=>{s.data?F(s.data.checkout_id):d(m.ERROR,"Datos de checkout no disponibles")},100);else throw new Error(s.message||"Error al crear checkout")}catch(r){console.error("Error al iniciar pago con Datafast:",r);const s=r instanceof Error?r.message:"Error desconocido";d(m.ERROR,s),t?.(s)}finally{l(!1)}}},F=r=>{try{console.log("Cargando widget de Datafast...",r);const s=document.getElementById("datafast-widget-script");s&&s.remove(),window.wpwlOptions={onReady:function(){console.log("Widget de Datafast listo!"),_(!0),d(m.SUCCESS,"Formulario de pago cargado correctamente.")},style:"card",locale:"es",labels:{cvv:"CVV",cardHolder:"Nombre (igual que en la tarjeta)"}};const i=document.createElement("script");i.id="datafast-widget-script",i.src=`https://eu-test.oppwa.com/v1/paymentWidgets.js?checkoutId=${r}`,i.async=!0,i.onload=()=>{console.log("Script de widget cargado")},i.onerror=()=>{console.error("Error al cargar script del widget"),d(m.ERROR,"Error al cargar el formulario de pago")},document.head.appendChild(i)}catch(s){console.error("Error al configurar widget:",s),d(m.ERROR,"Error al configurar el formulario de pago")}},O=async()=>{if(!a||a.items.length===0){d(m.ERROR,"El carrito está vacío");return}if(R()){l(!0);try{console.log("Iniciando checkout de prueba completo...");const r=C.getSellerIdFromCart(a);console.log("Seller ID obtenido:",r);const s={payment:{method:"transfer"},shipping:{address:c.address||"Calle de Prueba 123",city:c.city||"Quito",state:c.country||"Pichincha",country:c.country||"Ecuador",postal_code:"170000",phone:c.phone||"0999999999"},seller_id:r};console.log("Procesando checkout de prueba:",s);const i=await P.processCheckout(s);if(i.status==="success")p(),u(!1),f(!1),d(m.SUCCESS,"¡Pedido de prueba completado con éxito!"),console.log("Detalles de la orden de prueba:",i.data),n?.(i.data),o("/orders");else throw new Error(i.message||"Error en el checkout de prueba")}catch(r){console.error("Error en el checkout de prueba completo:",r);const s=r instanceof Error?r.message:"Error al procesar el checkout de prueba";d(m.ERROR,s),t?.(s)}finally{l(!1)}}},M=async()=>{if(!y){d(m.ERROR,"No hay datos de checkout");return}l(!0);try{console.log("Simulando pago exitoso completo...");const r=await S.simulateSuccessfulPayment(y.checkout_id,y.transaction_id);if(console.log("Respuesta de verificación Datafast:",r),r.success&&r.data){console.log("Procesando checkout completo en el sistema...");const s=C.getSellerIdFromCart(a);console.log("Seller ID obtenido:",s);const i={payment:{method:"transfer"},shipping:{address:c.address,city:c.city,state:c.country,country:c.country,postal_code:"00000",phone:c.phone},seller_id:s},E=await P.processCheckout(i);if(console.log("Respuesta del checkout completo:",E),E.status==="success")p(),u(!1),d(m.SUCCESS,"¡Pago y pedido completados exitosamente!"),console.log("Detalles completos de la orden:",{datafast:r.data,checkout:E.data}),n?.(E.data),o("/orders");else throw new Error(E.message||"Error al procesar el checkout completo")}else throw new Error(r.message||"Error en la simulación de Datafast")}catch(r){console.error("Error en la simulación completa:",r);const s=r instanceof Error?r.message:"Error al procesar la simulación completa";d(m.ERROR,s),t?.(s)}finally{l(!1)}},L=()=>{d(m.INFO,"Complete los datos de su tarjeta en el formulario y haga clic en 'Pagar'. Nota: En Fase 1, las transacciones son simuladas.")};return g?e.jsx("div",{className:"datafast-payment-widget",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Pagar con Datafast"}),e.jsxs("div",{className:"mb-4 p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-blue-800",children:"Información del pedido:"}),e.jsxs("p",{className:"text-blue-700",children:["Monto: $",y?.amount]}),e.jsxs("p",{className:"text-blue-700",children:["ID: ",y?.transaction_id]})]}),e.jsx("div",{className:"min-h-[400px] border border-gray-200 rounded-lg p-4",children:e.jsx("form",{action:`${window.location.origin}/datafast-result`,className:"paymentWidgets","data-brands":"VISA MASTER AMEX DINERS DISCOVER",children:!w&&e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Cargando formulario de pago..."})]})})})}),e.jsxs("div",{className:"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"Datos de prueba para usar:"}),e.jsxs("div",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tarjeta:"})," 4200 0000 0000 0000"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," 12/25"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"CVV:"})," 123"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Titular:"})," ",c.given_name," ",c.surname]})]})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("button",{onClick:L,disabled:!w,className:"bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-md transition-colors disabled:opacity-50",children:"Pago Real"}),e.jsx("button",{onClick:M,disabled:h,className:"bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition-colors disabled:opacity-50",children:h?"Verificando...":"Simular Pago Exitoso"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("button",{onClick:O,disabled:h,className:"w-full bg-yellow-500 hover:bg-yellow-600 text-white font-medium py-3 px-4 rounded-md transition-colors disabled:opacity-50 flex items-center justify-center",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Procesando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Prueba Completa de Checkout"]})}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"Simula el proceso completo de checkout como el botón de prueba original"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:()=>{u(!1),f(!0),_(!1);const r=document.getElementById("datafast-widget-script");r&&r.remove()},disabled:h,className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors",children:"Volver"})})]})]})}):k?e.jsx("div",{className:"datafast-form",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Información para Datafast"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre *"}),e.jsx("input",{type:"text",value:c.given_name,onChange:r=>j("given_name",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Segundo Nombre"}),e.jsx("input",{type:"text",value:c.middle_name,onChange:r=>j("middle_name",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Apellido *"}),e.jsx("input",{type:"text",value:c.surname,onChange:r=>j("surname",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teléfono *"}),e.jsx("input",{type:"text",value:c.phone,onChange:r=>j("phone",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500",placeholder:"0999999999"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cédula/ID * (10 dígitos)"}),e.jsx("input",{type:"text",value:c.doc_id,onChange:r=>{const s=r.target.value.replace(/\D/g,"").slice(0,10);j("doc_id",s)},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500",placeholder:"1234567890",maxLength:10})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dirección *"}),e.jsx("input",{type:"text",value:c.address,onChange:r=>j("address",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ciudad *"}),e.jsx("input",{type:"text",value:c.city,onChange:r=>j("city",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"País *"}),e.jsxs("select",{value:c.country,onChange:r=>j("country",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"EC",children:"Ecuador"}),e.jsx("option",{value:"CO",children:"Colombia"}),e.jsx("option",{value:"PE",children:"Perú"}),e.jsx("option",{value:"US",children:"Estados Unidos"})]})]})]}),e.jsxs("div",{className:"mt-6 flex gap-4",children:[e.jsx("button",{onClick:D,disabled:h,className:"flex-1 bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-md transition-colors disabled:opacity-50 flex items-center justify-center",children:h?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creando checkout..."]}):"Continuar con Datafast"}),e.jsx("button",{onClick:()=>f(!1),disabled:h,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors",children:"Cancelar"})]})]})}):e.jsxs("div",{className:"datafast-payment-button",children:[e.jsxs("button",{onClick:()=>f(!0),disabled:h||!a||a.items.length===0,className:"w-full transition-all duration-200 transform hover:scale-101 bg-[#003c58] border-1 hover:bg-[#00B86E] text-white font-medium py-3 px-4 rounded-md disabled:opacity-50 flex items-center justify-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),"Pagar con Datafast"]}),(!a||a.items.length===0)&&e.jsx("p",{className:"mt-2 text-sm text-gray-500 text-center",children:"Agrega productos al carrito para continuar"})]})},ee=()=>{const n=U(),{cart:t,clearCart:o,showNotification:a}=I(),{user:p}=V(),[d,h]=x.useState(!1),[l,g]=x.useState("credit_card"),[u,y]=x.useState({address:"",city:"",state:"",country:"",postal_code:"",phone:""}),[b,k]=x.useState({method:"credit_card",card_number:"",card_expiry:"",card_cvc:""}),[f,w]=x.useState({}),[_,c]=x.useState(!1),[N,S]=x.useState(null),P=new C;x.useEffect(()=>{p&&y({address:p.address||"",city:p.city||"",state:p.state||p.province||"",country:p.country||"Ecuador",postal_code:p.postal_code||p.zip_code||"",phone:p.phone||""})},[p]);const j=r=>{console.log("Pago exitoso:",r)},R=r=>{console.error("Error:",r)};x.useEffect(()=>{(!t||t.items.length===0)&&(a(m.ERROR,"El carrito está vacío"),n("/cart"))},[t,n,a]);const D=r=>{g(r),k({...b,method:r==="deuna"?"transfer":r})},F=(r,s)=>{if(y({...u,[r]:s}),s.trim()&&f[r]){const i={...f};delete i[r],w(i)}},O=(r,s)=>{if(k({...b,[r]:s}),s.trim()&&f[r]){const i={...f};delete i[r],w(i)}},M=()=>{const r={};return["address","city","state","country","postal_code","phone"].forEach(i=>{u[i]||(r[i]=`El campo ${i.replace("_"," ")} es obligatorio`)}),l==="credit_card"&&(b.card_number?/^\d{16}$/.test(b.card_number||"")||(r.card_number="El número de tarjeta debe tener 16 dígitos"):r.card_number="El número de tarjeta es obligatorio",b.card_expiry?/^\d{2}\/\d{2}$/.test(b.card_expiry||"")||(r.card_expiry="El formato debe ser MM/YY"):r.card_expiry="La fecha de expiración es obligatoria",b.card_cvc?/^\d{3,4}$/.test(b.card_cvc||"")||(r.card_cvc="El código debe tener 3 o 4 dígitos"):r.card_cvc="El código de seguridad es obligatorio"),w(r),Object.keys(r).length===0},L=async()=>{if(!M()){a(m.ERROR,"Por favor, completa todos los campos obligatorios");return}h(!0);try{const r={payment:{...b,method:l==="deuna"?"transfer":l},shipping:u};console.log("Procesando checkout con datos:",r);const s=await P.processCheckout(r);if(s.status==="success")c(!0),S(s.data),a(m.SUCCESS,"¡Pedido completado con éxito!"),o();else throw new Error(s.message||"Error al procesar el pedido")}catch(r){console.error("Error al procesar checkout:",r);const s=$(r,"Error al procesar el pago. Por favor, intenta de nuevo más tarde.");a(m.ERROR,s)}finally{h(!1)}};return _&&N?e.jsx("div",{className:"container mx-auto px-4 py-10",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-3xl mx-auto",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-4",children:"¡Pedido realizado con éxito!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Tu pedido ha sido procesado correctamente. Hemos enviado un correo electrónico con los detalles."})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 pb-2 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Detalles del pedido:"}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{className:"text-gray-600",children:"Número de orden:"}),e.jsx("span",{className:"font-medium",children:N.order_number})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{className:"text-gray-600",children:"Total:"}),e.jsx("span",{className:"font-medium",children:N.total})]}),e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("span",{className:"text-gray-600",children:"Estado del pago:"}),e.jsx("span",{className:`font-medium ${N.payment_status==="paid"?"text-green-600":"text-yellow-600"}`,children:N.payment_status==="paid"?"Pagado":N.payment_status})]})]}),e.jsxs("div",{className:"flex justify-center space-x-4 mt-6",children:[e.jsx("button",{onClick:()=>n("/"),className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Volver a la tienda"}),e.jsx("button",{onClick:()=>n("/orders"),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Ver mis pedidos"})]})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Finalizar compra"}),e.jsx(Q,{})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsxs("div",{className:"lg:w-2/3",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Información de facturación y envío"}),e.jsx(H,{shippingInfo:u,errors:f,onChange:F})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Método de pago"}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsxs("button",{type:"button",onClick:()=>D("credit_card"),className:`flex items-center border rounded-lg px-4 py-3 ${l==="credit_card"?"border-primary-600 bg-primary-50 text-primary-600":"border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("span",{className:"mr-2",children:"💳"}),e.jsx("span",{children:"Tarjeta de crédito"})]}),e.jsxs("button",{type:"button",onClick:()=>D("deuna"),className:`flex items-center border rounded-lg px-4 py-3 ${l==="deuna"?"border-primary-600 bg-primary-50 text-primary-600":"border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("span",{className:"mr-2",children:"🚀"}),e.jsx("span",{children:"Pago con DeUna!"})]})]}),l==="credit_card"&&e.jsx(q,{paymentInfo:b,errors:f,onChange:O,content:e.jsx(G,{onSuccess:j,onError:R})}),l==="deuna"&&e.jsx(W,{})]})]}),e.jsx("div",{className:"lg:w-1/3",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 sticky top-24",children:[e.jsx(B,{cart:t}),e.jsx("button",{onClick:L,disabled:d,className:"mt-6 w-full bg-primary-600 hover:bg-primary-700 text-white font-medium py-3 px-4 rounded-md transition-colors disabled:opacity-50 flex items-center justify-center",children:d?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Procesando..."]}):"Finalizar compra"}),e.jsxs("p",{className:"mt-4 text-xs text-gray-500 text-center",children:['Al hacer clic en "Finalizar compra", aceptas nuestros'," ",e.jsx("a",{href:"/terms",className:"text-primary-600 hover:underline",children:"Términos y condiciones"})," ","y"," ",e.jsx("a",{href:"/privacy",className:"text-primary-600 hover:underline",children:"Política de privacidad"}),"."]})]})})]})]})};export{ee as default};
//# sourceMappingURL=CheckoutPage-DhkLJWl0.js.map
