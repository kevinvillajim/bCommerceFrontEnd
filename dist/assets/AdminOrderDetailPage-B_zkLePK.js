import{j as e,a0 as f,s as k,G as C,I as U,c as F,a3 as N,e as E,R as L,H as q,P as B,r as R,h as H,an as $}from"./ui-vendor-BUNMIuFe.js";import{d as X,u as J,r,L as K}from"./react-vendor-Cy458wKG.js";import{f as l,k as Q}from"./admin-chunk-BNcFjXlJ.js";import{O as D}from"./OrderStatusBadge-CiQIj6sS.js";const se=()=>{const{id:m}=X(),x=J(),[z,n]=r.useState(!0),[s,p]=r.useState(null),[b,h]=r.useState(null),u=new Q,[I,g]=r.useState(!1),[d,y]=r.useState(""),[v,w]=r.useState(!1),[O,j]=r.useState(!1),[i,c]=r.useState({tracking_number:"",shipping_company:"",estimated_delivery:"",notes:""}),[_,S]=r.useState(!1);r.useEffect(()=>{if(!m)return;(async()=>{n(!0),h(null);try{const t=await u.getOrderDetails(parseInt(m));t?p(t):h("No se pudo obtener la información de la orden")}catch(t){console.error("Error al obtener detalles de la orden:",t),h("Error al cargar los detalles de la orden")}finally{n(!1)}})()},[m]);const A=[{value:"pending",label:"Pendiente"},{value:"processing",label:"En proceso"},{value:"paid",label:"Pagado"},{value:"shipped",label:"Enviado"},{value:"delivered",label:"Entregado"},{value:"completed",label:"Completado"},{value:"cancelled",label:"Cancelado"}],o=a=>{if(!a)return"N/A";const t=new Date(a);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)},P=async()=>{if(!(!d||!s)){w(!0);try{await u.updateOrderStatus(s.id,d)?(p({...s,status:d,updatedAt:new Date().toISOString()}),g(!1)):alert("Error al actualizar el estado de la orden")}catch(a){console.error("Error al actualizar estado:",a),alert("Error al actualizar el estado de la orden")}finally{w(!1)}}},T=async()=>{if(s){S(!0);try{alert("Funcionalidad aún no implementada"),j(!1)}catch(a){console.error("Error al actualizar información de envío:",a),alert("Error al actualizar la información de envío")}finally{S(!1)}}},M=async()=>{if(s&&window.confirm("¿Estás seguro de que deseas cancelar este pedido?")){n(!0);try{await u.cancelOrder(s.id)?p({...s,status:"cancelled",updatedAt:new Date().toISOString()}):alert("Error al cancelar la orden")}catch(a){console.error("Error al cancelar orden:",a),alert("Error al cancelar la orden")}finally{n(!1)}}};if(z)return e.jsx("div",{className:"p-6 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})});if(b)return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",children:[e.jsx("strong",{className:"font-bold",children:"Error!"}),e.jsxs("span",{className:"block sm:inline",children:[" ",b]})]}),e.jsxs("button",{onClick:()=>x("/admin/orders"),className:"flex items-center text-primary-600 hover:text-primary-800",children:[e.jsx(f,{className:"mr-2",size:16}),"Volver a la lista de pedidos"]})]});if(!s)return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded relative mb-4",children:[e.jsx("strong",{className:"font-bold",children:"No encontrado."}),e.jsxs("span",{className:"block sm:inline",children:[" ","No se encontró la orden solicitada."]})]}),e.jsxs("button",{onClick:()=>x("/admin/orders"),className:"flex items-center text-primary-600 hover:text-primary-800",children:[e.jsx(f,{className:"mr-2",size:16}),"Volver a la lista de pedidos"]})]});const V=!["cancelled","completed"].includes(s.status),G=["pending","processing","paid"].includes(s.status);return e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("button",{onClick:()=>x("/admin/orders"),className:"flex items-center text-primary-600 hover:text-primary-800",children:[e.jsx(f,{className:"mr-2",size:16}),"Volver a la lista de pedidos"]}),e.jsxs("h1",{className:"text-2xl font-bold",children:["Pedido ",s.orderNumber||`#${s.id}`]}),e.jsxs("div",{className:"flex space-x-2",children:[V&&e.jsxs("button",{onClick:()=>{y(s.status),g(!0)},className:"flex items-center px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:[e.jsx(k,{size:16,className:"mr-2"}),"Cambiar Estado"]}),G&&e.jsxs("button",{onClick:M,className:"flex items-center px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:[e.jsx(C,{size:16,className:"mr-2"}),"Cancelar"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Información General"}),e.jsx(D,{status:s.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"Fecha del pedido:"})]}),e.jsx("p",{className:"text-gray-900",children:o(s.date||s.createdAt)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"Última actualización:"})]}),e.jsx("p",{className:"text-gray-900",children:o(s.updatedAt)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"Método de pago:"})]}),e.jsx("p",{className:"text-gray-900",children:s.paymentMethod||"No especificado"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm",children:"Estado de pago:"})]}),e.jsx("p",{className:"text-gray-900",children:e.jsx(D,{status:s.paymentStatus,type:"payment"})})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Productos"}),e.jsx("div",{className:"space-y-4",children:s.items&&s.items.map(a=>e.jsxs("div",{className:"flex border-b border-gray-200 pb-4 last:border-0 last:pb-0",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-md overflow-hidden flex-shrink-0",children:a.image?e.jsx("img",{src:a.image,alt:a.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(E,{className:"w-8 h-8 text-gray-400"})})}),e.jsx("div",{className:"ml-4 flex-grow",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",a.productId]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[l(a.price)," x ",a.quantity]}),e.jsx("p",{className:"text-sm font-bold text-gray-900",children:l(a.subtotal)})]})]})})]},a.id))}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),e.jsx("span",{className:"font-medium text-gray-900",children:l(s.items.reduce((a,t)=>a+(t.subtotal||0),0))})]}),(s.seller_discount_savings>0||s.volume_discount_savings>0||s.feedback_discount_amount>0)&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Descuentos Aplicados:"}),s.seller_discount_savings>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-600",children:"Descuento del vendedor:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["-",l(s.seller_discount_savings)]})]}),s.volume_discount_savings>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-green-600",children:"Descuento por volumen:"}),e.jsxs("span",{className:"font-medium text-green-600",children:["-",l(s.volume_discount_savings)]})]}),s.feedback_discount_amount>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-green-600",children:["Código: ",s.feedback_discount_code||"N/A"]}),e.jsxs("span",{className:"font-medium text-green-600",children:["-",l(s.feedback_discount_amount)]})]}),s.total_discounts>0&&e.jsxs("div",{className:"flex justify-between text-sm font-medium mt-1 pt-1 border-t border-green-200",children:[e.jsx("span",{className:"text-green-700",children:"Total ahorros:"}),e.jsxs("span",{className:"text-green-700",children:["-",l(s.total_discounts)]})]})]}),e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-gray-600",children:"IVA (15%):"}),e.jsx("span",{className:"font-medium text-gray-900",children:l(s.iva_amount||0)})]}),s.shipping_cost>0&&e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-gray-600",children:"Envío:"}),e.jsx("span",{className:"font-medium text-gray-900",children:l(s.shipping_cost)})]}),s.free_shipping&&e.jsxs("div",{className:"flex justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-green-600",children:"Envío gratuito:"}),e.jsx("span",{className:"font-medium text-green-600",children:"¡Gratis!"})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg mt-2",children:[e.jsx("span",{children:"Total:"}),e.jsx("span",{children:l(s.total)})]})]})]}),s.history&&s.history.length>0&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Historial de la Orden"}),e.jsx("div",{className:"space-y-3",children:s.history.map((a,t)=>e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex-shrink-0 h-6 w-6 rounded-full bg-blue-100 flex items-center justify-center text-blue-500",children:[a.status==="created"&&e.jsx(E,{size:12}),a.status==="paid"&&e.jsx(N,{size:12}),a.status==="processing"&&e.jsx(L,{size:12}),a.status==="shipped"&&e.jsx(q,{size:12}),a.status==="delivered"&&e.jsx(B,{size:12}),a.status==="completed"&&e.jsx(R,{size:12}),a.status==="cancelled"&&e.jsx(C,{size:12})]}),e.jsxs("div",{className:"ml-3",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[a.status==="created"&&"Orden creada",a.status==="paid"&&"Pago realizado",a.status==="processing"&&"Procesando orden",a.status==="shipped"&&"Orden enviada",a.status==="delivered"&&"Orden entregada",a.status==="completed"&&"Orden completada",a.status==="cancelled"&&"Orden cancelada"]}),e.jsx("p",{className:"text-xs text-gray-500",children:o(a.timestamp)}),a.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.description})]})]},t))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Cliente"}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx(H,{className:"w-6 h-6 text-gray-500"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.customer?.name||"Cliente"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ID: ",s.customer?.id||s.userId]})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:"Email:"})," ",s.customer?.email||"No disponible"]}),s.customer?.phone&&e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:"Teléfono:"})," ",s.customer.phone]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Vendedor"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:"ID:"})," ",s.seller?.id||s.sellerId||"No disponible"]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("strong",{children:"Nombre:"})," ",s.seller?.name||"Vendedor"]})]}),(s.seller?.id||s.sellerId)&&e.jsx(K,{to:`/admin/sellers/${s.seller?.id||s.sellerId}`,className:"mt-3 inline-flex items-center text-sm text-primary-600 hover:text-primary-800",children:"Ver detalles del vendedor"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Información de Envío"}),e.jsxs("button",{onClick:()=>j(!0),className:"text-sm text-primary-600 hover:text-primary-800",children:[e.jsx(k,{size:14,className:"inline mr-1"}),"Editar"]})]}),s.shippingData?e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"text-gray-600 flex items-start",children:[e.jsx($,{className:"w-4 h-4 mr-2 mt-0.5 flex-shrink-0"}),e.jsxs("span",{children:[s.shippingData.address,",",e.jsx("br",{}),s.shippingData.city,","," ",s.shippingData.state,e.jsx("br",{}),s.shippingData.postalCode,","," ",s.shippingData.country]})]}),s.shippingData.phone&&e.jsxs("p",{className:"text-gray-600 mt-2",children:[e.jsx("strong",{children:"Teléfono:"})," ",s.shippingData.phone]}),s.shippingData.tracking_number&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsx("p",{className:"text-gray-600",children:e.jsx("strong",{children:"Número de seguimiento:"})}),e.jsx("p",{className:"font-mono bg-gray-100 px-2 py-1 rounded mt-1",children:s.shippingData.tracking_number})]}),s.shippingData.shipping_company&&e.jsxs("p",{className:"text-gray-600 mt-2",children:[e.jsx("strong",{children:"Transportista:"})," ",s.shippingData.shipping_company]}),s.shippingData.estimated_delivery&&e.jsxs("p",{className:"text-gray-600 mt-2",children:[e.jsx("strong",{children:"Entrega estimada:"})," ",o(s.shippingData.estimated_delivery)]})]}):e.jsx("div",{className:"text-gray-500 text-sm",children:"No hay información de envío disponible."})]})]})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Cambiar Estado del Pedido"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nuevo Estado"}),e.jsx("select",{value:d,onChange:a=>y(a.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",children:A.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>g(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100",children:"Cancelar"}),e.jsx("button",{onClick:P,disabled:v,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:v?"Actualizando...":"Guardar"})]})]})}),O&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Editar Información de Envío"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Número de Seguimiento"}),e.jsx("input",{type:"text",value:i.tracking_number,onChange:a=>c({...i,tracking_number:a.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Empresa de Transporte"}),e.jsx("input",{type:"text",value:i.shipping_company,onChange:a=>c({...i,shipping_company:a.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha Estimada de Entrega"}),e.jsx("input",{type:"date",value:i.estimated_delivery,onChange:a=>c({...i,estimated_delivery:a.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notas"}),e.jsx("textarea",{value:i.notes,onChange:a=>c({...i,notes:a.target.value}),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",rows:3})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>j(!1),className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100",children:"Cancelar"}),e.jsx("button",{onClick:T,disabled:_,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:_?"Actualizando...":"Guardar"})]})]})})]})};export{se as default};
//# sourceMappingURL=AdminOrderDetailPage-B_zkLePK.js.map
