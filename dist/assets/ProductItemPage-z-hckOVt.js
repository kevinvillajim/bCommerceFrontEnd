import{h as L,d as M,r as n,j as e,L as m,i as V,k as o,l as q}from"./index-DmNDOrWy.js";import{g as y}from"./imageUtils-B2iUz1H0.js";import{u as W}from"./useCart-DylEmA2w.js";import{u as G}from"./useFavorites-T3Y-P3Fr.js";import{u as H}from"./useChat-CTw3ZN82.js";import{L as K}from"./loader-DQksLurc.js";import{M as B}from"./minus-B_L9SZVF.js";import{P as J}from"./plus--kIPDPVf.js";import{S as Q}from"./shopping-cart-Ck1So-LU.js";import{H as X}from"./heart-DBtNcst0.js";import{M as Y}from"./message-square-C6QrtgNg.js";import{T as Z}from"./truck-DP84WB3Y.js";import{S as ee}from"./shield-C7SSAF2o.js";import{R as re}from"./rotate-ccw-CNCWbRSg.js";import{S as se}from"./share-2-CsgWKixZ.js";import{S as ae}from"./star-DFFyFcok.js";import"./errorHandler-ugMJT1nb.js";const ve=()=>{const{id:c}=L(),j=M(),[r,k]=n.useState(null),[S,N]=n.useState(!0),[v,b]=n.useState(null),[l,R]=n.useState(1),[w,A]=n.useState(0),[d,x]=n.useState("description"),{addToCart:I,showNotification:i}=W(),{toggleFavorite:F}=G(),{createChat:z}=H(),_=new V;n.useEffect(()=>{(async()=>{if(c)try{N(!0),b(null);const a=parseInt(c),t=await _.getProductById(a);console.log("Product data from API:",t),k(t),_.trackProductView(a).catch(P=>console.error("Error tracking product view:",P))}catch(a){console.error("Error fetching product:",a),b("No se pudo cargar el producto. Por favor, intente nuevamente.")}finally{N(!1)}})()},[c]);const g=s=>{s>=1&&s<=10&&R(s)},D=async()=>{if(!r){i(o.ERROR,"Error: No se pudo cargar la información del producto");return}if(console.log(`Añadido al carrito: ${l} unidades de ${r.name}`),!r.is_in_stock){i(o.ERROR,"Lo sentimos, este producto está agotado");return}try{if(await I({productId:Number(c),quantity:l}))i(o.SUCCESS,`${r.name} ha sido agregado al carrito`);else throw new Error("No se pudo agregar el producto al carrito")}catch(s){console.error("Error al agregar al carrito:",s),i(o.ERROR,"Error al agregar producto al carrito. Inténtalo de nuevo.")}},O=async()=>{if(!r){i(o.ERROR,"Error: No se pudo cargar la información del producto");return}console.log(`Añadido a favoritos: ${r.name}`);try{await F(Number(c))?i(o.SUCCESS,"Producto añadido a favoritos"):i(o.INFO,"Producto eliminado de favoritos")}catch(s){console.error("Error al manejar favorito:",s),i(o.ERROR,"Error al gestionar favoritos. Inténtalo de nuevo.")}},T=async()=>{if(!r){i(o.ERROR,"Error: No se pudo cargar la información del producto");return}try{let s;if(r.seller_id)s=r.seller_id,console.log(`Usando seller_id directo del producto: ${s}`);else if(r.seller?.id)s=r.seller.id,console.log(`Usando seller.id del producto: ${s}`);else if(r.user_id){console.log(`Intentando obtener seller_id a partir de user_id: ${r.user_id}`);try{const t=await q.get(`/sellers/by-user/${r.user_id}`);t&&t.data?t.data.id?(s=t.data.id,console.log(`Convertido user_id ${r.user_id} a seller_id ${s}`)):t.data.seller_id?(s=t.data.seller_id,console.log(`Convertido user_id ${r.user_id} a seller_id ${s}`)):(console.warn("No se pudo obtener seller_id, usando user_id como fallback"),s=r.user_id):(console.warn("Respuesta de API vacía o sin data, usando user_id como fallback"),s=r.user_id)}catch(t){console.error("Error al obtener seller_id:",t),s=r.user_id,console.warn(`Fallback: usando user_id ${s} como seller_id debido a error`)}}else throw console.error("No se encontró información de vendedor en datos del producto:",r),new Error("No se pudo determinar el vendedor del producto");console.log(`Iniciando chat con vendedor ID ${s} para producto ${r.id}`);const a=await z(s,Number(c));if(a)j(`/chats/${a}`);else throw new Error("No se pudo crear el chat con el vendedor")}catch(s){console.error("Error al iniciar chat con vendedor:",s),i(o.ERROR,"Error al iniciar chat con vendedor. Inténtalo de nuevo.")}},h=s=>e.jsx("div",{className:"flex items-center",children:[1,2,3,4,5].map(a=>e.jsx(ae,{size:18,className:`${a<=Math.floor(s)?"text-yellow-400 fill-current":a<=s?"text-yellow-400 fill-current opacity-60":"text-gray-300"}`},a))});if(S)return e.jsx("div",{className:"container mx-auto flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{size:40,className:"animate-spin mx-auto mb-4 text-primary-600"}),e.jsx("p",{className:"text-gray-600",children:"Cargando información del producto..."})]})});if(v||!r)return e.jsx("div",{className:"container mx-auto py-20",children:e.jsxs("div",{className:"max-w-lg mx-auto bg-white p-8 rounded-xl shadow-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error"}),e.jsx("p",{className:"text-gray-700 mb-6",children:v||"No se encontró el producto solicitado."}),e.jsx("button",{onClick:()=>j(-1),className:"bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700 transition-colors",children:"Volver"})]})});const p=r.category?[r.category.name]:[],C=s=>typeof s=="string"?y(s):y(s.original||s.medium||s.thumbnail),u=s=>{if(!s)return[];if(Array.isArray(s)){if(typeof s[0]=="string"&&!s[0].startsWith("["))return s;try{return s.join(",").replace(/\[|\]|"/g,"").split(",")}catch{return[]}}return[]},E=u(r.colors),$=u(r.sizes),f=u(r.tags),U=[{name:"SKU",value:r.sku||"N/A"},{name:"Peso",value:r.weight?`${r.weight} kg`:"N/A"},{name:"Dimensiones",value:r.dimensions||r.width&&r.height&&r.depth?`${r.width} × ${r.height} × ${r.depth} cm`:"N/A"},{name:"Disponibilidad",value:r.is_in_stock?"En stock":"Agotado"},{name:"Categoría",value:r.category?.name||"N/A"}];return e.jsx("div",{className:"container mx-auto px-4 py-10",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("nav",{className:"flex mb-6 text-sm text-gray-500",children:[e.jsx(m,{to:"/",className:"hover:text-primary-600",children:"Inicio"}),e.jsx("span",{className:"mx-2",children:"/"}),r.category&&e.jsxs(e.Fragment,{children:[e.jsx(m,{to:`/category/${r.category.slug}`,className:"hover:text-primary-600",children:r.category.name}),e.jsx("span",{className:"mx-2",children:"/"})]}),e.jsx("span",{className:"text-gray-700 font-medium",children:r.name})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-10 p-6 lg:p-10",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gray-50 rounded-xl overflow-hidden h-96 lg:h-[500px]",children:r.images&&r.images.length>0&&e.jsx("img",{src:C(r.images[w]),alt:r.name,className:"w-full h-full object-cover transition-all duration-300"})}),r.images&&r.images.length>1&&e.jsx("div",{className:"grid grid-cols-4 gap-3",children:r.images.map((s,a)=>e.jsx("div",{className:`bg-gray-50 rounded-lg h-24 cursor-pointer border-2 transition-all overflow-hidden ${a===w?"border-primary-500 shadow-md":"border-transparent hover:border-gray-300"}`,onClick:()=>A(a),children:e.jsx("img",{src:C(s),alt:`${r.name} thumbnail ${a+1}`,className:"w-full h-full object-cover"})},a))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[r.seller&&e.jsx("div",{className:"flex items-center mb-2",children:e.jsx("span",{className:"text-sm bg-primary-50 text-primary-700 px-2 py-0.5 rounded font-medium",children:r.seller.name||"Vendedor"})}),r.discount_percentage&&r.discount_percentage>0&&e.jsxs("span",{className:"ml-2 bg-red-100 text-red-700 px-2 py-0.5 rounded text-sm font-medium",children:[r.discount_percentage,"% DESCUENTO"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-3",children:r.name}),e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[h(r.rating||0),e.jsx("span",{className:"text-yellow-500 ml-1 font-medium",children:(r.rating||0).toFixed(1)})]}),e.jsxs("div",{className:"text-gray-500 text-sm",children:[e.jsx("span",{className:"font-medium",children:r.rating_count||0})," ","valoraciones"]}),e.jsx("div",{className:"text-gray-400",children:"|"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["SKU:"," ",e.jsx("span",{className:"text-gray-700",children:r.sku||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsxs("span",{className:"text-3xl font-bold text-primary-700",children:["$",r.final_price?r.final_price.toFixed(2):r.price.toFixed(2)]}),r.discount_percentage&&r.discount_percentage>0&&e.jsxs("span",{className:"ml-3 text-lg text-gray-500 line-through",children:["$",r.price.toFixed(2)]})]}),r.discount_percentage&&r.discount_percentage>0&&e.jsxs("p",{className:"text-sm text-green-600 font-medium mb-4",children:["¡Ahorra $",(r.price-(r.final_price||0)).toFixed(2),"! Oferta por tiempo limitado."]})]}),E.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Color:"}),e.jsx("div",{className:"flex space-x-3",children:E.map((s,a)=>e.jsx("div",{className:"px-3 py-1 border border-gray-300 rounded-full cursor-pointer hover:border-primary-500",title:s,children:s},a))})]}),$.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Tamaño:"}),e.jsx("div",{className:"flex space-x-3",children:$.map((s,a)=>e.jsx("div",{className:"px-3 py-1 border border-gray-300 rounded-full cursor-pointer hover:border-primary-500",title:s,children:s},a))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden h-12",children:[e.jsx("button",{className:"px-4 bg-gray-50 text-gray-600 hover:bg-gray-100 flex items-center justify-center",onClick:()=>g(l-1),disabled:l<=1,children:e.jsx(B,{size:18})}),e.jsx("input",{type:"number",className:"w-16 text-center border-x border-gray-300 text-gray-700 font-medium",min:"1",max:"10",value:l,onChange:s=>g(parseInt(s.target.value)||1)}),e.jsx("button",{className:"px-4 bg-gray-50 text-gray-600 hover:bg-gray-100 flex items-center justify-center",onClick:()=>g(l+1),disabled:l>=10,children:e.jsx(J,{size:18})})]}),e.jsxs("button",{className:"flex-grow h-12 bg-primary-600 hover:bg-primary-700 text-white rounded-lg font-medium transition-colors duration-200 flex items-center justify-center",onClick:D,disabled:!r.is_in_stock,children:[e.jsx(Q,{size:20,className:"mr-2"}),r.is_in_stock?"Añadir al Carrito":"Producto Agotado"]}),e.jsx("button",{className:"h-12 w-12 border border-gray-300 rounded-lg flex items-center justify-center text-gray-600 hover:text-primary-600 hover:border-primary-600 transition-colors duration-200",onClick:O,title:"Añadir a favoritos",children:e.jsx(X,{size:20})}),e.jsxs("button",{className:"h-12 px-4 border border-gray-300 rounded-lg flex items-center justify-center text-gray-600 hover:text-primary-600 hover:border-primary-600 transition-colors duration-200",onClick:T,title:"Chatear con el vendedor",children:[e.jsx(Y,{size:20,className:"mr-2"}),"Contactar"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-5 space-y-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(Z,{className:"text-primary-600 mt-1 flex-shrink-0 mr-3",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Entrega rápida"}),e.jsx("p",{className:"text-sm text-gray-600",children:r.is_in_stock?e.jsxs(e.Fragment,{children:["Disponible para entrega en"," ",e.jsx("span",{className:"font-medium",children:"1-3 días hábiles"})]}):"Producto agotado temporalmente"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(ee,{className:"text-primary-600 mt-1 flex-shrink-0 mr-3",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Garantía de 1 año"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Garantía del fabricante contra defectos"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(re,{className:"text-primary-600 mt-1 flex-shrink-0 mr-3",size:20}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Devolución gratuita"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Devolución sin costo en los primeros 30 días"})]})]})]}),(p.length>0||f.length>0)&&e.jsxs("div",{className:"pt-4 border-t border-gray-200",children:[p.length>0&&e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"text-gray-600 mr-2",children:"Categorías:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:p.map((s,a)=>e.jsx(m,{to:`/category/${r.category?.slug||""}`,className:"bg-gray-100 hover:bg-gray-200 px-3 py-1 text-sm rounded-full text-gray-700 transition-colors",children:s},a))})]}),f.length>0&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-600 mr-2",children:"Etiquetas:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:f.map((s,a)=>e.jsx(m,{to:`/tags/${s}`,className:"bg-gray-100 hover:bg-gray-200 px-3 py-1 text-sm rounded-full text-gray-700 transition-colors",children:s},a))})]})]}),e.jsxs("div",{className:"flex items-center text-gray-500 text-sm",children:[e.jsx(se,{size:16,className:"mr-2"}),e.jsx("span",{children:"Compartir este producto"})]})]})]}),e.jsxs("div",{className:"border-t border-gray-200",children:[e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsx("button",{className:`py-4 px-6 font-medium text-sm ${d==="description"?"text-primary-600 border-b-2 border-primary-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>x("description"),children:"Descripción"}),e.jsx("button",{className:`py-4 px-6 font-medium text-sm ${d==="specifications"?"text-primary-600 border-b-2 border-primary-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>x("specifications"),children:"Especificaciones"}),e.jsx("button",{className:`py-4 px-6 font-medium text-sm ${d==="reviews"?"text-primary-600 border-b-2 border-primary-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>x("reviews"),children:"Valoraciones"})]}),e.jsxs("div",{className:"p-6 lg:p-10",children:[d==="description"&&e.jsxs("div",{className:"max-w-3xl space-y-6",children:[r.short_description&&e.jsx("p",{className:"font-medium text-lg text-gray-800",children:r.short_description}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:r.description})]}),d==="specifications"&&e.jsx("div",{className:"max-w-3xl",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-y-4 gap-x-8",children:U.map((s,a)=>e.jsxs("div",{className:"flex border-b border-gray-100 pb-3",children:[e.jsxs("span",{className:"w-40 font-medium text-gray-700",children:[s.name,":"]}),e.jsx("span",{className:"text-gray-600",children:s.value})]},a))})}),d==="reviews"&&e.jsx("div",{className:"max-w-3xl",children:e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs("div",{className:"mr-4",children:[e.jsx("div",{className:"text-5xl font-bold text-gray-900",children:(r.rating||0).toFixed(1)}),e.jsx("div",{className:"flex mt-2",children:h(r.rating||0)}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[r.rating_count||0," valoraciones"]})]}),e.jsx("div",{className:"flex-grow",children:e.jsx("p",{className:"text-center text-gray-500",children:"No hay valoraciones disponibles"})}),e.jsx("div",{className:"ml-6",children:e.jsx("button",{className:"px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white font-medium rounded-lg",children:"Escribir valoración"})})]})})]})]})]}),r.related_products&&r.related_products.length>0&&e.jsxs("div",{className:"mt-16",children:[e.jsx("h2",{className:"text-2xl font-bold mb-8",children:"Productos relacionados"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:r.related_products.map(s=>e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow",children:[e.jsx("div",{className:"h-52 bg-gray-50 flex items-center justify-center p-4",children:e.jsx("img",{src:y(s.images&&s.images.length>0?typeof s.images[0]=="string"?s.images[0]:s.images[0].original||s.images[0].medium:null),alt:s.name,className:"max-h-full max-w-full object-contain"})}),e.jsxs("div",{className:"p-5",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[h(s.rating||0),e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",s.rating||0,")"]})]}),e.jsx(m,{to:`/product/${s.id}`,children:e.jsx("h3",{className:"font-medium text-gray-800 mb-2 hover:text-primary-600 transition-colors line-clamp-2 h-12",children:s.name})}),e.jsxs("p",{className:"text-primary-600 font-bold",children:["$",s.final_price?s.final_price.toFixed(2):s.price.toFixed(2)]}),e.jsx(m,{to:`/product/${s.id}`,className:"block w-full mt-3",children:e.jsx("button",{className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-800 py-2 rounded-lg font-medium text-sm transition-colors",children:"Ver detalles"})})]})]},s.id))})]})]})})};export{ve as default};
//# sourceMappingURL=ProductItemPage-z-hckOVt.js.map
