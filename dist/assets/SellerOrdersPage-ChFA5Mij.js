import{r as n,j as e,L as h}from"./index-DmNDOrWy.js";import{T as B}from"./Table-BdEePeKQ.js";import{f as v}from"./formatCurrency-CXuiUHwQ.js";import{S as G}from"./SellerStatCardList-DE6BvjV9.js";import{S as V}from"./SellerOrderServiceAdapter-BBCqUj0a.js";import{S as m}from"./shopping-bag-BMmsUIy8.js";import{C as D}from"./chart-no-axes-column-C4ngQd1-.js";import{T as F}from"./truck-DP84WB3Y.js";import{P as N}from"./package-CIRlwNqy.js";import{R as M}from"./refresh-cw-BOPCg90x.js";import{S as H}from"./search-CbEKe7UQ.js";import{F as J}from"./funnel-CAFb7hhq.js";import{E as W}from"./eye-CldZNoIz.js";import{F as Y}from"./file-text-DT6_O-Nw.js";import"./chevron-left-Dl3DF2OO.js";import"./arrow-up-DQySjn32.js";const O=i=>{if(!i)return"";try{const r=JSON.parse(i);if(typeof r=="object"&&r!==null)return[r.address,r.city,r.state,r.country].filter(Boolean).join(", ")}catch(r){console.error("Error al parsear dirección de envío:",r)}return i},ce=()=>{const i=new V,[r,f]=n.useState([]),[z,u]=n.useState(!0),[g,P]=n.useState("all"),[p,w]=n.useState("all"),[c,S]=n.useState("all"),[x,k]=n.useState(""),[d,T]=n.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),[$,C]=n.useState([]),[l,y]=n.useState({from:"",to:""});n.useEffect(()=>{E(),b()},[g,p,x,d.currentPage,c,l]);const E=async()=>{u(!0);try{const t={page:d.currentPage,limit:d.itemsPerPage};if(g!=="all"&&(t.status=g),p!=="all"&&(t.paymentStatus=p),x&&(t.search=x),c==="today"){const s=new Date().toISOString().split("T")[0];t.dateFrom=s,t.dateTo=s}else if(c==="week"){const s=new Date,o=new Date(s.setDate(s.getDate()-s.getDay()));t.dateFrom=o.toISOString().split("T")[0],t.dateTo=new Date().toISOString().split("T")[0]}else if(c==="month"){const s=new Date,o=new Date(s.getFullYear(),s.getMonth(),1);t.dateFrom=o.toISOString().split("T")[0],t.dateTo=new Date().toISOString().split("T")[0]}else c==="custom"&&l.from&&l.to&&(t.dateFrom=l.from,t.dateTo=l.to);const a=await i.getSellerOrders(t);f(a.orders),T(a.pagination)}catch(t){console.error("Error al cargar órdenes:",t)}finally{u(!1)}},b=async()=>{try{const a=(await i.getOrderStats()).map(s=>{let o;switch(s.label){case"Total Pedidos":o=e.jsx(m,{className:"h-5 w-5 text-blue-600"});break;case"Pendientes":o=e.jsx(N,{className:"h-5 w-5 text-yellow-600"});break;case"En Proceso":o=e.jsx(m,{className:"h-5 w-5 text-blue-600"});break;case"Enviados":o=e.jsx(F,{className:"h-5 w-5 text-indigo-600"});break;case"Total Ventas":o=e.jsx(D,{className:"h-5 w-5 text-green-600"});break;default:o=e.jsx(m,{className:"h-5 w-5 text-blue-600"})}return{...s,icon:o,value:s.isCurrency&&typeof s.value=="number"?v(s.value):s.value}});C(a)}catch(t){console.error("Error al cargar estadísticas:",t),C([{label:"Total Pedidos",value:r.length,icon:e.jsx(m,{className:"h-5 w-5 text-blue-600"}),color:"blue"},{label:"Pendientes",value:r.filter(a=>a.status==="pending").length,icon:e.jsx(N,{className:"h-5 w-5 text-yellow-600"}),color:"yellow"},{label:"En Proceso",value:r.filter(a=>a.status==="processing").length,icon:e.jsx(m,{className:"h-5 w-5 text-blue-600"}),color:"blue"},{label:"Total Ventas",value:v(r.reduce((a,s)=>a+s.total,0)),icon:e.jsx(D,{className:"h-5 w-5 text-green-600"}),color:"green"}])}},A=async(t,a)=>{try{u(!0),await i.updateOrderStatus(t,a)&&(f(o=>o.map(j=>j.id===t?{...j,status:a}:j)),b())}catch(s){console.error(`Error al actualizar estado de orden ${t}:`,s)}finally{u(!1)}},I=t=>{T(a=>({...a,currentPage:t}))},L=()=>{u(!0),E(),b()},R=[{key:"orderNumber",header:"Número de Pedido",sortable:!0,render:t=>e.jsx(h,{to:`/seller/orders/${t.id}`,className:"font-medium text-primary-600 hover:underline",children:t.orderNumber})},{key:"date",header:"Fecha",sortable:!0,render:t=>{const a=new Date(t.date);return e.jsxs("span",{children:[a.toLocaleDateString("es-ES")," ",a.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})]})}},{key:"customer",header:"Cliente",sortable:!0,render:t=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.customer.name}),e.jsx("div",{className:"text-xs text-gray-500",children:t.customer.email})]})},{key:"total",header:"Total",sortable:!0,render:t=>e.jsx("span",{className:"font-medium",children:v(t.total)})},{key:"items",header:"Productos",render:t=>e.jsx("span",{className:"text-center",children:t.items?t.items.length:0})},{key:"status",header:"Estado",sortable:!0,render:t=>{let a="",s="";switch(t.status){case"pending":a="bg-yellow-100 text-yellow-800",s="Pendiente";break;case"processing":a="bg-blue-100 text-blue-800",s="En Proceso";break;case"paid":a="bg-cyan-100 text-cyan-800",s="Pagado";break;case"shipped":a="bg-indigo-100 text-indigo-800",s="Enviado";break;case"delivered":a="bg-purple-100 text-purple-800",s="Entregado";break;case"completed":a="bg-green-100 text-green-800",s="Completado";break;case"cancelled":a="bg-red-100 text-red-800",s="Cancelado";break}return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${a}`,children:s})}},{key:"payment",header:"Pago",sortable:!0,render:t=>{let a="",s="";switch(t.paymentStatus){case"pending":a="bg-yellow-100 text-yellow-800",s="Pendiente";break;case"completed":a="bg-green-100 text-green-800",s="Pagado";break;case"rejected":a="bg-red-100 text-red-800",s="Rechazado";break}return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${a}`,children:s})}},{key:"address",header:"Dirección",render:t=>e.jsx("div",{className:"truncate max-w-xs",title:O(t.shippingAddress),children:O(t.shippingAddress)})},{key:"actions",header:"Acciones",render:t=>e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(h,{to:`/seller/orders/${t.id}`,className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Ver detalles",children:e.jsx(W,{size:18})}),e.jsx(h,{to:`/seller/invoices/generate/${t.id}`,className:"p-1 text-indigo-600 hover:bg-indigo-100 rounded-md",title:"Generar factura",children:e.jsx(Y,{size:18})}),e.jsx(h,{to:`/seller/shipping/${t.id}`,className:`p-1 rounded-md ${t.status==="pending"||t.status==="processing"?"text-green-600 hover:bg-green-100":"text-gray-400 cursor-not-allowed"}`,title:t.status==="pending"||t.status==="processing"?"Gestionar envío":"No se puede gestionar el envío en este estado",children:e.jsx(F,{size:18})}),t.status==="pending"&&e.jsx("button",{onClick:()=>A(t.id,"processing"),className:"p-1 text-orange-600 hover:bg-orange-100 rounded-md",title:"Preparar pedido",children:e.jsx(N,{size:18})})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Pedidos"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("button",{onClick:L,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(M,{size:18,className:"inline mr-2"}),"Actualizar"]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("input",{type:"text",placeholder:"Buscar por número de pedido, cliente...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",value:x,onChange:t=>k(t.target.value)}),e.jsx(H,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"h-5 w-5 text-gray-500"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:g,onChange:t=>P(t.target.value),children:[e.jsx("option",{value:"all",children:"Todos los estados"}),e.jsx("option",{value:"pending",children:"Pendientes"}),e.jsx("option",{value:"processing",children:"En Proceso"}),e.jsx("option",{value:"shipped",children:"Enviados"}),e.jsx("option",{value:"delivered",children:"Entregados"}),e.jsx("option",{value:"cancelled",children:"Cancelados"})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:p,onChange:t=>w(t.target.value),children:[e.jsx("option",{value:"all",children:"Todos los pagos"}),e.jsx("option",{value:"pending",children:"Pago Pendiente"}),e.jsx("option",{value:"completed",children:"Pagados"}),e.jsx("option",{value:"rejected",children:"Rechazados"})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:c,onChange:t=>S(t.target.value),children:[e.jsx("option",{value:"all",children:"Todas las fechas"}),e.jsx("option",{value:"today",children:"Hoy"}),e.jsx("option",{value:"week",children:"Esta semana"}),e.jsx("option",{value:"month",children:"Este mes"}),e.jsx("option",{value:"custom",children:"Personalizado"})]}),c==="custom"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:l.from,onChange:t=>y({...l,from:t.target.value})}),e.jsx("span",{className:"text-gray-500",children:"a"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:l.to,onChange:t=>y({...l,to:t.target.value})})]})]}),e.jsx("button",{onClick:()=>{P("all"),w("all"),S("all"),k(""),y({from:"",to:""})},className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Limpiar filtros"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:e.jsx(G,{items:$})}),e.jsx(B,{data:r,columns:R,searchFields:["orderNumber"],loading:z,emptyMessage:"No se encontraron pedidos",pagination:{currentPage:d.currentPage,totalPages:d.totalPages,totalItems:d.totalItems,itemsPerPage:d.itemsPerPage,onPageChange:I}})]})};export{ce as default};
//# sourceMappingURL=SellerOrdersPage-ChFA5Mij.js.map
