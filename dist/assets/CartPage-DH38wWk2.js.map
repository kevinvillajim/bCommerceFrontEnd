{"version":3,"file":"CartPage-DH38wWk2.js","sources":["../../src/presentation/pages/CartPage.tsx"],"sourcesContent":["// src/presentation/pages/CartPage.tsx - ACTUALIZADO CON DESCUENTOS Y CUPONES\r\nimport React, {useState, useEffect, useCallback} from \"react\";\r\nimport {Link, useNavigate} from \"react-router-dom\";\r\nimport {\r\n\tShoppingCart,\r\n\tTrash2,\r\n\tPlus,\r\n\tMinus,\r\n\tArrowLeft,\r\n\tHeart,\r\n\tGift,\r\n\tTrendingDown,\r\n\tAlertTriangle,\r\n\tTag // ‚úÖ NUEVO: Icono para cup√≥n\r\n} from \"lucide-react\";\r\nimport {useCart} from \"../hooks/useCart\";\r\nimport {useFavorites} from \"../hooks/useFavorites\";\r\nimport {useInvalidateCounters} from \"../hooks/useHeaderCounters\";\r\nimport {useErrorHandler} from \"../hooks/useErrorHandler\";\r\nimport {NotificationType} from \"../contexts/CartContext\";\r\nimport CacheService from \"../../infrastructure/services/CacheService\";\r\nimport {formatCurrency} from \"../../utils/formatters/formatCurrency\";\r\n\r\n// ‚úÖ NUEVO: Importar calculadora centralizada y funciones necesarias\r\nimport {calculateCartItemDiscountsAsync, calculateCartItemDiscounts} from \"../../utils/volumeDiscountCalculator\";\r\nimport {EcommerceCalculator} from \"../../utils/ecommerceCalculator\";\r\nimport type {CartItemWithDiscounts} from \"../../utils/volumeDiscountCalculator\";\r\n// üéØ JORDAN: VolumeDiscountContext eliminado - funcionalidad migrada a volumeDiscountCalculator\r\n// import {useCartVolumeDiscounts} from \"../contexts/VolumeDiscountContext\";\r\n\r\n// Importar hooks optimizados\r\nimport {useImageCache} from \"../hooks/useImageCache\";\r\nimport {useAutoPrefetch} from \"../hooks/useAutoPrefetch\";\r\n\r\nconst CartPage: React.FC = () => {\r\n\tconst [isLoading, setIsLoading] = useState(true);\r\n\tconst [isEmpty, setIsEmpty] = useState(false);\r\n\tconst [couponCode, setCouponCode] = useState(\"\");\r\n\tconst [loadingItem, setLoadingItem] = useState<number | null>(null);\r\n\tconst [isApplyingCoupon, setIsApplyingCoupon] = useState(false);\r\n\r\n\tconst navigate = useNavigate();\r\n\r\n\t// Hooks optimizados\r\n\tconst {getOptimizedImageUrl} = useImageCache();\r\n\tconst {prefetchCartPageData} = useAutoPrefetch({\r\n\t\tenabled: true,\r\n\t\tdelay: 500,\r\n\t\tonPrefetchComplete: () => console.log(\"‚úÖ Cart page prefetch completed\"),\r\n\t});\r\n\r\n\t// Obtener datos del carrito y funciones para manipularlo\r\n\tconst {\r\n\t\tcart,\r\n\t\tloading,\r\n\t\terror,\r\n\t\tfetchCart,\r\n\t\titemCount,\r\n\t\tremoveFromCart,\r\n\t\tupdateCartItem,\r\n\t\tclearCart,\r\n\t\tshowNotification,\r\n\t\t// ‚úÖ NUEVO: Funciones de descuento del CartContext\r\n\t\tappliedDiscount,\r\n\t\tapplyDiscountCode,\r\n\t\tremoveDiscountCode,\r\n\t} = useCart();\r\n\r\n\tconst {toggleFavorite} = useFavorites();\r\n\r\n\t// ‚úÖ NUEVO: Hook para descuentos por volumen din√°micos desde BD\r\n\t// üéØ JORDAN: Volume discounts ahora se manejan directamente en volumeDiscountCalculator\r\n\t// const {isEnabled: volumeDiscountsEnabled, config: volumeDiscountConfig} = useCartVolumeDiscounts();\r\n\r\n\t// Hook para manejo de errores mejorado\r\n\tconst {handleError, handleSuccess, handleStockError} = useErrorHandler({\r\n\t\tshowNotification,\r\n\t\tcontext: 'CartPage'\r\n\t});\r\n\r\n\t// ‚úÖ OPTIMIZADO: Solo fetch una vez al montar, sin duplicar con loadCart\r\n\r\n\t// Hook para actualizaciones optimistas\r\n\tconst {\r\n\t\toptimisticCartAdd,\r\n\t\toptimisticCartRemove,\r\n\t\toptimisticFavoriteAdd\r\n\t} = useInvalidateCounters();\r\n\r\n\t// Helper para obtener stock disponible\r\n\tconst getAvailableStock = useCallback((product: any): number => {\r\n\t\tif (typeof product.stockAvailable === 'number') {\r\n\t\t\treturn product.stockAvailable;\r\n\t\t}\r\n\t\tif (typeof product.stock === 'number') {\r\n\t\t\treturn product.stock;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}, []);\r\n\r\n\t// Helper para validar disponibilidad\r\n\tconst isStockAvailable = useCallback((product: any, requestedQuantity: number): boolean => {\r\n\t\tconst availableStock = getAvailableStock(product);\r\n\t\treturn availableStock >= requestedQuantity && product.is_in_stock !== false;\r\n\t}, [getAvailableStock]);\r\n\r\n\t// Funci√≥n simple para invalidar cache\r\n\tconst invalidateRelatedPages = useCallback(() => {\r\n\t\tCacheService.removeItem(\"cart_user_data\");\r\n\t\tCacheService.removeItem(\"cart_guest_data\");\r\n\t\tCacheService.removeItem(\"header_counters\");\r\n\t\t\r\n\t\t// Invalidar cache de favoritos\r\n\t\tfor (let page = 1; page <= 10; page++) {\r\n\t\t\tCacheService.removeItem(`user_favorites_${page}_10`);\r\n\t\t}\r\n\t\t\r\n\t\tconsole.log(\"üîÑ Cache invalidado desde CartPage\");\r\n\t}, []);\r\n\r\n\t// Funci√≥n optimizada para obtener imagen del producto\r\n\tconst getProductImage = useCallback(\r\n\t\t(product: any): string => {\r\n\t\t\treturn getOptimizedImageUrl(product, \"medium\");\r\n\t\t},\r\n\t\t[getOptimizedImageUrl]\r\n\t);\r\n\r\n\t// ‚úÖ ESTADO PARA ITEMS CON DESCUENTOS CALCULADOS AS√çNCRONAMENTE\r\n\tconst [cartItemsWithDiscounts, setCartItemsWithDiscounts] = useState<CartItemWithDiscounts[]>([]);\r\n\tconst [loadingDiscounts, setLoadingDiscounts] = useState(false);\r\n\r\n\t// ‚úÖ CALCULAR DESCUENTOS AS√çNCRONAMENTE USANDO BD CONFIG\r\n\tuseEffect(() => {\r\n\t\tconst calculateDiscountsAsync = async () => {\r\n\t\t\tif (!cart?.items) {\r\n\t\t\t\tsetCartItemsWithDiscounts([]);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tsetLoadingDiscounts(true);\r\n\t\t\tconsole.log(\"üîÑ CartPage: Calculando descuentos con configuraci√≥n din√°mica\");\r\n\r\n\t\t\ttry {\r\n\t\t\t\tconst itemsWithDiscounts = await Promise.all(\r\n\t\t\t\t\tcart.items.map(async (item) => {\r\n\t\t\t\t\t\t// üéØ JORDAN: Usar calculadora as√≠ncrona con configuraci√≥n din√°mica\r\n\t\t\t\t\t\tconst discount = await calculateCartItemDiscountsAsync(item);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\tdiscount,\r\n\t\t\t\t\t\t\timageUrl: getProductImage(item.product)\r\n\t\t\t\t\t\t} as CartItemWithDiscounts;\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\t\tconsole.log(\"‚úÖ CartPage: Descuentos calculados para\", itemsWithDiscounts.length, \"items\");\r\n\t\t\t\tsetCartItemsWithDiscounts(itemsWithDiscounts);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error(\"‚ùå Error calculando descuentos:\", error);\r\n\t\t\t\t// Fallback: usar calculadora s√≠ncrona\r\n\t\t\t\tconst fallbackItems = cart.items.map(item => {\r\n\t\t\t\t\tconst discount = calculateCartItemDiscounts(item);\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\tdiscount,\r\n\t\t\t\t\t\timageUrl: getProductImage(item.product)\r\n\t\t\t\t\t} as CartItemWithDiscounts;\r\n\t\t\t\t});\r\n\t\t\t\tsetCartItemsWithDiscounts(fallbackItems);\r\n\t\t\t} finally {\r\n\t\t\t\tsetLoadingDiscounts(false);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tcalculateDiscountsAsync();\r\n\t}, [cart?.items, getProductImage]); // üéØ JORDAN: Dependencias simplificadas\r\n\r\n\t// ‚úÖ ESTADO PARA TOTALES CALCULADOS AS√çNCRONAMENTE\r\n\tconst [cartTotals, setCartTotals] = useState({\r\n\t\tsubtotal: 0,\r\n\t\ttax: 0,\r\n\t\tcouponAmount: 0,\r\n\t\ttotal: 0,\r\n\t\ttotalVolumeSavings: 0,\r\n\t\ttotalSellerSavings: 0,\r\n\t\ttotalSavings: 0,\r\n\t\tvolumeDiscountsApplied: false,\r\n\t\tshipping: 0,\r\n\t});\r\n\r\n\t// ‚úÖ CALCULAR TOTALES DE FORMA AS√çNCRONA\r\n\tuseEffect(() => {\r\n\t\tconst calculateCartTotals = async () => {\r\n\t\t\tif (!cart?.items?.length) {\r\n\t\t\t\tsetCartTotals({\r\n\t\t\t\t\tsubtotal: 0,\r\n\t\t\t\t\ttax: 0,\r\n\t\t\t\t\tcouponAmount: 0,\r\n\t\t\t\t\ttotal: 0,\r\n\t\t\t\t\ttotalVolumeSavings: 0,\r\n\t\t\t\t\ttotalSellerSavings: 0,\r\n\t\t\t\t\ttotalSavings: 0,\r\n\t\t\t\t\tvolumeDiscountsApplied: false,\r\n\t\t\t\t\tshipping: 0,\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log(\"üîç JORDAN CART - Usando calculadora migrada con configuraci√≥n unificada\");\r\n\t\t\t// üéØ CRITICAL: forceRefresh para garantizar configuraciones frescas en Cart\r\n\t\t\tconst result = await EcommerceCalculator.calculateTotals(cart.items, appliedDiscount, true);\r\n\t\t\t\r\n\t\t\tconsole.log(\"üîç FLUJO CART - Totales finales calculados:\");\r\n\t\t\tconsole.log(\"   üí∞ Subtotal despu√©s de cup√≥n:\", result.subtotalAfterCoupon);\r\n\t\t\tconsole.log(\"   üí∞ + Env√≠o:\", result.shipping, \"=\", result.subtotalWithShipping);\r\n\t\t\tconsole.log(\"   üí∞ + IVA 15%:\", result.tax);\r\n\t\t\tconsole.log(\"   üéØ TOTAL CART:\", result.total);\r\n\t\t\tconsole.log(\"   üìä Descuentos: seller=\", result.sellerDiscounts, \r\n\t\t\t\t\t \"volume=\", result.volumeDiscounts, \"cup√≥n=\", result.couponDiscount);\r\n\r\n\t\t\tsetCartTotals({\r\n\t\t\t\tsubtotal: result.step3_afterVolumeDiscount, // CORREGIDO: Mostrar subtotal despu√©s de descuentos por volumen (antes del cup√≥n)\r\n\t\t\t\ttax: result.tax,\r\n\t\t\t\tcouponAmount: result.couponDiscount,\r\n\t\t\t\ttotal: result.total,\r\n\t\t\t\ttotalVolumeSavings: result.volumeDiscounts,\r\n\t\t\t\ttotalSellerSavings: result.sellerDiscounts,\r\n\t\t\t\ttotalSavings: result.totalDiscounts,\r\n\t\t\t\tvolumeDiscountsApplied: result.volumeDiscountsApplied,\r\n\t\t\t\tshipping: result.shipping,\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tcalculateCartTotals();\r\n\t}, [cart?.items, appliedDiscount]); // üéØ JORDAN: Dependencias simplificadas\r\n\r\n\t// Cargar carrito simple - Solo al montar componente\r\n\tuseEffect(() => {\r\n\t\tconst loadCart = async () => {\r\n\t\t\tsetIsLoading(true);\r\n\t\t\ttry {\r\n\t\t\t\t// ‚úÖ RESTAURADO: fetchCart() necesario ya que CartContext no auto-carga\r\n\t\t\t\tawait fetchCart();\r\n\t\t\t\t// Prefetch de datos relacionados despu√©s de cargar carrito\r\n\t\t\t\tprefetchCartPageData();\r\n\t\t\t} catch (error: any) {\r\n\t\t\t\tconsole.error(\"Error al cargar el carrito:\", error);\r\n\t\t\t\thandleError(error, \"No se pudo cargar el carrito. Int√©ntalo de nuevo.\");\r\n\t\t\t} finally {\r\n\t\t\t\tsetIsLoading(false);\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tloadCart();\r\n\t}, []);\r\n\r\n\t// Actualizar estado de carrito vac√≠o cuando cambia el carrito\r\n\tuseEffect(() => {\r\n\t\tif (!loading && cart) {\r\n\t\t\tsetIsEmpty(cart.items.length === 0);\r\n\t\t}\r\n\t}, [cart, loading]);\r\n\r\n\t// ‚úÖ FUNCI√ìN PARA INCREMENTAR CANTIDAD CON VALIDACI√ìN DE STOCK\r\n\tconst increaseQuantity = useCallback(\r\n\t\tasync (id: number) => {\r\n\t\t\tif (loadingItem) return;\r\n\r\n\t\t\tsetLoadingItem(id);\r\n\t\t\tconst item = cart?.items.find((item) => item.id === id);\r\n\r\n\t\t\tif (item) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// ‚úÖ VALIDAR STOCK ANTES DE INCREMENTAR\r\n\t\t\t\t\tconst availableStock = getAvailableStock(item.product);\r\n\t\t\t\t\tconst newQuantity = item.quantity + 1;\r\n\r\n\t\t\t\t\tif (!isStockAvailable(item.product, newQuantity)) {\r\n\t\t\t\t\t\thandleStockError(availableStock, newQuantity);\r\n\t\t\t\t\t\tsetLoadingItem(null);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Actualizaci√≥n optimista\r\n\t\t\t\t\toptimisticCartAdd();\r\n\r\n\t\t\t\t\tconst result = await updateCartItem({\r\n\t\t\t\t\t\titemId: id,\r\n\t\t\t\t\t\tquantity: newQuantity,\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (!result) {\r\n\t\t\t\t\t\tthrow new Error(\"No se pudo actualizar la cantidad\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// ‚úÖ OPTIMIZADO: Solo invalidar cache, no refetch (cart context ya se actualiza)\r\n\t\t\t\t\tinvalidateRelatedPages();\r\n\t\t\t\t} catch (error: any) {\r\n\t\t\t\t\tconsole.error(\"Error al aumentar cantidad:\", error);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Manejo espec√≠fico de errores de stock\r\n\t\t\t\t\tif (error?.response?.data?.message?.includes('stock') || \r\n\t\t\t\t\t\terror?.message?.includes('stock') ||\r\n\t\t\t\t\t\terror?.response?.data?.message?.includes('insuficiente')) {\r\n\t\t\t\t\t\tconst availableStock = getAvailableStock(item.product);\r\n\t\t\t\t\t\thandleStockError(availableStock, item.quantity + 1);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\thandleError(error, \"No se pudo actualizar la cantidad\");\r\n\t\t\t\t\t}\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tsetLoadingItem(null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t[cart?.items, loadingItem, updateCartItem, optimisticCartAdd, invalidateRelatedPages, fetchCart, \r\n\t\t getAvailableStock, isStockAvailable, handleStockError, handleError]\r\n\t);\r\n\r\n\t// ‚úÖ FUNCI√ìN PARA DISMINUIR CANTIDAD\r\n\tconst decreaseQuantity = useCallback(\r\n\t\tasync (id: number) => {\r\n\t\t\tif (loadingItem) return;\r\n\r\n\t\t\tsetLoadingItem(id);\r\n\t\t\tconst item = cart?.items.find((item) => item.id === id);\r\n\r\n\t\t\tif (item && item.quantity > 1) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\t// Actualizaci√≥n optimista\r\n\t\t\t\t\toptimisticCartRemove();\r\n\r\n\t\t\t\t\tconst result = await updateCartItem({\r\n\t\t\t\t\t\titemId: id,\r\n\t\t\t\t\t\tquantity: item.quantity - 1,\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tif (!result) {\r\n\t\t\t\t\t\tthrow new Error(\"No se pudo actualizar la cantidad\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// ‚úÖ OPTIMIZADO: Solo invalidar cache, no refetch (cart context ya se actualiza)\r\n\t\t\t\t\tinvalidateRelatedPages();\r\n\t\t\t\t} catch (error: any) {\r\n\t\t\t\t\tconsole.error(\"Error al disminuir cantidad:\", error);\r\n\t\t\t\t\thandleError(error, \"No se pudo actualizar la cantidad\");\r\n\t\t\t\t} finally {\r\n\t\t\t\t\tsetLoadingItem(null);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t[cart?.items, loadingItem, updateCartItem, optimisticCartRemove, invalidateRelatedPages, fetchCart, handleError]\r\n\t);\r\n\r\n\t// ‚úÖ FUNCI√ìN PARA ELIMINAR DEL CARRITO\r\n\tconst handleRemoveFromCart = useCallback(\r\n\t\tasync (id: number) => {\r\n\t\t\tif (loadingItem) return;\r\n\r\n\t\t\tsetLoadingItem(id);\r\n\t\t\ttry {\r\n\t\t\t\t// Actualizaci√≥n optimista\r\n\t\t\t\tconst item = cart?.items.find((item) => item.id === id);\r\n\t\t\t\tconst itemQuantity = item?.quantity || 1;\r\n\t\t\t\t\r\n\t\t\t\tfor (let i = 0; i < itemQuantity; i++) {\r\n\t\t\t\t\toptimisticCartRemove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst result = await removeFromCart(id);\r\n\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\t// ‚úÖ OPTIMIZADO: Solo invalidar cache, no refetch (cart context ya se actualiza)\r\n\t\t\t\t\tinvalidateRelatedPages();\r\n\r\n\t\t\t\t\thandleSuccess(\"Producto eliminado del carrito\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(\"No se pudo eliminar el producto\");\r\n\t\t\t\t}\r\n\t\t\t} catch (error: any) {\r\n\t\t\t\tconsole.error(\"Error al eliminar del carrito:\", error);\r\n\t\t\t\thandleError(error, \"No se pudo eliminar el producto\");\r\n\t\t\t} finally {\r\n\t\t\t\tsetLoadingItem(null);\r\n\t\t\t}\r\n\t\t},\r\n\t\t[loadingItem, removeFromCart, invalidateRelatedPages, optimisticCartRemove, cart?.items, fetchCart, handleSuccess, handleError]\r\n\t);\r\n\r\n\t// ‚úÖ FUNCI√ìN PARA MOVER A FAVORITOS\r\n\tconst moveToWishlist = useCallback(\r\n\t\tasync (id: number, productId: number) => {\r\n\t\t\tif (loadingItem) return;\r\n\r\n\t\t\tsetLoadingItem(id);\r\n\t\t\ttry {\r\n\t\t\t\t// Actualizaci√≥n optimista\r\n\t\t\t\toptimisticFavoriteAdd();\r\n\r\n\t\t\t\tconst item = cart?.items.find((item) => item.id === id);\r\n\t\t\t\tconst itemQuantity = item?.quantity || 1;\r\n\t\t\t\t\r\n\t\t\t\tfor (let i = 0; i < itemQuantity; i++) {\r\n\t\t\t\t\toptimisticCartRemove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Primero agregamos a favoritos\r\n\t\t\t\tawait toggleFavorite(productId);\r\n\r\n\t\t\t\t// Luego eliminamos del carrito\r\n\t\t\t\tconst result = await removeFromCart(id);\r\n\r\n\t\t\t\tif (result) {\r\n\t\t\t\t\t// ‚úÖ OPTIMIZADO: Solo invalidar cache, no refetch (cart context ya se actualiza)\r\n\t\t\t\t\tinvalidateRelatedPages();\r\n\r\n\t\t\t\t\thandleSuccess(\"Producto movido a favoritos\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error(\"No se pudo mover el producto a favoritos\");\r\n\t\t\t\t}\r\n\t\t\t} catch (error: any) {\r\n\t\t\t\tconsole.error(\"Error al mover a favoritos:\", error);\r\n\t\t\t\thandleError(error, \"No se pudo mover el producto a favoritos\");\r\n\t\t\t} finally {\r\n\t\t\t\tsetLoadingItem(null);\r\n\t\t\t}\r\n\t\t},\r\n\t\t[loadingItem, toggleFavorite, removeFromCart, optimisticFavoriteAdd, optimisticCartRemove, invalidateRelatedPages, cart?.items, fetchCart, handleSuccess, handleError]\r\n\t);\r\n\r\n\t// ‚úÖ FUNCI√ìN PARA APLICAR CUP√ìN - USANDO NUEVA API DE CART CONTEXT\r\n\tconst applyCoupon = useCallback(async () => {\r\n\t\tif (!couponCode.trim()) {\r\n\t\t\tshowNotification(NotificationType.ERROR, \"Por favor ingresa un c√≥digo de cup√≥n\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetIsApplyingCoupon(true);\r\n\r\n\t\ttry {\r\n\t\t\tconst result = await applyDiscountCode(couponCode);\r\n\t\t\t\r\n\t\t\tif (result.success) {\r\n\t\t\t\thandleSuccess(result.message);\r\n\t\t\t\tsetCouponCode(\"\"); // Limpiar el campo despu√©s de aplicar\r\n\t\t\t} else {\r\n\t\t\t\tshowNotification(NotificationType.ERROR, result.message);\r\n\t\t\t}\r\n\t\t} catch (error: any) {\r\n\t\t\tconsole.error(\"Error applying coupon:\", error);\r\n\t\t\tshowNotification(NotificationType.ERROR, \"Error inesperado al aplicar el cup√≥n\");\r\n\t\t} finally {\r\n\t\t\tsetIsApplyingCoupon(false);\r\n\t\t}\r\n\t}, [couponCode, applyDiscountCode, handleSuccess, showNotification]);\r\n\r\n\t// ‚úÖ FUNCI√ìN PARA REMOVER CUP√ìN - USANDO NUEVA API DE CART CONTEXT\r\n\tconst removeCoupon = useCallback(async () => {\r\n\t\ttry {\r\n\t\t\tconst result = await removeDiscountCode();\r\n\t\t\t\r\n\t\t\tif (result.success) {\r\n\t\t\t\thandleSuccess(result.message);\r\n\t\t\t\tsetCouponCode(\"\"); // Limpiar el campo\r\n\t\t\t} else {\r\n\t\t\t\tshowNotification(NotificationType.ERROR, result.message);\r\n\t\t\t}\r\n\t\t} catch (error: any) {\r\n\t\t\tconsole.error(\"Error removing coupon:\", error);\r\n\t\t\tshowNotification(NotificationType.ERROR, \"Error inesperado al remover el cup√≥n\");\r\n\t\t}\r\n\t}, [removeDiscountCode, handleSuccess, showNotification]);\r\n\r\n\t// ‚úÖ FUNCI√ìN PARA VACIAR CARRITO\r\n\tconst handleEmptyCart = useCallback(async () => {\r\n\t\tif (loading) return;\r\n\r\n\t\ttry {\r\n\t\t\t// Actualizaci√≥n optimista\r\n\t\t\tconst totalItems = cart?.items.reduce((total, item) => total + item.quantity, 0) || 0;\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < totalItems; i++) {\r\n\t\t\t\toptimisticCartRemove();\r\n\t\t\t}\r\n\r\n\t\t\tconst result = await clearCart();\r\n\r\n\t\t\tif (result) {\r\n\t\t\t\t// ‚úÖ INVALIDAR CACHE (clearCart() ya hace fetchCart internamente)\r\n\t\t\t\tinvalidateRelatedPages();\r\n\r\n\t\t\t\thandleSuccess(\"Carrito vaciado exitosamente\");\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"No se pudo vaciar el carrito\");\r\n\t\t\t}\r\n\t\t} catch (error: any) {\r\n\t\t\tconsole.error(\"Error al vaciar el carrito:\", error);\r\n\t\t\thandleError(error, \"No se pudo vaciar el carrito\");\r\n\t\t}\r\n\t}, [loading, clearCart, invalidateRelatedPages, optimisticCartRemove, cart?.items, fetchCart, handleSuccess, handleError]);\r\n\r\n\t// ‚úÖ FUNCI√ìN PARA PROCEDER AL CHECKOUT\r\n\tconst handleCheckout = useCallback(() => {\r\n\t\tif (isEmpty) {\r\n\t\t\tshowNotification(\r\n\t\t\t\tNotificationType.ERROR,\r\n\t\t\t\t\"No hay productos en el carrito\"\r\n\t\t\t);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Redireccionar a la p√°gina de checkout\r\n\t\tnavigate(\"/checkout\");\r\n\t}, [isEmpty, navigate, showNotification]);\r\n\r\n\t// ‚úÖ COMPONENTE ACTUALIZADO PARA ITEM DEL CARRITO CON DESCUENTOS POR VOLUMEN\r\n\tconst CartItem = React.memo(\r\n\t\t({\r\n\t\t\titem,\r\n\t\t\tonIncrease,\r\n\t\t\tonDecrease,\r\n\t\t\tonRemove,\r\n\t\t\tonMoveToWishlist,\r\n\t\t\tisLoading,\r\n\t\t}: {\r\n\t\t\titem: CartItemWithDiscounts;\r\n\t\t\tonIncrease: () => void;\r\n\t\t\tonDecrease: () => void;\r\n\t\t\tonRemove: () => void;\r\n\t\t\tonMoveToWishlist: () => void;\r\n\t\t\tisLoading: boolean;\r\n\t\t}) => {\r\n\t\t\tconst discount = item.discount;\r\n\t\t\tconst availableStock = getAvailableStock(item.product);\r\n\t\t\tconst isAtStockLimit = item.quantity >= availableStock;\r\n\t\t\t\r\n\t\t\treturn (\r\n\t\t\t\t<div className=\"border-b border-gray-200 last:border-b-0\">\r\n\t\t\t\t\t<div className=\"grid sm:grid-cols-12 gap-4 p-5\">\r\n\t\t\t\t\t\t{/* Producto (imagen y nombre) */}\r\n\t\t\t\t\t\t<div className=\"sm:col-span-6 flex\">\r\n\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\tto={`/products/${item.productId}`}\r\n\t\t\t\t\t\t\t\tclassName=\"w-24 h-24 flex-shrink-0\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\t\tsrc={item.imageUrl}\r\n\t\t\t\t\t\t\t\t\talt={item.product?.name || `Producto ${item.productId}`}\r\n\t\t\t\t\t\t\t\t\tclassName=\"w-full h-full object-cover rounded\"\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t<div className=\"ml-4 flex flex-col\">\r\n\t\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\t\tto={`/products/${item.productId}`}\r\n\t\t\t\t\t\t\t\t\tclassName=\"font-medium text-lg mb-2 text-gray-800 hover:text-primary-600\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{item.product?.name || `Producto ${item.productId}`}\r\n\t\t\t\t\t\t\t\t</Link>\r\n\r\n\t\t\t\t\t\t\t\t{/* ‚úÖ MOSTRAR INFORMACI√ìN DE STOCK */}\r\n\t\t\t\t\t\t\t\t<div className=\"flex items-center space-x-2 mb-2\">\r\n\t\t\t\t\t\t\t\t\t{availableStock > 0 ? (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-2 h-2 bg-green-500 rounded-full mr-1\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-green-600\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t{availableStock} en stock\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t\t<AlertTriangle size={12} className=\"text-red-500 mr-1\" />\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-red-600\">Agotado</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t{/* ‚úÖ MOSTRAR DESCUENTOS APLICADOS */}\r\n\t\t\t\t\t\t\t\t<div className=\"flex flex-wrap gap-2 mb-2\">\r\n\t\t\t\t\t\t\t\t\t{discount.sellerDiscountAmount > 0 && (\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded flex items-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t<Gift size={12} className=\"mr-1\" />\r\n\t\t\t\t\t\t\t\t\t\t\tSeller: {item.product?.discount_percentage || 0}% OFF\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t{discount.volumeDiscountAmount > 0 && (\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-xs bg-green-100 text-green-600 px-2 py-1 rounded flex items-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t<TrendingDown size={12} className=\"mr-1\" />\r\n\t\t\t\t\t\t\t\t\t\t\tVolumen: {discount.discountPercentage}% OFF adicional\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t{/* ‚úÖ MOSTRAR AHORROS TOTALES */}\r\n\t\t\t\t\t\t\t\t{discount.hasDiscount && (\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-green-600 mb-2\">\r\n\t\t\t\t\t\t\t\t\t\tAhorras: {formatCurrency(discount.savingsTotal)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t\t<div className=\"mt-auto flex space-x-3 text-sm pt-3\">\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tonClick={onRemove}\r\n\t\t\t\t\t\t\t\t\t\tdisabled={isLoading}\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"text-gray-500 hover:text-red-500 flex items-center disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<Trash2 size={14} className=\"mr-1\" />\r\n\t\t\t\t\t\t\t\t\t\tEliminar\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tonClick={onMoveToWishlist}\r\n\t\t\t\t\t\t\t\t\t\tdisabled={isLoading}\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"text-gray-500 hover:text-primary-600 flex items-center disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<Heart size={14} className=\"mr-1\" />\r\n\t\t\t\t\t\t\t\t\t\tGuardar\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t{/* Precio */}\r\n\t\t\t\t\t\t<div className=\"sm:col-span-2 flex items-center justify-center sm:justify-center\">\r\n\t\t\t\t\t\t\t<div className=\"sm:hidden mr-2 font-medium text-gray-800\">\r\n\t\t\t\t\t\t\t\tPrecio:\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"font-medium flex flex-col items-center\">\r\n\t\t\t\t\t\t\t\t<span className=\"text-gray-800\">\r\n\t\t\t\t\t\t\t\t\t{formatCurrency(discount.finalPricePerUnit)}\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t{discount.hasDiscount && (\r\n\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-gray-500 line-through\">\r\n\t\t\t\t\t\t\t\t\t\t{formatCurrency(discount.originalPrice)}\r\n\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t{/* Cantidad */}\r\n\t\t\t\t\t\t<div className=\"sm:col-span-2 flex items-center justify-center\">\r\n\t\t\t\t\t\t\t<div className=\"sm:hidden mr-2 font-medium text-gray-800\">\r\n\t\t\t\t\t\t\t\tCantidad:\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"flex flex-col items-center\">\r\n\t\t\t\t\t\t\t\t<div className=\"flex items-center border border-gray-300 rounded-md\">\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tonClick={onDecrease}\r\n\t\t\t\t\t\t\t\t\t\tdisabled={item.quantity <= 1 || isLoading}\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"px-2 py-1 text-gray-600 hover:text-gray-800 disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<Minus size={14} />\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t<span className=\"px-3 py-1 text-gray-800 text-center w-10\">\r\n\t\t\t\t\t\t\t\t\t\t{isLoading ? (\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"inline-block h-4 w-4 border-2 border-t-primary-600 border-r-primary-600 border-b-primary-200 border-l-primary-200 rounded-full animate-spin\"></span>\r\n\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\titem.quantity\r\n\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tonClick={onIncrease}\r\n\t\t\t\t\t\t\t\t\t\tdisabled={isLoading || isAtStockLimit || availableStock === 0}\r\n\t\t\t\t\t\t\t\t\t\tclassName=\"px-2 py-1 text-gray-600 hover:text-gray-800 disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t<Plus size={14} />\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t{/* ‚úÖ ADVERTENCIA DE STOCK LIMITADO */}\r\n\t\t\t\t\t\t\t\t{isAtStockLimit && availableStock > 0 && (\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-xs text-amber-600 mt-1 flex items-center\">\r\n\t\t\t\t\t\t\t\t\t\t<AlertTriangle size={10} className=\"mr-1\" />\r\n\t\t\t\t\t\t\t\t\t\tL√≠mite de stock\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t{/* Total */}\r\n\t\t\t\t\t\t<div className=\"sm:col-span-2 flex items-center justify-center sm:justify-center\">\r\n\t\t\t\t\t\t\t<div className=\"sm:hidden mr-2 font-medium text-gray-800\">\r\n\t\t\t\t\t\t\t\tTotal:\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"flex flex-col items-center\">\r\n\t\t\t\t\t\t\t\t<span className=\"font-bold text-gray-800\">\r\n\t\t\t\t\t\t\t\t\t{formatCurrency(discount.finalPricePerUnit * item.quantity)}\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t{discount.hasDiscount && (\r\n\t\t\t\t\t\t\t\t\t<span className=\"text-xs text-green-600\">\r\n\t\t\t\t\t\t\t\t\t\t(-{formatCurrency(discount.savingsTotal)})\r\n\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t);\r\n\t\t}\r\n\t);\r\n\r\n\treturn (\r\n\t\t<div className=\"container mx-auto px-4 lg:px-8 py-10\">\r\n\t\t\t<h1 className=\"text-3xl font-bold mb-8\">Mi Carrito</h1>\r\n\r\n\t\t\t{isLoading || loadingDiscounts ? (\r\n\t\t\t\t<div className=\"flex justify-center items-center h-64\">\r\n\t\t\t\t\t<div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600\"></div>\r\n\t\t\t\t</div>\r\n\t\t\t) : isEmpty ? (\r\n\t\t\t\t<div className=\"text-center py-20 bg-gray-50 rounded-lg\">\r\n\t\t\t\t\t<ShoppingCart className=\"mx-auto h-16 w-16 text-gray-300 mb-6\" />\r\n\t\t\t\t\t<h2 className=\"text-2xl font-semibold text-gray-700 mb-3\">\r\n\t\t\t\t\t\tTu carrito est√° vac√≠o\r\n\t\t\t\t\t</h2>\r\n\t\t\t\t\t<p className=\"text-gray-500 mb-8 max-w-md mx-auto\">\r\n\t\t\t\t\t\tA√±ade productos a tu carrito para continuar comprando.\r\n\t\t\t\t\t</p>\r\n\t\t\t\t\t<Link\r\n\t\t\t\t\t\tto=\"/products\"\r\n\t\t\t\t\t\tclassName=\"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tExplorar productos\r\n\t\t\t\t\t</Link>\r\n\t\t\t\t</div>\r\n\t\t\t) : (\r\n\t\t\t\t<div className=\"flex flex-col lg:flex-row gap-8\">\r\n\t\t\t\t\t{/* Lista de productos */}\r\n\t\t\t\t\t<div className=\"lg:w-2/3\">\r\n\t\t\t\t\t\t{/* ‚úÖ BANNER DE DESCUENTOS APLICADOS */}\r\n\t\t\t\t\t\t{(cartTotals.totalSavings > 0) && (\r\n\t\t\t\t\t\t\t<div className=\"bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4 mb-6\">\r\n\t\t\t\t\t\t\t\t<div className=\"flex items-center\">\r\n\t\t\t\t\t\t\t\t\t<TrendingDown size={20} className=\"text-green-600 mr-3\" />\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex-1\">\r\n\t\t\t\t\t\t\t\t\t\t<h3 className=\"font-medium text-green-800\">\r\n\t\t\t\t\t\t\t\t\t\t\t¬°Descuentos Aplicados!\r\n\t\t\t\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"text-sm text-green-600 mt-1 space-y-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t{cartTotals.totalSellerSavings > 0 && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p>Descuentos del vendedor: {formatCurrency(cartTotals.totalSellerSavings)}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t{cartTotals.totalVolumeSavings > 0 && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p>Descuentos por volumen: {formatCurrency(cartTotals.totalVolumeSavings)}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"text-2xl font-bold text-green-600\">\r\n\t\t\t\t\t\t\t\t\t\t{formatCurrency(cartTotals.totalSavings)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t<div className=\"bg-white rounded-lg shadow-lg overflow-hidden mb-6\">\r\n\t\t\t\t\t\t\t{/* Encabezado */}\r\n\t\t\t\t\t\t\t<div className=\"hidden sm:grid sm:grid-cols-12 gap-4 p-5 bg-gray-50 border-b\">\r\n\t\t\t\t\t\t\t\t<div className=\"sm:col-span-6\">\r\n\t\t\t\t\t\t\t\t\t<span className=\"font-medium text-gray-800\">Producto</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"sm:col-span-2 text-center\">\r\n\t\t\t\t\t\t\t\t\t<span className=\"font-medium text-gray-800\">Precio</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"sm:col-span-2 text-center\">\r\n\t\t\t\t\t\t\t\t\t<span className=\"font-medium text-gray-800\">Cantidad</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"sm:col-span-2 text-center\">\r\n\t\t\t\t\t\t\t\t\t<span className=\"font-medium text-gray-800\">Total</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t{/* ‚úÖ PRODUCTOS CON DESCUENTOS CALCULADOS */}\r\n\t\t\t\t\t\t\t{cartItemsWithDiscounts.map((item) => (\r\n\t\t\t\t\t\t\t\t<CartItem\r\n\t\t\t\t\t\t\t\t\tkey={item.id}\r\n\t\t\t\t\t\t\t\t\titem={item}\r\n\t\t\t\t\t\t\t\t\tonIncrease={() => increaseQuantity(item.id)}\r\n\t\t\t\t\t\t\t\t\tonDecrease={() => decreaseQuantity(item.id)}\r\n\t\t\t\t\t\t\t\t\tonRemove={() => handleRemoveFromCart(item.id)}\r\n\t\t\t\t\t\t\t\t\tonMoveToWishlist={() => moveToWishlist(item.id, item.productId)}\r\n\t\t\t\t\t\t\t\t\tisLoading={loadingItem === item.id}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t))}\r\n\r\n\t\t\t\t\t\t\t{/* Botones de acci√≥n en la parte inferior */}\r\n\t\t\t\t\t\t\t<div className=\"flex justify-between items-center p-5 bg-gray-50\">\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\tonClick={handleEmptyCart}\r\n\t\t\t\t\t\t\t\t\tdisabled={isEmpty || loading}\r\n\t\t\t\t\t\t\t\t\tclassName=\"px-4 py-2 text-red-600 border border-red-200 rounded-lg hover:bg-red-50 transition-colors disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\tVaciar carrito\r\n\t\t\t\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t\t\t\t<div className=\"text-sm text-gray-600\">\r\n\t\t\t\t\t\t\t\t\t{itemCount} {itemCount === 1 ? \"producto\" : \"productos\"} en el carrito\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t{/* Bot√≥n para continuar comprando */}\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\tto=\"/products\"\r\n\t\t\t\t\t\t\t\tclassName=\"inline-flex items-center text-primary-600 hover:text-primary-700\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<ArrowLeft size={18} className=\"mr-2\" />\r\n\t\t\t\t\t\t\t\tContinuar comprando\r\n\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* ‚úÖ RESUMEN CON TODOS LOS DESCUENTOS */}\r\n\t\t\t\t\t<div className=\"lg:w-1/3\">\r\n\t\t\t\t\t\t<div className=\"bg-white rounded-lg shadow-lg overflow-hidden\">\r\n\t\t\t\t\t\t\t<div className=\"p-6\">\r\n\t\t\t\t\t\t\t\t<h2 className=\"text-xl font-bold text-gray-800 mb-4\">\r\n\t\t\t\t\t\t\t\t\tResumen del pedido\r\n\t\t\t\t\t\t\t\t</h2>\r\n\r\n\t\t\t\t\t\t\t\t{/* ‚úÖ SECCI√ìN DE CUP√ìN - A√ëADIDA PARA CORREGIR ERRORES */}\r\n\t\t\t\t\t\t\t\t<div className=\"mb-4 pb-4 border-b border-gray-200\">\r\n\t\t\t\t\t\t\t\t\t<label htmlFor=\"coupon\" className=\"flex items-center text-sm font-medium text-gray-700 mb-2\">\r\n\t\t\t\t\t\t\t\t\t\t<Tag size={16} className=\"mr-2\" /> ¬øTienes un cup√≥n?\r\n\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex\">\r\n\t\t\t\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\t\t\t\tid=\"coupon\"\r\n\t\t\t\t\t\t\t\t\t\t\tvalue={couponCode}\r\n\t\t\t\t\t\t\t\t\t\t\tonChange={(e) => setCouponCode(e.target.value)}\r\n\t\t\t\t\t\t\t\t\t\t\tplaceholder=\"C√≥digo de cup√≥n\"\r\n\t\t\t\t\t\t\t\t\t\t\tdisabled={!!appliedDiscount}\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"flex-grow p-2 border border-gray-300 rounded-l-md focus:ring-primary-500 focus:border-primary-500 disabled:bg-gray-100\"\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\tonClick={applyCoupon}\r\n\t\t\t\t\t\t\t\t\t\t\tdisabled={!couponCode || !!appliedDiscount || isApplyingCoupon}\r\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"px-4 py-2 bg-gray-800 text-white font-semibold rounded-r-md hover:bg-gray-900 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t{isApplyingCoupon ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tAplicando...\r\n\t\t\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t'Aplicar'\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t{/* ‚úÖ C√ÅLCULOS CON DESCUENTOS POR VOLUMEN */}\r\n\t\t\t\t\t\t\t\t<div className=\"space-y-4 pt-4\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-600\">\r\n\t\t\t\t\t\t\t\t\t\t\tSubtotal (con descuentos)\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\r\n\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(cartTotals.subtotal)}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t{/* ‚úÖ MOSTRAR AHORROS DESGLOSADOS */}\r\n\t\t\t\t\t\t\t\t\t{cartTotals.totalSellerSavings > 0 && (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between text-blue-600\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"flex items-center text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Gift size={16} className=\"mr-1\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\tDescuentos del vendedor\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t-{formatCurrency(cartTotals.totalSellerSavings)}\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t\t\t{cartTotals.totalVolumeSavings > 0 && (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between text-green-600\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"flex items-center text-sm\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<TrendingDown size={16} className=\"mr-1\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\tDescuentos por volumen\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t-{formatCurrency(cartTotals.totalVolumeSavings)}\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-600\">Env√≠o:</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\r\n\t\t\t\t\t\t\t\t\t\t\t{cartTotals.shipping === 0 ? \r\n\t\t\t\t\t\t\t\t\t\t\t\t\"Gratis\" : \r\n\t\t\t\t\t\t\t\t\t\t\t\tformatCurrency(cartTotals.shipping)\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t{appliedDiscount && (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between text-green-600\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center gap-2\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span>Descuento de cup√≥n ({appliedDiscount.discountCode.discount_percentage}%)</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={removeCoupon}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"text-gray-400 hover:text-red-500 transition-colors text-sm\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Remover cup√≥n\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Trash2 className=\"w-4 h-4\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t<span>-{formatCurrency(cartTotals.couponAmount)}</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-gray-600\">IVA (15%)</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"font-medium\">\r\n\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(cartTotals.tax)}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex justify-between border-t border-gray-200 pt-4\">\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-xl font-bold\">Total</span>\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-xl font-bold\">\r\n\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(cartTotals.total)}\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t{/* ‚úÖ RESUMEN DE AHORROS TOTALES */}\r\n\t\t\t\t\t\t\t\t\t{cartTotals.totalSavings > 0 && (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"bg-green-50 border border-green-200 rounded-lg p-3\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-sm font-medium text-green-800\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tTotal ahorrado:\r\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"text-lg font-bold text-green-600\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{formatCurrency(cartTotals.totalSavings)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t{/* Bot√≥n de checkout */}\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\tonClick={handleCheckout}\r\n\t\t\t\t\t\t\t\t\tdisabled={isEmpty || loading}\r\n\t\t\t\t\t\t\t\t\tclassName=\"mt-8 w-full bg-primary-600 hover:bg-primary-700 text-white font-medium py-3 px-4 rounded-md transition-colors disabled:opacity-50\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\tProceder al pago\r\n\t\t\t\t\t\t\t\t</button>\r\n\r\n\t\t\t\t\t\t\t\t{/* Informaci√≥n adicional */}\r\n\t\t\t\t\t\t\t\t<div className=\"mt-4 text-xs text-gray-500\">\r\n\t\t\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t\t\tLos impuestos y gastos de env√≠o se calculan durante el\r\n\t\t\t\t\t\t\t\t\t\tproceso de pago.\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t<p className=\"mt-1\">\r\n\t\t\t\t\t\t\t\t\t\tAceptamos diversas formas de pago, incluyendo tarjetas de\r\n\t\t\t\t\t\t\t\t\t\tcr√©dito, transferencias bancarias y pago contra entrega.\r\n\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t{cartTotals.totalSavings > 0 && (\r\n\t\t\t\t\t\t\t\t\t\t<p className=\"mt-2 text-green-600 font-medium\">\r\n\t\t\t\t\t\t\t\t\t\t\t¬°Tienes descuentos aplicados en tu carrito!\r\n\t\t\t\t\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\r\n\t\t\t{/* Mostrar errores de la API */}\r\n\t\t\t{error && (\r\n\t\t\t\t<div className=\"mt-4 p-4 bg-red-50 text-red-700 rounded-lg\">\r\n\t\t\t\t\t<p className=\"font-medium\">Error: {error}</p>\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tonClick={() => fetchCart()}\r\n\t\t\t\t\t\tclassName=\"underline text-sm mt-1\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\tReintentar cargar el carrito\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default CartPage;\r\n"],"names":["CartPage","isLoading","setIsLoading","useState","isEmpty","setIsEmpty","couponCode","setCouponCode","loadingItem","setLoadingItem","isApplyingCoupon","setIsApplyingCoupon","navigate","useNavigate","getOptimizedImageUrl","useImageCache","prefetchCartPageData","useAutoPrefetch","cart","loading","error","fetchCart","itemCount","removeFromCart","updateCartItem","clearCart","showNotification","appliedDiscount","applyDiscountCode","removeDiscountCode","useCart","toggleFavorite","useFavorites","handleError","handleSuccess","handleStockError","useErrorHandler","optimisticCartAdd","optimisticCartRemove","optimisticFavoriteAdd","useInvalidateCounters","getAvailableStock","useCallback","product","isStockAvailable","requestedQuantity","invalidateRelatedPages","CacheService","page","getProductImage","cartItemsWithDiscounts","setCartItemsWithDiscounts","loadingDiscounts","setLoadingDiscounts","useEffect","itemsWithDiscounts","item","discount","calculateCartItemDiscountsAsync","fallbackItems","calculateCartItemDiscounts","cartTotals","setCartTotals","result","EcommerceCalculator","increaseQuantity","id","availableStock","newQuantity","decreaseQuantity","handleRemoveFromCart","itemQuantity","i","moveToWishlist","productId","applyCoupon","NotificationType","removeCoupon","handleEmptyCart","totalItems","total","handleCheckout","CartItem","React","onIncrease","onDecrease","onRemove","onMoveToWishlist","isAtStockLimit","jsxs","jsx","Link","AlertTriangle","Gift","TrendingDown","formatCurrency","Trash2","Heart","Minus","Plus","ShoppingCart","ArrowLeft","Tag","e","Fragment"],"mappings":"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"}