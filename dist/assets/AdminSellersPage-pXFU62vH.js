import{j as e,r as _,E as T,ag as $,n as V,X as B,R as U,F as G,d as A,D as H,aG as W,c as J}from"./ui-vendor-BUNMIuFe.js";import{r as d}from"./react-vendor-Cy458wKG.js";import{c as C,T as X,f as K}from"./admin-chunk-BNcFjXlJ.js";import{a as D}from"./AdminSellerService-B2Gtbd0h.js";const Q=({isOpen:b,onClose:c,onConfirm:S,sellerName:n})=>{const[l,v]=d.useState("active"),[u,g]=d.useState("");if(!b)return null;const i=()=>{S(l,l==="active"?"":u),g(""),v("active"),c()},k=()=>{switch(l){case"suspended":return e.jsx($,{className:"h-12 w-12 text-yellow-500"});case"inactive":return e.jsx(T,{className:"h-12 w-12 text-red-500"});case"active":return e.jsx(_,{className:"h-12 w-12 text-green-500"});default:return e.jsx(_,{className:"h-12 w-12 text-green-500"})}},y=()=>{switch(l){case"suspended":return"bg-yellow-600 hover:bg-yellow-700";case"inactive":return"bg-red-600 hover:bg-red-700";case"active":return"bg-green-600 hover:bg-green-700";default:return"bg-blue-600 hover:bg-blue-700"}},N=()=>{switch(l){case"active":return{title:"Estado Activo",description:"El vendedor tendrá acceso completo. Sus productos aparecerán en la tienda y podrá vender normalmente."};case"suspended":return{title:"Estado Suspendido",description:"El vendedor podrá ver su información histórica pero sus productos no aparecerán en la tienda. No podrá realizar ventas."};case"inactive":return{title:"Estado Inactivo",description:"El vendedor podrá ingresar pero verá todos sus datos en cero. Sus productos no aparecerán en la tienda."};default:return{title:"",description:""}}},m=[{value:"active",label:"Activo"},{value:"suspended",label:"Suspendido"},{value:"inactive",label:"Inactivo"}],x=N();return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:c}),e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md z-10",children:[e.jsxs("div",{className:"flex flex-col items-center mb-4",children:[k(),e.jsx("h3",{className:"text-xl font-semibold mt-2 text-gray-900",children:"Cambiar Estado de Vendedor"})]}),e.jsxs("p",{className:"text-gray-700 mb-4 text-center",children:["Vendedor: ",e.jsx("strong",{children:n})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nuevo Estado:"}),e.jsx("select",{className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500",value:l,onChange:h=>v(h.target.value),children:m.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))})]}),x.title&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-md border",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:x.title}),e.jsx("p",{className:"text-sm text-gray-600",children:x.description})]}),l!=="active"&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Motivo ",e.jsx("span",{className:"text-red-500",children:"*"}),":"]}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500",rows:3,value:u,onChange:h=>g(h.target.value),placeholder:"Explique brevemente la razón de esta acción...",required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition-colors",onClick:c,children:"Cancelar"}),e.jsx("button",{className:`px-4 py-2 text-white rounded-md transition-colors ${y()}`,onClick:i,disabled:l!=="active"&&!u.trim(),children:"Confirmar Cambio"})]})]})]})},Y=({isOpen:b,onClose:c,onSubmit:S,seller:n,title:l,isCreate:v=!1,users:u=[]})=>{const[g,i]=d.useState({store_name:"",description:"",status:"pending",commission_rate:10,is_featured:!1,user_id:0}),[k,y]=d.useState(!1),[N,m]=d.useState(null);if(d.useEffect(()=>{n&&!v?i({store_name:n.storeName,description:n.description||"",commission_rate:n.commissionRate,is_featured:n.isFeatured}):v&&i({user_id:u.length>0?u[0].id:0,store_name:"",description:"",status:"pending",commission_rate:10,is_featured:!1})},[n,v,u]),!b)return null;const x=o=>{const{name:p,value:E,type:P}=o.target;if(P==="checkbox"){const j=o.target;i(F=>({...F,[p]:j.checked}))}else i(p==="commission_rate"?j=>({...j,[p]:parseFloat(E)}):p==="user_id"?j=>({...j,[p]:parseInt(E,10)}):j=>({...j,[p]:E}))},h=async o=>{o.preventDefault(),y(!0),m(null);try{await S(g),c()}catch(p){p instanceof Error?m(p.message):m("Error al procesar el formulario")}finally{y(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:c}),e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-lg z-10 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"h-6 w-6 mr-2 text-primary-600"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:l})]}),e.jsx("button",{onClick:c,className:"text-gray-400 hover:text-gray-500",children:e.jsx(B,{className:"h-5 w-5"})})]}),N&&e.jsx("div",{className:"mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:N}),e.jsxs("form",{onSubmit:h,children:[v&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Usuario:"}),e.jsxs("select",{name:"user_id",value:g.user_id||0,onChange:x,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"",children:"Seleccionar usuario"}),u.map(o=>e.jsxs("option",{value:o.id,children:[o.name," (",o.email,")"]},o.id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de la tienda:"}),e.jsx("input",{type:"text",name:"store_name",value:g.store_name,onChange:x,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción:"}),e.jsx("textarea",{name:"description",value:g.description,onChange:x,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"})]}),v&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado inicial:"}),e.jsxs("select",{name:"status",value:g.status,onChange:x,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500",children:[e.jsx("option",{value:"pending",children:"Pendiente"}),e.jsx("option",{value:"active",children:"Activo"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"is_featured",checked:g.is_featured||!1,onChange:x,className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700",children:"Vendedor Destacado"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Los vendedores destacados tienen todos sus productos automáticamente destacados"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tasa de comisión (%):"}),e.jsx("input",{type:"number",name:"commission_rate",value:g.commission_rate,min:"0",max:"100",step:"0.1",disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100 text-gray-500 cursor-not-allowed"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Campo informativo - La comisión se configurará en el futuro"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[e.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:k,className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors disabled:opacity-70 disabled:cursor-not-allowed flex items-center",children:k?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Procesando..."]}):v?"Crear vendedor":"Guardar cambios"})]})]})]})]})},te=()=>{const[b,c]=d.useState([]),[S,n]=d.useState(!0),[l,v]=d.useState("all"),[u,g]=d.useState("all"),[i,k]=d.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),[y,N]=d.useState({isOpen:!1,sellerId:0,status:"activate",title:"",message:"",buttonText:""}),[m,x]=d.useState({isOpen:!1,seller:null,isCreate:!0,title:"Crear nuevo vendedor"}),[h,o]=d.useState(null);d.useEffect(()=>{p()},[l,u,i.currentPage]);const p=async()=>{n(!0),o(null);try{const a=new URLSearchParams({page:i.currentPage.toString(),per_page:i.itemsPerPage.toString()});l!=="all"&&a.append("status",l),u!=="all"&&a.append("is_featured",u==="featured"?"1":"0");const s=await C.get(`/admin/sellers?${a.toString()}`);console.log("Full response:",JSON.stringify(s,null,2));let t=[];if(s.success!==!1&&s.data)Array.isArray(s.data.data)?t=s.data.data:Array.isArray(s.data)&&(t=s.data),console.log("Extracted sellers data:",t),c(t),s.data&&s.data.current_page&&k({currentPage:s.data.current_page,totalPages:s.data.last_page,totalItems:s.data.total,itemsPerPage:s.data.per_page});else throw console.error("Response not successful:",s),new Error(s.message||s.error||"Error al obtener sellers")}catch(a){console.error("Error al obtener vendedores:",a),o("Error al cargar vendedores. Por favor, inténtalo de nuevo.")}finally{n(!1)}},E=a=>{const s=b.find(R=>R.id===a);if(!s)return;let t,r="",f="",w="";const z=s.store_name||s.storeName||s.userName||s.name||`ID: ${s.id}`;s.status==="active"?(t="suspend",r="Suspender vendedor",f=`¿Estás seguro de que deseas suspender al vendedor "${z}"? Esta acción limitará temporalmente su capacidad para vender y no podrá acceder a su cuenta.`,w="Suspender"):s.status==="suspended"?(t="deactivate",r="Desactivar vendedor",f=`¿Estás seguro de que deseas desactivar al vendedor "${z}"? Esta acción lo desactivará completamente.`,w="Desactivar"):(t="activate",r="Activar vendedor",f=`¿Estás seguro de que deseas activar al vendedor "${z}"? Esta acción permitirá que vuelva a vender en la plataforma.`,w="Activar"),N({isOpen:!0,sellerId:a,status:t,title:r,message:f,buttonText:w})},P=async(a,s)=>{n(!0),o(null);try{const{sellerId:t}=y;await D.updateSellerStatus(t,a,s),c(r=>r.map(f=>f.id===t?{...f,status:a}:f)),N(r=>({...r,isOpen:!1}))}catch(t){console.error("Error al actualizar estado:",t),o("Error al actualizar el estado del vendedor. Por favor, inténtalo de nuevo.")}finally{n(!1)}},j=async a=>{n(!0),o(null);try{await D.updateSellerStatus(a,"active"),c(s=>s.map(t=>t.id===a?{...t,status:"active"}:t)),alert(`Vendedor #${a} ha sido aprobado`)}catch(s){console.error("Error al aprobar vendedor:",s),o("Error al aprobar el vendedor. Por favor, inténtalo de nuevo.")}finally{n(!1)}},F=async a=>{const s=b.find(r=>r.id===a);if(!s)return;const t=!s.isFeatured;n(!0),o(null);try{if(await C.put(`/admin/sellers/${a}`,{is_featured:t}),t)try{await C.post(`/admin/sellers/${a}/feature-products`),console.log(`Todos los productos del vendedor ${a} han sido marcados como destacados`)}catch(f){console.error("Error al marcar productos como destacados:",f)}c(f=>f.map(w=>w.id===a?{...w,isFeatured:t}:w)),alert(`Vendedor ${t?"destacado":"desmarcado como destacado"} correctamente${t?". Todos sus productos han sido marcados como destacados.":"."}`)}catch(r){console.error("Error al actualizar estado destacado:",r),o("Error al actualizar estado destacado. Por favor, inténtalo de nuevo.")}finally{n(!1)}},O=a=>{x({isOpen:!0,seller:a,isCreate:!1,title:`Editar vendedor: ${a.store_name||a.storeName||a.userName||a.name}`})},I=async a=>{n(!0),o(null);try{m.isCreate?(await C.post("/admin/sellers",a),alert("Vendedor creado correctamente")):m.seller&&(await C.put(`/admin/sellers/${m.seller.id}`,a),alert("Vendedor actualizado correctamente")),p(),x(s=>({...s,isOpen:!1}))}catch(s){throw console.error("Error al procesar vendedor:",s),s}finally{n(!1)}},M=a=>{k(s=>({...s,currentPage:a}))},q=()=>{p()},L=[{key:"store",header:"Tienda",sortable:!0,render:a=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center overflow-hidden",children:e.jsx(V,{className:"h-6 w-6 text-primary-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900 flex items-center",children:[a.store_name,a.isFeatured&&e.jsx("span",{className:"ml-2",children:e.jsx(A,{className:"h-4 w-4 text-yellow-500 inline"})})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[a.userName," (",a.email,")"]}),e.jsxs("div",{className:"text-xs text-gray-400",children:["ID: ",a.id]})]})]})},{key:"status",header:"Estado",sortable:!0,render:a=>{let s="",t="",r=null;switch(a.status){case"active":s="bg-green-100 text-green-800",t="Activo",r=_;break;case"pending":s="bg-yellow-100 text-yellow-800",t="Pendiente",r=J;break;case"suspended":s="bg-red-100 text-red-800",t="Suspendido",r=$;break;case"inactive":s="bg-gray-100 text-gray-800",t="Inactivo",r=T;break}return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s}`,children:[r&&e.jsx(r,{className:"w-3 h-3 mr-1"}),t]})}},{key:"verification",header:"Verificación",sortable:!0,render:a=>{const s=a.isFeatured;return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:s?"Destacado":"Normal"})}},{key:"rating",header:"Valoración",sortable:!0,render:a=>e.jsx("div",{className:"flex items-center",children:a.average_rating&&a.average_rating>0?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-4 w-4 text-yellow-500 mr-1"}),e.jsx("span",{children:a.average_rating.toFixed(1)})]}):e.jsx("span",{className:"text-xs text-gray-500",children:"Sin valoraciones"})})},{key:"sales",header:"Ventas",sortable:!0,render:a=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"h-4 w-4 text-green-500 mr-1"}),e.jsx("span",{children:K(a.total_revenue||0)})]})},{key:"createdAt",header:"Creado",sortable:!0,render:a=>{const s=a.created_at;if(!s)return"N/A";const t=new Date(s);return isNaN(t.getTime())?"Fecha inválida":t.toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"})}},{key:"actions",header:"Acciones",render:a=>e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>E(a.id),className:`p-1 rounded-md ${a.status==="active"?"text-red-600 hover:bg-red-100":"text-green-600 hover:bg-green-100"}`,title:a.status==="active"?"Suspender vendedor":a.status==="suspended"?"Desactivar vendedor":"Activar vendedor",children:a.status==="active"?e.jsx($,{size:18}):e.jsx(_,{size:18})}),a.status==="pending"&&e.jsx("button",{onClick:()=>j(a.id),className:"p-1 text-green-600 hover:bg-green-100 rounded-md",title:"Aprobar vendedor",children:e.jsx(_,{size:18})}),e.jsx("button",{onClick:()=>F(a.id),className:`p-1 rounded-md ${a.isFeatured?"text-yellow-600 hover:bg-yellow-100":"text-gray-600 hover:bg-gray-100"}`,title:a.isFeatured?"Desmarcar como destacado":"Verificar",children:a.isFeatured?e.jsx(A,{size:18}):e.jsx(W,{size:18})}),e.jsx("button",{onClick:()=>O(a),className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Editar vendedor",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Vendedores"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("button",{onClick:q,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",disabled:S,children:[e.jsx(U,{size:18,className:`inline mr-2 ${S?"animate-spin":""}`}),"Actualizar"]})})]}),h&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:e.jsx("span",{className:"block sm:inline",children:h})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"h-5 w-5 text-gray-500"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:l,onChange:a=>v(a.target.value),children:[e.jsx("option",{value:"all",children:"Todos los Estados"}),e.jsx("option",{value:"active",children:"Activos"}),e.jsx("option",{value:"pending",children:"Pendientes"}),e.jsx("option",{value:"suspended",children:"Suspendidos"}),e.jsx("option",{value:"inactive",children:"Inactivos"})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:u,onChange:a=>g(a.target.value),children:[e.jsx("option",{value:"all",children:"Todos los Tipos"}),e.jsx("option",{value:"featured",children:"Destacados"}),e.jsx("option",{value:"normal",children:"Normales"})]})})]})}),e.jsx(X,{data:b,columns:L,searchFields:["store_name","storeName","name","userName","email"],loading:S,emptyMessage:"No se encontraron vendedores",pagination:{currentPage:i.currentPage,totalPages:i.totalPages,totalItems:i.totalItems,itemsPerPage:i.itemsPerPage,onPageChange:M}}),e.jsx(Q,{isOpen:y.isOpen,onClose:()=>N(a=>({...a,isOpen:!1})),onConfirm:P,sellerName:b.find(a=>a.id===y.sellerId)?.store_name||b.find(a=>a.id===y.sellerId)?.userName||"Vendedor"}),e.jsx(Y,{isOpen:m.isOpen,onClose:()=>x(a=>({...a,isOpen:!1})),onSubmit:I,seller:m.seller,title:m.title,isCreate:m.isCreate,users:[]})]})};export{te as default};
//# sourceMappingURL=AdminSellersPage-pXFU62vH.js.map
