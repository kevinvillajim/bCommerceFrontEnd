import{j as e,f as O,R as G,S as J,F as Q,e as B,a as D,M as X,P as H,E as W,aX as Y,T as Z,H as ee}from"./ui-vendor-DEBjJ4HS.js";import{r as a,L as U}from"./react-vendor-Cy458wKG.js";import{i as se,T as re}from"./admin-chunk-C7Ad4l4I.js";import{R as te,f as K}from"./seller-chunk-CL4v7LiS.js";import{S as ae}from"./StarRating-wHilpPP8.js";import{R as le}from"./RatingService-7o_oFnRY.js";import"./utils-vendor-DeGC_a19.js";const ne=({averageRating:f,totalRatings:i,distribution:n,className:h=""})=>{const v=c=>i>0?c/i*100:0;return e.jsx("div",{className:`bg-white rounded-lg shadow-sm p-4 ${h}`,children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center",children:[e.jsxs("div",{className:"flex flex-col items-center mb-4 md:mb-0 md:mr-8",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-900",children:f.toFixed(1)}),e.jsx(ae,{value:f,readOnly:!0,size:"small"}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:["(",i," ",i===1?"valoración":"valoraciones",")"]})]}),e.jsx("div",{className:"flex-grow w-full md:w-auto",children:[5,4,3,2,1].map(c=>{const m=n[c.toString()]||0,u=v(m);return e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsxs("div",{className:"flex items-center w-16 text-sm text-gray-600",children:[e.jsx("span",{children:c}),e.jsx(O,{size:12,className:"ml-1 text-yellow-400"})]}),e.jsx("div",{className:"flex-grow mx-2",children:e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-yellow-400 rounded-full",style:{width:`${u}%`}})})}),e.jsxs("div",{className:"w-12 text-right text-xs text-gray-500",children:[m," (",u.toFixed(0),"%)"]})]},c)})})]})})},oe=()=>{const i=a.useRef(new le).current,[n,h]=a.useState([]),[v,c]=a.useState(!0),[m,u]=a.useState(null),[d,j]=a.useState(""),[x,N]=a.useState("all"),[y,p]=a.useState("all"),[w,_]=a.useState("all"),[C,F]=a.useState("all"),[b,R]=a.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),g=a.useCallback(async()=>{c(!0),u(null);try{const r=await i.getMyReceivedRatings(b.currentPage,b.itemsPerPage,x!=="all"?x:void 0);r&&(h(r.data),R(t=>({...t,totalPages:r.meta.last_page,totalItems:r.meta.total})))}catch(r){console.error("Error al obtener valoraciones:",r);const t=se(r,"Error al cargar valoraciones");u(t)}finally{c(!1)}},[b.currentPage,b.itemsPerPage,x]);a.useEffect(()=>{g()},[]);const k=r=>{R(t=>({...t,currentPage:r})),setTimeout(()=>g(),0)},z=r=>{N(r),R(t=>({...t,currentPage:1})),setTimeout(()=>g(),0)},q=()=>{j(""),N("all"),p("all"),_("all"),F("all"),R(r=>({...r,currentPage:1})),setTimeout(()=>g(),0)},I=async(r,t)=>{try{const l=await i.replyToRating({rating_id:r,reply_text:t});return g(),l}catch(l){throw console.error("Error al responder valoración:",l),l}},S=async(r,t)=>{try{const l=await i.reportRating({rating_id:r,reason:t});return g(),l}catch(l){throw console.error("Error al reportar valoración:",l),l}},L=a.useMemo(()=>{const r={averageRating:0,totalCount:0,distribution:{1:0,2:0,3:0,4:0,5:0},statusCounts:{pending:0,approved:0,rejected:0},verifiedCount:0,respondedCount:0};if(!n.length)return r;let t=0;const l={1:0,2:0,3:0,4:0,5:0},E={pending:0,approved:0,rejected:0};let P=0,T=0;return n.forEach(s=>{t+=s.rating;const o=String(s.rating);l[o]++,E[s.status]++,s.is_verified_purchase&&P++,s.seller_response&&T++}),{averageRating:n.length?t/n.length:0,totalCount:n.length,distribution:l,statusCounts:E,verifiedCount:P,respondedCount:T}},[n]),M=a.useMemo(()=>n.filter(r=>!(d&&!A(r,d)||y!=="all"&&String(r.rating)!==y||x!=="all"&&r.status!==x||w==="verified"&&!r.is_verified_purchase||w==="unverified"&&r.is_verified_purchase||C!=="all"&&String(r.product_id)!==C)),[n,d,y,x,w,C]),A=(r,t)=>{const l=t.toLowerCase();return!!(r.title&&r.title.toLowerCase().includes(l)||r.comment&&r.comment.toLowerCase().includes(l)||r.user&&r.user.name&&r.user.name.toLowerCase().includes(l)||r.product&&r.product.name&&r.product.name.toLowerCase().includes(l))},$=a.useCallback(()=>{const r=new Map;return n.forEach(t=>{t.product_id&&t.product?.name&&r.set(String(t.product_id),{id:String(t.product_id),name:t.product.name})}),Array.from(r.values())},[n]);return{ratings:n,filteredRatings:M,loading:v,error:m,stats:L,pagination:b,handlePageChange:k,searchTerm:d,setSearchTerm:j,statusFilter:x,setStatusFilter:z,ratingFilter:y,setRatingFilter:p,verifiedFilter:w,setVerifiedFilter:_,productFilter:C,setProductFilter:F,clearFilters:q,fetchRatings:g,replyToRating:I,reportRating:S,getUniqueProducts:$}},ge=()=>{const[f,i]=a.useState(null),[n,h]=a.useState(""),[v,c]=a.useState(null),[m,u]=a.useState(""),[d,j]=a.useState(!1),{filteredRatings:x,loading:N,error:y,stats:p,statusFilter:w,setStatusFilter:_,ratingFilter:C,setRatingFilter:F,verifiedFilter:b,setVerifiedFilter:R,productFilter:g,setProductFilter:k,searchTerm:z,setSearchTerm:q,clearFilters:I,pagination:S,handlePageChange:L,fetchRatings:M,replyToRating:A,reportRating:$,getUniqueProducts:r}=oe(),t=r(),l=async s=>{if(s.preventDefault(),!(!f||!n.trim()))try{j(!0),await A(f,n.trim()),alert("Respuesta enviada con éxito"),i(null),h("")}catch(o){console.error("Error al responder valoración:",o),alert("Error al enviar la respuesta")}finally{j(!1)}},E=async s=>{if(s.preventDefault(),!(!v||!m.trim()))try{j(!0),await $(v,m.trim()),alert("Reporte enviado con éxito"),c(null),u("")}catch(o){console.error("Error al reportar valoración:",o),alert("Error al enviar el reporte")}finally{j(!1)}},P=()=>{i(null),h(""),c(null),u("")},T=[{key:"product",header:"Producto",sortable:!0,render:s=>e.jsxs("div",{className:"flex items-center space-x-3",children:[s.product?.image?e.jsx("img",{src:s.product.image,alt:s.product.name,className:"w-12 h-12 rounded-md object-cover",onError:o=>{const V=o.target;V.src="https://via.placeholder.com/100?text=Producto"}}):e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-md flex items-center justify-center",children:e.jsx(H,{className:"w-6 h-6 text-gray-500"})}),e.jsxs("div",{children:[e.jsx(U,{to:`/seller/products/${s.product_id}`,className:"font-medium text-primary-600 hover:underline",children:s.product?.name||`Producto #${s.product_id}`}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ID: ",s.product_id]})]})]})},{key:"rating",header:"Valoración",sortable:!0,render:s=>e.jsxs("div",{className:"flex flex-col items-start space-y-1",children:[e.jsx(te,{rating:s.rating,size:18}),e.jsxs("div",{className:"text-sm font-medium",children:[s.rating,"/5"]})]})},{key:"user",header:"Cliente",sortable:!0,render:s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[s.user?.avatar?e.jsx("img",{src:s.user.avatar,alt:s.user.name,className:"w-8 h-8 rounded-full object-cover",onError:o=>{const V=o.target;V.src="https://via.placeholder.com/100?text=User"}}):e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-gray-500 text-sm font-medium",children:s.user?.name?s.user.name.charAt(0).toUpperCase():"U"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.user?.name||`Usuario #${s.user_id}`}),e.jsx("div",{className:"flex items-center text-xs text-gray-500",children:s.is_verified_purchase&&e.jsxs("span",{className:"flex items-center text-green-600",children:[e.jsx(D,{size:12,className:"mr-1"}),"Compra verificada"]})})]})]})},{key:"comment",header:"Comentario",render:s=>e.jsxs("div",{children:[s.title&&e.jsx("div",{className:"font-medium text-gray-900",children:s.title}),s.comment&&e.jsx("div",{className:"text-sm text-gray-600 line-clamp-2",children:s.comment}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:K(s.created_at)})]})},{key:"status",header:"Estado",sortable:!0,render:s=>{let o={icon:B,colorClass:"bg-yellow-100 text-yellow-800",text:"Pendiente"};return s.status==="approved"?o={icon:D,colorClass:"bg-green-100 text-green-800",text:"Aprobada"}:s.status==="rejected"&&(o={icon:ee,colorClass:"bg-red-100 text-red-800",text:"Rechazada"}),e.jsx("div",{className:"flex flex-col space-y-2",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${o.colorClass}`,children:[e.jsx(o.icon,{size:12,className:"mr-1"}),o.text]})})}},{key:"response",header:"Respuesta",render:s=>e.jsx("div",{children:s.seller_response?e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded border border-gray-200",children:[e.jsx("div",{className:"line-clamp-2",children:s.seller_response.text}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:K(s.seller_response.created_at)})]}):e.jsx("span",{className:"text-gray-500 text-sm",children:"Sin respuesta"})})},{key:"actions",header:"Acciones",render:s=>e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(U,{to:`/seller/ratings/${s.id}`,className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Ver detalles completos",children:e.jsx(W,{size:18})}),e.jsx(U,{to:`/seller/products/${s.product_id}`,className:"p-1 text-gray-600 hover:bg-gray-100 rounded-md",title:"Ver producto",children:e.jsx(H,{size:18})}),!s.seller_response&&e.jsx("button",{onClick:()=>{i(s.id||0),h("")},className:"p-1 text-green-600 hover:bg-green-100 rounded-md",title:"Responder a la valoración",children:e.jsx(X,{size:18})}),e.jsx("button",{onClick:()=>{c(s.id||0),u("")},className:"p-1 text-orange-600 hover:bg-orange-100 rounded-md0",title:"Reportar valoración",children:e.jsx(Y,{size:18})}),s.rating<=2&&!s.seller_response&&e.jsx("span",{className:"p-1 text-red-600",title:"Valoración negativa sin respuesta",children:e.jsx(Z,{size:18})})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Valoraciones y Reseñas"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("button",{onClick:()=>M(),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",disabled:N,children:[e.jsx(G,{size:18,className:`inline mr-2 ${N?"animate-spin":""}`}),"Actualizar"]})})]}),y&&e.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:[e.jsx("strong",{className:"font-bold",children:"Error: "}),e.jsx("span",{className:"block sm:inline",children:y})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("input",{type:"text",placeholder:"Buscar por producto, cliente, comentario...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",value:z,onChange:s=>q(s.target.value)}),e.jsx(J,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"h-5 w-5 text-gray-500"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:C,onChange:s=>F(s.target.value),children:[e.jsx("option",{value:"all",children:"Todas las estrellas"}),e.jsx("option",{value:"5",children:"5 estrellas"}),e.jsx("option",{value:"4",children:"4 estrellas"}),e.jsx("option",{value:"3",children:"3 estrellas"}),e.jsx("option",{value:"2",children:"2 estrellas"}),e.jsx("option",{value:"1",children:"1 estrella"})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:w,onChange:s=>_(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos los estados"}),e.jsx("option",{value:"pending",children:"Pendientes"}),e.jsx("option",{value:"approved",children:"Aprobadas"}),e.jsx("option",{value:"rejected",children:"Rechazadas"})]})}),t.length>0&&e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:g,onChange:s=>k(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos los productos"}),t.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:b,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"all",children:"Todas las compras"}),e.jsx("option",{value:"verified",children:"Compras verificadas"}),e.jsx("option",{value:"unverified",children:"Compras no verificadas"})]})}),e.jsx("button",{onClick:I,className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Limpiar filtros"})]})}),e.jsx(ne,{averageRating:p.averageRating,totalRatings:p.totalCount,distribution:p.distribution}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:p.statusCounts.pending})]}),e.jsx("div",{className:"p-2 bg-yellow-50 rounded-lg",children:e.jsx(B,{className:"h-5 w-5 text-yellow-600"})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Aprobadas"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:p.statusCounts.approved})]}),e.jsx("div",{className:"p-2 bg-green-50 rounded-lg",children:e.jsx(D,{className:"h-5 w-5 text-green-600"})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Respondidas"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:p.respondedCount})]}),e.jsx("div",{className:"p-2 bg-blue-50 rounded-lg",children:e.jsx(X,{className:"h-5 w-5 text-blue-600"})})]})})]}),f&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 border-l-4 border-green-500",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Responder a la valoración"}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reply-text",className:"block text-sm font-medium text-gray-700 mb-2",children:"Tu respuesta"}),e.jsx("textarea",{id:"reply-text",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Escribe tu respuesta a esta valoración...",value:n,onChange:s=>h(s.target.value),required:!0}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Tu respuesta será visible públicamente para todos los usuarios."})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:P,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300",disabled:d,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",disabled:!n.trim()||d,children:d?"Enviando...":"Enviar respuesta"})]})]})]}),v&&e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6 border-l-4 border-orange-500",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Reportar valoración"}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"report-reason",className:"block text-sm font-medium text-gray-700 mb-2",children:"Motivo del reporte"}),e.jsx("textarea",{id:"report-reason",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Describe por qué consideras que esta valoración debe ser revisada...",value:m,onChange:s=>u(s.target.value),required:!0}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Tu reporte será revisado por el equipo de moderación."})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:P,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300",disabled:d,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700",disabled:!m.trim()||d,children:d?"Enviando...":"Enviar reporte"})]})]})]}),e.jsx(re,{data:x,columns:T,searchFields:["title","comment"],loading:N,emptyMessage:"No se encontraron valoraciones",pagination:{currentPage:S.currentPage,totalPages:S.totalPages,totalItems:S.totalItems,itemsPerPage:S.itemsPerPage,onPageChange:L}})]})};export{ge as default};
//# sourceMappingURL=SellerRatingsPage-VvBehw1J.js.map
