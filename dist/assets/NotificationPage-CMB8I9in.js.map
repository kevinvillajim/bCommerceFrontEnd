{"version":3,"file":"NotificationPage-CMB8I9in.js","sources":["../../src/presentation/pages/NotificationPage.tsx"],"sourcesContent":["// src/presentation/pages/NotificationPage.tsx - CON SOPORTE PARA MODO OSCURO\r\nimport React, {useState, useEffect, useCallback} from \"react\";\r\nimport {useNavigate} from \"react-router-dom\";\r\nimport {\r\n\tBell,\r\n\tCheck,\r\n\tCheckCheck,\r\n\tTrash2,\r\n\tPackage,\r\n\tShoppingCart,\r\n\tMessageCircle,\r\n\tStar,\r\n\tTrendingUp,\r\n\tAlertTriangle,\r\n\tGift,\r\n\tTruck,\r\n\tFileText,\r\n\tMoreVertical,\r\n\tShield,\r\n\tBan,\r\n} from \"lucide-react\";\r\nimport {useNotifications} from \"../hooks/useNotifications\";\r\nimport {useAuth} from \"../hooks/useAuth\";\r\nimport {useInvalidateCounters} from \"../hooks/useHeaderCounters\";\r\nimport type {Notification} from \"../../core/domain/entities/Notification\";\r\nimport {formatRelativeTime} from \"../../utils/dateUtils\";\r\nimport CacheService from \"../../infrastructure/services/CacheService\";\r\n\r\n// Funci√≥n para obtener el icono seg√∫n el tipo de notificaci√≥n\r\nconst getNotificationIcon = (type: string) => {\r\n\tswitch (type) {\r\n\t\tcase \"new_message\":\r\n\t\t\treturn <MessageCircle className=\"text-blue-500\" size={20} />;\r\n\t\tcase \"order_status\":\r\n\t\t\treturn <Package className=\"text-green-500\" size={20} />;\r\n\t\tcase \"shipping_update\":\r\n\t\t\treturn <Truck className=\"text-purple-500\" size={20} />;\r\n\t\tcase \"product_update\":\r\n\t\t\treturn <TrendingUp className=\"text-orange-500\" size={20} />;\r\n\t\tcase \"rating_received\":\r\n\t\tcase \"seller_rated\":\r\n\t\t\treturn <Star className=\"text-yellow-500\" size={20} />;\r\n\t\tcase \"new_order\":\r\n\t\t\treturn <ShoppingCart className=\"text-green-600\" size={20} />;\r\n\t\tcase \"low_stock\":\r\n\t\t\treturn <AlertTriangle className=\"text-red-500\" size={20} />;\r\n\t\tcase \"feedback_response\":\r\n\t\t\treturn <FileText className=\"text-indigo-500\" size={20} />;\r\n\t\tcase \"promotion\":\r\n\t\tcase \"discount\":\r\n\t\t\treturn <Gift className=\"text-pink-500\" size={20} />;\r\n\t\tcase \"seller_strike\":\r\n\t\t\treturn <Shield className=\"text-orange-500\" size={20} />;\r\n\t\tcase \"account_blocked\":\r\n\t\t\treturn <Ban className=\"text-red-500\" size={20} />;\r\n\t\tcase \"seller_status_warning\":\r\n\t\t\treturn <AlertTriangle className=\"text-orange-600\" size={20} />;\r\n\t\tcase \"seller_suspended\":\r\n\t\t\treturn <AlertTriangle className=\"text-yellow-600\" size={20} />;\r\n\t\tcase \"seller_inactive\":\r\n\t\t\treturn <Ban className=\"text-red-600\" size={20} />;\r\n\t\tdefault:\r\n\t\t\treturn <Bell className=\"text-gray-500\" size={20} />;\r\n\t}\r\n};\r\n\r\n// Funci√≥n para obtener el color de fondo seg√∫n el tipo - CON DARK MODE\r\nconst getNotificationColor = (type: string) => {\r\n\tswitch (type) {\r\n\t\tcase \"new_message\":\r\n\t\t\treturn \"bg-blue-50 border-blue-200\";\r\n\t\tcase \"order_status\":\r\n\t\t\treturn \"bg-green-50 border-green-200\";\r\n\t\tcase \"shipping_update\":\r\n\t\t\treturn \"bg-purple-50 border-purple-200\";\r\n\t\tcase \"product_update\":\r\n\t\t\treturn \"bg-orange-50 border-orange-200\";\r\n\t\tcase \"rating_received\":\r\n\t\tcase \"seller_rated\":\r\n\t\t\treturn \"bg-yellow-50 border-yellow-200\";\r\n\t\tcase \"new_order\":\r\n\t\t\treturn \"bg-emerald-50 border-emerald-200\";\r\n\t\tcase \"low_stock\":\r\n\t\t\treturn \"bg-red-50 border-red-200\";\r\n\t\tcase \"feedback_response\":\r\n\t\t\treturn \"bg-indigo-50 border-indigo-200\";\r\n\t\tcase \"promotion\":\r\n\t\tcase \"discount\":\r\n\t\t\treturn \"bg-pink-50 border-pink-200\";\r\n\t\tcase \"seller_strike\":\r\n\t\t\treturn \"bg-orange-50 border-orange-200\";\r\n\t\tcase \"account_blocked\":\r\n\t\t\treturn \"bg-red-50 border-red-200\";\r\n\t\tcase \"seller_status_warning\":\r\n\t\t\treturn \"bg-orange-50 border-orange-300\";\r\n\t\tcase \"seller_suspended\":\r\n\t\t\treturn \"bg-yellow-50 border-yellow-300\";\r\n\t\tcase \"seller_inactive\":\r\n\t\t\treturn \"bg-red-50 border-red-300\";\r\n\t\tdefault:\r\n\t\t\treturn \"bg-gray-50 border-gray-200/50\";\r\n\t}\r\n};\r\n\r\n// Componente para el men√∫ de acciones de notificaci√≥n - CON DARK MODE\r\ninterface NotificationActionsProps {\r\n\tnotification: Notification;\r\n\tonMarkAsRead: (id: number) => void;\r\n\tonDelete: (id: number) => void;\r\n\tisOpen: boolean;\r\n\tonToggle: () => void;\r\n}\r\n\r\nconst NotificationActions: React.FC<NotificationActionsProps> = ({\r\n\tnotification,\r\n\tonMarkAsRead,\r\n\tonDelete,\r\n\tisOpen,\r\n\tonToggle,\r\n}) => {\r\n\treturn (\r\n\t\t<div className=\"relative\">\r\n\t\t\t<button\r\n\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\tonToggle();\r\n\t\t\t\t}}\r\n\t\t\t\tclassName=\"p-1 rounded-full hover:bg-gray-200 transition-colors\"\r\n\t\t\t>\r\n\t\t\t\t<MoreVertical size={16} className=\"text-gray-500\" />\r\n\t\t\t</button>\r\n\r\n\t\t\t{isOpen && (\r\n\t\t\t\t<div className=\"absolute right-0 top-8 bg-white rounded-lg shadow-lg border border-gray-200 z-10 min-w-[150px]\">\r\n\t\t\t\t\t{!notification.read && (\r\n\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\t\tonMarkAsRead(notification.id!);\r\n\t\t\t\t\t\t\t\tonToggle();\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tclassName=\"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<Check size={14} className=\"mr-2\" />\r\n\t\t\t\t\t\t\tMarcar como le√≠da\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\tonClick={(e) => {\r\n\t\t\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t\t\t\tonDelete(notification.id!);\r\n\t\t\t\t\t\t\tonToggle();\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tclassName=\"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<Trash2 size={14} className=\"mr-2\" />\r\n\t\t\t\t\t\tEliminar\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nconst NotificationPage: React.FC = () => {\r\n\tconst [filter, setFilter] = useState<\"all\" | \"unread\">(\"all\");\r\n\tconst [activeMenu, setActiveMenu] = useState<number | null>(null);\r\n\tconst navigate = useNavigate();\r\n\tconst {isAuthenticated, roleInfo} = useAuth();\r\n\r\n\t// ‚úÖ Hook para actualizaciones optimistas del header\r\n\tconst {optimisticNotificationRead, forceRefresh: refreshHeaderCounters} = useInvalidateCounters();\r\n\r\n\tconst {\r\n\t\tnotifications,\r\n\t\tloading,\r\n\t\terror,\r\n\t\tunreadCount,\r\n\t\thasMore,\r\n\t\tcurrentPage,\r\n\t\ttotalNotifications,\r\n\t\tfetchNotifications,\r\n\t\tmarkAsRead,\r\n\t\tmarkAllAsRead,\r\n\t\tdeleteNotification,\r\n\t} = useNotifications();\r\n\r\n\t// ‚úÖ FUNCI√ìN SIMPLE PARA INVALIDAR CACHE\r\n\tconst invalidateNotificationsCache = useCallback(() => {\r\n\t\tconsole.log(\"üóëÔ∏è Invalidando cache de notificaciones\");\r\n\t\tCacheService.removeItem(\"notifications_data\");\r\n\t\tCacheService.removeItem(\"notifications_unread_count\");\r\n\t}, []);\r\n\r\n\t// ‚úÖ FUNCI√ìN SIMPLE PARA REFRESCAR MANUALMENTE\r\n\tconst forceRefresh = useCallback(() => {\r\n\t\tconsole.log(\"üîÑ Forzando refresh de notificaciones\");\r\n\t\tinvalidateNotificationsCache();\r\n\t\tfetchNotifications(1, filter === \"unread\");\r\n\t}, [invalidateNotificationsCache, fetchNotifications, filter]);\r\n\r\n\t// Redirigir si no est√° autenticado\r\n\tuseEffect(() => {\r\n\t\tif (!isAuthenticated) {\r\n\t\t\tnavigate(\"/login\", {state: {from: \"/notifications\"}});\r\n\t\t}\r\n\t}, [isAuthenticated, navigate]);\r\n\r\n\t// ‚úÖ CARGAR NOTIFICACIONES INICIALES SIMPLE\r\n\tuseEffect(() => {\r\n\t\tif (isAuthenticated) {\r\n\t\t\tconsole.log(`üìã Cargando notificaciones (filtro: ${filter})`);\r\n\t\t\tfetchNotifications(1, filter === \"unread\");\r\n\t\t}\r\n\t}, [isAuthenticated, filter, fetchNotifications]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (notifications.length > 0) {\r\n\t\t\tconsole.log(\"üìä Notificaciones recibidas:\", notifications.slice(0, 2));\r\n\t\t}\r\n\t}, [notifications]);\r\n\r\n\t// CORRECCI√ìN: Funci√≥n mejorada para obtener URL correcta seg√∫n el rol del usuario\r\n\tconst getNotificationUrl = (notification: Notification): string | null => {\r\n\t\tconst {type, data} = notification;\r\n\r\n\t\t// Detectar si es seller y ajustar rutas\r\n\t\tconst isSeller = roleInfo.isSeller;\r\n\r\n\t\tconsole.log(\r\n\t\t\t`üîÄ Procesando notificaci√≥n tipo: ${type}, isSeller: ${isSeller}`,\r\n\t\t\tdata\r\n\t\t);\r\n\r\n\t\tswitch (type) {\r\n\t\t\tcase \"new_message\":\r\n\t\t\t\tif (data.chat_id) {\r\n\t\t\t\t\t// CORRECCI√ìN: Redirigir a ruta correcta seg√∫n el rol\r\n\t\t\t\t\tconst chatUrl = isSeller\r\n\t\t\t\t\t\t? `/seller/messages/${data.chat_id}`\r\n\t\t\t\t\t\t: `/chats/${data.chat_id}`;\r\n\t\t\t\t\tconsole.log(`üìß Redirigiendo a chat: ${chatUrl}`);\r\n\t\t\t\t\treturn chatUrl;\r\n\t\t\t\t}\r\n\t\t\t\t// Fallback a p√°gina principal de mensajes\r\n\t\t\t\treturn isSeller ? \"/seller/messages\" : \"/chats\";\r\n\r\n\t\t\tcase \"feedback_response\":\r\n\t\t\t\treturn data.feedback_id ? `/feedback/${data.feedback_id}` : \"/feedback\";\r\n\r\n\t\t\tcase \"order_status\":\r\n\t\t\t\tif (data.order_id) {\r\n\t\t\t\t\treturn isSeller\r\n\t\t\t\t\t\t? `/seller/orders/${data.order_id}`\r\n\t\t\t\t\t\t: `/orders/${data.order_id}`;\r\n\t\t\t\t}\r\n\t\t\t\treturn isSeller ? \"/seller/orders\" : \"/orders\";\r\n\r\n\t\t\tcase \"product_update\":\r\n\t\t\t\tif (data.product_id) {\r\n\t\t\t\t\treturn isSeller\r\n\t\t\t\t\t\t? `/seller/products/edit/${data.product_id}`\r\n\t\t\t\t\t\t: `/products/${data.product_id}`;\r\n\t\t\t\t}\r\n\t\t\t\treturn isSeller ? \"/seller/products\" : null;\r\n\r\n\t\t\tcase \"shipping_update\":\r\n\t\t\t\tif (data.tracking_number) {\r\n\t\t\t\t\treturn `/tracking/${data.tracking_number}`;\r\n\t\t\t\t} else if (data.order_id) {\r\n\t\t\t\t\treturn isSeller\r\n\t\t\t\t\t\t? `/seller/orders/${data.order_id}`\r\n\t\t\t\t\t\t: `/orders/${data.order_id}`;\r\n\t\t\t\t}\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tcase \"rating_received\":\r\n\t\t\tcase \"seller_rated\":\r\n\t\t\t\tif (data.rating_id) {\r\n\t\t\t\t\treturn `/ratings/${data.rating_id}`;\r\n\t\t\t\t}\r\n\t\t\t\treturn isSeller ? \"/seller/ratings\" : \"/profile\";\r\n\r\n\t\t\tcase \"new_order\":\r\n\t\t\t\tif (data.order_id) {\r\n\t\t\t\t\treturn isSeller ? `/seller/orders/${data.order_id}` : null;\r\n\t\t\t\t}\r\n\t\t\t\treturn isSeller ? \"/seller/orders\" : null;\r\n\r\n\t\t\tcase \"low_stock\":\r\n\t\t\t\tif (data.product_id) {\r\n\t\t\t\t\treturn isSeller ? `/seller/products/edit/${data.product_id}` : null;\r\n\t\t\t\t}\r\n\t\t\t\treturn isSeller ? \"/seller/products\" : null;\r\n\r\n\t\t\t// CORRECCI√ìN: Casos espec√≠ficos para strikes y bloqueos\r\n\t\t\tcase \"seller_strike\":\r\n\t\t\tcase \"account_blocked\":\r\n\t\t\t\treturn isSeller ? \"/seller/profile\" : \"/profile\";\r\n\r\n\t\t\t// NUEVO: Manejo de solicitud de calificaci√≥n\r\n\t\t\tcase \"rating_request\":\r\n\t\t\t\treturn notification.data.action_url || \"/pending-rating\";\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.log(`‚ùì Tipo de notificaci√≥n no reconocido: ${type}`);\r\n\t\t\t\treturn null;\r\n\t\t}\r\n\t};\r\n\r\n\t// Manejar click en notificaci√≥n\r\n\tconst handleNotificationClick = useCallback(\r\n\t\tasync (notification: Notification) => {\r\n\t\t\tconsole.log(\r\n\t\t\t\t`üñ±Ô∏è Click en notificaci√≥n ${notification.id} (tipo: ${notification.type})`\r\n\t\t\t);\r\n\r\n\t\t\t// Cerrar men√∫ de acciones si est√° abierto\r\n\t\t\tsetActiveMenu(null);\r\n\r\n\t\t\t// Marcar como le√≠da si no lo est√°\r\n\t\t\tif (!notification.read) {\r\n\t\t\t\t// ‚úÖ ACTUALIZACI√ìN OPTIMISTA DEL HEADER INMEDIATA\r\n\t\t\t\toptimisticNotificationRead();\r\n\t\t\t\t\r\n\t\t\t\tawait markAsRead(notification.id!);\r\n\t\t\t\t// ‚úÖ INVALIDAR CACHE DESPU√âS DE MARCAR COMO LE√çDA\r\n\t\t\t\tinvalidateNotificationsCache();\r\n\t\t\t\t// ‚úÖ REFRESCAR CONTADORES DEL HEADER\r\n\t\t\t\trefreshHeaderCounters();\r\n\t\t\t}\r\n\r\n\t\t\t// Obtener URL de destino\r\n\t\t\tconst url = getNotificationUrl(notification);\r\n\t\t\tif (url) {\r\n\t\t\t\tconsole.log(\r\n\t\t\t\t\t`üîÄ Navegando a: ${url} (usuario ${roleInfo.isSeller ? \"seller\" : \"normal\"})`\r\n\t\t\t\t);\r\n\t\t\t\tnavigate(url);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.log(\"‚ö†Ô∏è No hay URL de destino para esta notificaci√≥n\");\r\n\t\t\t}\r\n\t\t},\r\n\t\t[\r\n\t\t\tmarkAsRead,\r\n\t\t\tinvalidateNotificationsCache,\r\n\t\t\tgetNotificationUrl,\r\n\t\t\troleInfo.isSeller,\r\n\t\t\tnavigate,\r\n\t\t\toptimisticNotificationRead,\r\n\t\t\trefreshHeaderCounters,\r\n\t\t]\r\n\t);\r\n\r\n\t// Manejar eliminaci√≥n de notificaci√≥n\r\n\tconst handleDelete = useCallback(\r\n\t\tasync (id: number) => {\r\n\t\t\t// ‚úÖ Verificar si la notificaci√≥n era no le√≠da para actualizar contador\r\n\t\t\tconst notification = notifications.find(n => n.id === id);\r\n\t\t\tconst wasUnread = notification && !notification.read;\r\n\t\t\t\r\n\t\t\tif (wasUnread) {\r\n\t\t\t\t// ‚úÖ ACTUALIZACI√ìN OPTIMISTA DEL HEADER INMEDIATA\r\n\t\t\t\toptimisticNotificationRead();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tawait deleteNotification(id);\r\n\t\t\t// ‚úÖ INVALIDAR CACHE DESPU√âS DE ELIMINAR\r\n\t\t\tinvalidateNotificationsCache();\r\n\t\t\t// ‚úÖ REFRESCAR CONTADORES DEL HEADER\r\n\t\t\trefreshHeaderCounters();\r\n\t\t},\r\n\t\t[deleteNotification, invalidateNotificationsCache, notifications, optimisticNotificationRead, refreshHeaderCounters]\r\n\t);\r\n\r\n\t// Manejar marcar como le√≠da\r\n\tconst handleMarkAsRead = useCallback(\r\n\t\tasync (id: number) => {\r\n\t\t\t// ‚úÖ ACTUALIZACI√ìN OPTIMISTA DEL HEADER INMEDIATA\r\n\t\t\toptimisticNotificationRead();\r\n\t\t\t\r\n\t\t\tawait markAsRead(id);\r\n\t\t\t// ‚úÖ INVALIDAR CACHE DESPU√âS DE MARCAR COMO LE√çDA\r\n\t\t\tinvalidateNotificationsCache();\r\n\t\t\t// ‚úÖ REFRESCAR CONTADORES DEL HEADER\r\n\t\t\trefreshHeaderCounters();\r\n\t\t},\r\n\t\t[markAsRead, invalidateNotificationsCache, optimisticNotificationRead, refreshHeaderCounters]\r\n\t);\r\n\r\n\t// Manejar marcar todas como le√≠das\r\n\tconst handleMarkAllAsRead = useCallback(async () => {\r\n\t\t// ‚úÖ ACTUALIZACI√ìN OPTIMISTA DEL HEADER - Restar todas las no le√≠das\r\n\t\tconst unreadNotifications = notifications.filter(n => !n.read);\r\n\t\tfor (let i = 0; i < unreadNotifications.length; i++) {\r\n\t\t\toptimisticNotificationRead();\r\n\t\t}\r\n\t\t\r\n\t\tawait markAllAsRead();\r\n\t\t// ‚úÖ INVALIDAR CACHE DESPU√âS DE MARCAR TODAS COMO LE√çDAS\r\n\t\tinvalidateNotificationsCache();\r\n\t\t// ‚úÖ REFRESCAR CONTADORES DEL HEADER\r\n\t\trefreshHeaderCounters();\r\n\t}, [markAllAsRead, invalidateNotificationsCache, notifications, optimisticNotificationRead, refreshHeaderCounters]);\r\n\r\n\t// Cargar m√°s notificaciones\r\n\tconst loadMore = useCallback(() => {\r\n\t\tif (hasMore && !loading) {\r\n\t\t\tfetchNotifications(currentPage + 1, filter === \"unread\");\r\n\t\t}\r\n\t}, [hasMore, loading, currentPage, filter, fetchNotifications]);\r\n\r\n\t// Cambiar filtro\r\n\tconst handleFilterChange = useCallback(\r\n\t\t(newFilter: \"all\" | \"unread\") => {\r\n\t\t\tsetFilter(newFilter);\r\n\t\t\tsetActiveMenu(null);\r\n\t\t\t// Cargar notificaciones con el nuevo filtro\r\n\t\t\tfetchNotifications(1, newFilter === \"unread\");\r\n\t\t},\r\n\t\t[fetchNotifications]\r\n\t);\r\n\r\n\tif (!isAuthenticated) {\r\n\t\treturn null;\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className=\"min-h-screen bg-gray-50 transition-colors\">\r\n\t\t\t<div className=\"container mx-auto px-4 lg:px-8 py-10 max-w-4xl\">\r\n\t\t\t\t{/* Header - CON DARK MODE */}\r\n\t\t\t\t<div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 space-y-4 sm:space-y-0\">\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<h1 className=\"text-3xl font-bold text-gray-900\">Notificaciones</h1>\r\n\t\t\t\t\t\t<p className=\"text-gray-600 mt-1\">\r\n\t\t\t\t\t\t\t{totalNotifications > 0 && (\r\n\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t{totalNotifications}{\" \"}\r\n\t\t\t\t\t\t\t\t\t{totalNotifications === 1 ? \"notificaci√≥n\" : \"notificaciones\"}\r\n\t\t\t\t\t\t\t\t\t{unreadCount > 0 && (\r\n\t\t\t\t\t\t\t\t\t\t<span className=\"text-primary-600 font-medium\">\r\n\t\t\t\t\t\t\t\t\t\t\t, {unreadCount} sin leer\r\n\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className=\"flex items-center space-x-3\">\r\n\t\t\t\t\t\t{/* Filtros - CON DARK MODE */}\r\n\t\t\t\t\t\t<div className=\"flex items-center space-x-2 bg-gray-100 rounded-lg p-1\">\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={() => handleFilterChange(\"all\")}\r\n\t\t\t\t\t\t\t\tclassName={`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${\r\n\t\t\t\t\t\t\t\t\tfilter === \"all\"\r\n\t\t\t\t\t\t\t\t\t\t? \"bg-white text-gray-900 shadow-sm\"\r\n\t\t\t\t\t\t\t\t\t\t: \"text-gray-600 hover:text-gray-900\"\r\n\t\t\t\t\t\t\t\t}`}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tTodas\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={() => handleFilterChange(\"unread\")}\r\n\t\t\t\t\t\t\t\tclassName={`px-3 py-1.5 text-sm font-medium rounded-md transition-colors relative ${\r\n\t\t\t\t\t\t\t\t\tfilter === \"unread\"\r\n\t\t\t\t\t\t\t\t\t\t? \"bg-white text-gray-900 shadow-sm\"\r\n\t\t\t\t\t\t\t\t\t\t: \"text-gray-600 hover:text-gray-900\"\r\n\t\t\t\t\t\t\t\t}`}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tNo le√≠das\r\n\t\t\t\t\t\t\t\t{unreadCount > 0 && (\r\n\t\t\t\t\t\t\t\t\t<span className=\"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center\">\r\n\t\t\t\t\t\t\t\t\t\t{unreadCount > 99 ? \"99\" : unreadCount}\r\n\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t{/* Marcar todas como le√≠das - CON DARK MODE */}\r\n\t\t\t\t\t\t{unreadCount > 0 && (\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={handleMarkAllAsRead}\r\n\t\t\t\t\t\t\t\tdisabled={loading}\r\n\t\t\t\t\t\t\t\tclassName=\"px-4 py-2 bg-primary-600  text-white text-sm font-medium rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 flex items-center\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<CheckCheck size={16} className=\"mr-2\" />\r\n\t\t\t\t\t\t\t\tMarcar todas\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t{/* ‚úÖ BOT√ìN DE REFRESH OPCIONAL - CON DARK MODE */}\r\n\t\t\t\t\t\t{notifications.length > 0 && (\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={forceRefresh}\r\n\t\t\t\t\t\t\t\tdisabled={loading}\r\n\t\t\t\t\t\t\t\tclassName=\"px-3 py-2 text-sm text-blue-600 hover:text-blue-700 disabled:opacity-50 border border-blue-200 rounded-lg hover:bg-blue-50 transition-colors\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{loading ? \"Actualizando...\" : \"Actualizar\"}\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t{/* Error - CON DARK MODE */}\r\n\t\t\t\t{error && (\r\n\t\t\t\t\t<div className=\"bg-red-50 border border-red-200  text-red-700 px-4 py-3 rounded-lg mb-6\">\r\n\t\t\t\t\t\t{error}\r\n\t\t\t\t\t\t<button className=\"ml-2 underline\" onClick={forceRefresh}>\r\n\t\t\t\t\t\t\tReintentar\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t{/* Loading inicial */}\r\n\t\t\t\t{loading && notifications.length === 0 ? (\r\n\t\t\t\t\t<div className=\"flex justify-center items-center h-64\">\r\n\t\t\t\t\t\t<div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600\"></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t) : notifications.length === 0 ? (\r\n\t\t\t\t\t/* Estado vac√≠o - CON DARK MODE */\r\n\t\t\t\t\t<div className=\"text-center py-20 bg-gradient-to-b from-gray-50 to-white rounded-xl shadow-md\">\r\n\t\t\t\t\t\t<Bell className=\"mx-auto h-16 w-16 text-gray-300 mb-6\" />\r\n\t\t\t\t\t\t<h2 className=\"text-2xl font-semibold text-gray-700 mb-3\">\r\n\t\t\t\t\t\t\t{filter === \"unread\"\r\n\t\t\t\t\t\t\t\t? \"No tienes notificaciones sin leer\"\r\n\t\t\t\t\t\t\t\t: \"No tienes notificaciones\"}\r\n\t\t\t\t\t\t</h2>\r\n\t\t\t\t\t\t<p className=\"text-gray-500 mb-8 max-w-md mx-auto\">\r\n\t\t\t\t\t\t\t{filter === \"unread\"\r\n\t\t\t\t\t\t\t\t? \"Todas tus notificaciones est√°n al d√≠a. Te avisaremos cuando tengas algo nuevo.\"\r\n\t\t\t\t\t\t\t\t: \"Cuando tengas actualizaciones importantes, aparecer√°n aqu√≠.\"}\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t\t{filter === \"unread\" && (\r\n\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\tonClick={() => handleFilterChange(\"all\")}\r\n\t\t\t\t\t\t\t\tclassName=\"inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-primary-600  hover:bg-primary-700 shadow-sm hover:shadow transition-all\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tVer todas las notificaciones\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t/* Lista de notificaciones - CON DARK MODE */\r\n\t\t\t\t\t<div className=\"bg-white rounded-xl shadow-lg overflow-hidden\">\r\n\t\t\t\t\t\t{notifications.map((notification, index) => (\r\n\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\tkey={notification.id}\r\n\t\t\t\t\t\t\t\tonClick={() => handleNotificationClick(notification)}\r\n\t\t\t\t\t\t\t\tclassName={`\r\n\t                relative border-l-4 cursor-pointer transition-all duration-200 hover:shadow-sm\r\n\t                ${\r\n\t\t\t\t\t\t\t\t\t\t!notification.read\r\n\t\t\t\t\t\t\t\t\t\t\t? \"bg-primary-50 border-l-primary-500 hover:bg-primary-100\"\r\n\t\t\t\t\t\t\t\t\t\t\t: \"bg-white border-l-gray-200 hover:bg-gray-50\"\r\n\t\t\t\t\t\t\t\t\t}\r\n\t                ${index !== notifications.length - 1 ? \"border-b border-gray-100\" : \"\"}\r\n\t              `}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<div className=\"p-6\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"flex items-start justify-between\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-start space-x-4 flex-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t{/* Icono */}\r\n\t\t\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName={`\r\n\t                      flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center\r\n\t                      ${getNotificationColor(notification.type)}\r\n\t                    `}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{getNotificationIcon(notification.type)}\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t{/* Contenido */}\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex-1 min-w-0\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center space-x-2 mb-1\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<h3\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={`text-base font-medium ${\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t!notification.read\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? \"text-gray-900\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: \"text-gray-700\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}`}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{notification.title}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{!notification.read && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"w-2 h-2 bg-primary-500rounded-full\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<p\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tclassName={`text-sm ${\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t!notification.read ? \"text-gray-700\" : \"text-gray-600\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} mb-2`}\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{notification.message}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</p>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center text-xs text-gray-500\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{formatRelativeTime(notification.createdAt)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t{notification.readAt && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span className=\"ml-2 flex items-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Check size={12} className=\"mr-1\" />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tLe√≠da el {formatRelativeTime(notification.readAt)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t\t\t\t{/* Men√∫ de acciones */}\r\n\t\t\t\t\t\t\t\t\t\t<NotificationActions\r\n\t\t\t\t\t\t\t\t\t\t\tnotification={notification}\r\n\t\t\t\t\t\t\t\t\t\t\tonMarkAsRead={handleMarkAsRead}\r\n\t\t\t\t\t\t\t\t\t\t\tonDelete={handleDelete}\r\n\t\t\t\t\t\t\t\t\t\t\tisOpen={activeMenu === notification.id}\r\n\t\t\t\t\t\t\t\t\t\t\tonToggle={() =>\r\n\t\t\t\t\t\t\t\t\t\t\t\tsetActiveMenu(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tactiveMenu === notification.id ? null : notification.id!\r\n\t\t\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t))}\r\n\r\n\t\t\t\t\t\t{/* Bot√≥n cargar m√°s - CON DARK MODE */}\r\n\t\t\t\t\t\t{hasMore && (\r\n\t\t\t\t\t\t\t<div className=\"p-6 bg-gray-50/50 border-t\">\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\tonClick={loadMore}\r\n\t\t\t\t\t\t\t\t\tdisabled={loading}\r\n\t\t\t\t\t\t\t\t\tclassName=\"w-full px-4 py-3 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 font-medium\"\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{loading ? (\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"flex items-center justify-center\">\r\n\t\t\t\t\t\t\t\t\t\t\t<div className=\"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-gray-400 mr-2\"></div>\r\n\t\t\t\t\t\t\t\t\t\t\tCargando...\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\"Cargar m√°s notificaciones\"\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t{/* Click outside para cerrar men√∫s */}\r\n\t\t\t\t{activeMenu !== null && (\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"fixed inset-0 z-0\"\r\n\t\t\t\t\t\tonClick={() => setActiveMenu(null)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default NotificationPage;"],"names":["getNotificationIcon","type","jsx","MessageCircle","Package","Truck","TrendingUp","Star","ShoppingCart","AlertTriangle","FileText","Gift","Shield","Ban","Bell","getNotificationColor","NotificationActions","notification","onMarkAsRead","onDelete","isOpen","onToggle","jsxs","e","MoreVertical","Check","Trash2","NotificationPage","filter","setFilter","useState","activeMenu","setActiveMenu","navigate","useNavigate","isAuthenticated","roleInfo","useAuth","optimisticNotificationRead","refreshHeaderCounters","useInvalidateCounters","notifications","loading","error","unreadCount","hasMore","currentPage","totalNotifications","fetchNotifications","markAsRead","markAllAsRead","deleteNotification","useNotifications","invalidateNotificationsCache","useCallback","CacheService","forceRefresh","useEffect","getNotificationUrl","data","isSeller","chatUrl","handleNotificationClick","url","handleDelete","id","n","handleMarkAsRead","handleMarkAllAsRead","unreadNotifications","i","loadMore","handleFilterChange","newFilter","Fragment","CheckCheck","index","formatRelativeTime"],"mappings":"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"}