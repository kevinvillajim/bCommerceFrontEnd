{"version":3,"file":"SellerLayout-DcjpVv1s.js","sources":["../../src/presentation/layouts/groups/sellerGroups.tsx","../../src/presentation/hooks/useSellerNotifications.ts","../../src/presentation/layouts/SellerLayout.tsx"],"sourcesContent":["import {\n\tBarChart2,\n\tPackage,\n\tShoppingBag,\n\tTruck,\n\tStar,\n\tMessageSquare,\n\tDollarSign,\n\tUser,\n} from \"lucide-react\";\n\ninterface sellerGroups {\n\tgroups: {\n\t\ttitle: string;\n\t\tlinks: {\n\t\t\tpath: string;\n\t\t\tlabel: string;\n\t\t\ticon?: React.ReactNode;\n\t\t\tisNotificated?: boolean;\n\t\t\tnotificationCount?: number;\n\t\t}[];\n\t}[];\n\ttitle: {\n\t\ttitle: string;\n\t\ticon: React.ReactNode;\n\t};\n}\n\nconst sellerGroups = [\n\t{\n\t\ttitle: \"Principal\",\n\t\tlinks: [\n\t\t\t{\n\t\t\t\tpath: \"/seller/dashboard\",\n\t\t\t\tlabel: \"Dashboard\",\n\t\t\t\ticon: <BarChart2 className=\"w-5 h-5 mr-3\" />,\n\t\t\t},\n\t\t],\n\t},\n\t{\n\t\ttitle: \"Productos\",\n\t\tlinks: [\n\t\t\t{\n\t\t\t\tpath: \"/seller/products\",\n\t\t\t\tlabel: \"Todos los Productos\",\n\t\t\t\ticon: <Package className=\"w-5 h-5 mr-3\" />,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: \"/seller/products/create\",\n\t\t\t\tlabel: \"Añadir Producto\",\n\t\t\t\ticon: <Package className=\"w-5 h-5 mr-3\" />,\n\t\t\t},\n\t\t],\n\t},\n\t{\n\t\ttitle: \"Pedidos\",\n\t\tlinks: [\n\t\t\t{\n\t\t\t\tpath: \"/seller/orders\",\n\t\t\t\tlabel: \"Pedidos\",\n\t\t\t\ticon: <ShoppingBag className=\"w-5 h-5 mr-3\" />,\n\t\t\t\tisNotificated: true,\n\t\t\t\tnotificationCount: 0, // Se actualizará dinámicamente\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: \"/seller/shipping\",\n\t\t\t\tlabel: \"Envíos\",\n\t\t\t\ticon: <Truck className=\"w-5 h-5 mr-3\" />,\n\t\t\t\tisNotificated: true,\n\t\t\t\tnotificationCount: 0, // Se actualizará dinámicamente\n\t\t\t},\n\t\t],\n\t},\n\t{\n\t\ttitle: \"Clientes\",\n\t\tlinks: [\n\t\t\t{\n\t\t\t\tpath: \"/seller/ratings\",\n\t\t\t\tlabel: \"Valoraciones y Reseñas\",\n\t\t\t\ticon: <Star className=\"w-5 h-5 mr-3\" />,\n\t\t\t\tisNotificated: true,\n\t\t\t\tnotificationCount: 0, // Se actualizará dinámicamente\n\t\t\t},\n\t\t\t{\n\t\t\t\tpath: \"/seller/messages\",\n\t\t\t\tlabel: \"Mensajes\",\n\t\t\t\ticon: <MessageSquare className=\"w-5 h-5 mr-3\" />,\n\t\t\t\tisNotificated: true,\n\t\t\t\tnotificationCount: 0, // Se actualizará dinámicamente\n\t\t\t},\n\t\t],\n\t},\n\t{\n\t\ttitle: \"Finanzas\",\n\t\tlinks: [\n\t\t\t{\n\t\t\t\tpath: \"/seller/earnings\",\n\t\t\t\tlabel: \"Ganancias\",\n\t\t\t\ticon: <DollarSign className=\"w-5 h-5 mr-3\" />,\n\t\t\t},\n\t\t],\n\t},\n\t{\n\t\ttitle: \"Cuenta\",\n\t\tlinks: [\n\t\t\t{\n\t\t\t\tpath: \"/seller/profile\",\n\t\t\t\tlabel: \"Perfil\",\n\t\t\t\ticon: <User className=\"w-5 h-5 mr-3\" />,\n\t\t\t},\n\t\t],\n\t},\n];\n\nexport default sellerGroups;\n","import { useEffect, useCallback, useMemo, useRef } from \"react\";\nimport { useAuth } from \"./useAuth\";\nimport { useLocation } from \"react-router-dom\";\nimport { useNotifications } from \"./useNotifications\";\n\ninterface SellerNotificationCounts {\n  orders: number;\n  shipping: number;\n  ratings: number;\n  messages: number;\n}\n\ninterface UseSellerNotificationsReturn {\n  counts: SellerNotificationCounts;\n  loading: boolean;\n  error: string | null;\n  refetch: () => Promise<void>;\n  markSectionAsRead: (section: keyof SellerNotificationCounts) => Promise<void>;\n}\n\nconst SECTION_PATHS = {\n  orders: '/seller/orders',\n  shipping: '/seller/shipping', \n  ratings: '/seller/ratings',\n  messages: '/seller/messages'\n};\n\n// Mapeo de tipos de notificación a secciones\nconst NOTIFICATION_TYPE_TO_SECTION: Record<string, keyof SellerNotificationCounts> = {\n  'new_order': 'orders',\n  'order_status': 'orders',\n  'order_update': 'orders',\n  'shipping_update': 'shipping',\n  'shipping_status': 'shipping',\n  'rating_received': 'ratings',\n  'seller_rated': 'ratings',\n  'rating_request': 'ratings',\n  'new_message': 'messages',\n  'message_received': 'messages',\n};\n\nexport const useSellerNotifications = (): UseSellerNotificationsReturn => {\n  const { isAuthenticated, roleInfo } = useAuth();\n  const location = useLocation();\n  \n  // Usar el hook de notificaciones existente\n  const {\n    notifications,\n    loading,\n    error,\n    fetchNotifications,\n    markAsRead,\n  } = useNotifications();\n\n  // Calcular contadores basados en notificaciones no leídas\n  const counts = useMemo(() => {\n    if (!isAuthenticated || !roleInfo.isSeller || !notifications.length) {\n      return { orders: 0, shipping: 0, ratings: 0, messages: 0 };\n    }\n\n    const sectionCounts = {\n      orders: 0,\n      shipping: 0,\n      ratings: 0,\n      messages: 0,\n    };\n\n    // Contar notificaciones no leídas por sección\n    notifications\n      .filter(notification => !notification.read) // Solo las no leídas\n      .forEach(notification => {\n        const section = NOTIFICATION_TYPE_TO_SECTION[notification.type];\n        if (section) {\n          sectionCounts[section]++;\n        }\n      });\n\n\n    return sectionCounts;\n  }, [notifications, isAuthenticated, roleInfo.isSeller]);\n\n  // Marcar notificaciones de una sección como leídas\n  const markSectionAsRead = useCallback(async (section: keyof SellerNotificationCounts) => {\n    if (!isAuthenticated || !roleInfo.isSeller) return;\n\n    try {\n\n      \n      // Encontrar todas las notificaciones no leídas de esta sección\n      const sectionNotifications = notifications\n        .filter(notification => \n          !notification.read && \n          NOTIFICATION_TYPE_TO_SECTION[notification.type] === section\n        );\n      \n      // Marcar cada una como leída\n      for (const notification of sectionNotifications) {\n        await markAsRead(notification.id!);\n      }\n      \n\n      \n    } catch (err: any) {\n\n    }\n  }, [isAuthenticated, roleInfo.isSeller, notifications, markAsRead]);\n\n  // Refs para evitar bucles infinitos\n  const countsRef = useRef(counts);\n  const markSectionAsReadRef = useRef(markSectionAsRead);\n\n  // Actualizar refs\n  countsRef.current = counts;\n  markSectionAsReadRef.current = markSectionAsRead;\n\n  // Detectar cambios de ruta y marcar como leídas\n  useEffect(() => {\n    const currentPath = location.pathname;\n    \n    // Verificar si estamos en alguna de las secciones\n    for (const [section, path] of Object.entries(SECTION_PATHS)) {\n      if (currentPath.startsWith(path)) {\n        const sectionKey = section as keyof SellerNotificationCounts;\n        // Solo marcar si hay notificaciones no leídas en esa sección\n        if (countsRef.current[sectionKey] > 0) {\n          markSectionAsReadRef.current(sectionKey);\n        }\n        break;\n      }\n    }\n  }, [location.pathname]); // Removido counts y markSectionAsRead para evitar bucles\n\n  // Cargar notificaciones al montar el componente\n  useEffect(() => {\n    if (isAuthenticated && roleInfo.isSeller) {\n      fetchNotifications(1, false); // Cargar todas las notificaciones\n    }\n  }, [isAuthenticated, roleInfo.isSeller, fetchNotifications]);\n\n  const refetch = useCallback(async () => {\n    if (isAuthenticated && roleInfo.isSeller) {\n      await fetchNotifications(1, false);\n    }\n  }, [isAuthenticated, roleInfo.isSeller, fetchNotifications]);\n\n  return {\n    counts,\n    loading,\n    error,\n    refetch,\n    markSectionAsRead,\n  };\n};\n","import React, { useMemo } from \"react\";\nimport type { ReactNode } from \"react\";\nimport {Package, TrendingUp} from \"lucide-react\";\nimport {DashboardProvider} from \"../components/dashboard/DashboardContext\";\nimport BaseDashboardLayout from \"../components/dashboard/BaseDashboardLayout\";\nimport sellerGroups from \"./groups/sellerGroups\";\nimport { useSellerNotifications } from \"../hooks/useSellerNotifications\";\n\n/**\n * Componente de Layout para el Panel del Vendedor\n */\nconst SellerLayout: React.FC = () => {\n\t// Hook para obtener contadores de notificaciones\n\tconst { counts } = useSellerNotifications();\n\n\t// Títulos dinámicos basados en rutas\n\tconst pageTitles: {[key: string]: string} = {\n\t\t\"/seller/dashboard\": \"Dashboard\",\n\t\t\"/seller/products\": \"Productos\",\n\t\t\"/seller/products/create\": \"Añadir Nuevo Producto\",\n\t\t\"/seller/orders\": \"Pedidos\",\n\t\t\"/seller/ratings\": \"Valoraciones y Reseñas\",\n\t\t\"/seller/messages\": \"Mensajes\",\n\t\t\"/seller/profile\": \"Mi Perfil\",\n\t\t\"/seller/settings\": \"Configuración\",\n\t\t\"/seller/shipping\": \"Envíos\",\n\t\t\"/seller/earnings\": \"Ganancias\",\n\t};\n\n\t// Título del sidebar\n\tconst sidebarTitle = {\n\t\ttitle: \"Portal del Vendedor\",\n\t\ticon: <Package className=\"w-7 h-7 text-primary-400\" />,\n\t};\n\n\t// Grupos del sidebar con contadores dinámicos\n\tconst dynamicSellerGroups = useMemo(() => {\n\t\treturn sellerGroups.map(group => ({\n\t\t\t...group,\n\t\t\tlinks: group.links.map(link => {\n\t\t\t\tlet notificationCount = 0;\n\t\t\t\t\n\t\t\t\t// Asignar contadores según la ruta\n\t\t\t\tswitch (link.path) {\n\t\t\t\t\tcase \"/seller/orders\":\n\t\t\t\t\t\tnotificationCount = counts.orders;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"/seller/shipping\":\n\t\t\t\t\t\tnotificationCount = counts.shipping;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"/seller/ratings\":\n\t\t\t\t\t\tnotificationCount = counts.ratings;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"/seller/messages\":\n\t\t\t\t\t\tnotificationCount = counts.messages;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\tnotificationCount = (link as any).notificationCount || 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\treturn {\n\t\t\t\t...link,\n\t\t\t\tnotificationCount,\n\t\t\t\t isNotificated: notificationCount > 0\n\t\t\t};\n\t\t\t})\n\t\t}));\n\t}, [counts]);\n\n\t// Componente de analytics rápidos para mostrar después del header\n\tconst SellerQuickStats = (): ReactNode => {\n\t\t// Simulamos leer datos de pendingActions del localStorage (en una app real vendría de un context o API)\n\t\tconst pendingOrders = parseInt(\n\t\t\tlocalStorage.getItem(\"sellerPendingOrders\") || \"0\"\n\t\t);\n\n\t\t// Solo mostrar si hay ventas recientes o hay pedidos pendientes\n\t\tif (pendingOrders === 0) return null;\n\n\t\treturn (\n\t\t\t<div className=\"bg-gradient-to-r from-primary-50 to-blue-50 px-4 py-3 border-b border-primary-100\">\n\t\t\t\t<div className=\"flex items-center\">\n\t\t\t\t\t<TrendingUp className=\"h-5 w-5 text-primary-500 mr-2\" />\n\t\t\t\t\t<span className=\"text-sm text-primary-700\">\n\t\t\t\t\t\tTienes <strong>{pendingOrders}</strong> pedido\n\t\t\t\t\t\t{pendingOrders !== 1 ? \"s\" : \"\"} pendiente\n\t\t\t\t\t\t{pendingOrders !== 1 ? \"s\" : \"\"} por procesar. ¡Revísalos pronto!\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t);\n\t};\n\n\treturn (\n\t\t<DashboardProvider initialType=\"seller\" initialPageTitles={pageTitles}>\n\t\t\t<BaseDashboardLayout\n\t\t\t\tsidebarGroups={dynamicSellerGroups}\n\t\t\t\tsidebarTitle={sidebarTitle}\n\t\t\t\theaderExtras={<SellerQuickStats />}\n\t\t\t/>\n\t\t</DashboardProvider>\n\t);\n};\n\nexport default SellerLayout;\n"],"names":["sellerGroups","jsx","BarChart2","Package","ShoppingBag","Truck","Star","MessageSquare","DollarSign","User","SECTION_PATHS","NOTIFICATION_TYPE_TO_SECTION","useSellerNotifications","isAuthenticated","roleInfo","useAuth","location","useLocation","notifications","loading","error","fetchNotifications","markAsRead","useNotifications","counts","useMemo","sectionCounts","notification","section","markSectionAsRead","useCallback","sectionNotifications","countsRef","useRef","markSectionAsReadRef","useEffect","currentPath","path","sectionKey","refetch","SellerLayout","pageTitles","sidebarTitle","dynamicSellerGroups","group","link","notificationCount","SellerQuickStats","pendingOrders","jsxs","TrendingUp","DashboardProvider","BaseDashboardLayout"],"mappings":"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"}