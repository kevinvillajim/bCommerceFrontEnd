import{j as r,R as Y,S as Z,F as K,P as T,J as Q,aZ as X,T as A,ao as ee,a5 as re,al as ae,aA as te,a_ as se,aD as le}from"./ui-vendor-DEBjJ4HS.js";import{r as s,L as O}from"./react-vendor-Cy458wKG.js";import{T as ne,f as oe}from"./admin-chunk-C7Ad4l4I.js";import{S as ie,d as de}from"./seller-chunk-CL4v7LiS.js";import{S as ce}from"./ShippingServiceAdapter-SShxCogr.js";import"./utils-vendor-DeGC_a19.js";const ue=({currentStatus:c,shippingId:n,onStatusChange:j,disabled:u=!1})=>{const[p,b]=s.useState(!1),[o,g]=s.useState(!1),f=[{value:"pending",label:"Pendiente",color:"bg-yellow-100 text-yellow-800"},{value:"ready_to_ship",label:"Listo para enviar",color:"bg-blue-100 text-blue-800"},{value:"shipped",label:"Enviado",color:"bg-purple-100 text-purple-800"},{value:"in_transit",label:"En tránsito",color:"bg-indigo-100 text-indigo-800"},{value:"delivered",label:"Entregado",color:"bg-green-100 text-green-800"},{value:"failed",label:"Fallido",color:"bg-red-100 text-red-800"},{value:"returned",label:"Devuelto",color:"bg-orange-100 text-orange-800"}],x=f.find(t=>t.value===c)||f[0],S=async t=>{if(!(t===c||o)){g(!0),b(!1);try{await j(n,t)}catch(P){console.error("Error al actualizar estado:",P)}finally{g(!1)}}};return r.jsxs("div",{className:"relative inline-block text-left",children:[r.jsxs("button",{onClick:()=>b(!p),disabled:u||o,className:`
					inline-flex items-center gap-2 px-3 py-1.5 text-xs font-medium rounded-full
					${x.color}
					${u||o?"opacity-50 cursor-not-allowed":"hover:opacity-80 cursor-pointer"}
					transition-all duration-200
				`,children:[r.jsx("span",{className:`w-2 h-2 rounded-full ${o?"animate-pulse bg-current":"bg-current"}`}),o?"Actualizando...":x.label,r.jsx(le,{className:`w-3 h-3 transition-transform duration-200 ${p?"rotate-180":""}`})]}),p&&!u&&!o&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>b(!1)}),r.jsx("div",{className:"absolute top-full left-0 z-20 mt-1 w-48 bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",children:r.jsx("div",{className:"flex flex-col divide-y divide-gray-200",children:f.map(t=>r.jsx("button",{onClick:()=>S(t.value),className:`
										w-full cursor-pointer text-left px-4 py-2 text-sm transition-colors duration-150
										${t.value===c?"bg-gray-100 text-gray-900 font-medium":"text-gray-700 hover:bg-gray-50"}
									`,children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:`w-2 h-2 rounded-full ${t.color.includes("bg-yellow")?"bg-yellow-500":t.color.includes("bg-blue")?"bg-blue-500":t.color.includes("bg-purple")?"bg-purple-500":t.color.includes("bg-indigo")?"bg-indigo-500":t.color.includes("bg-green")?"bg-green-500":t.color.includes("bg-red")?"bg-red-500":t.color.includes("bg-orange")?"bg-orange-500":"bg-gray-400"}`}),r.jsx("span",{children:t.label}),t.value===c&&r.jsx("span",{className:"ml-auto text-xs text-gray-500",children:"Actual"})]})},t.value))})})]})]})},fe=()=>{const c=new ce,[n,j]=s.useState([]),[u,p]=s.useState(!0),[b,o]=s.useState(null),[g,f]=s.useState("all"),[x,S]=s.useState("all"),[t,P]=s.useState("all"),[w,F]=s.useState(""),[h,_]=s.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),[N,U]=s.useState({from:"",to:""}),[L,i]=s.useState(null),[z,m]=s.useState(""),[v,k]=s.useState(!1),[M,C]=s.useState(!1),[y,D]=s.useState(null);s.useEffect(()=>{E()},[g,x,w,h.currentPage,t,N]);const E=async()=>{p(!0),o(null);try{const e={page:h.currentPage,limit:h.itemsPerPage};if(g!=="all"&&(e.status=g),x!=="all"&&(e.carrier=x),w&&(e.search=w),t==="today"){const l=new Date().toISOString().split("T")[0];e.dateFrom=l,e.dateTo=l}else if(t==="week"){const l=new Date,d=new Date(l.setDate(l.getDate()-l.getDay()));e.dateFrom=d.toISOString().split("T")[0],e.dateTo=new Date().toISOString().split("T")[0]}else if(t==="month"){const l=new Date,d=new Date(l.getFullYear(),l.getMonth(),1);e.dateFrom=d.toISOString().split("T")[0],e.dateTo=new Date().toISOString().split("T")[0]}else t==="custom"&&N.from&&N.to&&(e.dateFrom=N.from,e.dateTo=N.to);console.log("Cargando envíos con filtros:",e);const a=await c.getShippingsList(e);console.log("Datos de envío obtenidos:",a),j(a.items),_(a.pagination)}catch(e){console.error("Error al cargar envíos:",e),o("No se pudieron cargar los datos de envíos. Intenta de nuevo más tarde.")}finally{p(!1)}},R=e=>{D(e),C(!0)},H=async e=>{if(!y){i(!1),m("Error: No se ha seleccionado un pedido válido");return}k(!0),i(null),m("");try{if(console.log("Procesando envío para orden:",y,e),await c.markAsShipped(y,e))i(!0),m("Envío procesado correctamente"),j(l=>l.map(d=>d.orderId===y?{...d,status:"shipped",trackingNumber:e.tracking_number,carrier:e.shipping_company,estimatedDelivery:e.estimated_delivery,lastUpdate:new Date().toISOString()}:d)),C(!1),D(null),setTimeout(()=>{E(),i(null)},3e3);else throw new Error("El servidor no pudo procesar el envío")}catch(a){console.error("Error al procesar envío:",a),i(!1),m("Error al procesar el envío. Intenta de nuevo.")}finally{k(!1)}},$=async(e,a)=>{k(!0),i(null),m("");try{if(console.log(`Actualizando estado del envío ${e} a ${a}`),await c.updateShippingStatus(e,a))i(!0),m(`Estado actualizado a ${B(a)}`),j(d=>d.map(I=>I.id===e?{...I,status:a,lastUpdate:new Date().toISOString()}:I)),setTimeout(()=>{E(),i(null)},3e3);else throw new Error("El servidor no pudo actualizar el estado")}catch(l){console.error(`Error al actualizar estado a ${a}:`,l),i(!1),m("Error al actualizar estado. Intenta de nuevo.")}finally{k(!1)}},q=async e=>{R(e)},G=e=>{_(a=>({...a,currentPage:e}))},W=()=>{p(!0),o(null),E()},B=e=>{switch(e){case"pending":return"Pendiente";case"ready_to_ship":return"Listo para enviar";case"in_transit":case"shipped":return"En tránsito";case"delivered":return"Entregado";case"failed":return"Fallido";case"returned":return"Devuelto";default:return"Desconocido"}},J=[{key:"orderNumber",header:"Nº Pedido",sortable:!0,render:e=>r.jsx(O,{to:`/seller/orders/${e.orderId}`,className:"font-medium text-primary-600 hover:underline",children:e.orderNumber})},{key:"trackingNumber",header:"Nº Seguimiento",sortable:!0,render:e=>r.jsx("div",{children:e.trackingNumber?r.jsxs("div",{className:"flex items-center",children:[r.jsx("span",{className:"font-mono text-sm",children:e.trackingNumber}),e.carrier&&r.jsx("button",{onClick:()=>{e.trackingNumber?navigator.clipboard.writeText(e.trackingNumber).then(()=>{alert(`${e.trackingNumber} copiado al portapapeles`)}).catch(a=>{console.error("Error al copiar al portapapeles:",a),alert("Hubo un error al copiar")}):alert("No hay número de seguimiento para copiar")},className:"ml-2 text-blue-600 hover:text-blue-800",title:`Rastrear con ${e.carrier}`,children:r.jsx(ae,{size:14})})]}):r.jsx("span",{className:"text-gray-500 text-sm",children:"No asignado"})})},{key:"date",header:"Fecha de Pedido",sortable:!0,render:e=>{const a=new Date(e.date);return r.jsx("span",{className:"text-sm",children:a.toLocaleDateString("es-ES")})}},{key:"customer",header:"Cliente",sortable:!0,render:e=>r.jsxs("div",{children:[r.jsx("div",{className:"font-medium text-sm",children:e.customer.name}),r.jsx("div",{className:"text-xs text-gray-500 truncate max-w-[150px]",children:e.shippingAddress})]})},{key:"status",header:"Estado",sortable:!0,render:e=>r.jsx(ue,{currentStatus:e.status,shippingId:e.id,onStatusChange:$,disabled:v})},{key:"carrier",header:"Transportista",sortable:!0,render:e=>r.jsx("span",{children:e.carrier||"No asignado"})},{key:"estimatedDelivery",header:"Entrega Estimada",sortable:!0,render:e=>r.jsx("span",{children:e.estimatedDelivery?new Date(e.estimatedDelivery).toLocaleDateString("es-ES"):"No disponible"})},{key:"actions",header:"Acciones",render:e=>r.jsxs("div",{className:"flex justify-end space-x-2",children:[r.jsx(O,{to:`/seller/shipping/${e.id}`,className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Ver detalles",children:r.jsx(te,{size:18})}),(e.status==="pending"||e.status==="ready_to_ship")&&!e.trackingNumber&&r.jsx("button",{onClick:()=>q(e.orderId),className:"p-1 text-green-600 hover:bg-green-100 rounded-md",title:"Asignar número de seguimiento",disabled:v,children:r.jsx(T,{size:18})}),e.trackingNumber&&(e.status==="shipped"||e.status==="in_transit")&&r.jsx("button",{onClick:()=>alert(`Imprimiendo etiqueta para ${e.trackingNumber}`),className:"p-1 text-gray-600 hover:bg-gray-100 rounded-md",title:"Imprimir etiqueta",disabled:v,children:r.jsx(se,{size:18})}),(e.status==="ready_to_ship"||e.status==="in_transit"||e.status==="shipped"||e.status==="pending")&&r.jsx("button",{onClick:()=>$(e.id,"failed"),className:"p-1 text-red-600 hover:bg-red-100 rounded-md",title:"Marcar como fallido",disabled:v,children:r.jsx(A,{size:18})})]})}],V=()=>{const e={pending:n.filter(a=>a.status==="pending").length,readyToShip:n.filter(a=>a.status==="ready_to_ship").length,inTransit:n.filter(a=>a.status==="in_transit"||a.status==="shipped").length,delivered:n.filter(a=>a.status==="delivered").length,failed:n.filter(a=>a.status==="failed").length,returned:n.filter(a=>a.status==="returned").length,totalShippingCost:n.reduce((a,l)=>a+(l.shippingCost||0),0)};return[{label:"Pendientes",value:e.pending,icon:r.jsx(T,{className:"h-5 w-5 text-yellow-600"}),color:"yellow"},{label:"Listos",value:e.readyToShip,icon:r.jsx(T,{className:"h-5 w-5 text-blue-600"}),color:"blue"},{label:"En Tránsito",value:e.inTransit,icon:r.jsx(Q,{className:"h-5 w-5 text-indigo-600"}),color:"indigo"},{label:"Entregados",value:e.delivered,icon:r.jsx(X,{className:"h-5 w-5 text-green-600"}),color:"green"},{label:"Fallidos",value:e.failed,icon:r.jsx(A,{className:"h-5 w-5 text-red-600"}),color:"red"},{label:"Devueltos",value:e.returned,icon:r.jsx(ee,{className:"h-5 w-5 text-orange-600"}),color:"orange"},{label:"Coste Envíos",value:oe(e.totalShippingCost),icon:r.jsx(re,{className:"h-5 w-5 text-primary-600"}),color:"primary"}]};return r.jsxs("div",{className:"space-y-6",children:[r.jsx(ie,{orderId:y||"",orderNumber:n.find(e=>e.orderId===y)?.orderNumber,isOpen:M,onClose:()=>{C(!1),D(null)},onSubmit:H,isLoading:v}),r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Envíos"}),r.jsx("div",{className:"flex space-x-2",children:r.jsxs("button",{onClick:W,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",disabled:v||u,children:[r.jsx(Y,{size:18,className:`inline mr-2 ${u?"animate-spin":""}`}),"Actualizar"]})})]}),L===!0&&r.jsx("div",{className:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative",role:"alert",children:r.jsx("span",{className:"block sm:inline",children:z})}),L===!1&&r.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:r.jsx("span",{className:"block sm:inline",children:z})}),b&&r.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",role:"alert",children:r.jsx("span",{className:"block sm:inline",children:b})}),r.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:r.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[r.jsxs("div",{className:"relative flex-grow",children:[r.jsx("input",{type:"text",placeholder:"Buscar por número de pedido, seguimiento, cliente...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",value:w,onChange:e=>F(e.target.value)}),r.jsx(Z,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx(K,{className:"h-5 w-5 text-gray-500"}),r.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:g,onChange:e=>f(e.target.value),children:[r.jsx("option",{value:"all",children:"Todos los estados"}),r.jsx("option",{value:"pending",children:"Pendientes"}),r.jsx("option",{value:"ready_to_ship",children:"Listos para enviar"}),r.jsx("option",{value:"shipped",children:"En tránsito"}),r.jsx("option",{value:"delivered",children:"Entregados"}),r.jsx("option",{value:"failed",children:"Fallidos"}),r.jsx("option",{value:"returned",children:"Devueltos"})]})]}),r.jsx("div",{className:"flex items-center space-x-2",children:r.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:x,onChange:e=>S(e.target.value),children:[r.jsx("option",{value:"all",children:"Todos los transportistas"}),r.jsx("option",{value:"Correos Express",children:"Correos Express"}),r.jsx("option",{value:"SEUR",children:"SEUR"}),r.jsx("option",{value:"MRW",children:"MRW"}),r.jsx("option",{value:"DHL",children:"DHL"}),r.jsx("option",{value:"FedEx",children:"FedEx"}),r.jsx("option",{value:"UPS",children:"UPS"})]})}),r.jsx("button",{onClick:()=>{f("all"),S("all"),P("all"),F(""),U({from:"",to:""})},className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Limpiar filtros"})]})}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-7 gap-4",children:r.jsx(de,{items:V()})}),r.jsx(ne,{data:n,columns:J,searchFields:["orderNumber","trackingNumber","shippingAddress"],loading:u,emptyMessage:"No se encontraron envíos",pagination:{currentPage:h.currentPage,totalPages:h.totalPages,totalItems:h.totalItems,itemsPerPage:h.itemsPerPage,onPageChange:G}})]})};export{fe as default};
//# sourceMappingURL=SellerShippingPage-C58Kgxl3.js.map
