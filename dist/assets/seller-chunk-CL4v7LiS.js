import{j as e,f as de,D as se,g as J,P as H,Z as ge,a4 as xe,S as Se,F as Ne,C as Te,x as $e,E as we,t as Ue,o as Fe,J as ae,X as ue,a as Le,a5 as me,R as Ee,I as ze,a6 as Me,a7 as Be,a8 as Ve,l as He,a9 as Ge,aa as Ke,K as qe}from"./ui-vendor-DEBjJ4HS.js";import{b as Je,r as c,L as q,u as Ce,a as Ye,d as We}from"./react-vendor-Cy458wKG.js";import{C as j,a as ne,A as D,b as z,s as Xe,c as A,u as Qe,D as Pe,f as T,d as Ie,P as Ze,T as et}from"./admin-chunk-C7Ad4l4I.js";import{r as tt}from"./utils-vendor-DeGC_a19.js";class rt{setItem(r,t){try{const s=typeof t=="object"?JSON.stringify(t):t;localStorage.setItem(r,s)}catch(s){console.error("Error al guardar en localStorage:",s)}}getItem(r){try{const t=localStorage.getItem(r);if(t===null)return null;try{return JSON.parse(t)}catch{return t}}catch(t){return console.error("Error al recuperar de localStorage:",t),null}}removeItem(r){try{localStorage.removeItem(r)}catch(t){console.error("Error al eliminar de localStorage:",t)}}clear(){try{localStorage.clear()}catch(r){console.error("Error al limpiar localStorage:",r)}}hasKey(r){try{return localStorage.getItem(r)!==null}catch(t){return console.error("Error al verificar clave en localStorage:",t),!1}}}const ie="user_role_data",st=10*60*1e3;let V=null,Z=0;class oe{static async checkUserRole(r=!1){try{const t=Date.now();if(!r&&V&&t-Z<3e4)return console.log("Usando datos de rol desde memoria:",V),V;if(!r){const a=j.getItem(ie);if(a)return V=a,Z=t,console.log("Usando datos de rol desde localStorage:",V),V}console.log("Verificando rol del usuario desde API...");const s=await ne.get(D.AUTH.CHECK_ROLE);return console.log("Respuesta del endpoint check-role:",s.data),s&&s.data&&s.data.success?(j.setItem(ie,s.data,st),V=s.data,Z=t,console.log("Datos de rol actualizados desde API:",V),V):(console.error("Respuesta invÃ¡lida del endpoint check-role:",s.data),null)}catch(t){return console.error("Error al verificar rol de usuario:",t),null}}static async isAdmin(){const r=await this.checkUserRole(),t=r?.data?.is_admin||!1;return console.log("Verificando si es admin:",t,r),t}static async isSeller(){const r=await this.checkUserRole(),t=r?.data?.is_seller||!1;return console.log("Verificando si es seller:",t,r),t}static async getUserRole(){const r=await this.checkUserRole(),t=r?.data?.role||null;return console.log("Obteniendo rol del usuario:",t,r),t}static clearRoleCache(){j.removeItem(ie),V=null,Z=0,console.log("CachÃ© de roles limpiada")}static async getSellerInfo(){return(await this.checkUserRole())?.data?.seller_info||null}static async getAdminInfo(){return(await this.checkUserRole())?.data?.admin_info||null}}const Dt=Object.freeze(Object.defineProperty({__proto__:null,RoleService:oe,default:oe},Symbol.toStringTag,{value:"Module"}));var at=tt();const X=Je(at),ot={};var fe={};const nt=()=>typeof import.meta<"u"&&ot?"nTIonshRityLkSomPLIgMayOUsEmPLeW":typeof process<"u"&&fe&&fe.REACT_APP_CACHE_KEY||"nTIonshRityLkSomPLIgMayOUsEmPLeW",ye=nt(),lt="role-integrity-2024";class ee{static sessionId=this.generateSessionId();static STORAGE_CACHE_TIME=5*60*1e3;static CRITICAL_REVALIDATION_TIME=2*60*1e3;static generateSessionId(){return X.lib.WordArray.random(16).toString()}static encrypt(r){const t=JSON.stringify(r);return X.AES.encrypt(t,ye).toString()}static decrypt(r){try{const s=X.AES.decrypt(r,ye).toString(X.enc.Utf8);return JSON.parse(s)}catch{return null}}static generateIntegrityHash(r){const t=`${r.role}-${r.isAdmin}-${r.isSeller}-${r.timestamp}-${r.sessionId}`;return X.HmacSHA256(t,lt).toString()}static validateIntegrity(r,t){return this.generateIntegrityHash(r)===t}static setSecureRoleData(r){const t={...r,timestamp:Date.now(),sessionId:this.sessionId},s=this.encrypt(t),a=this.generateIntegrityHash(t),u={encrypted:s,hash:a,timestamp:t.timestamp};try{localStorage.setItem("secure_role_cache",JSON.stringify(u))}catch(d){console.warn("No se pudo guardar cache de roles:",d)}}static getSecureRoleData(){try{const r=localStorage.getItem("secure_role_cache");if(!r)return null;const t=JSON.parse(r);if(Date.now()-t.timestamp>this.STORAGE_CACHE_TIME)return this.clearSecureCache(),null;const a=this.decrypt(t.encrypted);return a?this.validateIntegrity(a,t.hash)?a.sessionId!==this.sessionId?(console.log("Cache de sesiÃ³n anterior, invalidando"),this.clearSecureCache(),null):a:(console.warn("Integridad de cache de roles comprometida"),this.clearSecureCache(),null):(this.clearSecureCache(),null)}catch(r){return console.warn("Error al leer cache seguro:",r),this.clearSecureCache(),null}}static clearSecureCache(){localStorage.removeItem("secure_role_cache")}static needsCriticalRevalidation(){const r=this.getSecureRoleData();return r?Date.now()-r.timestamp>this.CRITICAL_REVALIDATION_TIME:!0}}const it=D?.AUTH?.CHECK_ROLE;class K{static memoryCache=new Map;static MEMORY_CACHE_TIME=3e4;static getFromMemory(r){const t=this.memoryCache.get(r);return t?Date.now()-t.timestamp>this.MEMORY_CACHE_TIME?(this.memoryCache.delete(r),null):t.data:null}static setInMemory(r,t){if(this.memoryCache.set(r,{data:t,timestamp:Date.now()}),this.memoryCache.size>10){const s=this.memoryCache.keys().next().value;s!==void 0&&this.memoryCache.delete(s)}}static async checkUserRole(r=!1,t=!1){const s="user_role_check";try{if(!r&&!t){const u=this.getFromMemory(s);if(u)return console.log("ðŸ§  Usando rol desde memoria"),u}if(!r)if(t&&ee.needsCriticalRevalidation())console.log("ðŸ”’ OperaciÃ³n crÃ­tica requiere revalidaciÃ³n");else{const u=ee.getSecureRoleData();if(u){console.log("ðŸ” Usando rol desde cache seguro");const d={success:!0,status:200,data:{user_id:0,role:u.role,is_admin:u.isAdmin,is_seller:u.isSeller,is_payment_user:!1,seller_info:u.sellerInfo,admin_info:u.adminInfo,payment_info:null}};return this.setInMemory(s,d),d}}console.log("ðŸŒ Consultando rol desde API");const a=await ne.get(it);if(a?.data?.success){const u=a.data;return ee.setSecureRoleData({role:u.data.role,isAdmin:u.data.is_admin,isSeller:u.data.is_seller,sellerInfo:u.data.seller_info,adminInfo:u.data.admin_info}),this.setInMemory(s,u),u}return null}catch(a){return console.error("Error verificando rol:",a),null}}static async isAdmin(){return(await this.checkUserRole(!1,!1))?.data?.is_admin||!1}static async isSeller(){return(await this.checkUserRole(!1,!1))?.data?.is_seller||!1}static async isAdminCritical(){return(await this.checkUserRole(!1,!0))?.data?.is_admin||!1}static async isSellerCritical(){return(await this.checkUserRole(!1,!0))?.data?.is_seller||!1}static clearAllCache(){this.memoryCache.clear(),ee.clearSecureCache(),console.log("ðŸ—‘ï¸ Cache de roles limpiada completamente")}}const G=new rt,B={ROLE_INFO:"auth_role_info",USER_DATA:"auth_user_data"},te={ROLE_INFO:5*60*1e3,USER_DATA:10*60*1e3},De=c.createContext({user:null,setUser:()=>{},isAuthenticated:!1,setIsAuthenticated:()=>{},logout:async()=>{},clearSessionData:()=>{},roleInfo:{role:null,isAdmin:!1,isSeller:!1,isPaymentUser:!1,sellerInfo:null,adminInfo:null,paymentInfo:null},isLoadingRole:!1,refreshRoleInfo:async()=>{},isInitialized:!1,getDefaultRouteForRole:()=>"/",isAdmin:async()=>!1,isSeller:async()=>!1}),At=({children:p})=>{const[r,t]=c.useState(null),[s,a]=c.useState(!1),[u,d]=c.useState(!1),[N,P]=c.useState(!1),[x,O]=c.useState({role:null,isAdmin:!1,isSeller:!1,isPaymentUser:!1,sellerInfo:null,adminInfo:null,paymentInfo:null}),_=c.useRef(!1),I=c.useRef(!1),w=c.useRef(null),f=c.useRef(!1);c.useEffect(()=>{I.current=s},[s]),c.useEffect(()=>{w.current=r},[r]);const b=c.useCallback(()=>x.isAdmin?"/admin/dashboard":x.isSeller?"/seller/dashboard":"/",[x]),y=c.useCallback(n=>{if(r){const i={...r,...n};t(i),typeof window<"u"&&localStorage.setItem("user",JSON.stringify(i))}},[r]),v=c.useCallback(()=>{const n=window.location.pathname;if(!(["/login","/register"].includes(n)||n.startsWith("/auth"))){console.log("No estamos en pÃ¡gina de auth, no redireccionar automÃ¡ticamente");return}if(s&&x.role&&f.current){const m=b();console.log(`ðŸ”„ RedirecciÃ³n automÃ¡tica desde ${n} a ${m}`),setTimeout(()=>{window.location.replace(m)},100)}},[s,x,b]),R=c.useCallback(async()=>{if(!(!I.current||N||_.current)){P(!0);try{if(console.log("Obteniendo informaciÃ³n de rol del usuario..."),!f.current){const i=j.getItem(B.ROLE_INFO);if(i){console.log("ðŸ” Usando roleInfo desde cache (no-inicializaciÃ³n)"),O(i),_.current=!0;return}}let n=null;try{n=await K.checkUserRole(!0,!1),console.log("âœ… Usando OptimizedRoleService en fetchRoleInfo")}catch(i){console.log("âš ï¸ OptimizedRoleService no disponible, usando RoleService:",i),n=await oe.checkUserRole(!0)}if(n&&n.success){const i={role:n.data.role,isAdmin:n.data.is_admin,isSeller:n.data.is_seller,isPaymentUser:n.data.is_payment_user||!1,sellerInfo:n.data.seller_info||null,adminInfo:n.data.admin_info||null,paymentInfo:n.data.payment_info||null};console.log("InformaciÃ³n de rol obtenida:",i),O(i),j.setItem(B.ROLE_INFO,i,te.ROLE_INFO),w.current&&!w.current.role&&t(m=>m?{...m,role:n.data.role}:null),_.current=!0,f.current&&setTimeout(()=>{v()},300)}}catch(n){console.error("Error al obtener informaciÃ³n de rol:",n)}finally{P(!1)}}},[N,v]),k=c.useCallback(async()=>{j.removeItem(B.ROLE_INFO),_.current=!1,P(!0);try{console.log("Refrescando informaciÃ³n de rol del usuario...");let n=null;try{n=await K.checkUserRole(!0,!1),console.log("âœ… Usando OptimizedRoleService en refreshRoleInfo")}catch(i){console.log("âš ï¸ OptimizedRoleService no disponible, usando RoleService:",i),n=await oe.checkUserRole(!0)}if(n&&n.success){const i={role:n.data.role,isAdmin:n.data.is_admin,isSeller:n.data.is_seller,isPaymentUser:n.data.is_payment_user||!1,sellerInfo:n.data.seller_info||null,adminInfo:n.data.admin_info||null,paymentInfo:n.data.payment_info||null};console.log("InformaciÃ³n de rol refrescada:",i),O(i),j.setItem(B.ROLE_INFO,i,te.ROLE_INFO),w.current&&!w.current.role&&t(m=>m?{...m,role:n.data.role}:null),_.current=!0}}catch(n){console.error("Error al refrescar informaciÃ³n de rol:",n)}finally{P(!1)}},[]),$=c.useCallback(async(n=!1)=>{try{return n?await K.isAdminCritical():await K.isAdmin()}catch(i){return console.warn("âš ï¸ OptimizedRoleService fallÃ³, usando roleInfo:",i),x.isAdmin}},[x.isAdmin]),F=c.useCallback(async(n=!1)=>{try{return n?await K.isSellerCritical():await K.isSeller()}catch(i){return console.warn("âš ï¸ OptimizedRoleService fallÃ³, usando roleInfo:",i),x.isSeller}},[x.isSeller]);c.useEffect(()=>{if(f.current)return;(async()=>{try{if(G.getItem(z.storage.authTokenKey)){console.log("ðŸ”‘ Token encontrado, inicializando autenticaciÃ³n..."),a(!0),I.current=!0;let m=j.getItem(B.USER_DATA);m||(m=G.getItem(z.storage.userKey),m&&j.setItem(B.USER_DATA,m,te.USER_DATA)),m&&(t(m),w.current=m,console.log("ðŸ‘¤ Datos de usuario cargados (cache/localStorage)")),await R()}else console.log("âŒ No hay token, usuario no autenticado"),a(!1),t(null),j.removeItem(B.ROLE_INFO),j.removeItem(B.USER_DATA),K.clearAllCache()}catch(i){console.error("âŒ Error durante la inicializaciÃ³n:",i),a(!1),t(null)}finally{d(!0),f.current=!0}})()},[R]),c.useEffect(()=>{if(u)if(r){const n=G.getItem(z.storage.userKey),i=JSON.stringify(r),m=n?JSON.stringify(n):"";i!==m&&(G.setItem(z.storage.userKey,r),j.setItem(B.USER_DATA,r,te.USER_DATA))}else u&&(G.removeItem(z.storage.userKey),j.removeItem(B.USER_DATA))},[r,u]);const h=c.useCallback(()=>{console.log("ðŸ§¹ Iniciando limpieza completa de datos de sesiÃ³n..."),G.removeItem(z.storage.authTokenKey),G.removeItem(z.storage.userKey),G.removeItem(z.storage.refreshTokenKey),G.removeItem(z.storage.cartKey),j.removeItem(B.ROLE_INFO),j.removeItem(B.USER_DATA),K.clearAllCache();const n=["user_theme"],i=["bcommerce_shipping_config","bcommerce_volume_discount_config"],m=["user_data","cache_user_role_data"],C=[/^eyJ/,/^cache_header_counters/,/^cache_products_/];m.forEach(L=>localStorage.removeItem(L)),Object.keys(localStorage).forEach(L=>{C.some(g=>g.test(L))&&!n.includes(L)&&localStorage.removeItem(L)}),Object.keys(sessionStorage).forEach(L=>{!i.includes(L)&&!L.includes("_executed")&&!L.includes("autoprefetch")&&sessionStorage.removeItem(L)}),console.log("âœ… Limpieza inteligente completada - Preservadas configs tÃ©cnicas"),_.current=!1,I.current=!1,w.current=null,a(!1),t(null),O({role:null,isAdmin:!1,isSeller:!1,isPaymentUser:!1,sellerInfo:null,adminInfo:null,paymentInfo:null})},[]),l=c.useCallback(async()=>{try{if(I.current)try{await ne.post(D.AUTH.LOGOUT)}catch(n){console.error("âŒ Error al hacer logout en el servidor:",n)}h(),console.log("âœ… Logout completado exitosamente")}catch(n){console.error("âŒ Error durante el proceso de logout:",n),h()}},[h]);c.useEffect(()=>{Xe(h)},[h]);const o=c.useMemo(()=>({user:r,setUser:t,isAuthenticated:s,setIsAuthenticated:a,logout:l,clearSessionData:h,roleInfo:x,isLoadingRole:N,refreshRoleInfo:k,isInitialized:u,getDefaultRouteForRole:b,isAdmin:$,isSeller:F,updateUser:y}),[r,s,l,h,x,N,k,u,b,$,F]);return e.jsx(De.Provider,{value:o,children:p})},Ae=()=>{const p=c.useContext(De);if(!p)throw new Error("useAuth debe usarse dentro de un AuthProvider");return p};class ct{async getProducts(r){try{return await A.get(D.PRODUCTS.LIST,r)}catch(t){return console.error("âŒ Error en ProductService.getProducts:",t),null}}async deleteProduct(r){try{return(await A.delete(D.PRODUCTS.DELETE(r)))?.success===!0}catch(t){return console.error(`Error al eliminar producto ${r}:`,t),!1}}async createProduct(r){try{console.log("ðŸ“¤ ProductService: Creando producto:",r);const t=new FormData;if(t.append("name",r.name),t.append("description",r.description),t.append("price",String(r.price)),t.append("stock",String(r.stock)),t.append("category_id",String(r.category_id)),r.shortDescription&&t.append("short_description",r.shortDescription),r.weight!==void 0&&t.append("weight",String(r.weight)),r.width!==void 0&&t.append("width",String(r.width)),r.height!==void 0&&t.append("height",String(r.height)),r.depth!==void 0&&t.append("depth",String(r.depth)),r.dimensions&&t.append("dimensions",r.dimensions),r.sku&&t.append("sku",r.sku),r.status&&t.append("status",r.status),r.featured!==void 0&&t.append("featured",String(r.featured)),r.published!==void 0&&t.append("published",String(r.published)),r.discount_percentage!==void 0&&t.append("discount_percentage",String(r.discount_percentage)),r.colors){const a=typeof r.colors=="string"?r.colors:JSON.stringify(r.colors);t.append("colors",a)}if(r.sizes){const a=typeof r.sizes=="string"?r.sizes:JSON.stringify(r.sizes);t.append("sizes",a)}if(r.tags){const a=typeof r.tags=="string"?r.tags:JSON.stringify(r.tags);t.append("tags",a)}r.attributes&&Object.keys(r.attributes).length>0&&t.append("attributes",JSON.stringify(r.attributes)),r.images&&r.images.length>0&&r.images.forEach((a,u)=>{t.append(`images[${u}]`,a)});const s=await A.uploadFile(D.PRODUCTS.CREATE,t);return console.log("âœ… ProductService: Producto creado:",s),s}catch(t){throw console.error("âŒ Error en ProductService.createProduct:",t),t}}async getProductById(r){try{return(await A.get(D.PRODUCTS.DETAILS(r)))?.data||null}catch(t){return console.error("âŒ Error en ProductService.getProductById:",t),null}}async getProductBySlug(r){try{return(await A.get(D.PRODUCTS.DETAILS_BY_SLUG(r)))?.data||null}catch(t){return console.error("âŒ Error en ProductService.getProductBySlug:",t),null}}async getFeaturedProducts(r=8){try{return(await A.get(D.PRODUCTS.FEATURED,{limit:r}))?.data||[]}catch(t){return console.error("âŒ Error en ProductService.getFeaturedProducts:",t),[]}}async getRelatedProducts(r,t=4){try{return(await A.get(D.PRODUCTS.LIST,{limit:t,excludeId:r}))?.data||[]}catch(s){return console.error("âŒ Error en ProductService.getRelatedProducts:",s),[]}}async searchProducts(r,t){try{return await A.get(D.PRODUCTS.SEARCH(r),t)}catch(s){return console.error("âŒ Error en ProductService.searchProducts:",s),null}}async trackProductView(r){try{await A.post(D.PRODUCTS.INCREMENT_VIEW(r),{timestamp:new Date().toISOString()})}catch(t){console.error("âŒ Error en ProductService.trackProductView:",t)}}async getProductsByCategory(r,t=12,s=0){try{return await A.get(D.PRODUCTS.BY_CATEGORY(r),{limit:t,offset:s})}catch(a){return console.error("âŒ Error en ProductService.getProductsByCategory:",a),null}}static async getFeaturedRandom(r=6){try{return await A.get(D.PRODUCTS.FEATURED_RANDOM,{limit:r})||{data:[],meta:{total:0,count:0}}}catch(t){return console.error("âŒ Error en ProductService.getFeaturedRandom:",t),{data:[],meta:{total:0,count:0,limit:0,offset:0}}}}static async getTrendingAndOffers(r=12){try{return await A.get(D.PRODUCTS.TRENDING_OFFERS,{limit:r})||{data:[],meta:{total:0,count:0}}}catch(t){return console.error("âŒ Error en ProductService.getTrendingAndOffers:",t),{data:[],meta:{total:0,count:0,limit:0,offset:0}}}}static async getPersonalizedProducts(r=10){try{return await A.get(D.PRODUCTS.PERSONALIZED,{limit:r})||{data:[],meta:{total:0,count:0}}}catch(t){return console.error("âŒ Error en ProductService.getPersonalizedProducts:",t),{data:[],meta:{total:0,count:0,limit:0,offset:0}}}}static async getDiscountedProducts(r=12){try{return await A.get(D.PRODUCTS.DISCOUNTED,{limit:r})||{data:[],meta:{total:0,count:0}}}catch(t){return console.error("âŒ Error en ProductService.getDiscountedProducts:",t),{data:[],meta:{total:0,count:0,limit:0,offset:0}}}}static async getPopularProducts(r=12){try{return await A.get(D.PRODUCTS.POPULAR,{limit:r})||{data:[],meta:{total:0,count:0}}}catch(t){return console.error("âŒ Error en ProductService.getPopularProducts:",t),{data:[],meta:{total:0,count:0,limit:0,offset:0}}}}}const dt=({rating:p,maxRating:r=5,size:t=16,showValue:s=!1,reviews:a})=>{const u=p!=null&&p>0?Math.max(0,Math.min(p,r)):0;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex relative gap-[2px]",children:Array.from({length:r}).map((d,N)=>{const P=u>=N+1?100:u>N?(u-N)*100:0;return e.jsxs("div",{className:"relative",style:{width:t,height:t},children:[e.jsx(de,{size:t,className:"text-gray-300 absolute top-0 left-0"}),e.jsx("div",{className:"overflow-hidden absolute top-0 left-0 text-yellow-400",style:{width:`${P}%`},children:e.jsx(de,{size:t,className:"fill-yellow-400"})})]},N)})}),s&&u>0&&e.jsxs("span",{className:"ml-1 text-xs text-gray-500",children:[u.toFixed(1),a!=null&&a>0&&` (${a})`]})]})};class ut{async getCategories(r){try{console.log("ðŸ“¤ CategoryService: Obteniendo categorÃ­as:",r);const t=await A.get(D.CATEGORIES.LIST,r);return console.log("ðŸ“¥ CategoryService: Respuesta del servidor:",t),t}catch(t){return console.error("âŒ Error en CategoryService.getCategories:",t),null}}async getCategoryById(r){try{console.log(`ðŸ“¤ CategoryService: Obteniendo categorÃ­a ${r}`);const t=await A.get(D.CATEGORIES.DETAILS(r));return console.log("âœ… CategoryService: CategorÃ­a obtenida:",t),t}catch(t){return console.error("âŒ Error en CategoryService.getCategoryById:",t),null}}async getCategoryBySlug(r){try{console.log(`ðŸ“¤ CategoryService: Obteniendo categorÃ­a por slug ${r}`);const t=await A.get(D.CATEGORIES.SLUG(r));return console.log("âœ… CategoryService: CategorÃ­a obtenida por slug:",t),t}catch(t){return console.error("âŒ Error en CategoryService.getCategoryBySlug:",t),null}}async getMainCategories(r=!0){try{console.log("ðŸ“¤ CategoryService: Obteniendo categorÃ­as principales");const t=await A.get(D.CATEGORIES.MAIN,{with_counts:r});return console.log("âœ… CategoryService: CategorÃ­as principales obtenidas:",t),t?.data||[]}catch(t){return console.error("âŒ Error en CategoryService.getMainCategories:",t),[]}}async getFeaturedCategories(r=8){try{console.log("ðŸ“¤ CategoryService: Obteniendo categorÃ­as destacadas");const t=await A.get(D.CATEGORIES.FEATURED,{limit:r});return console.log("âœ… CategoryService: CategorÃ­as destacadas obtenidas:",t),t?.data||[]}catch(t){return console.error("âŒ Error en CategoryService.getFeaturedCategories:",t),[]}}async getSubcategories(r){try{console.log(`ðŸ“¤ CategoryService: Obteniendo subcategorÃ­as de ${r}`);const t=await A.get(D.CATEGORIES.SUBCATEGORIES(r));return console.log("âœ… CategoryService: SubcategorÃ­as obtenidas:",t),t?.data||[]}catch(t){return console.error("âŒ Error en CategoryService.getSubcategories:",t),[]}}async getCategoryProducts(r,t){try{console.log(`ðŸ“¤ CategoryService: Obteniendo productos de categorÃ­a ${r}`);const s=await A.get(D.CATEGORIES.PRODUCTS(r),t);return console.log("âœ… CategoryService: Productos de categorÃ­a obtenidos:",s),s}catch(s){return console.error("âŒ Error en CategoryService.getCategoryProducts:",s),null}}}const Q=new ut,mt=()=>{const[p,r]=c.useState(!1),[t,s]=c.useState(null),[a,u]=c.useState([]),[d,N]=c.useState([]),[P,x]=c.useState([]),[O,_]=c.useState(null),[I,w]=c.useState(!1),{invalidate:f}=Qe(),b=c.useCallback(h=>!h||typeof h!="object"?(console.error("CategorÃ­a invÃ¡lida para adaptar:",h),{}):{id:h.id,name:h.name||"",slug:h.slug||"",description:h.description||"",parent_id:h.parent_id,icon:h.icon,image:h.image,order:h.order,is_active:!!(h.is_active??!0),featured:!!(h.featured??!1),created_at:h.created_at,updated_at:h.updated_at,subcategories:Array.isArray(h.subcategories)?h.subcategories.map(l=>b(l)):void 0,product_count:h.product_count||0,parent:h.parent?b(h.parent):void 0},[]);c.useEffect(()=>{if(!I){const h=j.getItem("categories_all");h&&Array.isArray(h.data)&&u(h.data);const l=j.getItem("categories_main");l&&Array.isArray(l)&&N(l);const o=j.getItem("categories_featured");o&&Array.isArray(o)&&x(o),w(!0)}},[I]);const y=c.useCallback(async(h=!0,l=!1)=>{r(!0),s(null);const o=`categories_all_${h?"with_counts":"no_counts"}`;try{if(!l){const i=j.getItem(o);if(i&&Array.isArray(i.data))return console.log("ðŸ’¾ Usando categorÃ­as en cachÃ©"),u(i.data),r(!1),i}console.log("ðŸŒ Obteniendo categorÃ­as desde API con withCounts:",h);const n=await Q.getCategories({with_counts:h,is_active:!0});if(n&&typeof n=="object"&&"data"in n&&Array.isArray(n.data)){const i=n.data.map(b),m={data:i,meta:n.meta||{total:i.length}};return j.setItem(o,m,z.cache.categoryCacheTime),u(i),m}else return console.warn("Respuesta de categorÃ­as no tiene el formato esperado:",n),u([]),{data:[],meta:{total:0}}}catch(n){const i=n instanceof Error?n.message:"Error al obtener categorÃ­as";return s(i),console.error("Error al obtener categorÃ­as:",n),u([]),{data:[],meta:{total:0}}}finally{r(!1)}},[b]),v=c.useCallback(async(h=!0,l=!1)=>{r(!0),s(null);const o=`categories_main_${h?"with_counts":"no_counts"}`;try{if(!l){const C=j.getItem(o);if(C&&Array.isArray(C))return console.log("ðŸ’¾ Usando categorÃ­as principales en cachÃ©"),N(C),r(!1),C}console.log("ðŸŒ Obteniendo categorÃ­as principales desde API");const n=await Q.getMainCategories(h);let i=[];if(Array.isArray(n))i=n;else if(n&&typeof n=="object"&&"data"in n&&Array.isArray(n.data))i=n.data;else return console.warn("Respuesta de categorÃ­as principales no tiene el formato esperado:",n),N([]),[];const m=i.map(b);return j.setItem(o,m,z.cache.categoryCacheTime),N(m),m}catch(n){const i=n instanceof Error?n.message:"Error al obtener categorÃ­as principales";return s(i),console.error("Error al obtener categorÃ­as principales:",n),N([]),[]}finally{r(!1)}},[b]),R=c.useCallback(async(h=8,l=!1)=>{r(!0),s(null);const o=`categories_featured_${h}`;try{if(!l){const C=j.getItem(o);if(C&&Array.isArray(C))return console.log("ðŸ’¾ Usando categorÃ­as destacadas en cachÃ©"),x(C),r(!1),C}console.log("ðŸŒ Obteniendo categorÃ­as destacadas desde API");const n=await Q.getFeaturedCategories(h);let i=[];if(Array.isArray(n))i=n;else if(n&&typeof n=="object"&&"data"in n&&Array.isArray(n.data))i=n.data;else return console.warn("Respuesta de categorÃ­as destacadas no tiene el formato esperado:",n),x([]),[];const m=i.map(b);return j.setItem(o,m,z.cache.categoryCacheTime),x(m),m}catch(n){const i=n instanceof Error?n.message:"Error al obtener categorÃ­as destacadas";return s(i),console.error("Error al obtener categorÃ­as destacadas:",n),x([]),[]}finally{r(!1)}},[b]),k=c.useCallback(async h=>{r(!0),s(null);const l=`categories_subcats_${h}`;try{const o=j.getItem(l);if(o&&Array.isArray(o))return console.log(`ðŸ’¾ Usando subcategorÃ­as en cachÃ© para categorÃ­a ${h}`),r(!1),o;const n=await Q.getSubcategories(h);let i=[];if(Array.isArray(n))i=n;else if(n&&typeof n=="object"&&"data"in n&&Array.isArray(n.data))i=n.data;else return[];if(i.length>0){const m=i.map(b);return j.setItem(l,m,z.cache.categoryCacheTime),m}return[]}catch(o){const n=o instanceof Error?o.message:"Error al obtener subcategorÃ­as";return s(n),console.error("Error al obtener subcategorÃ­as:",o),[]}finally{r(!1)}},[b]),$=c.useCallback(async h=>{r(!0),s(null);const l=`category_slug_${h}`;try{const o=j.getItem(l);if(o)return console.log(`ðŸ’¾ Usando categorÃ­a en cachÃ© para slug ${h}`),_(o),r(!1),o;const n=await Q.getCategoryBySlug(h);if(n&&typeof n=="object"){const i=b(n);return j.setItem(l,i,z.cache.categoryCacheTime),_(i),i}return _(null),null}catch(o){const n=o instanceof Error?o.message:"Error al obtener categorÃ­a por slug";return s(n),console.error("Error al obtener categorÃ­a por slug:",o),_(null),null}finally{r(!1)}},[b]),F=c.useCallback(h=>{h?(f(`category_${h}`),f("category_slug_*"),console.log(`ðŸ—‘ï¸ CachÃ© de la categorÃ­a ${h} invalidada`)):(f("categories_*"),f("category_*"),console.log("ðŸ—‘ï¸ Toda la cachÃ© de categorÃ­as invalidada"))},[f]);return{loading:p,error:t,categories:a,mainCategories:d,featuredCategories:P,categoryDetail:O,fetchCategories:y,fetchMainCategories:v,fetchFeaturedCategories:R,fetchSubcategories:k,fetchCategoryBySlug:$,clearCategoryCache:F}},pe=(p,r={})=>{if(!p)return"Sin fecha";try{const t=typeof p=="string"?new Date(p):p;if(isNaN(t.getTime()))return"Fecha invÃ¡lida";const{showTime:s=!0,timeFormat:a="24h",dateFormat:u="medium"}=r,d={day:"numeric",month:"long",year:"numeric"};u==="short"?d.month="numeric":u==="long"&&(d.weekday="long");const N={hour:"numeric",minute:"numeric"};a==="12h"?N.hour12=!0:N.hour12=!1;let P=t.toLocaleDateString("es-ES",d);if(s){const x=t.toLocaleTimeString("es-ES",N);P+=` ${x}`}return P}catch(t){return console.error("Error al formatear fecha:",t),String(p)}},Rt=p=>["pending","processing","paid","shipped","delivered","completed","cancelled","rejected"].includes(p),pt=p=>({pending:["processing","cancelled","rejected"],processing:["shipped","cancelled","rejected"],paid:["processing","shipped","cancelled","rejected"],shipped:["delivered","cancelled"],delivered:["completed"],completed:[],cancelled:[],rejected:[],ready_to_ship:[],in_transit:[],failed:[],returned:[]})[p]||[],be=(p,r)=>pt(p).includes(r);class W{static instance;static getInstance(){return W.instance||(W.instance=new W),W.instance}adaptSellerDataToBreakdownFormat(r){const t=[];return r.items&&Array.isArray(r.items)&&r.items.forEach(s=>{const a=[];a.push({step:1,label:"Precio original",price_per_unit:s.original_unit_price||s.unit_price||0,percentage:0,is_discount:!1}),s.seller_discount_percentage&&s.seller_discount_percentage>0&&a.push({step:2,label:`Descuento del seller (${s.seller_discount_percentage}%)`,price_per_unit:s.unit_price||0,percentage:s.seller_discount_percentage,is_discount:!0}),s.volume_discount_percentage&&s.volume_discount_percentage>0&&a.push({step:a.length+1,label:`Descuento por volumen (${s.volume_discount_percentage}%)`,price_per_unit:s.unit_price||0,percentage:s.volume_discount_percentage,is_discount:!0});const u={id:s.id,product_id:s.product_id,product_name:s.product_name||"Producto",product_image:s.product_image,quantity:s.quantity||1,original_price_per_unit:s.original_unit_price||s.unit_price||0,final_price_per_unit:s.unit_price||0,subtotal:s.total_price||0,total_savings:s.total_savings||0,breakdown_steps:a,has_seller_discount:(s.seller_discount_percentage||0)>0,has_volume_discount:(s.volume_discount_percentage||0)>0,has_coupon_discount:!1,seller_net_earning_per_unit:s.seller_net_earning_from_products||0,platform_commission_rate:s.platform_commission_rate||0,platform_commission_amount:s.platform_commission_amount||0};t.push(u)}),{order_id:r.id||0,items:t,summary:{total_items:t.length,total_quantity:t.reduce((s,a)=>s+a.quantity,0),total_original_amount:t.reduce((s,a)=>s+a.original_price_per_unit*a.quantity,0),total_final_amount:t.reduce((s,a)=>s+a.subtotal,0),total_savings:t.reduce((s,a)=>s+a.total_savings,0),seller_commission_info:(()=>{const s=r.order_summary||r.orderSummary||{};return{platform_commission_rate:s.shipping_distribution?.platform_commission_rate||10,total_commission:s.total_platform_commission||0,seller_earnings_from_products:s.total_seller_earnings_from_products||0,shipping_distribution:s.shipping_distribution||{seller_amount:0}}})()}}}async getOrderItemsBreakdown(r,t="customer"){try{console.log(`ðŸ“Š Obteniendo desglose de items para orden ${r} (vista: ${t})`),console.log("ðŸ” OrderBreakdownService.getOrderItemsBreakdown llamado");const s=t==="seller"?`/seller/orders/${r}`:`/user/orders/${r}/items-breakdown`;console.log("ðŸ” Endpoint a usar:",s),console.log("ðŸ” OrderID que se estÃ¡ usando:",r),console.log("ðŸ” ViewType:",t);const u=await A.get(s);let d=null;if(u.success&&u.data||u.data?d=u.data:u.id&&u.items&&(d=u),d)return t==="seller"?this.adaptSellerDataToBreakdownFormat(d):this.adaptCustomerDataToBreakdownFormat(d);throw new Error("No se pudo obtener el desglose de items")}catch(s){throw console.error("âŒ Error al obtener desglose:",s),console.error("âŒ Error especÃ­fico:",s),console.error("âŒ Error mensaje:",s instanceof Error?s.message:"Error desconocido"),console.error("âŒ Error status:",s?.response?.status),console.error("âŒ Error data:",s?.response?.data),s}}adaptCustomerDataToBreakdownFormat(r){const t=[];return r.items&&Array.isArray(r.items)&&r.items.forEach(s=>{t.push({id:s.id,product_id:s.product_id,product_name:s.product_name||"Producto",product_image:s.product_image,quantity:s.quantity||1,original_price_per_unit:s.original_unit_price||0,final_price_per_unit:s.unit_price||0,subtotal:s.total_price||0,total_savings:s.total_savings||0,breakdown_steps:s.breakdown_steps||[],has_seller_discount:(s.seller_discount_percentage||0)>0,has_volume_discount:(s.volume_discount_percentage||0)>0,has_coupon_discount:!1})}),{order_id:r.order_id||0,items:t,summary:{total_items:t.length,total_quantity:t.reduce((s,a)=>s+a.quantity,0),total_original_amount:t.reduce((s,a)=>s+a.original_price_per_unit*a.quantity,0),total_final_amount:t.reduce((s,a)=>s+a.subtotal,0),total_savings:t.reduce((s,a)=>s+a.total_savings,0)}}}}const gt=()=>[{key:"id",header:"ID Pedido",render:(p,r)=>e.jsxs(q,{to:`/seller/orders/${r.id}`,className:"text-primary-600 hover:underline font-medium",children:["#",p]})},{key:"date",header:"Fecha"},{key:"customer",header:"Cliente"},{key:"total",header:"Total",render:p=>T(p)},{key:"status",header:"Estado",render:p=>{const t={Completed:{text:"Completado",classes:"bg-green-100 text-green-800"},Shipped:{text:"Enviado",classes:"bg-blue-100 text-blue-800"},Processing:{text:"En Proceso",classes:"bg-yellow-100 text-yellow-800"}}[p]||{text:p,classes:""};return e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${t.classes}`,children:t.text})}}],ht=({orders:p,title:r,viewAllLink:t,viewAllText:s,compact:a=!1,className:u="",onOrderClick:d})=>e.jsx(Pe,{data:p,columns:gt(),title:r,viewAllLink:t,viewAllText:s,compact:a,className:u,onRowClick:d}),xt=()=>[{key:"name",header:"Producto",render:(p,r)=>e.jsx(q,{to:`/seller/products/edit/${r.id}`,className:"text-primary-600 hover:underline font-medium",children:p})},{key:"sold",header:"Unidades Vendidas"},{key:"revenue",header:"Ingresos",render:p=>T(p)}],ft=({products:p,title:r,viewAllLink:t,viewAllText:s,compact:a=!1,className:u="",onProductClick:d})=>e.jsx(Pe,{data:p,columns:xt(),title:r,viewAllLink:t,viewAllText:s,compact:a,className:u,onRowClick:d}),yt=()=>{const p=Ce(),[r,t]=c.useState(null),[s,a]=c.useState(!0);c.useEffect(()=>{u()},[]);const u=async()=>{try{const I=await A.get(D.SELLER.DASHBOARD);I.status==="success"?t(I.data):(console.error("Dashboard API returned error:",I),t(d()))}catch(I){console.error("Error fetching dashboard data:",I),t(d())}finally{a(!1)}},d=()=>({stats:{total_sales:0,total_orders:0,active_products:0,total_products:0,average_rating:0,pending_orders:0},recent_orders:[],top_products:[]}),N=I=>{p(`/seller/orders/${I.id}`)},P=I=>{p(`/seller/products/${I.id}`)};if(s)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Panel del Vendedor"}),e.jsx("div",{className:"text-center py-12",children:"Cargando..."})]});const x=r||d(),O=[{title:"Ventas Totales",value:T(x.stats.total_sales),change:0,icon:se,iconBgColor:"bg-primary-50",iconColor:"text-primary-600"},{title:"Pedidos Totales",value:x.stats.total_orders,change:0,icon:J,iconBgColor:"bg-orange-50",iconColor:"text-orange-600"},{title:"Productos Activos",value:`${x.stats.active_products} / ${x.stats.total_products}`,change:0,text:`${x.stats.active_products} productos activos`,icon:H,iconBgColor:"bg-blue-50",iconColor:"text-blue-600"},{title:"Promedio de Valoraciones",value:x.stats.average_rating.toFixed(1),change:0,text:e.jsx(dt,{rating:x.stats.average_rating,size:15}),icon:de,iconBgColor:"bg-yellow-50",iconColor:"text-yellow-600"}],_=[{icon:J,iconBgColor:"bg-orange-50",iconColor:"text-orange-600",title:"Pedidos Pendientes",description:`Tienes ${x.stats.pending_orders} pedidos esperando ser procesados.`,linkText:"Procesar Pedidos",linkTo:"/seller/orders?status=pending"},{icon:H,iconBgColor:"bg-blue-50",iconColor:"text-blue-600",title:"AÃ±adir Nuevo Producto",description:"Aumenta tu catÃ¡logo aÃ±adiendo nuevos productos a tu tienda.",linkText:"AÃ±adir Producto",linkTo:"/seller/products/create"},{icon:ge,iconBgColor:"bg-green-50",iconColor:"text-green-600",title:"Informes de Ventas",description:"Consulta informes detallados de ventas y anÃ¡lisis para tu tienda.",linkText:"Ver Informes",linkTo:"/seller/earnings"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Panel del Vendedor"}),e.jsx(Ie,{cards:O}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(ht,{orders:x.recent_orders,title:"Pedidos Recientes",viewAllLink:"/seller/orders",onOrderClick:N}),e.jsx(ft,{products:x.top_products,title:"Productos MÃ¡s Vendidos",viewAllLink:"/seller/products",onProductClick:P})]}),e.jsx(Ze,{items:_,color:!0})]})},Ot=Object.freeze(Object.defineProperty({__proto__:null,default:yt},Symbol.toStringTag,{value:"Module"})),ce=new ct,bt=()=>{const{user:p}=Ae(),[r,t]=c.useState(!1),[s,a]=c.useState(null),[u,d]=c.useState([]),[N,P]=c.useState(null),[x,O]=c.useState(0),[_,I]=c.useState(1),[w,f]=c.useState(10),b=c.useCallback(async(l=1,o=10,n=!1)=>{t(!0),a(null);try{const i=p?.id;if(!i)throw new Error("No se pudo obtener el ID del vendedor");const m={limit:o,offset:(l-1)*o,page:l,sellerId:i,sortBy:"created_at",sortDir:"desc",featured:void 0,status:void 0,...n&&{_t:Date.now()}};n&&console.log("ðŸ”¥ FORCE REFRESH - timestamp:",Date.now());const C=await ce.getProducts(m);C?Array.isArray(C.data)?(d(C.data),O(C.meta?.total||C.data.length)):(d([]),O(0)):(d([]),O(0))}catch(i){const m=i instanceof Error?i.message:"Error al obtener productos del vendedor";a(m),console.error("Error al obtener productos del vendedor:",i),d([]),O(0)}finally{t(!1)}},[p]),y=c.useCallback(async l=>{t(!0),a(null);try{const o=await ce.getProductById(l);return P(o),o}catch(o){const n=o instanceof Error?o.message:"Error al obtener los detalles del producto";return a(n),console.error("Error al obtener detalles del producto:",o),null}finally{t(!1)}},[]),v=c.useCallback(async l=>{t(!0),a(null);try{const o=new FormData;if(o.append("name",l.name),o.append("description",l.description),l.shortDescription&&o.append("short_description",l.shortDescription),o.append("price",String(l.price)),o.append("stock",String(l.stock)),l.weight!==void 0&&o.append("weight",String(l.weight)),l.width!==void 0&&o.append("width",String(l.width)),l.height!==void 0&&o.append("height",String(l.height)),l.depth!==void 0&&o.append("depth",String(l.depth)),l.dimensions&&o.append("dimensions",l.dimensions),o.append("category_id",String(l.category_id)),l.sku&&o.append("sku",l.sku),l.status!==void 0&&o.append("status",l.status),l.featured!==void 0&&o.append("featured",String(l.featured)),l.published!==void 0&&o.append("published",String(l.published)),l.discount_percentage!==void 0&&o.append("discount_percentage",String(l.discount_percentage)),l.colors){const m=typeof l.colors=="string"?l.colors:JSON.stringify(l.colors);o.append("colors",m)}if(l.sizes){const m=typeof l.sizes=="string"?l.sizes:JSON.stringify(l.sizes);o.append("sizes",m)}if(l.tags){const m=typeof l.tags=="string"?l.tags:JSON.stringify(l.tags);o.append("tags",m)}l.attributes&&Object.keys(l.attributes).length>0&&o.append("attributes",JSON.stringify(l.attributes)),l.images&&l.images.length>0&&l.images.forEach((m,C)=>{o.append(`images[${C}]`,m)}),console.log("Enviando datos de producto para creaciÃ³n:");for(const[m,C]of o.entries())m.startsWith("images[")?console.log(`${m}: (archivo binario)`):console.log(`${m}: ${C}`);const n=await A.uploadFile(D.PRODUCTS.CREATE,o);let i=null;if(n&&typeof n=="object"&&(i=n),i){console.log("âœ… Producto creado exitosamente:",i),console.log("ðŸ”„ Iniciando invalidaciÃ³n de cache y refetch...");try{j.removeItem("seller_products_list"),j.removeItem("seller_products_page_1"),j.removeItem("seller_products_page_2"),j.removeItem("seller_products_page_3"),j.removeItem("products_list"),j.removeItem("header_counters"),console.log("ðŸ—‘ï¸ Cache de productos invalidado correctamente")}catch(m){console.warn("âš ï¸ Error invalidando cache:",m)}setTimeout(async()=>{console.log("ðŸ”„ Ejecutando fetchSellerProducts despuÃ©s de crear..."),await b(_,w,!0),console.log("âœ… fetchSellerProducts completado")},100),setTimeout(async()=>{console.log("ðŸ”„ Refetch backup despuÃ©s de 1s..."),await b(_,w,!0)},1e3)}else throw console.error("Respuesta de creaciÃ³n de producto no vÃ¡lida:",n),new Error("No se pudo crear el producto. La respuesta del servidor no es vÃ¡lida.");return i}catch(o){let n="Error desconocido al crear producto";if(o&&typeof o=="object")if(o.response&&o.response.data){const m=o.response.data;m.message?n=m.message:m.error?n=m.error:o.message&&(n=o.message)}else o.message&&(n=o.message);const i=`Error al crear producto: ${n}`;return a(i),console.error("Error al crear producto:",o),alert(n),null}finally{t(!1)}},[b,_,w]),R=c.useCallback(async l=>{t(!0),a(null);try{console.log("Actualizando producto con datos:",l);const o=new FormData;if(l.name&&o.append("name",l.name),l.description&&o.append("description",l.description),l.shortDescription&&o.append("short_description",l.shortDescription),l.price!==void 0&&o.append("price",String(l.price)),l.stock!==void 0&&o.append("stock",String(l.stock)),l.weight!==void 0&&o.append("weight",String(l.weight)),l.width!==void 0&&o.append("width",String(l.width)),l.height!==void 0&&o.append("height",String(l.height)),l.depth!==void 0&&o.append("depth",String(l.depth)),l.dimensions&&o.append("dimensions",l.dimensions),l.category_id&&o.append("category_id",String(l.category_id)),l.status&&o.append("status",l.status),l.featured!==void 0&&o.append("featured",String(l.featured)),l.published!==void 0&&o.append("published",String(l.published)),l.discount_percentage!==void 0&&o.append("discount_percentage",String(l.discount_percentage)),l.colors){const m=typeof l.colors=="string"?l.colors:JSON.stringify(l.colors);o.append("colors",m)}if(l.sizes){const m=typeof l.sizes=="string"?l.sizes:JSON.stringify(l.sizes);o.append("sizes",m)}if(l.tags){const m=typeof l.tags=="string"?l.tags:JSON.stringify(l.tags);o.append("tags",m)}l.attributes&&Object.keys(l.attributes).length>0&&o.append("attributes",JSON.stringify(l.attributes)),l.replace_images!==void 0&&o.append("replace_images",String(l.replace_images)),l.remove_images&&l.remove_images.length>0&&o.append("remove_images",JSON.stringify(l.remove_images)),l.images&&l.images.length>0&&l.images.forEach((m,C)=>{o.append(`images[${C}]`,m)});const n=await A.updateFile(D.PRODUCTS.UPDATE(l.id),o);let i=null;if(n&&typeof n=="object"&&(i=n),i){console.log("âœ… Producto actualizado exitosamente:",i),console.log("ðŸ”„ Iniciando invalidaciÃ³n de cache y refetch despuÃ©s de actualizar...");try{j.removeItem("seller_products_list"),j.removeItem("seller_products_page_1"),j.removeItem("seller_products_page_2"),j.removeItem("seller_products_page_3"),j.removeItem("products_list"),j.removeItem("header_counters"),j.removeItem("product_"+l.id),console.log("ðŸ—‘ï¸ Cache de productos invalidado correctamente")}catch(m){console.warn("âš ï¸ Error invalidando cache:",m)}setTimeout(async()=>{console.log("ðŸ”„ Ejecutando fetchSellerProducts despuÃ©s de actualizar..."),await b(_,w,!0),console.log("âœ… fetchSellerProducts completado")},100),setTimeout(async()=>{console.log("ðŸ”„ Refetch backup despuÃ©s de 1s..."),await b(_,w,!0)},1e3)}else throw new Error("No se pudo actualizar el producto");return i}catch(o){let n="Error desconocido al actualizar producto";if(o&&typeof o=="object")if(o.response&&o.response.data){const m=o.response.data;m.message?n=m.message:m.error?n=m.error:o.message&&(n=o.message)}else o.message&&(n=o.message);const i=`Error al actualizar producto: ${n}`;return a(i),console.error("Error al actualizar producto:",o),alert(n),null}finally{t(!1)}},[b,_,w]),k=c.useCallback(async l=>{t(!0),a(null);try{const o=await ce.deleteProduct(l);if(o){console.log("âœ… Producto eliminado exitosamente");try{j.removeItem("seller_products_list"),j.removeItem("seller_products_page_1"),j.removeItem("seller_products_page_2"),j.removeItem("seller_products_page_3"),j.removeItem("products_list"),j.removeItem("header_counters"),j.removeItem("product_"+l),console.log("ðŸ—‘ï¸ Cache de productos invalidado correctamente")}catch(n){console.warn("âš ï¸ Error invalidando cache:",n)}setTimeout(async()=>{await b(_,w,!0)},100)}return o}catch(o){const n=o instanceof Error?o.message:"Error al eliminar producto";return a(n),console.error("Error al eliminar producto:",o),!1}finally{t(!1)}},[b,_,w]),$=c.useCallback(async(l,o)=>{t(!0),a(null);try{const n=o==="active"?"inactive":"active",i=new FormData;if(i.append("status",n),await A.uploadFile(D.PRODUCTS.UPDATE(l),i))return console.log("âœ… Estado del producto cambiado exitosamente"),setTimeout(async()=>{await b(_,w,!0)},100),!0;throw new Error("Error al cambiar estado del producto")}catch(n){const i=n instanceof Error?n.message:"Error al cambiar estado del producto";return a(i),console.error("Error al cambiar estado del producto:",n),!1}finally{t(!1)}},[b,_,w]);c.useEffect(()=>{p&&b(_,w)},[p,_,w,b]);const F=c.useCallback(l=>{I(l)},[]),h=c.useCallback(l=>{f(l),I(1)},[]);return{products:u,productDetail:N,totalProducts:x,loading:r,error:s,page:_,itemsPerPage:w,fetchSellerProducts:b,fetchProductById:y,createProduct:v,updateProduct:R,deleteProduct:k,toggleProductStatus:$,changePage:F,changeItemsPerPage:h}},_t=()=>{const p=Ce(),r=Ye(),{products:t,loading:s,error:a,fetchSellerProducts:u,deleteProduct:d,toggleProductStatus:N}=bt(),{categories:P,fetchCategories:x}=mt(),[O,_]=c.useState(""),[I,w]=c.useState("all"),[f,b]=c.useState([]),[y,v]=c.useState(null),[R,k]=c.useState(null);c.useEffect(()=>{x()},[x]),c.useEffect(()=>{const o=r.state;o?.updatedProduct&&(console.log("ðŸ”„ Detectado regreso desde ediciÃ³n, forzando refresh...",{productId:o.productId,timestamp:o.timestamp}),setTimeout(()=>{u(1,10,!0)},100),p(r.pathname,{replace:!0,state:null}))},[r.state,u,p,r.pathname]),c.useEffect(()=>{if(t&&t.length>0){const o=new Map;P.forEach(i=>{i.id&&o.set(i.id,i.name)});const n=t.map(i=>{const m=i.categoryId||0,C=i.category_name||`CategorÃ­a ${m}`;return{id:i.id||0,name:i.name,price:typeof i.price=="number"?i.price:parseFloat(String(i.price))||0,stock:typeof i.stock=="number"?i.stock:parseInt(String(i.stock))||0,categoryId:m,category:C,status:i.status||"inactive",createdAt:pe(i.created_at)}});b(n)}else b([])},[t,P]);const $=f.filter(o=>{const n=o.name.toLowerCase().includes(O.toLowerCase())||o.category.toLowerCase().includes(O.toLowerCase()),i=I==="all"||o.status===I;return n&&i}),F=async o=>{if(window.confirm("Â¿EstÃ¡s seguro de que deseas eliminar este producto?"))try{v(o),await d(o)||alert("No se pudo eliminar el producto. IntÃ©ntalo de nuevo mÃ¡s tarde.")}finally{v(null)}},h=async(o,n)=>{try{k(o),await N(o,n)||alert("No se pudo cambiar el estado del producto. IntÃ©ntalo de nuevo mÃ¡s tarde.")}finally{k(null)}},l=o=>{p(`/seller/products/edit/${o}`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mis Productos"}),e.jsxs(q,{to:"/seller/products/create",className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(xe,{size:18,className:"mr-2"}),"AÃ±adir Nuevo Producto"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("input",{type:"text",placeholder:"Buscar productos...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:O,onChange:o=>_(o.target.value)}),e.jsx(Se,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-gray-500"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:I,onChange:o=>w(o.target.value),children:[e.jsx("option",{value:"all",children:"Todos los Estados"}),e.jsx("option",{value:"active",children:"Activo"}),e.jsx("option",{value:"inactive",children:"Inactivo"}),e.jsx("option",{value:"draft",children:"Borrador"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:s?e.jsx("div",{className:"p-8 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})}):a?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(Te,{className:"h-12 w-12 mx-auto text-red-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error al cargar productos"}),e.jsx("p",{className:"text-gray-500 mb-4",children:a}),e.jsx("button",{onClick:()=>u(),className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Intentar de nuevo"})]}):$.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(H,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No se encontraron productos"}),e.jsx("p",{className:"text-gray-500 mb-4",children:O||I!=="all"?"Intenta ajustar tu bÃºsqueda o filtro para encontrar lo que buscas.":"Comienza agregando tu primer producto."}),e.jsxs(q,{to:"/seller/products/create",className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(xe,{size:18,className:"mr-2"}),"AÃ±adir Nuevo Producto"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Producto"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CategorÃ­a"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Creado"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:$.map(o=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-gray-100 rounded-md flex items-center justify-center",children:e.jsx(H,{className:"h-6 w-6 text-gray-500"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:o.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",o.id]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:o.category||"Sin categorÃ­a"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:T(o.price)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:`text-sm ${o.stock>0?"text-green-600":"text-red-600"}`,children:o.stock>0?o.stock:"Sin stock"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${o.status==="active"?"bg-green-100 text-green-800":o.status==="inactive"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:[o.status==="active"&&"Activo",o.status==="inactive"&&"Inactivo",o.status==="draft"&&"Borrador"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:o.createdAt}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>h(o.id,o.status),disabled:R===o.id,className:`p-1 rounded-md ${R===o.id?"opacity-50 cursor-not-allowed":o.status==="active"?"text-yellow-600 hover:bg-yellow-100":"text-green-600 hover:bg-green-100"}`,title:o.status==="active"?"Desactivar":"Activar",children:R===o.id?e.jsx("div",{className:"animate-spin h-4 w-4"}):o.status==="active"?e.jsx($e,{size:18}):e.jsx(we,{size:18})}),e.jsx("button",{onClick:()=>l(o.id),className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Editar producto",children:e.jsx(Ue,{size:18})}),e.jsx("button",{onClick:()=>F(o.id),disabled:y===o.id,className:`p-1 text-red-600 hover:bg-red-100 rounded-md ${y===o.id?"opacity-50 cursor-not-allowed":""}`,title:"Eliminar producto",children:y===o.id?e.jsx("div",{className:"animate-spin h-4 w-4"}):e.jsx(Fe,{size:18})})]})})]},o.id))})]})})})]})},kt=Object.freeze(Object.defineProperty({__proto__:null,default:_t},Symbol.toStringTag,{value:"Module"})),vt=({items:p})=>{const r=t=>{switch(t){case"blue":return"bg-blue-50 text-blue-700 border-blue-200";case"green":return"bg-green-50 text-green-700 border-green-200";case"indigo":return"bg-indigo-50 text-indigo-700 border-indigo-200";case"red":return"bg-red-50 text-red-700 border-red-200";case"yellow":return"bg-yellow-50 text-yellow-700 border-yellow-200";case"purple":return"bg-purple-50 text-purple-700 border-purple-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}};return e.jsx(e.Fragment,{children:p.map((t,s)=>e.jsxs("div",{className:`rounded-lg border p-4 ${r(t.color)}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:t.label}),t.icon||null]}),e.jsx("p",{className:"mt-2 text-2xl font-bold",children:t.value})]},s))})};class Re{async getSellerOrders(r={}){try{console.log("SellerOrderServiceAdapter: Obteniendo Ã³rdenes con filtros:",r);const t={limit:r.limit||10,page:r.page||1};r.status&&r.status!=="all"&&(t.status=r.status),r.paymentStatus&&r.paymentStatus!=="all"&&(t.payment_status=r.paymentStatus),r.search&&(t.search=r.search),r.dateFrom&&(t.date_from=r.dateFrom),r.dateTo&&(t.date_to=r.dateTo);const s=await A.get(D.ORDERS.SELLER_ORDERS,t);if(console.log("SellerOrderServiceAdapter: Respuesta de la API:",s),!s||s.success!==!0)throw new Error("Respuesta de API invÃ¡lida");const a=Array.isArray(s.data)?s.data.map(N=>this.mapOrderToUI(N)):[],u=s.pagination||{currentPage:1,totalPages:1,totalItems:a.length,itemsPerPage:10},d={currentPage:Number(u.currentPage)||1,totalPages:Number(u.totalPages)||1,totalItems:Number(u.totalItems)||a.length,itemsPerPage:Number(u.itemsPerPage)||10};return{orders:a,pagination:d}}catch(t){return console.error("SellerOrderServiceAdapter: Error al obtener Ã³rdenes:",t),{orders:[],pagination:{currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}}}}mapOrderToUI(r){if(!r)return console.warn("SellerOrderServiceAdapter: Orden invÃ¡lida recibida"),{id:"0",orderNumber:"N/A",date:new Date().toISOString(),customer:{id:0,name:"Cliente",email:"sin@email.com"},total:0,items:[],status:"pending",paymentStatus:"pending"};const t=r.customer?.name||"Cliente",s=r.customer?.email||"sin@email.com",a=Array.isArray(r.items)?r.items.map(d=>({id:d.id,product_id:d.product_id,quantity:Number(d.quantity)||1,price:Number(d.price)||0,subtotal:Number(d.subtotal)||0,name:d.product?.name||d.product_name||`Producto ${d.product_id}`,sku:d.product?.sku||d.product_sku||`SKU-${d.product_id}`,image:d.product?.image||d.product_image||"/placeholder-product.jpg"})):[],u=typeof r.total=="string"?parseFloat(r.total):r.total||0;return{id:String(r.id||0),orderNumber:r.orderNumber||r.order_number||`#${r.id||0}`,date:r.date||r.created_at||new Date().toISOString(),customer:{id:r.customer?.id||r.user_id||0,name:t,email:s},total:u,items:a,status:r.status||"pending",paymentStatus:r.paymentStatus||r.payment_status||"pending",shippingAddress:typeof r.shippingAddress=="string"?r.shippingAddress:JSON.stringify(r.shippingAddress||{})}}async updateOrderStatus(r,t){try{console.log(`SellerOrderServiceAdapter: Actualizando orden ${r} a estado ${t}`);const s=await A.put(D.ORDERS.UPDATE_STATUS(Number(r)),{status:t});return!s||s.success!==!0?(console.error("Error al actualizar estado: Respuesta invÃ¡lida",s),!1):(console.log("Estado de orden actualizado correctamente:",s.data||s.message),!0)}catch(s){return console.error(`SellerOrderServiceAdapter: Error al actualizar estado de orden ${r}:`,s),!1}}async getOrderStats(){try{console.log("SellerOrderServiceAdapter: Obteniendo estadÃ­sticas de Ã³rdenes");const r=await A.get(D.ORDERS.STATS);if(console.log("SellerOrderServiceAdapter: Respuesta de estadÃ­sticas:",r),!r||r.success!==!0)throw new Error("Respuesta de API invÃ¡lida para estadÃ­sticas");const t=r.data||{};return[{label:"Total Pedidos",value:Number(t.totalOrders)||0,color:"blue"},{label:"Pendientes",value:Number(t.pendingOrders)||0,color:"yellow"},{label:"En Proceso",value:Number(t.processingOrders)||0,color:"blue"},{label:"Enviados",value:Number(t.shippedOrders)||0,color:"indigo"},{label:"Total Ventas",value:Number(t.totalSales)||0,isCurrency:!0,color:"green"}]}catch(r){return console.error("SellerOrderServiceAdapter: Error al obtener estadÃ­sticas:",r),[{label:"Total Pedidos",value:0,color:"blue"},{label:"Pendientes",value:0,color:"yellow"},{label:"En Proceso",value:0,color:"blue"},{label:"Total Ventas",value:0,isCurrency:!0,color:"green"}]}}async getOrderDetails(r){try{const t=typeof r=="string"?parseInt(r):r;console.log(`SellerOrderServiceAdapter: Obteniendo detalle de orden ${t} como vendedor`);const s=await A.get(D.ORDERS.SELLER_ORDER_DETAILS(t));if(console.log(`SellerOrderServiceAdapter: Respuesta para orden ${t}:`,s),!s||!s.data)throw new Error("Respuesta vacÃ­a al obtener detalle de orden");const a=s.data;console.log("ðŸ” TODOS LOS CAMPOS EN orderData:",Object.keys(a)),console.log("ðŸ” orderData.seller_id:",a.seller_id),console.log("ðŸ” orderData.sellerId:",a.sellerId),console.log("ðŸ” orderData.user_id:",a.user_id),console.log("ðŸ” orderData.userId:",a.userId),console.log("ðŸ” orderData.seller:",a.seller),console.log("ðŸ” orderData completo:",a);const u={id:a.id,sellerId:a.seller_id||a.sellerId,orderNumber:a.orderNumber||a.order_number||`#${a.id}`,orderDate:a.orderDate||a.order_date||a.date,status:a.status,total:Number(a.total)||0,items:Array.isArray(a.items)?a.items.map(d=>({id:d.id,product_id:d.product_id,product_name:d.product_name||`Producto ${d.product_id}`,quantity:Number(d.quantity)||1,unit_price:Number(d.unit_price)||0,total_price:Number(d.total_price)||0,original_unit_price:Number(d.original_unit_price)||0,price:Number(d.unit_price)||0,subtotal:Number(d.total_price)||0,product_image:d.product_image||"/placeholder-product.jpg",product_slug:d.product_slug||null,seller_discount_percentage:Number(d.seller_discount_percentage)||0,seller_discount_amount:Number(d.seller_discount_amount)||0,platform_commission_rate:Number(d.platform_commission_rate)||0,platform_commission_amount:Number(d.platform_commission_amount)||0,seller_net_earning_from_products:Number(d.seller_net_earning_from_products)||0,volume_discount_percentage:Number(d.volume_discount_percentage)||0,has_volume_discount:!!d.has_volume_discount||!1})):[],customer:a.customer||{id:a.user_id||0,name:"Cliente",email:"sin@email.com"},customerName:a.customer?.name||"Cliente",customerEmail:a.customer?.email||"sin@email.com",shippingData:a.shippingData||a.shipping_data||{},shipping:a.shipping||null,payment:a.payment||{method:"Tarjeta de crÃ©dito",status:"completed",payment_id:null},paymentMethod:a.payment?.method||"Tarjeta de crÃ©dito",paymentStatus:a.payment?.status||"completed",paymentId:a.payment?.payment_id||null,createdAt:a.orderDate||a.order_date||a.date,updatedAt:a.updated_at||a.orderDate,shippingAddress:this.formatShippingAddress(a),orderSummary:a.order_summary||{}};return console.log("Orden adaptada para UI de vendedor:",u),u}catch(t){throw console.error(`SellerOrderServiceAdapter: Error al obtener detalle de orden ${r}:`,t),t}}formatShippingAddress(r){const t=r.shippingData||r.shipping_data||{};if(typeof t=="string")try{const s=JSON.parse(t),a=[s.address,s.city,s.state||s.province,s.country,s.postal_code].filter(Boolean);return a.length>0?a.join(", "):"DirecciÃ³n no disponible"}catch{return t}if(t&&typeof t=="object"){const s=[t.address,t.city,t.state||t.province,t.country,t.postal_code].filter(Boolean);return s.length>0?s.join(", "):"DirecciÃ³n no disponible"}return"DirecciÃ³n no disponible"}async completeOrder(r){try{const t=typeof r=="string"?parseInt(r):r;console.log(`SellerOrderServiceAdapter: Completando orden ${t}`);const s=await A.post(D.ORDERS.COMPLETE(t));return console.log(`Respuesta al completar orden ${t}:`,s),s&&s.success===!0}catch(t){return console.error(`SellerOrderServiceAdapter: Error al completar orden ${r}:`,t),!1}}async updateShippingInfo(r,t){try{const s=typeof r=="string"?parseInt(r):r;console.log(`SellerOrderServiceAdapter: Actualizando informaciÃ³n de envÃ­o para orden ${s}`);const a=await A.patch(D.ORDERS.UPDATE_SHIPPING(s),t);return console.log("Respuesta al actualizar informaciÃ³n de envÃ­o:",a),a&&a.success===!0}catch(s){return console.error(`SellerOrderServiceAdapter: Error al actualizar informaciÃ³n de envÃ­o para orden ${r}:`,s),!1}}async createShipping(r,t){try{const s=typeof r=="string"?parseInt(r):r;console.log(`SellerOrderServiceAdapter: Creando informaciÃ³n de envÃ­o para orden ${s}`);const a=await A.post(D.ORDERS.UPDATE_SHIPPING(s),{...t,status:"shipped"});return console.log("Respuesta al crear informaciÃ³n de envÃ­o:",a),a&&a.success===!0}catch(s){return console.error(`SellerOrderServiceAdapter: Error al crear informaciÃ³n de envÃ­o para orden ${r}:`,s),!1}}}const Oe=[{value:"Servientrega",name:"Servientrega",prefix:"SE"},{value:"LaarCourier",name:"LaarCourier",prefix:"LAAR"},{value:"TramacoExpress",name:"TramacoExpress",prefix:"TRM"},{value:"DHL",name:"DHL",prefix:"DHL"},{value:"FedEx",name:"FedEx",prefix:"FDX"},{value:"TransportePesado",name:"TransportePesado",prefix:"TP"},{value:"AutoEntrega",name:"AutoEntrega",prefix:"AUTO"}],jt=p=>Oe.find(r=>r.value===p),_e=p=>{const r=Date.now().toString(),t=Math.random().toString(36).substring(2,8).toUpperCase(),s=jt(p);if(!s)return`TRK${r.slice(-8)}${t}`;const{prefix:a}=s;switch(a){case"CE":return`${a}${r.slice(-8)}${t}`;case"SEUR":return`${a}${r.slice(-6)}${t.slice(0,4)}`;case"MRW":return`${a}${r.slice(-7)}${t.slice(0,3)}`;case"DHL":return`${a}${r.slice(-8)}${t}`;case"FDX":return`${a}${r.slice(-8)}${t}`;case"1Z":return`${a}${t}${r.slice(-6)}`;case"NCX":return`${a}${r.slice(-8)}${t}`;case"GLS":return`${a}${r.slice(-8)}${t}`;default:return`TRK${r.slice(-8)}${t}`}},ke=({orderId:p,orderNumber:r,isOpen:t,onClose:s,onSubmit:a,isLoading:u=!1})=>{const[d,N]=c.useState({tracking_number:"",shipping_company:"Correos Express",estimated_delivery:"",notes:""}),[P,x]=c.useState({});c.useEffect(()=>{if(t){const f=_e("Correos Express"),b=new Date;b.setDate(b.getDate()+4),N({tracking_number:f,shipping_company:"Correos Express",estimated_delivery:b.toISOString().split("T")[0],notes:""}),x({})}},[t]);const O=f=>{const b=_e(f);N(y=>({...y,shipping_company:f,tracking_number:b}))},_=()=>{const f={};if(d.tracking_number.trim()||(f.tracking_number="El nÃºmero de seguimiento es requerido"),d.shipping_company.trim()||(f.shipping_company="La empresa de envÃ­o es requerida"),d.estimated_delivery){const b=new Date(d.estimated_delivery),y=new Date;y.setHours(0,0,0,0),b<y&&(f.estimated_delivery="La fecha de entrega debe ser futura")}return x(f),Object.keys(f).length===0},I=async f=>{if(f.preventDefault(),!!_())try{await a(d)}catch(b){console.error("Error al procesar envÃ­o:",b)}},w=f=>{const{name:b,value:y}=f.target;b==="shipping_company"?O(y):N(v=>({...v,[b]:y})),P[b]&&x(v=>({...v,[b]:""}))};return t?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 py-10 text-center sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-black-30 backdrop-blur-sm transition-opacity z-40",onClick:s}),e.jsxs("div",{role:"dialog","aria-modal":"true",className:"z-50 inline-block align-bottom bg-white rounded-xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary-500 to-primary-700 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 flex items-center justify-center h-10 w-10 rounded-full bg-white bg-opacity-20",children:e.jsx(ae,{className:"h-6 w-6 text-primary-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-lg leading-6 font-semibold text-white",children:"Procesar EnvÃ­o"}),e.jsx("p",{className:"text-sm text-primary-100",children:r?`Pedido ${r}`:`Pedido #${p}`})]})]}),e.jsx("button",{onClick:s,className:"text-white hover:text-primary-200 transition-colors",disabled:u,children:e.jsx(ue,{size:24})})]})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Empresa de EnvÃ­o"}),e.jsx("select",{name:"shipping_company",value:d.shipping_company,onChange:w,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",disabled:u,children:Oe.map(f=>e.jsx("option",{value:f.value,children:f.name},f.value))}),P.shipping_company&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.shipping_company})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["NÃºmero de Seguimiento",e.jsx("span",{className:"text-green-600 text-xs ml-2",children:"(Generado automÃ¡ticamente)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"tracking_number",value:d.tracking_number,onChange:w,className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg bg-gray-50 font-mono text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",disabled:u}),e.jsx(Le,{className:"absolute right-3 top-2.5 h-5 w-5 text-green-500"})]}),P.tracking_number&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.tracking_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Entrega Estimada"}),e.jsx("input",{type:"date",name:"estimated_delivery",value:d.estimated_delivery,onChange:w,min:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",disabled:u}),P.estimated_delivery&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.estimated_delivery})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notas (Opcional)"}),e.jsx("textarea",{name:"notes",value:d.notes,onChange:w,rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"InformaciÃ³n adicional sobre el envÃ­o...",disabled:u})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:s,disabled:u,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{type:"submit",onClick:I,disabled:u,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 flex items-center",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Procesando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{size:16,className:"mr-2"}),"Procesar EnvÃ­o"]})})]})]})]})}):null},ve=p=>{if(!p)return"";try{const r=JSON.parse(p);if(typeof r=="object"&&r!==null)return[r.address,r.city,r.state,r.country].filter(Boolean).join(", ")}catch(r){console.error("Error al parsear direcciÃ³n de envÃ­o:",r)}return p},St=()=>{const p=new Re,[r,t]=c.useState([]),[s,a]=c.useState(!0),[u,d]=c.useState("all"),[N,P]=c.useState("all"),[x,O]=c.useState("all"),[_,I]=c.useState(""),[w,f]=c.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),[b,y]=c.useState([]),[v,R]=c.useState({from:"",to:""}),[k,$]=c.useState(!1),[F,h]=c.useState(!1),[l,o]=c.useState(null);c.useEffect(()=>{n(),i()},[u,N,_,w.currentPage,x,v]);const n=async()=>{a(!0);try{const g={page:w.currentPage,limit:w.itemsPerPage};if(u!=="all"&&(g.status=u),N!=="all"&&(g.paymentStatus=N),_&&(g.search=_),x==="today"){const S=new Date().toISOString().split("T")[0];g.dateFrom=S,g.dateTo=S}else if(x==="week"){const S=new Date,U=new Date(S.setDate(S.getDate()-S.getDay()));g.dateFrom=U.toISOString().split("T")[0],g.dateTo=new Date().toISOString().split("T")[0]}else if(x==="month"){const S=new Date,U=new Date(S.getFullYear(),S.getMonth(),1);g.dateFrom=U.toISOString().split("T")[0],g.dateTo=new Date().toISOString().split("T")[0]}else x==="custom"&&v.from&&v.to&&(g.dateFrom=v.from,g.dateTo=v.to);const E=await p.getSellerOrders(g);t(E.orders),f(E.pagination)}catch(g){console.error("Error al cargar Ã³rdenes:",g)}finally{a(!1)}},i=async()=>{try{const E=(await p.getOrderStats()).map(S=>{let U;switch(S.label){case"Total Pedidos":U=e.jsx(J,{className:"h-5 w-5 text-blue-600"});break;case"Pendientes":U=e.jsx(H,{className:"h-5 w-5 text-yellow-600"});break;case"En Proceso":U=e.jsx(J,{className:"h-5 w-5 text-blue-600"});break;case"Enviados":U=e.jsx(ae,{className:"h-5 w-5 text-indigo-600"});break;case"Total Ventas":U=e.jsx(me,{className:"h-5 w-5 text-green-600"});break;default:U=e.jsx(J,{className:"h-5 w-5 text-blue-600"})}return{...S,icon:U,value:S.isCurrency&&typeof S.value=="number"?T(S.value):S.value}});y(E)}catch(g){console.error("Error al cargar estadÃ­sticas:",g),y([{label:"Total Pedidos",value:r.length,icon:e.jsx(J,{className:"h-5 w-5 text-blue-600"}),color:"blue"},{label:"Pendientes",value:r.filter(E=>E.status==="pending").length,icon:e.jsx(H,{className:"h-5 w-5 text-yellow-600"}),color:"yellow"},{label:"En Proceso",value:r.filter(E=>E.status==="processing").length,icon:e.jsx(J,{className:"h-5 w-5 text-blue-600"}),color:"blue"},{label:"Total Ventas",value:T(r.reduce((E,S)=>E+S.total,0)),icon:e.jsx(me,{className:"h-5 w-5 text-green-600"}),color:"green"}])}},m=async(g,E)=>{try{$(!0),await p.updateOrderStatus(g,E)&&(t(U=>U.map(le=>le.id===g?{...le,status:E}:le)),i())}catch(S){console.error(`Error al actualizar estado de orden ${g}:`,S)}finally{$(!1)}},C=g=>{o(g),h(!0)},M=async g=>{if(l)try{$(!0),await p.updateShippingInfo(l,g)&&(t(S=>S.map(U=>U.id===l?{...U,status:"shipped"}:U)),h(!1),o(null),n(),i())}catch(E){console.error("Error al procesar envÃ­o:",E)}finally{$(!1)}},Y=g=>{f(E=>({...E,currentPage:g}))},L=()=>{a(!0),n(),i()},he=[{key:"orderNumber",header:"NÃºmero de Pedido",sortable:!0,render:g=>e.jsx(q,{to:`/seller/orders/${g.id}`,className:"font-medium text-primary-600 hover:underline",children:g.orderNumber})},{key:"date",header:"Fecha",sortable:!0,render:g=>{const E=new Date(g.date);return e.jsxs("span",{children:[E.toLocaleDateString("es-ES")," ",E.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})]})}},{key:"customer",header:"Cliente",sortable:!0,render:g=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:g.customer.name}),e.jsx("div",{className:"text-xs text-gray-500",children:g.customer.email})]})},{key:"total",header:"Total",sortable:!0,render:g=>e.jsx("span",{className:"font-medium",children:T(g.total)})},{key:"items",header:"Productos",render:g=>e.jsx("span",{className:"text-center",children:g.items?g.items.reduce((E,S)=>E+S.quantity,0):0})},{key:"status",header:"Estado",sortable:!0,render:g=>{let E="",S="";switch(g.status){case"pending":E="bg-yellow-100 text-yellow-800",S="Pendiente";break;case"ready_to_ship":E="bg-blue-100 text-blue-800",S="Listo para enviar";break;case"in_transit":E="bg-indigo-100 text-indigo-800",S="En TrÃ¡nsito";break;case"processing":E="bg-blue-100 text-blue-800",S="En Proceso";break;case"paid":E="bg-cyan-100 text-cyan-800",S="Pagado";break;case"shipped":E="bg-indigo-100 text-indigo-800",S="Enviado";break;case"delivered":E="bg-green-100 text-green-800",S="Entregado";break;case"completed":E="bg-emerald-100 text-emerald-800",S="Completado";break;case"failed":E="bg-red-100 text-red-800",S="Fallido";break;case"rejected":E="bg-orange-100 text-orange-800",S="Devuelto";break;case"cancelled":E="bg-gray-100 text-gray-800",S="Cancelado";break;case"returned":E="bg-orange-100 text-orange-800",S="Devuelto";break;default:E="bg-gray-100 text-gray-800",S="Desconocido";break}return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${E}`,children:S})}},{key:"payment",header:"Pago",sortable:!0,render:g=>{let E="",S="";switch(g.paymentStatus){case"pending":E="bg-yellow-100 text-yellow-800",S="Pendiente";break;case"completed":E="bg-green-100 text-green-800",S="Pagado";break;case"rejected":E="bg-red-100 text-red-800",S="Rechazado";break}return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${E}`,children:S})}},{key:"address",header:"DirecciÃ³n",render:g=>e.jsx("div",{className:"truncate max-w-xs",title:ve(g.shippingAddress),children:ve(g.shippingAddress)})},{key:"actions",header:"Acciones",render:g=>e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(q,{to:`/seller/orders/${g.id}`,className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Ver detalles",children:e.jsx(we,{size:18})}),e.jsx("button",{onClick:()=>C(g.id),disabled:!(g.status==="pending"||g.status==="processing")||k,className:`p-1 rounded-md ${g.status==="pending"||g.status==="processing"?"text-green-600 hover:bg-green-100":"text-gray-400 cursor-not-allowed"} disabled:opacity-50`,title:g.status==="pending"||g.status==="processing"?"Gestionar envÃ­o":"No se puede gestionar el envÃ­o en este estado",children:e.jsx(ae,{size:18})}),g.status==="pending"&&e.jsx("button",{onClick:()=>m(g.id,"processing"),disabled:k,className:"p-1 text-orange-600 hover:bg-orange-100 rounded-md disabled:opacity-50",title:"Preparar pedido",children:e.jsx(H,{size:18})})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(ke,{orderId:l||"",orderNumber:r.find(g=>g.id===l)?.orderNumber,isOpen:F,onClose:()=>{h(!1),o(null)},onSubmit:M,isLoading:k}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"GestiÃ³n de Pedidos"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("button",{onClick:L,disabled:s,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50",children:[e.jsx(Ee,{size:18,className:`inline mr-2 ${s?"animate-spin":""}`}),"Actualizar"]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("input",{type:"text",placeholder:"Buscar por nÃºmero de pedido, cliente...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",value:_,onChange:g=>I(g.target.value)}),e.jsx(Se,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-gray-500"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:u,onChange:g=>d(g.target.value),children:[e.jsx("option",{value:"all",children:"Todos los estados"}),e.jsx("option",{value:"pending",children:"Pendientes"}),e.jsx("option",{value:"processing",children:"En Proceso"}),e.jsx("option",{value:"paid",children:"Pagados"}),e.jsx("option",{value:"shipped",children:"Enviados"}),e.jsx("option",{value:"in_transit",children:"En TrÃ¡nsito"}),e.jsx("option",{value:"delivered",children:"Entregados"}),e.jsx("option",{value:"completed",children:"Completados"}),e.jsx("option",{value:"failed",children:"Fallidos"}),e.jsx("option",{value:"returned",children:"Devueltos"}),e.jsx("option",{value:"cancelled",children:"Cancelados"})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:N,onChange:g=>P(g.target.value),children:[e.jsx("option",{value:"all",children:"Todos los pagos"}),e.jsx("option",{value:"pending",children:"Pago Pendiente"}),e.jsx("option",{value:"completed",children:"Pagados"}),e.jsx("option",{value:"rejected",children:"Rechazados"})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:x,onChange:g=>O(g.target.value),children:[e.jsx("option",{value:"all",children:"Todas las fechas"}),e.jsx("option",{value:"today",children:"Hoy"}),e.jsx("option",{value:"week",children:"Esta semana"}),e.jsx("option",{value:"month",children:"Este mes"}),e.jsx("option",{value:"custom",children:"Personalizado"})]}),x==="custom"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:v.from,onChange:g=>R({...v,from:g.target.value})}),e.jsx("span",{className:"text-gray-500",children:"a"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:v.to,onChange:g=>R({...v,to:g.target.value})})]})]}),e.jsx("button",{onClick:()=>{d("all"),P("all"),O("all"),I(""),R({from:"",to:""})},className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Limpiar filtros"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:e.jsx(vt,{items:b})}),e.jsx(et,{data:r,columns:he,searchFields:["orderNumber"],loading:s,emptyMessage:"No se encontraron pedidos",pagination:{currentPage:w.currentPage,totalPages:w.totalPages,totalItems:w.totalItems,itemsPerPage:w.itemsPerPage,onPageChange:Y}})]})},Tt=Object.freeze(Object.defineProperty({__proto__:null,default:St},Symbol.toStringTag,{value:"Module"})),je=({grossEarnings:p,platformCommission:r,netEarnings:t,shippingEarnings:s,totalEarnings:a,commissionRate:u,sellerCount:d=1,showBreakdown:N=!1,className:P=""})=>{const x=_=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(_),O=_=>`${_.toFixed(1)}%`;return N?e.jsxs("div",{className:`bg-gray-50 rounded-lg p-4 space-y-3 ${P}`,children:[e.jsxs("div",{className:"flex items-center gap-2 font-semibold text-gray-800",children:[e.jsx(se,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{children:"Desglose de Ganancias"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal de productos:"}),e.jsx("span",{className:"font-medium",children:x(p)})]}),e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsxs("span",{children:["ComisiÃ³n plataforma (",O(u),"):"]}),e.jsxs("span",{className:"font-medium",children:["-",x(r)]})]}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{className:"text-gray-800",children:"Ganancia neta de productos:"}),e.jsx("span",{className:"text-green-700",children:x(t)})]}),s>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Ganancia por envÃ­o:",d>1&&e.jsxs("span",{className:"text-xs ml-1",children:["(",d," vendedores)"]})]}),e.jsxs("span",{className:"font-medium text-blue-700",children:["+",x(s)]})]}),e.jsx("hr",{className:"border-gray-300"}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{className:"text-gray-800",children:"Total a recibir:"}),e.jsx("span",{className:"text-green-700",children:x(a)})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-300",children:e.jsxs("div",{className:"flex items-start gap-2 text-xs text-gray-500",children:[e.jsx(ze,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{children:"Configuraciones actuales del sistema:"}),e.jsxs("ul",{className:"mt-1 space-y-1",children:[e.jsxs("li",{children:["â€¢ ComisiÃ³n plataforma: ",O(u)]}),d===1&&e.jsx("li",{children:"â€¢ EnvÃ­o un vendedor: 80.0%"}),d>1&&e.jsx("li",{children:"â€¢ EnvÃ­o mÃ¡ximo/vendedor: 50.0%"})]})]})]})})]}):e.jsxs("div",{className:`flex items-center gap-2 ${P}`,children:[e.jsx(ge,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-green-700",children:x(a)}),e.jsxs("div",{className:"text-xs text-gray-500",children:["(ComisiÃ³n: ",O(u),")"]})]})]})},Nt=()=>{const{id:p}=We(),{user:r}=Ae(),[t,s]=c.useState(null),[a,u]=c.useState(!0),[d,N]=c.useState(null),[P,x]=c.useState(!1),[O,_]=c.useState(null),[I,w]=c.useState(!1),[f,b]=c.useState(null),[y,v]=c.useState(!1),R=new Re,k=W.getInstance();c.useEffect(()=>{F()},[p]);const $=c.useCallback(async()=>{if(console.log("ðŸ” loadItemsBreakdown ejecutÃ¡ndose con order:",t?.id,"sellerId:",t?.sellerId,"user.id:",r?.id),!t?.id){console.log("âŒ No se puede cargar breakdown - falta order.id:",{id:t?.id});return}const i=t?.sellerId||r?.id;console.log("ðŸ” effectiveSellerId calculado:",i),console.log("âœ… Iniciando carga de breakdown para orden:",t.id),v(!0);try{const m=await k.getOrderItemsBreakdown(t.id,"seller");b(m)}catch(m){console.error("âŒ ERROR DETALLADO al cargar breakdown para orden",t.id,":",m),console.error("âŒ URL del endpoint usado:",`/seller/orders/${t.id}`),console.error("âŒ Detalles del error:",m instanceof Error?m.message:m)}finally{v(!1)}},[t?.id,t?.sellerId,r?.id,k]);c.useEffect(()=>{console.log("ðŸ” useEffect para loadItemsBreakdown ejecutÃ¡ndose, order cambiÃ³:",t?.id),$()},[$]);const F=async()=>{if(p){u(!0);try{const i=await R.getOrderDetails(p);console.log("ðŸ›ï¸ Detalles de la orden del seller:",i),console.log("ðŸ” VERIFICAR: order.sellerId =",i?.sellerId),console.log("ðŸ” VERIFICAR: order.id =",i?.id),console.log("ðŸ” VERIFICAR: user.id del contexto =",r?.id),s(i)}catch(i){console.error("Error al cargar detalles de la orden:",i),N("No se pudieron cargar los detalles de la orden")}finally{u(!1)}}},h=async i=>{if(!(!t||!p)){x(!0);try{await R.updateOrderStatus(p,i),s({...t,status:i}),_("Estado de la orden actualizado correctamente"),setTimeout(()=>_(null),3e3)}catch(m){console.error("Error al actualizar estado:",m),N("No se pudo actualizar el estado de la orden")}finally{x(!1)}}},l=async i=>{if(!(!t||!p)){x(!0);try{await R.createShipping(p,i),w(!1),await F(),_("InformaciÃ³n de envÃ­o creada correctamente"),setTimeout(()=>_(null),3e3)}catch(m){console.error("Error al crear envÃ­o:",m),N("No se pudo crear la informaciÃ³n de envÃ­o")}finally{x(!1)}}};if(a)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Cargando detalles de la orden..."})]})});if(d||!t)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-4",children:d||"Orden no encontrada"}),e.jsx(q,{to:"/seller/orders",className:"text-primary-600 hover:text-primary-800 font-medium",children:"â† Volver a pedidos"})]})});const n=(()=>{if(!t.orderSummary||!t.items)return{totalQuantity:0,subtotalOriginal:0,subtotalFinal:0,platformCommission:0,shippingIncome:0,totalToReceive:0,sellerEarningsFromProducts:0};const i=t.orderSummary.total_quantity||0,m=t.orderSummary.total_seller_earnings_from_products||0,C=t.orderSummary.total_platform_commission||0,M=t.orderSummary.shipping_distribution?.seller_amount||0,Y=m+C,L=m+M;return{totalQuantity:i,subtotalVendido:Y,platformCommission:C,shippingIncome:M,totalToReceive:L,sellerEarningsFromProducts:m}})();return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(q,{to:"/seller/orders",className:"flex items-center text-gray-600 hover:text-gray-800 mr-4",children:[e.jsx(Me,{className:"w-5 h-5 mr-1"}),"Volver a pedidos"]}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Pedido #",t.orderNumber]})]}),e.jsxs("div",{className:"flex space-x-3",children:[be(t.status,"shipped")&&e.jsxs("button",{onClick:()=>w(!0),disabled:P,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium disabled:opacity-50",children:[e.jsx(ae,{className:"w-4 h-4 mr-2 inline"}),"Marcar como enviado"]}),be(t.status,"cancelled")&&e.jsxs("button",{onClick:()=>h("cancelled"),disabled:P,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium disabled:opacity-50",children:[e.jsx(ue,{className:"w-4 h-4 mr-2 inline"}),"Cancelar pedido"]})]})]})})}),O&&e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-md",children:[e.jsx(Be,{className:"w-5 h-5 inline mr-2"}),O]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Estado del pedido"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"Estado:"}),e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${t.status==="completed"?"bg-green-100 text-green-800":t.status==="shipped"?"bg-blue-100 text-blue-800":t.status==="processing"?"bg-yellow-100 text-yellow-800":t.status==="cancelled"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:t.status==="pending"?"Pendiente":t.status==="processing"?"En proceso":t.status==="shipped"?"Enviado":t.status==="delivered"?"Entregado":t.status==="cancelled"?"Cancelado":t.status==="completed"?"Completado":t.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"Pago:"}),e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${t.paymentStatus==="completed"?"bg-green-100 text-green-800":t.paymentStatus==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:t.paymentStatus==="completed"?"Completado":t.paymentStatus==="pending"?"Pendiente":t.paymentStatus})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"MÃ©todo de pago:"}),e.jsx("p",{className:"text-gray-900",children:t.paymentMethod||"No especificado"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"Fecha:"}),e.jsx("p",{className:"text-gray-900",children:pe(t.createdAt)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Cliente"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"Nombre:"}),e.jsx("p",{className:"text-gray-900",children:t.customerName||"No especificado"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"Email:"}),e.jsx("p",{className:"text-gray-900",children:t.customerEmail||"No especificado"})]}),t.shippingAddress&&e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"DirecciÃ³n de envÃ­o:"}),e.jsxs("p",{className:"text-gray-900",children:[t.shippingAddress.address,e.jsx("br",{}),t.shippingAddress.city,", ",t.shippingAddress.state,e.jsx("br",{}),t.shippingAddress.country]})]})]})]}),t.shippingData&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"InformaciÃ³n de envÃ­o"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"NÃºmero de seguimiento:"}),e.jsx("p",{className:"text-primary-600 font-medium",children:t.shippingData.tracking_number})]}),t.shippingData.shipping_company&&e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"Empresa de transporte:"}),e.jsx("p",{className:"text-gray-900",children:t.shippingData.shipping_company})]}),t.shippingData.estimated_delivery&&e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"Entrega estimada:"}),e.jsx("p",{className:"text-gray-900",children:pe(t.shippingData.estimated_delivery)})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(H,{className:"w-5 h-5 text-gray-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Productos de tu Tienda"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",n.totalQuantity," ",n.totalQuantity===1?"producto":"productos",")"]})]}),e.jsx("div",{className:"space-y-4",children:t.items&&t.items.length>0?t.items.map((i,m)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:i.product_image?e.jsx("img",{src:i.product_image,alt:i.product_name,className:"w-16 h-16 object-cover rounded-lg border border-gray-200"}):e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx(H,{className:"w-8 h-8 text-gray-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:i.product_name||"Producto"}),y?e.jsx("div",{className:"mt-3 bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Calculando ganancias..."})]})}):e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Cantidad a enviar:"}),e.jsx("span",{className:"text-xl font-bold text-primary-600",children:i.quantity||0})]})}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ganancia por este producto:"}),e.jsx("span",{className:"text-xl font-bold text-green-600",children:f?(()=>{const C=f.items.find(M=>M.product_id===i.productId);if(C){if(C.seller_net_earning_per_unit&&C.seller_net_earning_per_unit>0)return`$${(C.seller_net_earning_per_unit*i.quantity).toFixed(2)}`;if(f.summary?.seller_commission_info){const M=f.summary.seller_commission_info.platform_commission_rate/100;return`$${(C.final_price_per_unit*(1-M)*i.quantity).toFixed(2)}`}}return"$0.00"})():"$0.00"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["(",i.quantity," x $",f?(()=>{const C=f.items.find(M=>M.product_id===i.productId);if(C){if(C.seller_net_earning_per_unit&&C.seller_net_earning_per_unit>0)return C.seller_net_earning_per_unit.toFixed(2);if(f.summary?.seller_commission_info){const M=f.summary.seller_commission_info.platform_commission_rate/100;return(C.final_price_per_unit*(1-M)).toFixed(2)}}return"0.00"})():"0.00"," c/u)"]})]})]})]})]})},i.id||m)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay productos en esta orden"})}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"InformaciÃ³n del Vendedor:"})," Los precios mostrados son los finales que se usaron para calcular tu comisiÃ³n. Los descuentos ya estÃ¡n aplicados."]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(Ve,{className:"w-5 h-5 text-gray-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Resumen de Venta"})]}),y?e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Calculando resumen..."})]})}):f&&f.summary?.seller_commission_info?e.jsx(je,{grossEarnings:f.summary.total_final_amount,platformCommission:f.summary.seller_commission_info.total_commission,netEarnings:f.summary.seller_commission_info.seller_earnings_from_products,shippingEarnings:f.summary.seller_commission_info.shipping_distribution?.seller_amount||0,totalEarnings:f.summary.seller_commission_info.seller_earnings_from_products+(f.summary.seller_commission_info.shipping_distribution?.seller_amount||0),commissionRate:f.summary.seller_commission_info.platform_commission_rate,sellerCount:1,showBreakdown:!0,className:"mb-4"}):e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Nota:"})," No se pudieron cargar los cÃ¡lculos centralizados. Usando datos del backend como respaldo."]}),e.jsx(je,{grossEarnings:n.subtotalVendido||0,platformCommission:n.platformCommission||0,netEarnings:n.sellerEarningsFromProducts||0,shippingEarnings:n.shippingIncome||0,totalEarnings:n.totalToReceive||0,commissionRate:(n.platformCommission??0)>0&&(n.subtotalVendido??0)>0?(n.platformCommission??0)/(n.subtotalVendido??1)*100:10,sellerCount:1,showBreakdown:!0,className:"mt-2"})]}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Nota:"})," Los cupones de descuento NO afectan al seller (son asumidos por la tienda). Solo se aplican descuentos de seller y por volumen. El envÃ­o se reparte entre sellers."]})})]})]})]})}),e.jsx(ke,{orderId:p||"",orderNumber:t.orderNumber,isOpen:I,onClose:()=>w(!1),onSubmit:l,isLoading:P})]})},$t=Object.freeze(Object.defineProperty({__proto__:null,default:Nt},Symbol.toStringTag,{value:"Module"}));class re{static async getEarnings(r){try{const t=new URLSearchParams;r?.start_date&&t.append("start_date",r.start_date),r?.end_date&&t.append("end_date",r.end_date);const s=D.SELLER.EARNINGS.BASE,a=await A.get(s,Object.fromEntries(t));if(!a.success)throw new Error(a.message||"Error al obtener earnings");return a.data}catch(t){throw console.error("Error fetching seller earnings:",t),new Error(t.message||"Error al obtener las ganancias del seller")}}static async getMonthlyBreakdown(r){try{const t=D.SELLER.EARNINGS.MONTHLY,s=[];r?.start_date&&s.push(["start_date",r.start_date]),r?.end_date&&s.push(["end_date",r.end_date]);const a=await A.get(t,Object.fromEntries(s));if(!a.success)throw new Error(a.message||"Error al obtener desglose mensual");return a.data}catch(t){throw console.error("Error fetching monthly earnings breakdown:",t),new Error(t.message||"Error al obtener el desglose mensual")}}static validateDateRange(r,t){if(!r||!t)return!1;const s=new Date(r),a=new Date(t);return s<=a}static getDefaultDateRange(){const r=new Date,t=new Date;return t.setMonth(t.getMonth()-1),{start_date:t.toISOString().split("T")[0],end_date:r.toISOString().split("T")[0]}}static formatForCharts(r){return{monthlySales:r.map(t=>({month:t.month_short,sales:t.sales,commissions:t.commissions,net:t.net})),totals:{total_sales:r.reduce((t,s)=>t+s.sales,0),total_commissions:r.reduce((t,s)=>t+s.commissions,0),total_net:r.reduce((t,s)=>t+s.net,0),total_orders:r.reduce((t,s)=>t+s.orders_count,0)}}}static calculateGrowth(r,t){return t===0?r>0?100:0:(r-t)/t*100}static async exportPdf(r){try{const t=D.SELLER.EARNINGS.EXPORT_PDF,s=await A.post(t,r||{});if(!s.success)throw new Error(s.message||"Error al exportar reporte PDF");return s.data}catch(t){throw console.error("Error exporting earnings PDF:",t),new Error(t.message||"Error al exportar el reporte en PDF")}}static async downloadPdf(r){try{const t=D.SELLER.EARNINGS.DOWNLOAD_PDF;return(await ne.get(t,{params:{file_path:r},responseType:"blob"})).data}catch(t){throw console.error("Error downloading PDF:",t),new Error(t.message||"Error al descargar el archivo PDF")}}}const wt=()=>{const[p,r]=c.useState(!0),[t,s]=c.useState({start:"",end:""}),[a,u]=c.useState(null),[d,N]=c.useState([]),[P,x]=c.useState(""),[O,_]=c.useState(!1);c.useEffect(()=>{I()},[]);const I=async()=>{r(!0),x("");try{const y=await re.getEarnings(t.start?{start_date:t.start,end_date:t.end}:void 0),v=await re.getMonthlyBreakdown(t.start?{start_date:t.start,end_date:t.end}:void 0);u(y),N(v)}catch(y){console.error("Error loading earnings data:",y),x(y.message||"Error al cargar los datos de ganancias")}finally{r(!1)}},w=async()=>{_(!0);try{const y=await re.exportPdf(t.start&&t.end?{start_date:t.start,end_date:t.end}:void 0),v=await re.downloadPdf(y.file_path),R=document.createElement("a");R.href=URL.createObjectURL(v),R.download=y.filename,document.body.appendChild(R),R.click(),document.body.removeChild(R),URL.revokeObjectURL(R.href)}catch(y){console.error("Error exporting PDF:",y),x(y.message||"Error al exportar el reporte PDF")}finally{_(!1)}},f=y=>{if(!y||y.length===0)return null;const v=y,R=Math.max(...v.map(k=>Math.max(k.sales,k.commissions,k.net)));return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Ventas Mensuales"}),e.jsxs("div",{className:"mt-2 sm:mt-0 sm:ml-4 flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ventas"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Comisiones"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ganancias netas"})]})]})]}),e.jsx("div",{className:"h-64 w-full",children:e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:"w-12 h-full flex flex-col justify-between text-xs text-gray-500 pr-2",children:[e.jsx("span",{children:T(R)}),e.jsx("span",{children:T(R*.75)}),e.jsx("span",{children:T(R*.5)}),e.jsx("span",{children:T(R*.25)}),e.jsx("span",{children:T(0)})]}),e.jsxs("div",{className:"flex-1 h-full",children:[e.jsxs("div",{className:"h-full flex flex-col justify-between relative",children:[e.jsx("div",{className:"border-t border-gray-200absolute top-0 w-full"}),e.jsx("div",{className:"border-t border-gray-200absolute top-1/4 w-full"}),e.jsx("div",{className:"border-t border-gray-200absolute top-2/4 w-full"}),e.jsx("div",{className:"border-t border-gray-200absolute top-3/4 w-full"}),e.jsx("div",{className:"border-t border-gray-200absolute bottom-0 w-full"}),e.jsx("div",{className:"absolute inset-0 flex items-end",children:v.map((k,$)=>{const F=R>0?k.sales/R*100:0,h=R>0?k.commissions/R*100:0,l=R>0?k.net/R*100:0;return e.jsx("div",{className:"flex-1 flex justify-center h-full px-1",children:e.jsxs("div",{className:"w-full max-w-[30px] flex justify-between items-end h-full",children:[e.jsx("div",{className:"w-2 bg-blue-500 rounded-t relative group cursor-pointer",style:{height:`${F}%`,minHeight:F>0?"4px":"0"},children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap z-10",children:["Ventas: ",T(k.sales)]})}),e.jsx("div",{className:"w-2 bg-red-500 rounded-t relative group cursor-pointer",style:{height:`${h}%`,minHeight:h>0?"4px":"0"},children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap z-10",children:["Comisiones: ",T(k.commissions)]})}),e.jsx("div",{className:"w-2 bg-green-500 rounded-t relative group cursor-pointer",style:{height:`${l}%`,minHeight:l>0?"4px":"0"},children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap z-10",children:["Neto: ",T(k.net)]})})]})},$)})})]}),e.jsx("div",{className:"flex mt-2",children:v.map((k,$)=>e.jsx("div",{className:"flex-1 text-center",children:e.jsx("div",{className:"text-xs text-gray-500",children:k.month_short})},$))})]})]})})]})},b=a?[{title:"Total Ganancias",value:T(a.total_earnings),change:0,icon:se,iconBgColor:"bg-green-50",iconColor:"text-green-600"},{title:"Ventas este perÃ­odo",value:T(a.sales_this_period),change:a.sales_growth,text:`${Math.abs(a.sales_growth)}% respecto al perÃ­odo anterior`,icon:ge,iconBgColor:"bg-blue-50",iconColor:"text-blue-600"},{title:"Comisiones este perÃ­odo",value:T(a.commissions_this_period),change:0,text:`${a.commissions_percentage}% de comisiÃ³n`,icon:He,iconBgColor:"bg-red-50",iconColor:"text-red-600"},{title:"Ganancias netas este perÃ­odo",value:T(a.net_earnings_this_period),change:a.earnings_growth,text:`${Math.abs(a.earnings_growth)}% respecto al perÃ­odo anterior`,icon:Ge,iconBgColor:"bg-indigo-50",iconColor:"text-indigo-600"}]:[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(se,{className:"w-6 h-6 mr-2"}),"Ganancias"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:I,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center",disabled:p,children:[e.jsx(Ee,{size:18,className:`mr-2 ${p?"animate-spin":""}`}),p?"Cargando...":"Actualizar"]}),e.jsxs("button",{onClick:w,disabled:O||p,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Ke,{size:18,className:`mr-2 ${O?"animate-spin":""}`}),O?"Exportando...":"Exportar PDF"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[e.jsx("div",{className:"text-sm text-gray-700 font-medium",children:"Rango de fechas:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(qe,{className:"h-5 w-5 text-gray-500"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:t.start,onChange:y=>s(v=>({...v,start:y.target.value}))}),e.jsx("span",{className:"text-gray-500",children:"a"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:t.end,onChange:y=>s(v=>({...v,end:y.target.value}))})]}),e.jsx("button",{className:"px-3 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center",onClick:I,disabled:p,children:p?"Aplicando...":"Aplicar"})]})}),P&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsx("div",{className:"flex",children:e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error al cargar datos"}),e.jsx("div",{className:"mt-2 text-sm text-red-700",children:P}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:I,className:"px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:"Reintentar"})})]})})}),p?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})}):a&&!P?e.jsxs(e.Fragment,{children:[e.jsx(Ie,{cards:b}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 flex items-center",children:[e.jsx(me,{size:20,className:"mr-2"}),"Ventas por PerÃ­odo"]}),e.jsx("div",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:t.start&&t.end?"PerÃ­odo personalizado":"Ãšltimos 12 meses"})]}),f(d)]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Desglose de Ventas Mensuales"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Mes"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ventas"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Comisiones"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Neto"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ã“rdenes"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map((y,v)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:y.month}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:T(y.sales)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600",children:T(y.commissions)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600",children:T(y.net)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:y.orders_count})]},v))}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:"Total"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:T(d.reduce((y,v)=>y+v.sales,0))}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-red-600",children:T(d.reduce((y,v)=>y+v.commissions,0))}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600",children:T(d.reduce((y,v)=>y+v.net,0))}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:d.reduce((y,v)=>y+v.orders_count,0)})]})})]})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500",children:"No se pudieron cargar los datos de ganancias."}),e.jsx("button",{onClick:I,className:"mt-4 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Reintentar"})]})]})},Ut=Object.freeze(Object.defineProperty({__proto__:null,default:wt},Symbol.toStringTag,{value:"Module"}));export{De as A,rt as L,W as O,ct as P,dt as R,ke as S,At as a,mt as b,bt as c,vt as d,Dt as e,pe as f,Ot as g,kt as h,Rt as i,Tt as j,$t as k,Ut as l,Ae as u};
//# sourceMappingURL=seller-chunk-CL4v7LiS.js.map
