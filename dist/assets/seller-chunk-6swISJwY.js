import{j as e,d as ce,D as te,e as q,P as H,Y as ge,_ as he,S as je,F as Ne,f as ke,w as Oe,E as Se,s as Te,k as $e,H as re,X as de,r as Ue,$ as ue,R as we,K as Me,a0 as Fe,a1 as Le,a2 as ze,a3 as xe,a4 as Be,a5 as Ve,I as Ge,a6 as He,a7 as Ke}from"./ui-vendor-BUNMIuFe.js";import{b as Je,r as d,L as J,u as Ee,a as qe,d as Ye}from"./react-vendor-Cy458wKG.js";import{C as j,a as pe,A as I,b as F,c as D,u as We,D as Ce,f as k,d as Pe,P as Qe,T as Xe}from"./admin-chunk-BNcFjXlJ.js";import{r as Ze}from"./utils-vendor-DeGC_a19.js";class es{setItem(t,s){try{const a=typeof s=="object"?JSON.stringify(s):s;localStorage.setItem(t,a)}catch(a){console.error("Error al guardar en localStorage:",a)}}getItem(t){try{const s=localStorage.getItem(t);if(s===null)return null;try{return JSON.parse(s)}catch{return s}}catch(s){return console.error("Error al recuperar de localStorage:",s),null}}removeItem(t){try{localStorage.removeItem(t)}catch(s){console.error("Error al eliminar de localStorage:",s)}}clear(){try{localStorage.clear()}catch(t){console.error("Error al limpiar localStorage:",t)}}hasKey(t){try{return localStorage.getItem(t)!==null}catch(s){return console.error("Error al verificar clave en localStorage:",s),!1}}}const le="user_role_data",ss=10*60*1e3;let G=null,Z=0;class ae{static async checkUserRole(t=!1){try{const s=Date.now();if(!t&&G&&s-Z<3e4)return console.log("Usando datos de rol desde memoria:",G),G;if(!t){const o=j.getItem(le);if(o)return G=o,Z=s,console.log("Usando datos de rol desde localStorage:",G),G}console.log("Verificando rol del usuario desde API...");const a=await pe.get(I.AUTH.CHECK_ROLE);return console.log("Respuesta del endpoint check-role:",a.data),a&&a.data&&a.data.success?(j.setItem(le,a.data,ss),G=a.data,Z=s,console.log("Datos de rol actualizados desde API:",G),G):(console.error("Respuesta invÃ¡lida del endpoint check-role:",a.data),null)}catch(s){return console.error("Error al verificar rol de usuario:",s),null}}static async isAdmin(){const t=await this.checkUserRole(),s=t?.data?.is_admin||!1;return console.log("Verificando si es admin:",s,t),s}static async isSeller(){const t=await this.checkUserRole(),s=t?.data?.is_seller||!1;return console.log("Verificando si es seller:",s,t),s}static async getUserRole(){const t=await this.checkUserRole(),s=t?.data?.role||null;return console.log("Obteniendo rol del usuario:",s,t),s}static clearRoleCache(){j.removeItem(le),G=null,Z=0,console.log("CachÃ© de roles limpiada")}static async getSellerInfo(){return(await this.checkUserRole())?.data?.seller_info||null}static async getAdminInfo(){return(await this.checkUserRole())?.data?.admin_info||null}}const Cs=Object.freeze(Object.defineProperty({__proto__:null,RoleService:ae,default:ae},Symbol.toStringTag,{value:"Module"}));var ts=Ze();const W=Je(ts),rs={};var fe={};const as=()=>typeof import.meta<"u"&&rs?"nTIonshRityLkSomPLIgMayOUsEmPLeW":typeof process<"u"&&fe&&fe.REACT_APP_CACHE_KEY||"nTIonshRityLkSomPLIgMayOUsEmPLeW",ye=as(),os="role-integrity-2024";class ee{static sessionId=this.generateSessionId();static STORAGE_CACHE_TIME=5*60*1e3;static CRITICAL_REVALIDATION_TIME=2*60*1e3;static generateSessionId(){return W.lib.WordArray.random(16).toString()}static encrypt(t){const s=JSON.stringify(t);return W.AES.encrypt(s,ye).toString()}static decrypt(t){try{const a=W.AES.decrypt(t,ye).toString(W.enc.Utf8);return JSON.parse(a)}catch{return null}}static generateIntegrityHash(t){const s=`${t.role}-${t.isAdmin}-${t.isSeller}-${t.timestamp}-${t.sessionId}`;return W.HmacSHA256(s,os).toString()}static validateIntegrity(t,s){return this.generateIntegrityHash(t)===s}static setSecureRoleData(t){const s={...t,timestamp:Date.now(),sessionId:this.sessionId},a=this.encrypt(s),o=this.generateIntegrityHash(s),c={encrypted:a,hash:o,timestamp:s.timestamp};try{localStorage.setItem("secure_role_cache",JSON.stringify(c))}catch(u){console.warn("No se pudo guardar cache de roles:",u)}}static getSecureRoleData(){try{const t=localStorage.getItem("secure_role_cache");if(!t)return null;const s=JSON.parse(t);if(Date.now()-s.timestamp>this.STORAGE_CACHE_TIME)return this.clearSecureCache(),null;const o=this.decrypt(s.encrypted);return o?this.validateIntegrity(o,s.hash)?o.sessionId!==this.sessionId?(console.log("Cache de sesiÃ³n anterior, invalidando"),this.clearSecureCache(),null):o:(console.warn("Integridad de cache de roles comprometida"),this.clearSecureCache(),null):(this.clearSecureCache(),null)}catch(t){return console.warn("Error al leer cache seguro:",t),this.clearSecureCache(),null}}static clearSecureCache(){localStorage.removeItem("secure_role_cache")}static needsCriticalRevalidation(){const t=this.getSecureRoleData();return t?Date.now()-t.timestamp>this.CRITICAL_REVALIDATION_TIME:!0}}const ns=I?.AUTH?.CHECK_ROLE;class K{static memoryCache=new Map;static MEMORY_CACHE_TIME=3e4;static getFromMemory(t){const s=this.memoryCache.get(t);return s?Date.now()-s.timestamp>this.MEMORY_CACHE_TIME?(this.memoryCache.delete(t),null):s.data:null}static setInMemory(t,s){if(this.memoryCache.set(t,{data:s,timestamp:Date.now()}),this.memoryCache.size>10){const a=this.memoryCache.keys().next().value;a!==void 0&&this.memoryCache.delete(a)}}static async checkUserRole(t=!1,s=!1){const a="user_role_check";try{if(!t&&!s){const c=this.getFromMemory(a);if(c)return console.log("ðŸ§  Usando rol desde memoria"),c}if(!t)if(s&&ee.needsCriticalRevalidation())console.log("ðŸ”’ OperaciÃ³n crÃ­tica requiere revalidaciÃ³n");else{const c=ee.getSecureRoleData();if(c){console.log("ðŸ” Usando rol desde cache seguro");const u={success:!0,status:200,data:{user_id:0,role:c.role,is_admin:c.isAdmin,is_seller:c.isSeller,seller_info:c.sellerInfo,admin_info:c.adminInfo}};return this.setInMemory(a,u),u}}console.log("ðŸŒ Consultando rol desde API");const o=await pe.get(ns);if(o?.data?.success){const c=o.data;return ee.setSecureRoleData({role:c.data.role,isAdmin:c.data.is_admin,isSeller:c.data.is_seller,sellerInfo:c.data.seller_info,adminInfo:c.data.admin_info}),this.setInMemory(a,c),c}return null}catch(o){return console.error("Error verificando rol:",o),null}}static async isAdmin(){return(await this.checkUserRole(!1,!1))?.data?.is_admin||!1}static async isSeller(){return(await this.checkUserRole(!1,!1))?.data?.is_seller||!1}static async isAdminCritical(){return(await this.checkUserRole(!1,!0))?.data?.is_admin||!1}static async isSellerCritical(){return(await this.checkUserRole(!1,!0))?.data?.is_seller||!1}static clearAllCache(){this.memoryCache.clear(),ee.clearSecureCache(),console.log("ðŸ—‘ï¸ Cache de roles limpiada completamente")}}const V=new es,B={ROLE_INFO:"auth_role_info",USER_DATA:"auth_user_data"},se={ROLE_INFO:5*60*1e3,USER_DATA:10*60*1e3},Ie=d.createContext({user:null,setUser:()=>{},isAuthenticated:!1,setIsAuthenticated:()=>{},logout:async()=>{},roleInfo:{role:null,isAdmin:!1,isSeller:!1,sellerInfo:null,adminInfo:null},isLoadingRole:!1,refreshRoleInfo:async()=>{},isInitialized:!1,getDefaultRouteForRole:()=>"/",isAdmin:async()=>!1,isSeller:async()=>!1}),Ps=({children:m})=>{const[t,s]=d.useState(null),[a,o]=d.useState(!1),[c,u]=d.useState(!1),[S,P]=d.useState(!1),[y,R]=d.useState({role:null,isAdmin:!1,isSeller:!1,sellerInfo:null,adminInfo:null}),v=d.useRef(!1),A=d.useRef(!1),g=d.useRef(null),h=d.useRef(!1);d.useEffect(()=>{A.current=a},[a]),d.useEffect(()=>{g.current=t},[t]);const f=d.useCallback(()=>y.isAdmin?"/admin/dashboard":y.isSeller?"/seller/dashboard":"/",[y]),_=d.useCallback(r=>{if(t){const l={...t,...r};s(l),typeof window<"u"&&localStorage.setItem("user",JSON.stringify(l))}},[t]),N=d.useCallback(()=>{const r=window.location.pathname;if(!(["/login","/register"].includes(r)||r.startsWith("/auth"))){console.log("No estamos en pÃ¡gina de auth, no redireccionar automÃ¡ticamente");return}if(a&&y.role&&h.current){const i=f();console.log(`ðŸ”„ RedirecciÃ³n automÃ¡tica desde ${r} a ${i}`),setTimeout(()=>{window.location.replace(i)},100)}},[a,y,f]),O=d.useCallback(async()=>{if(!(!A.current||S||v.current)){P(!0);try{if(console.log("Obteniendo informaciÃ³n de rol del usuario..."),!h.current){const l=j.getItem(B.ROLE_INFO);if(l){console.log("ðŸ” Usando roleInfo desde cache (no-inicializaciÃ³n)"),R(l),v.current=!0;return}}let r=null;try{r=await K.checkUserRole(!0,!1),console.log("âœ… Usando OptimizedRoleService en fetchRoleInfo")}catch(l){console.log("âš ï¸ OptimizedRoleService no disponible, usando RoleService:",l),r=await ae.checkUserRole(!0)}if(r&&r.success){const l={role:r.data.role,isAdmin:r.data.is_admin,isSeller:r.data.is_seller,sellerInfo:r.data.seller_info||null,adminInfo:r.data.admin_info||null};console.log("InformaciÃ³n de rol obtenida:",l),R(l),j.setItem(B.ROLE_INFO,l,se.ROLE_INFO),g.current&&!g.current.role&&s(i=>i?{...i,role:r.data.role}:null),v.current=!0,h.current&&setTimeout(()=>{N()},300)}}catch(r){console.error("Error al obtener informaciÃ³n de rol:",r)}finally{P(!1)}}},[S,N]),$=d.useCallback(async()=>{j.removeItem(B.ROLE_INFO),v.current=!1,P(!0);try{console.log("Refrescando informaciÃ³n de rol del usuario...");let r=null;try{r=await K.checkUserRole(!0,!1),console.log("âœ… Usando OptimizedRoleService en refreshRoleInfo")}catch(l){console.log("âš ï¸ OptimizedRoleService no disponible, usando RoleService:",l),r=await ae.checkUserRole(!0)}if(r&&r.success){const l={role:r.data.role,isAdmin:r.data.is_admin,isSeller:r.data.is_seller,sellerInfo:r.data.seller_info||null,adminInfo:r.data.admin_info||null};console.log("InformaciÃ³n de rol refrescada:",l),R(l),j.setItem(B.ROLE_INFO,l,se.ROLE_INFO),g.current&&!g.current.role&&s(i=>i?{...i,role:r.data.role}:null),v.current=!0}}catch(r){console.error("Error al refrescar informaciÃ³n de rol:",r)}finally{P(!1)}},[]),T=d.useCallback(async(r=!1)=>{try{return r?await K.isAdminCritical():await K.isAdmin()}catch(l){return console.warn("âš ï¸ OptimizedRoleService fallÃ³, usando roleInfo:",l),y.isAdmin}},[y.isAdmin]),L=d.useCallback(async(r=!1)=>{try{return r?await K.isSellerCritical():await K.isSeller()}catch(l){return console.warn("âš ï¸ OptimizedRoleService fallÃ³, usando roleInfo:",l),y.isSeller}},[y.isSeller]);d.useEffect(()=>{if(h.current)return;(async()=>{try{if(V.getItem(F.storage.authTokenKey)){console.log("ðŸ”‘ Token encontrado, inicializando autenticaciÃ³n..."),o(!0),A.current=!0;let i=j.getItem(B.USER_DATA);i||(i=V.getItem(F.storage.userKey),i&&j.setItem(B.USER_DATA,i,se.USER_DATA)),i&&(s(i),g.current=i,console.log("ðŸ‘¤ Datos de usuario cargados (cache/localStorage)")),await O()}else console.log("âŒ No hay token, usuario no autenticado"),o(!1),s(null),j.removeItem(B.ROLE_INFO),j.removeItem(B.USER_DATA),K.clearAllCache()}catch(l){console.error("âŒ Error durante la inicializaciÃ³n:",l),o(!1),s(null)}finally{u(!0),h.current=!0}})()},[O]),d.useEffect(()=>{if(c)if(t){const r=V.getItem(F.storage.userKey),l=JSON.stringify(t),i=r?JSON.stringify(r):"";l!==i&&(V.setItem(F.storage.userKey,t),j.setItem(B.USER_DATA,t,se.USER_DATA))}else c&&(V.removeItem(F.storage.userKey),j.removeItem(B.USER_DATA))},[t,c]);const b=d.useCallback(async()=>{try{if(A.current)try{await pe.post(I.AUTH.LOGOUT)}catch(U){console.error("âŒ Error al hacer logout en el servidor:",U)}V.removeItem(F.storage.authTokenKey),V.removeItem(F.storage.userKey),V.removeItem(F.storage.refreshTokenKey),V.removeItem(F.storage.cartKey),j.removeItem(B.ROLE_INFO),j.removeItem(B.USER_DATA),K.clearAllCache(),console.log("ðŸ§¹ Limpiando datos especÃ­ficos de sesiÃ³n...");const r=["user_theme"],l=["bcommerce_shipping_config","bcommerce_volume_discount_config"],i=["user_data","cache_user_role_data"],p=[/^eyJ/,/^cache_header_counters/,/^cache_products_/];i.forEach(U=>localStorage.removeItem(U)),Object.keys(localStorage).forEach(U=>{p.some(oe=>oe.test(U))&&!r.includes(U)&&localStorage.removeItem(U)}),Object.keys(sessionStorage).forEach(U=>{!l.includes(U)&&!U.includes("_executed")&&!U.includes("autoprefetch")&&sessionStorage.removeItem(U)}),console.log("âœ… Limpieza inteligente completada - Preservadas configs tÃ©cnicas"),v.current=!1,A.current=!1,g.current=null,o(!1),s(null),R({role:null,isAdmin:!1,isSeller:!1,sellerInfo:null,adminInfo:null}),console.log("âœ… Logout completado exitosamente")}catch(r){console.error("âŒ Error durante el proceso de logout:",r),V.removeItem(F.storage.authTokenKey),V.removeItem(F.storage.userKey),j.removeItem(B.ROLE_INFO),j.removeItem(B.USER_DATA),o(!1),s(null)}},[]),n=d.useMemo(()=>({user:t,setUser:s,isAuthenticated:a,setIsAuthenticated:o,logout:b,roleInfo:y,isLoadingRole:S,refreshRoleInfo:$,isInitialized:c,getDefaultRouteForRole:f,isAdmin:T,isSeller:L,updateUser:_}),[t,a,b,y,S,$,c,f,T,L]);return e.jsx(Ie.Provider,{value:n,children:m})},Ae=()=>{const m=d.useContext(Ie);if(!m)throw new Error("useAuth debe usarse dentro de un AuthProvider");return m};class ls{async getProducts(t){try{return await D.get(I.PRODUCTS.LIST,t)}catch(s){return console.error("âŒ Error en ProductService.getProducts:",s),null}}async deleteProduct(t){try{return(await D.delete(I.PRODUCTS.DELETE(t)))?.success===!0}catch(s){return console.error(`Error al eliminar producto ${t}:`,s),!1}}async createProduct(t){try{console.log("ðŸ“¤ ProductService: Creando producto:",t);const s=new FormData;if(s.append("name",t.name),s.append("description",t.description),s.append("price",String(t.price)),s.append("stock",String(t.stock)),s.append("category_id",String(t.category_id)),t.shortDescription&&s.append("short_description",t.shortDescription),t.weight!==void 0&&s.append("weight",String(t.weight)),t.width!==void 0&&s.append("width",String(t.width)),t.height!==void 0&&s.append("height",String(t.height)),t.depth!==void 0&&s.append("depth",String(t.depth)),t.dimensions&&s.append("dimensions",t.dimensions),t.sku&&s.append("sku",t.sku),t.status&&s.append("status",t.status),t.featured!==void 0&&s.append("featured",String(t.featured)),t.published!==void 0&&s.append("published",String(t.published)),t.discount_percentage!==void 0&&s.append("discount_percentage",String(t.discount_percentage)),t.colors){const o=typeof t.colors=="string"?t.colors:JSON.stringify(t.colors);s.append("colors",o)}if(t.sizes){const o=typeof t.sizes=="string"?t.sizes:JSON.stringify(t.sizes);s.append("sizes",o)}if(t.tags){const o=typeof t.tags=="string"?t.tags:JSON.stringify(t.tags);s.append("tags",o)}t.attributes&&Object.keys(t.attributes).length>0&&s.append("attributes",JSON.stringify(t.attributes)),t.images&&t.images.length>0&&t.images.forEach((o,c)=>{s.append(`images[${c}]`,o)});const a=await D.uploadFile(I.PRODUCTS.CREATE,s);return console.log("âœ… ProductService: Producto creado:",a),a}catch(s){throw console.error("âŒ Error en ProductService.createProduct:",s),s}}async getProductById(t){try{return(await D.get(I.PRODUCTS.DETAILS(t)))?.data||null}catch(s){return console.error("âŒ Error en ProductService.getProductById:",s),null}}async getProductBySlug(t){try{return(await D.get(I.PRODUCTS.DETAILS_BY_SLUG(t)))?.data||null}catch(s){return console.error("âŒ Error en ProductService.getProductBySlug:",s),null}}async getFeaturedProducts(t=8){try{return(await D.get(I.PRODUCTS.FEATURED,{limit:t}))?.data||[]}catch(s){return console.error("âŒ Error en ProductService.getFeaturedProducts:",s),[]}}async getRelatedProducts(t,s=4){try{return(await D.get(I.PRODUCTS.LIST,{limit:s,excludeId:t}))?.data||[]}catch(a){return console.error("âŒ Error en ProductService.getRelatedProducts:",a),[]}}async searchProducts(t,s){try{return await D.get(I.PRODUCTS.SEARCH(t),s)}catch(a){return console.error("âŒ Error en ProductService.searchProducts:",a),null}}async trackProductView(t){try{await D.post(I.PRODUCTS.INCREMENT_VIEW(t),{timestamp:new Date().toISOString()})}catch(s){console.error("âŒ Error en ProductService.trackProductView:",s)}}async getProductsByCategory(t,s=12,a=0){try{return await D.get(I.PRODUCTS.BY_CATEGORY(t),{limit:s,offset:a})}catch(o){return console.error("âŒ Error en ProductService.getProductsByCategory:",o),null}}static async getFeaturedRandom(t=6){try{return await D.get(I.PRODUCTS.FEATURED_RANDOM,{limit:t})||{data:[],meta:{total:0,count:0}}}catch(s){return console.error("âŒ Error en ProductService.getFeaturedRandom:",s),{data:[],meta:{total:0,count:0,limit:0,offset:0}}}}static async getTrendingAndOffers(t=12){try{return await D.get(I.PRODUCTS.TRENDING_OFFERS,{limit:t})||{data:[],meta:{total:0,count:0}}}catch(s){return console.error("âŒ Error en ProductService.getTrendingAndOffers:",s),{data:[],meta:{total:0,count:0,limit:0,offset:0}}}}static async getPersonalizedProducts(t=10){try{return await D.get(I.PRODUCTS.PERSONALIZED,{limit:t})||{data:[],meta:{total:0,count:0}}}catch(s){return console.error("âŒ Error en ProductService.getPersonalizedProducts:",s),{data:[],meta:{total:0,count:0,limit:0,offset:0}}}}static async getDiscountedProducts(t=12){try{return await D.get(I.PRODUCTS.DISCOUNTED,{limit:t})||{data:[],meta:{total:0,count:0}}}catch(s){return console.error("âŒ Error en ProductService.getDiscountedProducts:",s),{data:[],meta:{total:0,count:0,limit:0,offset:0}}}}static async getPopularProducts(t=12){try{return await D.get(I.PRODUCTS.POPULAR,{limit:t})||{data:[],meta:{total:0,count:0}}}catch(s){return console.error("âŒ Error en ProductService.getPopularProducts:",s),{data:[],meta:{total:0,count:0,limit:0,offset:0}}}}}const is=({rating:m,maxRating:t=5,size:s=16,showValue:a=!1,reviews:o})=>{const c=m!=null&&m>0?Math.max(0,Math.min(m,t)):0;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex relative gap-[2px]",children:Array.from({length:t}).map((u,S)=>{const P=c>=S+1?100:c>S?(c-S)*100:0;return e.jsxs("div",{className:"relative",style:{width:s,height:s},children:[e.jsx(ce,{size:s,className:"text-gray-300 absolute top-0 left-0"}),e.jsx("div",{className:"overflow-hidden absolute top-0 left-0 text-yellow-400",style:{width:`${P}%`},children:e.jsx(ce,{size:s,className:"fill-yellow-400"})})]},S)})}),a&&c>0&&e.jsxs("span",{className:"ml-1 text-xs text-gray-500",children:[c.toFixed(1),o!=null&&o>0&&` (${o})`]})]})};class cs{async getCategories(t){try{console.log("ðŸ“¤ CategoryService: Obteniendo categorÃ­as:",t);const s=await D.get(I.CATEGORIES.LIST,t);return console.log("ðŸ“¥ CategoryService: Respuesta del servidor:",s),s}catch(s){return console.error("âŒ Error en CategoryService.getCategories:",s),null}}async getCategoryById(t){try{console.log(`ðŸ“¤ CategoryService: Obteniendo categorÃ­a ${t}`);const s=await D.get(I.CATEGORIES.DETAILS(t));return console.log("âœ… CategoryService: CategorÃ­a obtenida:",s),s}catch(s){return console.error("âŒ Error en CategoryService.getCategoryById:",s),null}}async getCategoryBySlug(t){try{console.log(`ðŸ“¤ CategoryService: Obteniendo categorÃ­a por slug ${t}`);const s=await D.get(I.CATEGORIES.SLUG(t));return console.log("âœ… CategoryService: CategorÃ­a obtenida por slug:",s),s}catch(s){return console.error("âŒ Error en CategoryService.getCategoryBySlug:",s),null}}async getMainCategories(t=!0){try{console.log("ðŸ“¤ CategoryService: Obteniendo categorÃ­as principales");const s=await D.get(I.CATEGORIES.MAIN,{with_counts:t});return console.log("âœ… CategoryService: CategorÃ­as principales obtenidas:",s),s?.data||[]}catch(s){return console.error("âŒ Error en CategoryService.getMainCategories:",s),[]}}async getFeaturedCategories(t=8){try{console.log("ðŸ“¤ CategoryService: Obteniendo categorÃ­as destacadas");const s=await D.get(I.CATEGORIES.FEATURED,{limit:t});return console.log("âœ… CategoryService: CategorÃ­as destacadas obtenidas:",s),s?.data||[]}catch(s){return console.error("âŒ Error en CategoryService.getFeaturedCategories:",s),[]}}async getSubcategories(t){try{console.log(`ðŸ“¤ CategoryService: Obteniendo subcategorÃ­as de ${t}`);const s=await D.get(I.CATEGORIES.SUBCATEGORIES(t));return console.log("âœ… CategoryService: SubcategorÃ­as obtenidas:",s),s?.data||[]}catch(s){return console.error("âŒ Error en CategoryService.getSubcategories:",s),[]}}async getCategoryProducts(t,s){try{console.log(`ðŸ“¤ CategoryService: Obteniendo productos de categorÃ­a ${t}`);const a=await D.get(I.CATEGORIES.PRODUCTS(t),s);return console.log("âœ… CategoryService: Productos de categorÃ­a obtenidos:",a),a}catch(a){return console.error("âŒ Error en CategoryService.getCategoryProducts:",a),null}}}const Q=new cs,ds=()=>{const[m,t]=d.useState(!1),[s,a]=d.useState(null),[o,c]=d.useState([]),[u,S]=d.useState([]),[P,y]=d.useState([]),[R,v]=d.useState(null),[A,g]=d.useState(!1),{invalidate:h}=We(),f=d.useCallback(b=>!b||typeof b!="object"?(console.error("CategorÃ­a invÃ¡lida para adaptar:",b),{}):{id:b.id,name:b.name||"",slug:b.slug||"",description:b.description||"",parent_id:b.parent_id,icon:b.icon,image:b.image,order:b.order,is_active:!!(b.is_active??!0),featured:!!(b.featured??!1),created_at:b.created_at,updated_at:b.updated_at,subcategories:Array.isArray(b.subcategories)?b.subcategories.map(n=>f(n)):void 0,product_count:b.product_count||0,parent:b.parent?f(b.parent):void 0},[]);d.useEffect(()=>{if(!A){const b=j.getItem("categories_all");b&&Array.isArray(b.data)&&c(b.data);const n=j.getItem("categories_main");n&&Array.isArray(n)&&S(n);const r=j.getItem("categories_featured");r&&Array.isArray(r)&&y(r),g(!0)}},[A]);const _=d.useCallback(async(b=!0,n=!1)=>{t(!0),a(null);const r=`categories_all_${b?"with_counts":"no_counts"}`;try{if(!n){const i=j.getItem(r);if(i&&Array.isArray(i.data))return console.log("ðŸ’¾ Usando categorÃ­as en cachÃ©"),c(i.data),t(!1),i}console.log("ðŸŒ Obteniendo categorÃ­as desde API con withCounts:",b);const l=await Q.getCategories({with_counts:b,is_active:!0});if(l&&typeof l=="object"&&"data"in l&&Array.isArray(l.data)){const i=l.data.map(f),p={data:i,meta:l.meta||{total:i.length}};return j.setItem(r,p,F.cache.categoryCacheTime),c(i),p}else return console.warn("Respuesta de categorÃ­as no tiene el formato esperado:",l),c([]),{data:[],meta:{total:0}}}catch(l){const i=l instanceof Error?l.message:"Error al obtener categorÃ­as";return a(i),console.error("Error al obtener categorÃ­as:",l),c([]),{data:[],meta:{total:0}}}finally{t(!1)}},[f]),N=d.useCallback(async(b=!0,n=!1)=>{t(!0),a(null);const r=`categories_main_${b?"with_counts":"no_counts"}`;try{if(!n){const E=j.getItem(r);if(E&&Array.isArray(E))return console.log("ðŸ’¾ Usando categorÃ­as principales en cachÃ©"),S(E),t(!1),E}console.log("ðŸŒ Obteniendo categorÃ­as principales desde API");const l=await Q.getMainCategories(b);let i=[];if(Array.isArray(l))i=l;else if(l&&typeof l=="object"&&"data"in l&&Array.isArray(l.data))i=l.data;else return console.warn("Respuesta de categorÃ­as principales no tiene el formato esperado:",l),S([]),[];const p=i.map(f);return j.setItem(r,p,F.cache.categoryCacheTime),S(p),p}catch(l){const i=l instanceof Error?l.message:"Error al obtener categorÃ­as principales";return a(i),console.error("Error al obtener categorÃ­as principales:",l),S([]),[]}finally{t(!1)}},[f]),O=d.useCallback(async(b=8,n=!1)=>{t(!0),a(null);const r=`categories_featured_${b}`;try{if(!n){const E=j.getItem(r);if(E&&Array.isArray(E))return console.log("ðŸ’¾ Usando categorÃ­as destacadas en cachÃ©"),y(E),t(!1),E}console.log("ðŸŒ Obteniendo categorÃ­as destacadas desde API");const l=await Q.getFeaturedCategories(b);let i=[];if(Array.isArray(l))i=l;else if(l&&typeof l=="object"&&"data"in l&&Array.isArray(l.data))i=l.data;else return console.warn("Respuesta de categorÃ­as destacadas no tiene el formato esperado:",l),y([]),[];const p=i.map(f);return j.setItem(r,p,F.cache.categoryCacheTime),y(p),p}catch(l){const i=l instanceof Error?l.message:"Error al obtener categorÃ­as destacadas";return a(i),console.error("Error al obtener categorÃ­as destacadas:",l),y([]),[]}finally{t(!1)}},[f]),$=d.useCallback(async b=>{t(!0),a(null);const n=`categories_subcats_${b}`;try{const r=j.getItem(n);if(r&&Array.isArray(r))return console.log(`ðŸ’¾ Usando subcategorÃ­as en cachÃ© para categorÃ­a ${b}`),t(!1),r;const l=await Q.getSubcategories(b);let i=[];if(Array.isArray(l))i=l;else if(l&&typeof l=="object"&&"data"in l&&Array.isArray(l.data))i=l.data;else return[];if(i.length>0){const p=i.map(f);return j.setItem(n,p,F.cache.categoryCacheTime),p}return[]}catch(r){const l=r instanceof Error?r.message:"Error al obtener subcategorÃ­as";return a(l),console.error("Error al obtener subcategorÃ­as:",r),[]}finally{t(!1)}},[f]),T=d.useCallback(async b=>{t(!0),a(null);const n=`category_slug_${b}`;try{const r=j.getItem(n);if(r)return console.log(`ðŸ’¾ Usando categorÃ­a en cachÃ© para slug ${b}`),v(r),t(!1),r;const l=await Q.getCategoryBySlug(b);if(l&&typeof l=="object"){const i=f(l);return j.setItem(n,i,F.cache.categoryCacheTime),v(i),i}return v(null),null}catch(r){const l=r instanceof Error?r.message:"Error al obtener categorÃ­a por slug";return a(l),console.error("Error al obtener categorÃ­a por slug:",r),v(null),null}finally{t(!1)}},[f]),L=d.useCallback(b=>{b?(h(`category_${b}`),h("category_slug_*"),console.log(`ðŸ—‘ï¸ CachÃ© de la categorÃ­a ${b} invalidada`)):(h("categories_*"),h("category_*"),console.log("ðŸ—‘ï¸ Toda la cachÃ© de categorÃ­as invalidada"))},[h]);return{loading:m,error:s,categories:o,mainCategories:u,featuredCategories:P,categoryDetail:R,fetchCategories:_,fetchMainCategories:N,fetchFeaturedCategories:O,fetchSubcategories:$,fetchCategoryBySlug:T,clearCategoryCache:L}},me=(m,t={})=>{if(!m)return"Sin fecha";try{const s=typeof m=="string"?new Date(m):m;if(isNaN(s.getTime()))return"Fecha invÃ¡lida";const{showTime:a=!0,timeFormat:o="24h",dateFormat:c="medium"}=t,u={day:"numeric",month:"long",year:"numeric"};c==="short"?u.month="numeric":c==="long"&&(u.weekday="long");const S={hour:"numeric",minute:"numeric"};o==="12h"?S.hour12=!0:S.hour12=!1;let P=s.toLocaleDateString("es-ES",u);if(a){const y=s.toLocaleTimeString("es-ES",S);P+=` ${y}`}return P}catch(s){return console.error("Error al formatear fecha:",s),String(m)}},Is=m=>["pending","processing","paid","shipped","delivered","completed","cancelled","rejected"].includes(m),us=m=>({pending:["processing","cancelled","rejected"],processing:["shipped","cancelled","rejected"],paid:["processing","shipped","cancelled","rejected"],shipped:["delivered","cancelled"],delivered:["completed"],completed:[],cancelled:[],rejected:[],ready_to_ship:[],in_transit:[],failed:[],returned:[]})[m]||[],be=(m,t)=>us(m).includes(t);class Y{static instance;static getInstance(){return Y.instance||(Y.instance=new Y),Y.instance}adaptSellerDataToBreakdownFormat(t){const s=[];return t.items&&Array.isArray(t.items)&&t.items.forEach(a=>{const o=[];o.push({step:1,label:"Precio original",price_per_unit:a.original_unit_price||a.unit_price||0,percentage:0,is_discount:!1}),a.seller_discount_percentage&&a.seller_discount_percentage>0&&o.push({step:2,label:`Descuento del seller (${a.seller_discount_percentage}%)`,price_per_unit:a.unit_price||0,percentage:a.seller_discount_percentage,is_discount:!0}),a.volume_discount_percentage&&a.volume_discount_percentage>0&&o.push({step:o.length+1,label:`Descuento por volumen (${a.volume_discount_percentage}%)`,price_per_unit:a.unit_price||0,percentage:a.volume_discount_percentage,is_discount:!0});const c={id:a.id,product_id:a.product_id,product_name:a.product_name||"Producto",product_image:a.product_image,quantity:a.quantity||1,original_price_per_unit:a.original_unit_price||a.unit_price||0,final_price_per_unit:a.unit_price||0,subtotal:a.total_price||0,total_savings:a.total_savings||0,breakdown_steps:o,has_seller_discount:(a.seller_discount_percentage||0)>0,has_volume_discount:(a.volume_discount_percentage||0)>0,has_coupon_discount:!1,seller_net_earning_per_unit:a.seller_net_earning_from_products||0,platform_commission_rate:a.platform_commission_rate||0,platform_commission_amount:a.platform_commission_amount||0};s.push(c)}),{order_id:t.id||0,items:s,summary:{total_items:s.length,total_quantity:s.reduce((a,o)=>a+o.quantity,0),total_original_amount:s.reduce((a,o)=>a+o.original_price_per_unit*o.quantity,0),total_final_amount:s.reduce((a,o)=>a+o.subtotal,0),total_savings:s.reduce((a,o)=>a+o.total_savings,0),seller_commission_info:(()=>{const a=t.order_summary||t.orderSummary||{};return{platform_commission_rate:a.shipping_distribution?.platform_commission_rate||10,total_commission:a.total_platform_commission||0,seller_earnings_from_products:a.total_seller_earnings_from_products||0,shipping_distribution:a.shipping_distribution||{seller_amount:0}}})()}}}async getOrderItemsBreakdown(t,s="customer"){try{console.log(`ðŸ“Š Obteniendo desglose de items para orden ${t} (vista: ${s})`),console.log("ðŸ” OrderBreakdownService.getOrderItemsBreakdown llamado");const a=s==="seller"?`/seller/orders/${t}`:`/user/orders/${t}/items-breakdown`;console.log("ðŸ” Endpoint a usar:",a),console.log("ðŸ” OrderID que se estÃ¡ usando:",t),console.log("ðŸ” ViewType:",s);const c=await D.get(a);let u=null;if(c.success&&c.data||c.data?u=c.data:c.id&&c.items&&(u=c),u)return s==="seller"?this.adaptSellerDataToBreakdownFormat(u):this.adaptCustomerDataToBreakdownFormat(u);throw new Error("No se pudo obtener el desglose de items")}catch(a){throw console.error("âŒ Error al obtener desglose:",a),console.error("âŒ Error especÃ­fico:",a),console.error("âŒ Error mensaje:",a instanceof Error?a.message:"Error desconocido"),console.error("âŒ Error status:",a?.response?.status),console.error("âŒ Error data:",a?.response?.data),a}}adaptCustomerDataToBreakdownFormat(t){const s=[];return t.items&&Array.isArray(t.items)&&t.items.forEach(a=>{s.push({id:a.id,product_id:a.product_id,product_name:a.product_name||"Producto",product_image:a.product_image,quantity:a.quantity||1,original_price_per_unit:a.original_unit_price||0,final_price_per_unit:a.unit_price||0,subtotal:a.total_price||0,total_savings:a.total_savings||0,breakdown_steps:a.breakdown_steps||[],has_seller_discount:(a.seller_discount_percentage||0)>0,has_volume_discount:(a.volume_discount_percentage||0)>0,has_coupon_discount:!1})}),{order_id:t.order_id||0,items:s,summary:{total_items:s.length,total_quantity:s.reduce((a,o)=>a+o.quantity,0),total_original_amount:s.reduce((a,o)=>a+o.original_price_per_unit*o.quantity,0),total_final_amount:s.reduce((a,o)=>a+o.subtotal,0),total_savings:s.reduce((a,o)=>a+o.total_savings,0)}}}}const ms=()=>[{key:"id",header:"ID Pedido",render:(m,t)=>e.jsxs(J,{to:`/seller/orders/${t.id}`,className:"text-primary-600 hover:underline font-medium",children:["#",m]})},{key:"date",header:"Fecha"},{key:"customer",header:"Cliente"},{key:"total",header:"Total",render:m=>k(m)},{key:"status",header:"Estado",render:m=>{const s={Completed:{text:"Completado",classes:"bg-green-100 text-green-800"},Shipped:{text:"Enviado",classes:"bg-blue-100 text-blue-800"},Processing:{text:"En Proceso",classes:"bg-yellow-100 text-yellow-800"}}[m]||{text:m,classes:""};return e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${s.classes}`,children:s.text})}}],gs=({orders:m,title:t,viewAllLink:s,viewAllText:a,compact:o=!1,className:c="",onOrderClick:u})=>e.jsx(Ce,{data:m,columns:ms(),title:t,viewAllLink:s,viewAllText:a,compact:o,className:c,onRowClick:u}),ps=()=>[{key:"name",header:"Producto",render:(m,t)=>e.jsx(J,{to:`/seller/products/edit/${t.id}`,className:"text-primary-600 hover:underline font-medium",children:m})},{key:"sold",header:"Unidades Vendidas"},{key:"revenue",header:"Ingresos",render:m=>k(m)}],hs=({products:m,title:t,viewAllLink:s,viewAllText:a,compact:o=!1,className:c="",onProductClick:u})=>e.jsx(Ce,{data:m,columns:ps(),title:t,viewAllLink:s,viewAllText:a,compact:o,className:c,onRowClick:u}),xs=()=>{const m=Ee(),[t,s]=d.useState(null),[a,o]=d.useState(!0);d.useEffect(()=>{c()},[]);const c=async()=>{try{const A=await D.get(I.SELLER.DASHBOARD);A.status==="success"?s(A.data):(console.error("Dashboard API returned error:",A),s(u()))}catch(A){console.error("Error fetching dashboard data:",A),s(u())}finally{o(!1)}},u=()=>({stats:{total_sales:0,total_orders:0,active_products:0,total_products:0,average_rating:0,pending_orders:0},recent_orders:[],top_products:[]}),S=A=>{m(`/seller/orders/${A.id}`)},P=A=>{m(`/seller/products/${A.id}`)};if(a)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Panel del Vendedor"}),e.jsx("div",{className:"text-center py-12",children:"Cargando..."})]});const y=t||u(),R=[{title:"Ventas Totales",value:k(y.stats.total_sales),change:0,icon:te,iconBgColor:"bg-primary-50",iconColor:"text-primary-600"},{title:"Pedidos Totales",value:y.stats.total_orders,change:0,icon:q,iconBgColor:"bg-orange-50",iconColor:"text-orange-600"},{title:"Productos Activos",value:`${y.stats.active_products} / ${y.stats.total_products}`,change:0,text:`${y.stats.active_products} productos activos`,icon:H,iconBgColor:"bg-blue-50",iconColor:"text-blue-600"},{title:"Promedio de Valoraciones",value:y.stats.average_rating.toFixed(1),change:0,text:e.jsx(is,{rating:y.stats.average_rating,size:15}),icon:ce,iconBgColor:"bg-yellow-50",iconColor:"text-yellow-600"}],v=[{icon:q,iconBgColor:"bg-orange-50",iconColor:"text-orange-600",title:"Pedidos Pendientes",description:`Tienes ${y.stats.pending_orders} pedidos esperando ser procesados.`,linkText:"Procesar Pedidos",linkTo:"/seller/orders?status=pending"},{icon:H,iconBgColor:"bg-blue-50",iconColor:"text-blue-600",title:"AÃ±adir Nuevo Producto",description:"Aumenta tu catÃ¡logo aÃ±adiendo nuevos productos a tu tienda.",linkText:"AÃ±adir Producto",linkTo:"/seller/products/create"},{icon:ge,iconBgColor:"bg-green-50",iconColor:"text-green-600",title:"Informes de Ventas",description:"Consulta informes detallados de ventas y anÃ¡lisis para tu tienda.",linkText:"Ver Informes",linkTo:"/seller/earnings"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Panel del Vendedor"}),e.jsx(Pe,{cards:R}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(gs,{orders:y.recent_orders,title:"Pedidos Recientes",viewAllLink:"/seller/orders",onOrderClick:S}),e.jsx(hs,{products:y.top_products,title:"Productos MÃ¡s Vendidos",viewAllLink:"/seller/products",onProductClick:P})]}),e.jsx(Qe,{items:v,color:!0})]})},As=Object.freeze(Object.defineProperty({__proto__:null,default:xs},Symbol.toStringTag,{value:"Module"})),ie=new ls,fs=()=>{const{user:m}=Ae(),[t,s]=d.useState(!1),[a,o]=d.useState(null),[c,u]=d.useState([]),[S,P]=d.useState(null),[y,R]=d.useState(0),[v,A]=d.useState(1),[g,h]=d.useState(10),f=d.useCallback(async(n=1,r=10,l=!1)=>{s(!0),o(null);try{const i=m?.id;if(!i)throw new Error("No se pudo obtener el ID del vendedor");const p={limit:r,offset:(n-1)*r,page:n,sellerId:i,sortBy:"created_at",sortDir:"desc",featured:void 0,status:void 0,...l&&{_t:Date.now()}};l&&console.log("ðŸ”¥ FORCE REFRESH - timestamp:",Date.now());const E=await ie.getProducts(p);E?Array.isArray(E.data)?(u(E.data),R(E.meta?.total||E.data.length)):(u([]),R(0)):(u([]),R(0))}catch(i){const p=i instanceof Error?i.message:"Error al obtener productos del vendedor";o(p),console.error("Error al obtener productos del vendedor:",i),u([]),R(0)}finally{s(!1)}},[m]),_=d.useCallback(async n=>{s(!0),o(null);try{const r=await ie.getProductById(n);return P(r),r}catch(r){const l=r instanceof Error?r.message:"Error al obtener los detalles del producto";return o(l),console.error("Error al obtener detalles del producto:",r),null}finally{s(!1)}},[]),N=d.useCallback(async n=>{s(!0),o(null);try{const r=new FormData;if(r.append("name",n.name),r.append("description",n.description),n.shortDescription&&r.append("short_description",n.shortDescription),r.append("price",String(n.price)),r.append("stock",String(n.stock)),n.weight!==void 0&&r.append("weight",String(n.weight)),n.width!==void 0&&r.append("width",String(n.width)),n.height!==void 0&&r.append("height",String(n.height)),n.depth!==void 0&&r.append("depth",String(n.depth)),n.dimensions&&r.append("dimensions",n.dimensions),r.append("category_id",String(n.category_id)),n.sku&&r.append("sku",n.sku),n.status!==void 0&&r.append("status",n.status),n.featured!==void 0&&r.append("featured",String(n.featured)),n.published!==void 0&&r.append("published",String(n.published)),n.discount_percentage!==void 0&&r.append("discount_percentage",String(n.discount_percentage)),n.colors){const p=typeof n.colors=="string"?n.colors:JSON.stringify(n.colors);r.append("colors",p)}if(n.sizes){const p=typeof n.sizes=="string"?n.sizes:JSON.stringify(n.sizes);r.append("sizes",p)}if(n.tags){const p=typeof n.tags=="string"?n.tags:JSON.stringify(n.tags);r.append("tags",p)}n.attributes&&Object.keys(n.attributes).length>0&&r.append("attributes",JSON.stringify(n.attributes)),n.images&&n.images.length>0&&n.images.forEach((p,E)=>{r.append(`images[${E}]`,p)}),console.log("Enviando datos de producto para creaciÃ³n:");for(const[p,E]of r.entries())p.startsWith("images[")?console.log(`${p}: (archivo binario)`):console.log(`${p}: ${E}`);const l=await D.uploadFile(I.PRODUCTS.CREATE,r);let i=null;if(l&&typeof l=="object"&&(i=l),i){console.log("âœ… Producto creado exitosamente:",i),console.log("ðŸ”„ Iniciando invalidaciÃ³n de cache y refetch...");try{j.removeItem("seller_products_list"),j.removeItem("seller_products_page_1"),j.removeItem("seller_products_page_2"),j.removeItem("seller_products_page_3"),j.removeItem("products_list"),j.removeItem("header_counters"),console.log("ðŸ—‘ï¸ Cache de productos invalidado correctamente")}catch(p){console.warn("âš ï¸ Error invalidando cache:",p)}setTimeout(async()=>{console.log("ðŸ”„ Ejecutando fetchSellerProducts despuÃ©s de crear..."),await f(v,g,!0),console.log("âœ… fetchSellerProducts completado")},100),setTimeout(async()=>{console.log("ðŸ”„ Refetch backup despuÃ©s de 1s..."),await f(v,g,!0)},1e3)}else throw console.error("Respuesta de creaciÃ³n de producto no vÃ¡lida:",l),new Error("No se pudo crear el producto. La respuesta del servidor no es vÃ¡lida.");return i}catch(r){let l="Error desconocido al crear producto";if(r&&typeof r=="object")if(r.response&&r.response.data){const p=r.response.data;p.message?l=p.message:p.error?l=p.error:r.message&&(l=r.message)}else r.message&&(l=r.message);const i=`Error al crear producto: ${l}`;return o(i),console.error("Error al crear producto:",r),alert(l),null}finally{s(!1)}},[f,v,g]),O=d.useCallback(async n=>{s(!0),o(null);try{console.log("Actualizando producto con datos:",n);const r=new FormData;if(n.name&&r.append("name",n.name),n.description&&r.append("description",n.description),n.shortDescription&&r.append("short_description",n.shortDescription),n.price!==void 0&&r.append("price",String(n.price)),n.stock!==void 0&&r.append("stock",String(n.stock)),n.weight!==void 0&&r.append("weight",String(n.weight)),n.width!==void 0&&r.append("width",String(n.width)),n.height!==void 0&&r.append("height",String(n.height)),n.depth!==void 0&&r.append("depth",String(n.depth)),n.dimensions&&r.append("dimensions",n.dimensions),n.category_id&&r.append("category_id",String(n.category_id)),n.status&&r.append("status",n.status),n.featured!==void 0&&r.append("featured",String(n.featured)),n.published!==void 0&&r.append("published",String(n.published)),n.discount_percentage!==void 0&&r.append("discount_percentage",String(n.discount_percentage)),n.colors){const p=typeof n.colors=="string"?n.colors:JSON.stringify(n.colors);r.append("colors",p)}if(n.sizes){const p=typeof n.sizes=="string"?n.sizes:JSON.stringify(n.sizes);r.append("sizes",p)}if(n.tags){const p=typeof n.tags=="string"?n.tags:JSON.stringify(n.tags);r.append("tags",p)}n.attributes&&Object.keys(n.attributes).length>0&&r.append("attributes",JSON.stringify(n.attributes)),n.replace_images!==void 0&&r.append("replace_images",String(n.replace_images)),n.remove_images&&n.remove_images.length>0&&r.append("remove_images",JSON.stringify(n.remove_images)),n.images&&n.images.length>0&&n.images.forEach((p,E)=>{r.append(`images[${E}]`,p)});const l=await D.updateFile(I.PRODUCTS.UPDATE(n.id),r);let i=null;if(l&&typeof l=="object"&&(i=l),i){console.log("âœ… Producto actualizado exitosamente:",i),console.log("ðŸ”„ Iniciando invalidaciÃ³n de cache y refetch despuÃ©s de actualizar...");try{j.removeItem("seller_products_list"),j.removeItem("seller_products_page_1"),j.removeItem("seller_products_page_2"),j.removeItem("seller_products_page_3"),j.removeItem("products_list"),j.removeItem("header_counters"),j.removeItem("product_"+n.id),console.log("ðŸ—‘ï¸ Cache de productos invalidado correctamente")}catch(p){console.warn("âš ï¸ Error invalidando cache:",p)}setTimeout(async()=>{console.log("ðŸ”„ Ejecutando fetchSellerProducts despuÃ©s de actualizar..."),await f(v,g,!0),console.log("âœ… fetchSellerProducts completado")},100),setTimeout(async()=>{console.log("ðŸ”„ Refetch backup despuÃ©s de 1s..."),await f(v,g,!0)},1e3)}else throw new Error("No se pudo actualizar el producto");return i}catch(r){let l="Error desconocido al actualizar producto";if(r&&typeof r=="object")if(r.response&&r.response.data){const p=r.response.data;p.message?l=p.message:p.error?l=p.error:r.message&&(l=r.message)}else r.message&&(l=r.message);const i=`Error al actualizar producto: ${l}`;return o(i),console.error("Error al actualizar producto:",r),alert(l),null}finally{s(!1)}},[f,v,g]),$=d.useCallback(async n=>{s(!0),o(null);try{const r=await ie.deleteProduct(n);if(r){console.log("âœ… Producto eliminado exitosamente");try{j.removeItem("seller_products_list"),j.removeItem("seller_products_page_1"),j.removeItem("seller_products_page_2"),j.removeItem("seller_products_page_3"),j.removeItem("products_list"),j.removeItem("header_counters"),j.removeItem("product_"+n),console.log("ðŸ—‘ï¸ Cache de productos invalidado correctamente")}catch(l){console.warn("âš ï¸ Error invalidando cache:",l)}setTimeout(async()=>{await f(v,g,!0)},100)}return r}catch(r){const l=r instanceof Error?r.message:"Error al eliminar producto";return o(l),console.error("Error al eliminar producto:",r),!1}finally{s(!1)}},[f,v,g]),T=d.useCallback(async(n,r)=>{s(!0),o(null);try{const l=r==="active"?"inactive":"active",i=new FormData;if(i.append("status",l),await D.uploadFile(I.PRODUCTS.UPDATE(n),i))return console.log("âœ… Estado del producto cambiado exitosamente"),setTimeout(async()=>{await f(v,g,!0)},100),!0;throw new Error("Error al cambiar estado del producto")}catch(l){const i=l instanceof Error?l.message:"Error al cambiar estado del producto";return o(i),console.error("Error al cambiar estado del producto:",l),!1}finally{s(!1)}},[f,v,g]);d.useEffect(()=>{m&&f(v,g)},[m,v,g,f]);const L=d.useCallback(n=>{A(n)},[]),b=d.useCallback(n=>{h(n),A(1)},[]);return{products:c,productDetail:S,totalProducts:y,loading:t,error:a,page:v,itemsPerPage:g,fetchSellerProducts:f,fetchProductById:_,createProduct:N,updateProduct:O,deleteProduct:$,toggleProductStatus:T,changePage:L,changeItemsPerPage:b}},ys=()=>{const m=Ee(),t=qe(),{products:s,loading:a,error:o,fetchSellerProducts:c,deleteProduct:u,toggleProductStatus:S}=fs(),{categories:P,fetchCategories:y}=ds(),[R,v]=d.useState(""),[A,g]=d.useState("all"),[h,f]=d.useState([]),[_,N]=d.useState(null),[O,$]=d.useState(null);d.useEffect(()=>{y()},[y]),d.useEffect(()=>{const r=t.state;r?.updatedProduct&&(console.log("ðŸ”„ Detectado regreso desde ediciÃ³n, forzando refresh...",{productId:r.productId,timestamp:r.timestamp}),setTimeout(()=>{c(1,10,!0)},100),m(t.pathname,{replace:!0,state:null}))},[t.state,c,m,t.pathname]),d.useEffect(()=>{if(s&&s.length>0){const r=new Map;P.forEach(i=>{i.id&&r.set(i.id,i.name)});const l=s.map(i=>{const p=i.categoryId||0,E=i.category_name||`CategorÃ­a ${p}`;return{id:i.id||0,name:i.name,price:typeof i.price=="number"?i.price:parseFloat(String(i.price))||0,stock:typeof i.stock=="number"?i.stock:parseInt(String(i.stock))||0,categoryId:p,category:E,status:i.status||"inactive",createdAt:me(i.created_at)}});f(l)}else f([])},[s,P]);const T=h.filter(r=>{const l=r.name.toLowerCase().includes(R.toLowerCase())||r.category.toLowerCase().includes(R.toLowerCase()),i=A==="all"||r.status===A;return l&&i}),L=async r=>{if(window.confirm("Â¿EstÃ¡s seguro de que deseas eliminar este producto?"))try{N(r),await u(r)||alert("No se pudo eliminar el producto. IntÃ©ntalo de nuevo mÃ¡s tarde.")}finally{N(null)}},b=async(r,l)=>{try{$(r),await S(r,l)||alert("No se pudo cambiar el estado del producto. IntÃ©ntalo de nuevo mÃ¡s tarde.")}finally{$(null)}},n=r=>{m(`/seller/products/edit/${r}`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mis Productos"}),e.jsxs(J,{to:"/seller/products/create",className:"flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(he,{size:18,className:"mr-2"}),"AÃ±adir Nuevo Producto"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("input",{type:"text",placeholder:"Buscar productos...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:R,onChange:r=>v(r.target.value)}),e.jsx(je,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-gray-500"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:A,onChange:r=>g(r.target.value),children:[e.jsx("option",{value:"all",children:"Todos los Estados"}),e.jsx("option",{value:"active",children:"Activo"}),e.jsx("option",{value:"inactive",children:"Inactivo"}),e.jsx("option",{value:"draft",children:"Borrador"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:a?e.jsx("div",{className:"p-8 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})}):o?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(ke,{className:"h-12 w-12 mx-auto text-red-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Error al cargar productos"}),e.jsx("p",{className:"text-gray-500 mb-4",children:o}),e.jsx("button",{onClick:()=>c(),className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Intentar de nuevo"})]}):T.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(H,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No se encontraron productos"}),e.jsx("p",{className:"text-gray-500 mb-4",children:R||A!=="all"?"Intenta ajustar tu bÃºsqueda o filtro para encontrar lo que buscas.":"Comienza agregando tu primer producto."}),e.jsxs(J,{to:"/seller/products/create",className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:[e.jsx(he,{size:18,className:"mr-2"}),"AÃ±adir Nuevo Producto"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Producto"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CategorÃ­a"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Creado"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:T.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-gray-100 rounded-md flex items-center justify-center",children:e.jsx(H,{className:"h-6 w-6 text-gray-500"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.name}),e.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",r.id]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:r.category||"Sin categorÃ­a"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-900",children:k(r.price)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:`text-sm ${r.stock>0?"text-green-600":"text-red-600"}`,children:r.stock>0?r.stock:"Sin stock"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${r.status==="active"?"bg-green-100 text-green-800":r.status==="inactive"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:[r.status==="active"&&"Activo",r.status==="inactive"&&"Inactivo",r.status==="draft"&&"Borrador"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.createdAt}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>b(r.id,r.status),disabled:O===r.id,className:`p-1 rounded-md ${O===r.id?"opacity-50 cursor-not-allowed":r.status==="active"?"text-yellow-600 hover:bg-yellow-100":"text-green-600 hover:bg-green-100"}`,title:r.status==="active"?"Desactivar":"Activar",children:O===r.id?e.jsx("div",{className:"animate-spin h-4 w-4"}):r.status==="active"?e.jsx(Oe,{size:18}):e.jsx(Se,{size:18})}),e.jsx("button",{onClick:()=>n(r.id),className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Editar producto",children:e.jsx(Te,{size:18})}),e.jsx("button",{onClick:()=>L(r.id),disabled:_===r.id,className:`p-1 text-red-600 hover:bg-red-100 rounded-md ${_===r.id?"opacity-50 cursor-not-allowed":""}`,title:"Eliminar producto",children:_===r.id?e.jsx("div",{className:"animate-spin h-4 w-4"}):e.jsx($e,{size:18})})]})})]},r.id))})]})})})]})},Ds=Object.freeze(Object.defineProperty({__proto__:null,default:ys},Symbol.toStringTag,{value:"Module"})),bs=({items:m})=>{const t=s=>{switch(s){case"blue":return"bg-blue-50 text-blue-700 border-blue-200";case"green":return"bg-green-50 text-green-700 border-green-200";case"indigo":return"bg-indigo-50 text-indigo-700 border-indigo-200";case"red":return"bg-red-50 text-red-700 border-red-200";case"yellow":return"bg-yellow-50 text-yellow-700 border-yellow-200";case"purple":return"bg-purple-50 text-purple-700 border-purple-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}};return e.jsx(e.Fragment,{children:m.map((s,a)=>e.jsxs("div",{className:`rounded-lg border p-4 ${t(s.color)}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:s.label}),s.icon||null]}),e.jsx("p",{className:"mt-2 text-2xl font-bold",children:s.value})]},a))})};class De{async getSellerOrders(t={}){try{console.log("SellerOrderServiceAdapter: Obteniendo Ã³rdenes con filtros:",t);const s={limit:t.limit||10,page:t.page||1};t.status&&t.status!=="all"&&(s.status=t.status),t.paymentStatus&&t.paymentStatus!=="all"&&(s.payment_status=t.paymentStatus),t.search&&(s.search=t.search),t.dateFrom&&(s.date_from=t.dateFrom),t.dateTo&&(s.date_to=t.dateTo);const a=await D.get(I.ORDERS.SELLER_ORDERS,s);if(console.log("SellerOrderServiceAdapter: Respuesta de la API:",a),!a||a.success!==!0)throw new Error("Respuesta de API invÃ¡lida");const o=Array.isArray(a.data)?a.data.map(S=>this.mapOrderToUI(S)):[],c=a.pagination||{currentPage:1,totalPages:1,totalItems:o.length,itemsPerPage:10},u={currentPage:Number(c.currentPage)||1,totalPages:Number(c.totalPages)||1,totalItems:Number(c.totalItems)||o.length,itemsPerPage:Number(c.itemsPerPage)||10};return{orders:o,pagination:u}}catch(s){return console.error("SellerOrderServiceAdapter: Error al obtener Ã³rdenes:",s),{orders:[],pagination:{currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}}}}mapOrderToUI(t){if(!t)return console.warn("SellerOrderServiceAdapter: Orden invÃ¡lida recibida"),{id:"0",orderNumber:"N/A",date:new Date().toISOString(),customer:{id:0,name:"Cliente",email:"sin@email.com"},total:0,items:[],status:"pending",paymentStatus:"pending"};const s=t.customer?.name||"Cliente",a=t.customer?.email||"sin@email.com",o=Array.isArray(t.items)?t.items.map(u=>({id:u.id,product_id:u.product_id,quantity:Number(u.quantity)||1,price:Number(u.price)||0,subtotal:Number(u.subtotal)||0,name:u.product?.name||u.product_name||`Producto ${u.product_id}`,sku:u.product?.sku||u.product_sku||`SKU-${u.product_id}`,image:u.product?.image||u.product_image||"/placeholder-product.jpg"})):[],c=typeof t.total=="string"?parseFloat(t.total):t.total||0;return{id:String(t.id||0),orderNumber:t.orderNumber||t.order_number||`#${t.id||0}`,date:t.date||t.created_at||new Date().toISOString(),customer:{id:t.customer?.id||t.user_id||0,name:s,email:a},total:c,items:o,status:t.status||"pending",paymentStatus:t.paymentStatus||t.payment_status||"pending",shippingAddress:typeof t.shippingAddress=="string"?t.shippingAddress:JSON.stringify(t.shippingAddress||{})}}async updateOrderStatus(t,s){try{console.log(`SellerOrderServiceAdapter: Actualizando orden ${t} a estado ${s}`);const a=await D.patch(I.ORDERS.UPDATE_STATUS(Number(t)),{status:s});return!a||a.success!==!0?(console.error("Error al actualizar estado: Respuesta invÃ¡lida",a),!1):(console.log("Estado de orden actualizado correctamente:",a.data||a.message),!0)}catch(a){return console.error(`SellerOrderServiceAdapter: Error al actualizar estado de orden ${t}:`,a),!1}}async getOrderStats(){try{console.log("SellerOrderServiceAdapter: Obteniendo estadÃ­sticas de Ã³rdenes");const t=await D.get(I.ORDERS.STATS);if(console.log("SellerOrderServiceAdapter: Respuesta de estadÃ­sticas:",t),!t||t.success!==!0)throw new Error("Respuesta de API invÃ¡lida para estadÃ­sticas");const s=t.data||{};return[{label:"Total Pedidos",value:Number(s.totalOrders)||0,color:"blue"},{label:"Pendientes",value:Number(s.pendingOrders)||0,color:"yellow"},{label:"En Proceso",value:Number(s.processingOrders)||0,color:"blue"},{label:"Enviados",value:Number(s.shippedOrders)||0,color:"indigo"},{label:"Total Ventas",value:Number(s.totalSales)||0,isCurrency:!0,color:"green"}]}catch(t){return console.error("SellerOrderServiceAdapter: Error al obtener estadÃ­sticas:",t),[{label:"Total Pedidos",value:0,color:"blue"},{label:"Pendientes",value:0,color:"yellow"},{label:"En Proceso",value:0,color:"blue"},{label:"Total Ventas",value:0,isCurrency:!0,color:"green"}]}}async getOrderDetails(t){try{const s=typeof t=="string"?parseInt(t):t;console.log(`SellerOrderServiceAdapter: Obteniendo detalle de orden ${s} como vendedor`);const a=await D.get(I.ORDERS.SELLER_ORDER_DETAILS(s));if(console.log(`SellerOrderServiceAdapter: Respuesta para orden ${s}:`,a),!a||!a.data)throw new Error("Respuesta vacÃ­a al obtener detalle de orden");const o=a.data;console.log("ðŸ” TODOS LOS CAMPOS EN orderData:",Object.keys(o)),console.log("ðŸ” orderData.seller_id:",o.seller_id),console.log("ðŸ” orderData.sellerId:",o.sellerId),console.log("ðŸ” orderData.user_id:",o.user_id),console.log("ðŸ” orderData.userId:",o.userId),console.log("ðŸ” orderData.seller:",o.seller),console.log("ðŸ” orderData completo:",o);const c={id:o.id,sellerId:o.seller_id||o.sellerId,orderNumber:o.orderNumber||o.order_number||`#${o.id}`,orderDate:o.orderDate||o.order_date||o.date,status:o.status,total:Number(o.total)||0,items:Array.isArray(o.items)?o.items.map(u=>({id:u.id,product_id:u.product_id,product_name:u.product_name||`Producto ${u.product_id}`,quantity:Number(u.quantity)||1,unit_price:Number(u.unit_price)||0,total_price:Number(u.total_price)||0,original_unit_price:Number(u.original_unit_price)||0,price:Number(u.unit_price)||0,subtotal:Number(u.total_price)||0,product_image:u.product_image||"/placeholder-product.jpg",product_slug:u.product_slug||null,seller_discount_percentage:Number(u.seller_discount_percentage)||0,seller_discount_amount:Number(u.seller_discount_amount)||0,platform_commission_rate:Number(u.platform_commission_rate)||0,platform_commission_amount:Number(u.platform_commission_amount)||0,seller_net_earning_from_products:Number(u.seller_net_earning_from_products)||0,volume_discount_percentage:Number(u.volume_discount_percentage)||0,has_volume_discount:!!u.has_volume_discount||!1})):[],customer:o.customer||{id:o.user_id||0,name:"Cliente",email:"sin@email.com"},customerName:o.customer?.name||"Cliente",customerEmail:o.customer?.email||"sin@email.com",shippingData:o.shippingData||o.shipping_data||{},shipping:o.shipping||null,payment:o.payment||{method:"Tarjeta de crÃ©dito",status:"completed",payment_id:null},paymentMethod:o.payment?.method||"Tarjeta de crÃ©dito",paymentStatus:o.payment?.status||"completed",paymentId:o.payment?.payment_id||null,createdAt:o.orderDate||o.order_date||o.date,updatedAt:o.updated_at||o.orderDate,shippingAddress:this.formatShippingAddress(o),orderSummary:o.order_summary||{}};return console.log("Orden adaptada para UI de vendedor:",c),c}catch(s){throw console.error(`SellerOrderServiceAdapter: Error al obtener detalle de orden ${t}:`,s),s}}formatShippingAddress(t){const s=t.shippingData||t.shipping_data||{};if(typeof s=="string")try{const a=JSON.parse(s),o=[a.address,a.city,a.state||a.province,a.country,a.postal_code].filter(Boolean);return o.length>0?o.join(", "):"DirecciÃ³n no disponible"}catch{return s}if(s&&typeof s=="object"){const a=[s.address,s.city,s.state||s.province,s.country,s.postal_code].filter(Boolean);return a.length>0?a.join(", "):"DirecciÃ³n no disponible"}return"DirecciÃ³n no disponible"}async completeOrder(t){try{const s=typeof t=="string"?parseInt(t):t;console.log(`SellerOrderServiceAdapter: Completando orden ${s}`);const a=await D.post(I.ORDERS.COMPLETE(s));return console.log(`Respuesta al completar orden ${s}:`,a),a&&a.success===!0}catch(s){return console.error(`SellerOrderServiceAdapter: Error al completar orden ${t}:`,s),!1}}async updateShippingInfo(t,s){try{const a=typeof t=="string"?parseInt(t):t;console.log(`SellerOrderServiceAdapter: Actualizando informaciÃ³n de envÃ­o para orden ${a}`);const o=await D.patch(I.ORDERS.UPDATE_SHIPPING(a),s);return console.log("Respuesta al actualizar informaciÃ³n de envÃ­o:",o),o&&o.success===!0}catch(a){return console.error(`SellerOrderServiceAdapter: Error al actualizar informaciÃ³n de envÃ­o para orden ${t}:`,a),!1}}async createShipping(t,s){try{const a=typeof t=="string"?parseInt(t):t;console.log(`SellerOrderServiceAdapter: Creando informaciÃ³n de envÃ­o para orden ${a}`);const o=await D.post(I.ORDERS.UPDATE_SHIPPING(a),{...s,status:"shipped"});return console.log("Respuesta al crear informaciÃ³n de envÃ­o:",o),o&&o.success===!0}catch(a){return console.error(`SellerOrderServiceAdapter: Error al crear informaciÃ³n de envÃ­o para orden ${t}:`,a),!1}}}const Re=({orderId:m,orderNumber:t,isOpen:s,onClose:a,onSubmit:o,isLoading:c=!1})=>{const[u,S]=d.useState({tracking_number:"",shipping_company:"Correos Express",estimated_delivery:"",notes:""}),[P,y]=d.useState({}),R=f=>{const _=Date.now().toString(),N=Math.random().toString(36).substring(2,8).toUpperCase();switch(f){case"Correos Express":return`CE${_.slice(-8)}${N}`;case"SEUR":return`SEUR${_.slice(-6)}${N.slice(0,4)}`;case"MRW":return`MRW${_.slice(-7)}${N.slice(0,3)}`;case"DHL":return`DHL${_.slice(-8)}${N}`;case"FedEx":return`FDX${_.slice(-8)}${N}`;case"UPS":return`1Z${N}${_.slice(-6)}`;case"Nacex":return`NCX${_.slice(-8)}${N}`;case"GLS":return`GLS${_.slice(-8)}${N}`;default:return`TRK${_.slice(-8)}${N}`}};d.useEffect(()=>{if(s){const f=R("Correos Express"),_=new Date;_.setDate(_.getDate()+4),S({tracking_number:f,shipping_company:"Correos Express",estimated_delivery:_.toISOString().split("T")[0],notes:""}),y({})}},[s]);const v=f=>{const _=R(f);S(N=>({...N,shipping_company:f,tracking_number:_}))},A=()=>{const f={};if(u.tracking_number.trim()||(f.tracking_number="El nÃºmero de seguimiento es requerido"),u.shipping_company.trim()||(f.shipping_company="La empresa de envÃ­o es requerida"),u.estimated_delivery){const _=new Date(u.estimated_delivery),N=new Date;N.setHours(0,0,0,0),_<N&&(f.estimated_delivery="La fecha de entrega debe ser futura")}return y(f),Object.keys(f).length===0},g=async f=>{if(f.preventDefault(),!!A())try{await o(u)}catch(_){console.error("Error al procesar envÃ­o:",_)}},h=f=>{const{name:_,value:N}=f.target;_==="shipping_company"?v(N):S(O=>({...O,[_]:N})),P[_]&&y(O=>({...O,[_]:""}))};return s?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 py-10 text-center sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-black-30 backdrop-blur-sm transition-opacity z-40",onClick:a}),e.jsxs("div",{role:"dialog","aria-modal":"true",className:"z-50 inline-block align-bottom bg-white rounded-xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary-500 to-primary-700 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 flex items-center justify-center h-10 w-10 rounded-full bg-white bg-opacity-20",children:e.jsx(re,{className:"h-6 w-6 text-primary-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-lg leading-6 font-semibold text-white",children:"Procesar EnvÃ­o"}),e.jsx("p",{className:"text-sm text-primary-100",children:t?`Pedido ${t}`:`Pedido #${m}`})]})]}),e.jsx("button",{onClick:a,className:"text-white hover:text-primary-200 transition-colors",disabled:c,children:e.jsx(de,{size:24})})]})}),e.jsx("div",{className:"px-6 py-4",children:e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Empresa de EnvÃ­o"}),e.jsxs("select",{name:"shipping_company",value:u.shipping_company,onChange:h,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",disabled:c,children:[e.jsx("option",{value:"Correos Express",children:"ðŸ“¦ Correos Express"}),e.jsx("option",{value:"SEUR",children:"ðŸšš SEUR"}),e.jsx("option",{value:"MRW",children:"ðŸ“® MRW"}),e.jsx("option",{value:"DHL",children:"âœˆï¸ DHL"}),e.jsx("option",{value:"FedEx",children:"ðŸ“¦ FedEx"}),e.jsx("option",{value:"UPS",children:"ðŸ“¦ UPS"}),e.jsx("option",{value:"Nacex",children:"ðŸš› Nacex"}),e.jsx("option",{value:"GLS",children:"ðŸ“¦ GLS"})]}),P.shipping_company&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.shipping_company})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["NÃºmero de Seguimiento",e.jsx("span",{className:"text-green-600 text-xs ml-2",children:"(Generado automÃ¡ticamente)"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",name:"tracking_number",value:u.tracking_number,onChange:h,className:"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg bg-gray-50 font-mono text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",disabled:c}),e.jsx(Ue,{className:"absolute right-3 top-2.5 h-5 w-5 text-green-500"})]}),P.tracking_number&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.tracking_number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Entrega Estimada"}),e.jsx("input",{type:"date",name:"estimated_delivery",value:u.estimated_delivery,onChange:h,min:new Date().toISOString().split("T")[0],className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",disabled:c}),P.estimated_delivery&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:P.estimated_delivery})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notas (Opcional)"}),e.jsx("textarea",{name:"notes",value:u.notes,onChange:h,rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"InformaciÃ³n adicional sobre el envÃ­o...",disabled:c})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:a,disabled:c,className:"px-4 py-2 border border-gray-300 rounded-lg text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{type:"submit",onClick:g,disabled:c,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 flex items-center",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Procesando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{size:16,className:"mr-2"}),"Procesar EnvÃ­o"]})})]})]})]})}):null},ve=m=>{if(!m)return"";try{const t=JSON.parse(m);if(typeof t=="object"&&t!==null)return[t.address,t.city,t.state,t.country].filter(Boolean).join(", ")}catch(t){console.error("Error al parsear direcciÃ³n de envÃ­o:",t)}return m},vs=()=>{const m=new De,[t,s]=d.useState([]),[a,o]=d.useState(!0),[c,u]=d.useState("all"),[S,P]=d.useState("all"),[y,R]=d.useState("all"),[v,A]=d.useState(""),[g,h]=d.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),[f,_]=d.useState([]),[N,O]=d.useState({from:"",to:""}),[$,T]=d.useState(!1),[L,b]=d.useState(!1),[n,r]=d.useState(null);d.useEffect(()=>{l(),i()},[c,S,v,g.currentPage,y,N]);const l=async()=>{o(!0);try{const x={page:g.currentPage,limit:g.itemsPerPage};if(c!=="all"&&(x.status=c),S!=="all"&&(x.paymentStatus=S),v&&(x.search=v),y==="today"){const w=new Date().toISOString().split("T")[0];x.dateFrom=w,x.dateTo=w}else if(y==="week"){const w=new Date,M=new Date(w.setDate(w.getDate()-w.getDay()));x.dateFrom=M.toISOString().split("T")[0],x.dateTo=new Date().toISOString().split("T")[0]}else if(y==="month"){const w=new Date,M=new Date(w.getFullYear(),w.getMonth(),1);x.dateFrom=M.toISOString().split("T")[0],x.dateTo=new Date().toISOString().split("T")[0]}else y==="custom"&&N.from&&N.to&&(x.dateFrom=N.from,x.dateTo=N.to);const C=await m.getSellerOrders(x);s(C.orders),h(C.pagination)}catch(x){console.error("Error al cargar Ã³rdenes:",x)}finally{o(!1)}},i=async()=>{try{const C=(await m.getOrderStats()).map(w=>{let M;switch(w.label){case"Total Pedidos":M=e.jsx(q,{className:"h-5 w-5 text-blue-600"});break;case"Pendientes":M=e.jsx(H,{className:"h-5 w-5 text-yellow-600"});break;case"En Proceso":M=e.jsx(q,{className:"h-5 w-5 text-blue-600"});break;case"Enviados":M=e.jsx(re,{className:"h-5 w-5 text-indigo-600"});break;case"Total Ventas":M=e.jsx(ue,{className:"h-5 w-5 text-green-600"});break;default:M=e.jsx(q,{className:"h-5 w-5 text-blue-600"})}return{...w,icon:M,value:w.isCurrency&&typeof w.value=="number"?k(w.value):w.value}});_(C)}catch(x){console.error("Error al cargar estadÃ­sticas:",x),_([{label:"Total Pedidos",value:t.length,icon:e.jsx(q,{className:"h-5 w-5 text-blue-600"}),color:"blue"},{label:"Pendientes",value:t.filter(C=>C.status==="pending").length,icon:e.jsx(H,{className:"h-5 w-5 text-yellow-600"}),color:"yellow"},{label:"En Proceso",value:t.filter(C=>C.status==="processing").length,icon:e.jsx(q,{className:"h-5 w-5 text-blue-600"}),color:"blue"},{label:"Total Ventas",value:k(t.reduce((C,w)=>C+w.total,0)),icon:e.jsx(ue,{className:"h-5 w-5 text-green-600"}),color:"green"}])}},p=async(x,C)=>{try{T(!0),await m.updateOrderStatus(x,C)&&(s(M=>M.map(ne=>ne.id===x?{...ne,status:C}:ne)),i())}catch(w){console.error(`Error al actualizar estado de orden ${x}:`,w)}finally{T(!1)}},E=x=>{r(x),b(!0)},z=async x=>{if(n)try{T(!0),await m.updateShippingInfo(n,x)&&(s(w=>w.map(M=>M.id===n?{...M,status:"shipped"}:M)),b(!1),r(null),l(),i())}catch(C){console.error("Error al procesar envÃ­o:",C)}finally{T(!1)}},U=x=>{h(C=>({...C,currentPage:x}))},X=()=>{o(!0),l(),i()},oe=[{key:"orderNumber",header:"NÃºmero de Pedido",sortable:!0,render:x=>e.jsx(J,{to:`/seller/orders/${x.id}`,className:"font-medium text-primary-600 hover:underline",children:x.orderNumber})},{key:"date",header:"Fecha",sortable:!0,render:x=>{const C=new Date(x.date);return e.jsxs("span",{children:[C.toLocaleDateString("es-ES")," ",C.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})]})}},{key:"customer",header:"Cliente",sortable:!0,render:x=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:x.customer.name}),e.jsx("div",{className:"text-xs text-gray-500",children:x.customer.email})]})},{key:"total",header:"Total",sortable:!0,render:x=>e.jsx("span",{className:"font-medium",children:k(x.total)})},{key:"items",header:"Productos",render:x=>e.jsx("span",{className:"text-center",children:x.items?x.items.reduce((C,w)=>C+w.quantity,0):0})},{key:"status",header:"Estado",sortable:!0,render:x=>{let C="",w="";switch(x.status){case"pending":C="bg-yellow-100 text-yellow-800",w="Pendiente";break;case"ready_to_ship":C="bg-blue-100 text-blue-800",w="Listo para enviar";break;case"in_transit":C="bg-indigo-100 text-indigo-800",w="En TrÃ¡nsito";break;case"processing":C="bg-blue-100 text-blue-800",w="En Proceso";break;case"paid":C="bg-cyan-100 text-cyan-800",w="Pagado";break;case"shipped":C="bg-indigo-100 text-indigo-800",w="Enviado";break;case"delivered":C="bg-green-100 text-green-800",w="Entregado";break;case"completed":C="bg-emerald-100 text-emerald-800",w="Completado";break;case"failed":C="bg-red-100 text-red-800",w="Fallido";break;case"rejected":C="bg-orange-100 text-orange-800",w="Devuelto";break;case"cancelled":C="bg-gray-100 text-gray-800",w="Cancelado";break;case"returned":C="bg-orange-100 text-orange-800",w="Devuelto";break;default:C="bg-gray-100 text-gray-800",w="Desconocido";break}return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${C}`,children:w})}},{key:"payment",header:"Pago",sortable:!0,render:x=>{let C="",w="";switch(x.paymentStatus){case"pending":C="bg-yellow-100 text-yellow-800",w="Pendiente";break;case"completed":C="bg-green-100 text-green-800",w="Pagado";break;case"rejected":C="bg-red-100 text-red-800",w="Rechazado";break}return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${C}`,children:w})}},{key:"address",header:"DirecciÃ³n",render:x=>e.jsx("div",{className:"truncate max-w-xs",title:ve(x.shippingAddress),children:ve(x.shippingAddress)})},{key:"actions",header:"Acciones",render:x=>e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(J,{to:`/seller/orders/${x.id}`,className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Ver detalles",children:e.jsx(Se,{size:18})}),e.jsx("button",{onClick:()=>E(x.id),disabled:!(x.status==="pending"||x.status==="processing")||$,className:`p-1 rounded-md ${x.status==="pending"||x.status==="processing"?"text-green-600 hover:bg-green-100":"text-gray-400 cursor-not-allowed"} disabled:opacity-50`,title:x.status==="pending"||x.status==="processing"?"Gestionar envÃ­o":"No se puede gestionar el envÃ­o en este estado",children:e.jsx(re,{size:18})}),x.status==="pending"&&e.jsx("button",{onClick:()=>p(x.id,"processing"),disabled:$,className:"p-1 text-orange-600 hover:bg-orange-100 rounded-md disabled:opacity-50",title:"Preparar pedido",children:e.jsx(H,{size:18})})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Re,{orderId:n||"",orderNumber:t.find(x=>x.id===n)?.orderNumber,isOpen:L,onClose:()=>{b(!1),r(null)},onSubmit:z,isLoading:$}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"GestiÃ³n de Pedidos"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("button",{onClick:X,disabled:a,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50",children:[e.jsx(we,{size:18,className:`inline mr-2 ${a?"animate-spin":""}`}),"Actualizar"]})})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("input",{type:"text",placeholder:"Buscar por nÃºmero de pedido, cliente...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",value:v,onChange:x=>A(x.target.value)}),e.jsx(je,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-gray-500"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:c,onChange:x=>u(x.target.value),children:[e.jsx("option",{value:"all",children:"Todos los estados"}),e.jsx("option",{value:"pending",children:"Pendientes"}),e.jsx("option",{value:"processing",children:"En Proceso"}),e.jsx("option",{value:"paid",children:"Pagados"}),e.jsx("option",{value:"shipped",children:"Enviados"}),e.jsx("option",{value:"in_transit",children:"En TrÃ¡nsito"}),e.jsx("option",{value:"delivered",children:"Entregados"}),e.jsx("option",{value:"completed",children:"Completados"}),e.jsx("option",{value:"failed",children:"Fallidos"}),e.jsx("option",{value:"returned",children:"Devueltos"}),e.jsx("option",{value:"cancelled",children:"Cancelados"})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:S,onChange:x=>P(x.target.value),children:[e.jsx("option",{value:"all",children:"Todos los pagos"}),e.jsx("option",{value:"pending",children:"Pago Pendiente"}),e.jsx("option",{value:"completed",children:"Pagados"}),e.jsx("option",{value:"rejected",children:"Rechazados"})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:y,onChange:x=>R(x.target.value),children:[e.jsx("option",{value:"all",children:"Todas las fechas"}),e.jsx("option",{value:"today",children:"Hoy"}),e.jsx("option",{value:"week",children:"Esta semana"}),e.jsx("option",{value:"month",children:"Este mes"}),e.jsx("option",{value:"custom",children:"Personalizado"})]}),y==="custom"&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.from,onChange:x=>O({...N,from:x.target.value})}),e.jsx("span",{className:"text-gray-500",children:"a"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:N.to,onChange:x=>O({...N,to:x.target.value})})]})]}),e.jsx("button",{onClick:()=>{u("all"),P("all"),R("all"),A(""),O({from:"",to:""})},className:"bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300",children:"Limpiar filtros"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:e.jsx(bs,{items:f})}),e.jsx(Xe,{data:t,columns:oe,searchFields:["orderNumber"],loading:a,emptyMessage:"No se encontraron pedidos",pagination:{currentPage:g.currentPage,totalPages:g.totalPages,totalItems:g.totalItems,itemsPerPage:g.itemsPerPage,onPageChange:U}})]})},Rs=Object.freeze(Object.defineProperty({__proto__:null,default:vs},Symbol.toStringTag,{value:"Module"})),_e=({grossEarnings:m,platformCommission:t,netEarnings:s,shippingEarnings:a,totalEarnings:o,commissionRate:c,sellerCount:u=1,showBreakdown:S=!1,className:P=""})=>{const y=v=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(v),R=v=>`${v.toFixed(1)}%`;return S?e.jsxs("div",{className:`bg-gray-50 rounded-lg p-4 space-y-3 ${P}`,children:[e.jsxs("div",{className:"flex items-center gap-2 font-semibold text-gray-800",children:[e.jsx(te,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{children:"Desglose de Ganancias"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal de productos:"}),e.jsx("span",{className:"font-medium",children:y(m)})]}),e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsxs("span",{children:["ComisiÃ³n plataforma (",R(c),"):"]}),e.jsxs("span",{className:"font-medium",children:["-",y(t)]})]}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{className:"text-gray-800",children:"Ganancia neta de productos:"}),e.jsx("span",{className:"text-green-700",children:y(s)})]}),a>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Ganancia por envÃ­o:",u>1&&e.jsxs("span",{className:"text-xs ml-1",children:["(",u," vendedores)"]})]}),e.jsxs("span",{className:"font-medium text-blue-700",children:["+",y(a)]})]}),e.jsx("hr",{className:"border-gray-300"}),e.jsxs("div",{className:"flex justify-between font-bold text-lg",children:[e.jsx("span",{className:"text-gray-800",children:"Total a recibir:"}),e.jsx("span",{className:"text-green-700",children:y(o)})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-300",children:e.jsxs("div",{className:"flex items-start gap-2 text-xs text-gray-500",children:[e.jsx(Me,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{children:"Configuraciones actuales del sistema:"}),e.jsxs("ul",{className:"mt-1 space-y-1",children:[e.jsxs("li",{children:["â€¢ ComisiÃ³n plataforma: ",R(c)]}),u===1&&e.jsx("li",{children:"â€¢ EnvÃ­o un vendedor: 80.0%"}),u>1&&e.jsx("li",{children:"â€¢ EnvÃ­o mÃ¡ximo/vendedor: 50.0%"})]})]})]})})]}):e.jsxs("div",{className:`flex items-center gap-2 ${P}`,children:[e.jsx(ge,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-green-700",children:y(o)}),e.jsxs("div",{className:"text-xs text-gray-500",children:["(ComisiÃ³n: ",R(c),")"]})]})]})},_s=()=>{const{id:m}=Ye(),{user:t}=Ae(),[s,a]=d.useState(null),[o,c]=d.useState(!0),[u,S]=d.useState(null),[P,y]=d.useState(!1),[R,v]=d.useState(null),[A,g]=d.useState(!1),[h,f]=d.useState(null),[_,N]=d.useState(!1),O=new De,$=Y.getInstance();d.useEffect(()=>{L()},[m]);const T=d.useCallback(async()=>{if(console.log("ðŸ” loadItemsBreakdown ejecutÃ¡ndose con order:",s?.id,"sellerId:",s?.sellerId,"user.id:",t?.id),!s?.id){console.log("âŒ No se puede cargar breakdown - falta order.id:",{id:s?.id});return}const i=s?.sellerId||t?.id;console.log("ðŸ” effectiveSellerId calculado:",i),console.log("âœ… Iniciando carga de breakdown para orden:",s.id),N(!0);try{const p=await $.getOrderItemsBreakdown(s.id,"seller");f(p)}catch(p){console.error("âŒ ERROR DETALLADO al cargar breakdown para orden",s.id,":",p),console.error("âŒ URL del endpoint usado:",`/seller/orders/${s.id}`),console.error("âŒ Detalles del error:",p instanceof Error?p.message:p)}finally{N(!1)}},[s?.id,s?.sellerId,t?.id,$]);d.useEffect(()=>{console.log("ðŸ” useEffect para loadItemsBreakdown ejecutÃ¡ndose, order cambiÃ³:",s?.id),T()},[T]);const L=async()=>{if(m){c(!0);try{const i=await O.getOrderDetails(m);console.log("ðŸ›ï¸ Detalles de la orden del seller:",i),console.log("ðŸ” VERIFICAR: order.sellerId =",i?.sellerId),console.log("ðŸ” VERIFICAR: order.id =",i?.id),console.log("ðŸ” VERIFICAR: user.id del contexto =",t?.id),a(i)}catch(i){console.error("Error al cargar detalles de la orden:",i),S("No se pudieron cargar los detalles de la orden")}finally{c(!1)}}},b=async i=>{if(!(!s||!m)){y(!0);try{await O.updateOrderStatus(m,i),a({...s,status:i}),v("Estado de la orden actualizado correctamente"),setTimeout(()=>v(null),3e3)}catch(p){console.error("Error al actualizar estado:",p),S("No se pudo actualizar el estado de la orden")}finally{y(!1)}}},n=async i=>{if(!(!s||!m)){y(!0);try{await O.createShipping(m,i),g(!1),await L(),v("InformaciÃ³n de envÃ­o creada correctamente"),setTimeout(()=>v(null),3e3)}catch(p){console.error("Error al crear envÃ­o:",p),S("No se pudo crear la informaciÃ³n de envÃ­o")}finally{y(!1)}}};if(o)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Cargando detalles de la orden..."})]})});if(u||!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(de,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-4",children:u||"Orden no encontrada"}),e.jsx(J,{to:"/seller/orders",className:"text-primary-600 hover:text-primary-800 font-medium",children:"â† Volver a pedidos"})]})});const l=(()=>{if(!s.orderSummary||!s.items)return{totalQuantity:0,subtotalOriginal:0,subtotalFinal:0,platformCommission:0,shippingIncome:0,totalToReceive:0,sellerEarningsFromProducts:0};const i=s.orderSummary.total_quantity||0,p=s.orderSummary.total_seller_earnings_from_products||0,E=s.orderSummary.total_platform_commission||0,z=s.orderSummary.shipping_distribution?.seller_amount||0,U=p+E,X=p+z;return{totalQuantity:i,subtotalVendido:U,platformCommission:E,shippingIncome:z,totalToReceive:X,sellerEarningsFromProducts:p}})();return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(J,{to:"/seller/orders",className:"flex items-center text-gray-600 hover:text-gray-800 mr-4",children:[e.jsx(Fe,{className:"w-5 h-5 mr-1"}),"Volver a pedidos"]}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:["Pedido #",s.orderNumber]})]}),e.jsxs("div",{className:"flex space-x-3",children:[be(s.status,"shipped")&&e.jsxs("button",{onClick:()=>g(!0),disabled:P,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium disabled:opacity-50",children:[e.jsx(re,{className:"w-4 h-4 mr-2 inline"}),"Marcar como enviado"]}),be(s.status,"cancelled")&&e.jsxs("button",{onClick:()=>b("cancelled"),disabled:P,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium disabled:opacity-50",children:[e.jsx(de,{className:"w-4 h-4 mr-2 inline"}),"Cancelar pedido"]})]})]})})}),R&&e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-md",children:[e.jsx(Le,{className:"w-5 h-5 inline mr-2"}),R]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Estado del pedido"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"Estado:"}),e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${s.status==="completed"?"bg-green-100 text-green-800":s.status==="shipped"?"bg-blue-100 text-blue-800":s.status==="processing"?"bg-yellow-100 text-yellow-800":s.status==="cancelled"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:s.status==="pending"?"Pendiente":s.status==="processing"?"En proceso":s.status==="shipped"?"Enviado":s.status==="delivered"?"Entregado":s.status==="cancelled"?"Cancelado":s.status==="completed"?"Completado":s.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"Pago:"}),e.jsx("span",{className:`inline-block px-2 py-1 rounded-full text-xs font-medium ${s.paymentStatus==="completed"?"bg-green-100 text-green-800":s.paymentStatus==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.paymentStatus==="completed"?"Completado":s.paymentStatus==="pending"?"Pendiente":s.paymentStatus})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"MÃ©todo de pago:"}),e.jsx("p",{className:"text-gray-900",children:s.paymentMethod||"No especificado"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"Fecha:"}),e.jsx("p",{className:"text-gray-900",children:me(s.createdAt)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Cliente"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"Nombre:"}),e.jsx("p",{className:"text-gray-900",children:s.customerName||"No especificado"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"Email:"}),e.jsx("p",{className:"text-gray-900",children:s.customerEmail||"No especificado"})]}),s.shippingAddress&&e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"DirecciÃ³n de envÃ­o:"}),e.jsxs("p",{className:"text-gray-900",children:[s.shippingAddress.address,e.jsx("br",{}),s.shippingAddress.city,", ",s.shippingAddress.state,e.jsx("br",{}),s.shippingAddress.country]})]})]})]}),s.shippingData&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"InformaciÃ³n de envÃ­o"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"NÃºmero de seguimiento:"}),e.jsx("p",{className:"text-primary-600 font-medium",children:s.shippingData.tracking_number})]}),s.shippingData.shipping_company&&e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"Empresa de transporte:"}),e.jsx("p",{className:"text-gray-900",children:s.shippingData.shipping_company})]}),s.shippingData.estimated_delivery&&e.jsxs("div",{children:[e.jsx("span",{className:"block text-sm font-medium text-gray-600",children:"Entrega estimada:"}),e.jsx("p",{className:"text-gray-900",children:me(s.shippingData.estimated_delivery)})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(H,{className:"w-5 h-5 text-gray-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Productos de tu Tienda"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-500",children:["(",l.totalQuantity," ",l.totalQuantity===1?"producto":"productos",")"]})]}),e.jsx("div",{className:"space-y-4",children:s.items&&s.items.length>0?s.items.map((i,p)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:i.product_image?e.jsx("img",{src:i.product_image,alt:i.product_name,className:"w-16 h-16 object-cover rounded-lg border border-gray-200"}):e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx(H,{className:"w-8 h-8 text-gray-400"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-lg font-medium text-gray-900",children:i.product_name||"Producto"}),_?e.jsx("div",{className:"mt-3 bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Calculando ganancias..."})]})}):e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Cantidad a enviar:"}),e.jsx("span",{className:"text-xl font-bold text-primary-600",children:i.quantity||0})]})}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ganancia por este producto:"}),e.jsx("span",{className:"text-xl font-bold text-green-600",children:h?(()=>{const E=h.items.find(z=>z.product_id===i.productId);if(E){if(E.seller_net_earning_per_unit&&E.seller_net_earning_per_unit>0)return`$${(E.seller_net_earning_per_unit*i.quantity).toFixed(2)}`;if(h.summary?.seller_commission_info){const z=h.summary.seller_commission_info.platform_commission_rate/100;return`$${(E.final_price_per_unit*(1-z)*i.quantity).toFixed(2)}`}}return"$0.00"})():"$0.00"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["(",i.quantity," x $",h?(()=>{const E=h.items.find(z=>z.product_id===i.productId);if(E){if(E.seller_net_earning_per_unit&&E.seller_net_earning_per_unit>0)return E.seller_net_earning_per_unit.toFixed(2);if(h.summary?.seller_commission_info){const z=h.summary.seller_commission_info.platform_commission_rate/100;return(E.final_price_per_unit*(1-z)).toFixed(2)}}return"0.00"})():"0.00"," c/u)"]})]})]})]})]})},i.id||p)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay productos en esta orden"})}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"InformaciÃ³n del Vendedor:"})," Los precios mostrados son los finales que se usaron para calcular tu comisiÃ³n. Los descuentos ya estÃ¡n aplicados."]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(ze,{className:"w-5 h-5 text-gray-600 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Resumen de Venta"})]}),_?e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600"}),e.jsx("span",{className:"ml-2 text-sm text-gray-500",children:"Calculando resumen..."})]})}):h&&h.summary?.seller_commission_info?e.jsx(_e,{grossEarnings:h.summary.total_final_amount,platformCommission:h.summary.seller_commission_info.total_commission,netEarnings:h.summary.seller_commission_info.seller_earnings_from_products,shippingEarnings:h.summary.seller_commission_info.shipping_distribution?.seller_amount||0,totalEarnings:h.summary.seller_commission_info.seller_earnings_from_products+(h.summary.seller_commission_info.shipping_distribution?.seller_amount||0),commissionRate:h.summary.seller_commission_info.platform_commission_rate,sellerCount:1,showBreakdown:!0,className:"mb-4"}):e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Nota:"})," No se pudieron cargar los cÃ¡lculos centralizados. Usando datos del backend como respaldo."]}),e.jsx(_e,{grossEarnings:l.subtotalVendido||0,platformCommission:l.platformCommission||0,netEarnings:l.sellerEarningsFromProducts||0,shippingEarnings:l.shippingIncome||0,totalEarnings:l.totalToReceive||0,commissionRate:(l.platformCommission??0)>0&&(l.subtotalVendido??0)>0?(l.platformCommission??0)/(l.subtotalVendido??1)*100:10,sellerCount:1,showBreakdown:!0,className:"mt-2"})]}),e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Nota:"})," Los cupones de descuento NO afectan al seller (son asumidos por la tienda). Solo se aplican descuentos de seller y por volumen. El envÃ­o se reparte entre sellers."]})})]})]})]})}),e.jsx(Re,{orderId:m||"",orderNumber:s.orderNumber,isOpen:A,onClose:()=>g(!1),onSubmit:n,isLoading:P})]})},ks=Object.freeze(Object.defineProperty({__proto__:null,default:_s},Symbol.toStringTag,{value:"Module"})),js=()=>{const[m,t]=d.useState(!0),[s,a]=d.useState({start:"",end:""}),[o,c]=d.useState(null),[u,S]=d.useState("sales");d.useEffect(()=>{P()},[]);const P=()=>{t(!0),setTimeout(()=>{c({totalEarnings:12580.45,pendingPayments:1458.32,salesThisMonth:3450.8,salesGrowth:12.5,commissionsThisMonth:517.62,commissionsPercentage:15,netEarningsThisMonth:2933.18,earningsGrowth:8.2,paymentMethods:[{method:"Tarjeta de CrÃ©dito",amount:7548.27,percentage:60,color:"bg-blue-500"},{method:"Transferencia",amount:2516.09,percentage:20,color:"bg-green-500"},{method:"PayPal",amount:1887.07,percentage:15,color:"bg-indigo-500"},{method:"Otros",amount:629.02,percentage:5,color:"bg-gray-500"}],monthlySales:[{month:"Enero",sales:1850.5,commissions:277.58,net:1572.92},{month:"Febrero",sales:2105.3,commissions:315.8,net:1789.5},{month:"Marzo",sales:2300.75,commissions:345.11,net:1955.64},{month:"Abril",sales:2150.4,commissions:322.56,net:1827.84},{month:"Mayo",sales:2485.6,commissions:372.84,net:2112.76},{month:"Junio",sales:2890.25,commissions:433.54,net:2456.71},{month:"Julio",sales:3120.8,commissions:468.12,net:2652.68},{month:"Agosto",sales:3250.45,commissions:487.57,net:2762.88},{month:"Septiembre",sales:3125.3,commissions:468.8,net:2656.5},{month:"Octubre",sales:3450.8,commissions:517.62,net:2933.18},{month:"Noviembre",sales:0,commissions:0,net:0},{month:"Diciembre",sales:0,commissions:0,net:0}],categorySales:[{category:"ElectrÃ³nica",amount:4650.25,percentage:37,color:"bg-blue-500"},{category:"Accesorios",amount:3145.11,percentage:25,color:"bg-green-500"},{category:"Moda",amount:2516.09,percentage:20,color:"bg-yellow-500"},{category:"Hogar",amount:1258.05,percentage:10,color:"bg-red-500"},{category:"Otros",amount:1010.95,percentage:8,color:"bg-purple-500"}],pendingPaymentsList:[{id:"PAY-2023-001",date:"2023-11-05",amount:958.32,status:"processing"},{id:"PAY-2023-002",date:"2023-11-10",amount:500,status:"scheduled",estimatedArrival:"2023-11-15"}]}),t(!1)},800)},y=g=>{if(!g||g.length===0)return null;const h=g,f=Math.max(...h.map(_=>_.sales));return e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Ventas Mensuales"}),e.jsxs("div",{className:"mt-2 sm:mt-0 sm:ml-4 flex flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded-full mr-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ventas"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Comisiones"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-1"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Ganancias netas"})]})]})]}),e.jsx("div",{className:"h-64 w-full",children:e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:"w-12 h-full flex flex-col justify-between text-xs text-gray-500 pr-2",children:[e.jsx("span",{children:k(f)}),e.jsx("span",{children:k(f*.75)}),e.jsx("span",{children:k(f*.5)}),e.jsx("span",{children:k(f*.25)}),e.jsx("span",{children:k(0)})]}),e.jsxs("div",{className:"flex-1 h-full",children:[e.jsxs("div",{className:"h-full flex flex-col justify-between relative",children:[e.jsx("div",{className:"border-t border-gray-200absolute top-0 w-full"}),e.jsx("div",{className:"border-t border-gray-200absolute top-1/4 w-full"}),e.jsx("div",{className:"border-t border-gray-200absolute top-2/4 w-full"}),e.jsx("div",{className:"border-t border-gray-200absolute top-3/4 w-full"}),e.jsx("div",{className:"border-t border-gray-200absolute bottom-0 w-full"}),e.jsx("div",{className:"absolute inset-0 flex items-end",children:h.map((_,N)=>{const O=f>0?_.sales/f*100:0,$=f>0?_.commissions/f*100:0,T=f>0?_.net/f*100:0;return e.jsx("div",{className:"flex-1 flex justify-center h-full px-1",children:e.jsxs("div",{className:"w-full max-w-[30px] flex justify-between items-end h-full",children:[e.jsx("div",{className:"w-2 bg-blue-500 rounded-t relative group cursor-pointer",style:{height:`${O}%`,minHeight:O>0?"4px":"0"},children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap z-10",children:["Ventas: ",k(_.sales)]})}),e.jsx("div",{className:"w-2 bg-red-500 rounded-t relative group cursor-pointer",style:{height:`${$}%`,minHeight:$>0?"4px":"0"},children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap z-10",children:["Comisiones: ",k(_.commissions)]})}),e.jsx("div",{className:"w-2 bg-green-500 rounded-t relative group cursor-pointer",style:{height:`${T}%`,minHeight:T>0?"4px":"0"},children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap z-10",children:["Neto: ",k(_.net)]})})]})},N)})})]}),e.jsx("div",{className:"flex mt-2",children:h.map((_,N)=>e.jsx("div",{className:"flex-1 text-center",children:e.jsx("div",{className:"text-xs text-gray-500",children:_.month.substring(0,3)})},N))})]})]})})]})},R=g=>!g||g.length===0?null:e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Ventas por CategorÃ­a"}),e.jsxs("div",{className:"flex flex-col md:flex-row",children:[e.jsx("div",{className:"md:w-1/2 flex justify-center items-center",children:e.jsx("div",{className:"relative w-48 h-48 md:w-56 md:h-56",children:e.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full",children:[e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"#f3f4f6",className:""}),g.map((h,f)=>{const N=g.slice(0,f).reduce((z,U)=>z+U.percentage,0)/100*360,O=N+h.percentage/100*360,$=(N-90)*Math.PI/180,T=(O-90)*Math.PI/180,L=50+40*Math.cos($),b=50+40*Math.sin($),n=50+40*Math.cos(T),r=50+40*Math.sin(T),l=O-N<=180?"0":"1",i=["M 50 50",`L ${L} ${b}`,`A 40 40 0 ${l} 1 ${n} ${r}`,"Z"].join(" "),E={"bg-blue-500":"#3b82f6","bg-green-500":"#10b981","bg-yellow-500":"#f59e0b","bg-red-500":"#ef4444","bg-purple-500":"#8b5cf6","bg-indigo-500":"#6366f1","bg-pink-500":"#ec4899","bg-gray-500":"#6b7280"}[h.color]||"#6b7280";return e.jsxs("g",{className:"cursor-pointer",children:[e.jsx("path",{d:i,fill:E,className:"hover:opacity-80 transition-opacity"}),e.jsxs("title",{children:[h.category,": ",h.percentage,"% (",k(h.amount),")"]})]},f)})]})})}),e.jsx("div",{className:"md:w-1/2 mt-4 md:mt-0",children:e.jsx("div",{className:"space-y-3",children:g.map((h,f)=>e.jsxs("div",{className:"flex items-center group",children:[e.jsx("div",{className:`w-4 h-4 ${h.color} rounded-sm mr-2`}),e.jsx("span",{className:"text-sm text-gray-700 flex-1",children:h.category}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:k(h.amount)}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2 w-12 text-right",children:["(",h.percentage,"%)"]})]},f))})})]})]}),v={totalEarnings:12580.45,salesThisMonth:3450.8,salesGrowth:12.5,commissionsThisMonth:517.62,commissionsPercentage:15,netEarningsThisMonth:2933.18,earningsGrowth:8.2},A=[{title:"Total Ganancias",value:k(v.totalEarnings),change:0,icon:te,iconBgColor:"bg-green-50",iconColor:"text-green-600"},{title:"Ventas este mes",value:k(v.salesThisMonth),change:v.salesGrowth,text:`${Math.abs(v.salesGrowth)}% respecto al mes anterior`,icon:ge,iconBgColor:"bg-blue-50",iconColor:"text-blue-600"},{title:"Comisiones este mes",value:k(v.commissionsThisMonth),change:0,text:`${v.commissionsPercentage}% de comisiÃ³n`,icon:xe,iconBgColor:"bg-red-50",iconColor:"text-red-600"},{title:"Ganancias netas este mes",value:k(v.netEarningsThisMonth),change:v.earningsGrowth,text:`${Math.abs(v.earningsGrowth)}% respecto al mes anterior`,icon:Be,iconBgColor:"bg-indigo-50",iconColor:"text-indigo-600"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(te,{className:"w-6 h-6 mr-2"}),"Ganancias"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:P,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center",disabled:m,children:[e.jsx(we,{size:18,className:`mr-2 ${m?"animate-spin":""}`}),m?"Cargando...":"Actualizar"]}),e.jsxs("button",{onClick:()=>alert("Descargando reporte de ganancias..."),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors flex items-center",children:[e.jsx(Ve,{size:18,className:"mr-2"}),"Exportar"]})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-4",children:[e.jsx("div",{className:"text-sm text-gray-700 font-medium",children:"Rango de fechas:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ge,{className:"h-5 w-5 text-gray-500"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:s.start,onChange:g=>a(h=>({...h,start:g.target.value}))}),e.jsx("span",{className:"text-gray-500",children:"a"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:s.end,onChange:g=>a(h=>({...h,end:g.target.value}))})]}),e.jsx("button",{className:"px-3 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center",onClick:()=>console.log("Aplicando filtro de fechas:",s),children:"Aplicar"})]})}),m?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"})}):o?e.jsxs(e.Fragment,{children:[e.jsx(Pe,{cards:A}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"AnÃ¡lisis de Ventas"}),e.jsxs("div",{className:"flex border border-gray-300 rounded-lg overflow-hidden",children:[e.jsxs("button",{className:`px-3 py-1 text-sm ${u==="sales"?"bg-primary-600 text-white":"bg-white text-gray-700"}`,onClick:()=>S("sales"),children:[e.jsx(ue,{size:16,className:"inline mr-1"}),"Ventas mensuales"]}),e.jsxs("button",{className:`px-3 py-1 text-sm ${u==="categories"?"bg-primary-600 text-white":"bg-white text-gray-700"}`,onClick:()=>S("categories"),children:[e.jsx(He,{size:16,className:"inline mr-1"}),"CategorÃ­as"]})]})]}),u==="sales"?y(o.monthlySales):R(o.categorySales)]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 flex items-center",children:[e.jsx(xe,{className:"w-5 h-5 mr-2"}),"Pagos Pendientes"]}),e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2.5 py-0.5 rounded-full",children:k(o.pendingPayments)})]}),o.pendingPaymentsList.length>0?e.jsx("div",{className:"space-y-4",children:o.pendingPaymentsList.map((g,h)=>e.jsxs("div",{className:"border border-gray-200rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:g.id}),e.jsx("span",{className:`text-xs font-medium px-2.5 py-0.5 rounded-full ${g.status==="processing"?"bg-amber-100 text-amber-800":"bg-green-100 text-green-800"}`,children:g.status==="processing"?"En proceso":"Programado"})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-500 mb-2",children:[e.jsx("span",{children:"Fecha:"}),e.jsx("span",{children:g.date})]}),g.estimatedArrival&&e.jsxs("div",{className:"flex justify-between text-sm text-gray-500 mb-2",children:[e.jsx("span",{children:"Llegada estimada:"}),e.jsx("span",{children:g.estimatedArrival})]}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900",children:k(g.amount)}),e.jsxs("a",{href:"#",className:"text-primary-600 text-sm hover:underline flex items-center",children:["Detalles",e.jsx(Ke,{size:14,className:"ml-1"})]})]})]},h))}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No hay pagos pendientes"})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-md font-medium text-gray-900 mb-3",children:"MÃ©todos de Pago Recibidos"}),e.jsx("div",{className:"space-y-2",children:o.paymentMethods.map((g,h)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:g.method}),e.jsx("span",{className:"text-gray-900 font-medium",children:k(g.amount)})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-1",children:e.jsx("div",{className:`${g.color} h-2 rounded-full`,style:{width:`${g.percentage}%`}})})]},h))})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200aaborder-gray-700",children:e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Desglose de Ventas Mensuales"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Comisiones"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Neto"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.monthlySales.map((g,h)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:g.month}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:k(g.sales)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600",children:k(g.commissions)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600",children:k(g.net)})]},h))}),e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:"Total"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:k(o.monthlySales.reduce((g,h)=>g+h.sales,0))}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-red-600",children:k(o.monthlySales.reduce((g,h)=>g+h.commissions,0))}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600",children:k(o.monthlySales.reduce((g,h)=>g+h.net,0))})]})})]})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500",children:"No se pudieron cargar los datos de ganancias."}),e.jsx("button",{onClick:P,className:"mt-4 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Reintentar"})]})]})},Os=Object.freeze(Object.defineProperty({__proto__:null,default:js},Symbol.toStringTag,{value:"Module"}));export{Ie as A,es as L,Y as O,ls as P,is as R,Re as S,Ps as a,ds as b,fs as c,bs as d,Cs as e,me as f,As as g,Ds as h,Is as i,Rs as j,ks as k,Os as l,Ae as u};
//# sourceMappingURL=seller-chunk-6swISJwY.js.map
