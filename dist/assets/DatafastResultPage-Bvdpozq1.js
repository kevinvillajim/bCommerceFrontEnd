import{d as y,o as N,r as i,j as e,k as h}from"./index-DmNDOrWy.js";import{D as w}from"./DatafastService-mqZFUM13.js";import{u as k}from"./useCart-DylEmA2w.js";import{f as C}from"./formatCurrency-CXuiUHwQ.js";import"./errorHandler-ugMJT1nb.js";const M=()=>{const s=y(),[c]=N(),{clearCart:f,showNotification:m}=k(),[g,p]=i.useState(!0),[o,j]=i.useState(null),[x,v]=i.useState(null),[u]=i.useState(5),b=new w;return i.useEffect(()=>{(async()=>{try{const r=c.get("resourcePath");if(!r)throw new Error("No se encontró resourcePath en la respuesta de Datafast");console.log("Procesando resultado de Datafast:",{resourcePath:r,allParams:Object.fromEntries(c.entries())});let t=localStorage.getItem("datafast_transaction_id");if(!t){const l=r.match(/\/checkouts\/([^\/]+)/),n=l?l[1]:Date.now().toString();t=`ORDER_${Date.now()}_${n}`,console.warn("No se encontró transaction_id en localStorage, usando:",t)}console.log("Verificando pago con:",{resourcePath:r,transactionId:t});const a=await b.verifyPayment({resource_path:r,transaction_id:t});if(console.log("Respuesta de verificación:",a),a.success&&a.data)j({success:!0,data:a.data,message:"Pago procesado exitosamente"}),localStorage.removeItem("datafast_transaction_id"),setTimeout(()=>{f(),m(h.SUCCESS,"¡Pago procesado exitosamente con Datafast!")},100),setTimeout(()=>{s("/orders")},5e3);else{const l=a.message||"El pago no fue completado",n=a.result_code;console.warn("Pago no exitoso:",{message:l,resultCode:n,fullResponse:a});let d=l;throw n==="000.200.100"?d="El checkout fue creado pero el pago no se completó. Por favor, intente nuevamente.":n&&n.startsWith("800")&&(d="El pago fue rechazado por el banco. Verifique sus datos e intente nuevamente."),new Error(d)}}catch(r){console.error("Error al procesar resultado de Datafast:",r);const t=r instanceof Error?r.message:"Error desconocido al procesar el pago";v(t),setTimeout(()=>{m(h.ERROR,t)},100),setTimeout(()=>{s("/cart")},8e3)}finally{p(!1)}})()},[c,s]),g?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Procesando pago..."}),e.jsx("p",{className:"text-gray-600",children:"Estamos verificando tu pago con Datafast. Por favor espera."}),e.jsx("div",{className:"mt-4 text-sm text-gray-500",children:e.jsx("p",{children:"Este proceso puede tomar unos segundos."})})]})})}):x?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Error en el pago"}),e.jsx("p",{className:"text-gray-600 mb-6",children:x}),e.jsx("div",{className:"text-sm text-gray-500 mb-6",children:e.jsxs("p",{children:["Serás redirigido al carrito en ",u," segundos..."]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:()=>s("/cart"),className:"flex-1 bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-md transition-colors",children:"Volver al carrito"}),e.jsx("button",{onClick:()=>s("/"),className:"flex-1 border border-gray-300 text-gray-700 hover:bg-gray-50 font-medium py-2 px-4 rounded-md transition-colors",children:"Ir a inicio"})]})]})})}):o&&o.success&&o.data?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-lg w-full mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"¡Pago exitoso!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Tu pago ha sido procesado correctamente con Datafast."}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-6 mb-6 text-left",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4 text-center",children:"Detalles del pedido"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Número de orden:"}),e.jsx("span",{className:"font-medium text-gray-800",children:o.data.order_number})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"ID de pago:"}),e.jsx("span",{className:"font-medium text-gray-800",children:o.data.payment_id})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Total pagado:"}),e.jsx("span",{className:"font-bold text-lg text-primary-600",children:C(o.data.total)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Estado del pago:"}),e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Completado"]})]})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-500 mt-0.5 mr-2 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsx("p",{className:"font-medium mb-1",children:"¿Qué sigue?"}),e.jsxs("ul",{className:"text-xs space-y-1",children:[e.jsx("li",{children:"• Recibirás un correo de confirmación"}),e.jsx("li",{children:"• Procesaremos tu pedido en las próximas 24 horas"}),e.jsx("li",{children:"• Te notificaremos cuando tu pedido sea enviado"})]})]})]})}),e.jsx("div",{className:"text-sm text-gray-500 mb-6",children:e.jsxs("p",{children:["Serás redirigido a tus pedidos en"," ",e.jsx("span",{className:"font-medium text-primary-600",children:u})," ","segundos..."]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:()=>s("/orders"),className:"flex-1 bg-primary-600 hover:bg-primary-700 text-white font-medium py-3 px-4 rounded-md transition-colors flex items-center justify-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Ver mis pedidos"]}),e.jsxs("button",{onClick:()=>s("/"),className:"flex-1 border border-gray-300 text-gray-700 hover:bg-gray-50 font-medium py-3 px-4 rounded-md transition-colors flex items-center justify-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),"Ir a inicio"]}),e.jsxs("button",{onClick:()=>s("/products"),className:"flex-1 border border-primary-600 text-primary-600 hover:bg-primary-50 font-medium py-3 px-4 rounded-md transition-colors flex items-center justify-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),"Seguir comprando"]})]})]})})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Estado desconocido"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"No se pudo determinar el estado del pago."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("button",{onClick:()=>s("/cart"),className:"flex-1 bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-md transition-colors",children:"Volver al carrito"}),e.jsx("button",{onClick:()=>s("/"),className:"flex-1 border border-gray-300 text-gray-700 hover:bg-gray-50 font-medium py-2 px-4 rounded-md transition-colors",children:"Ir a inicio"})]})]})})})};export{M as default};
//# sourceMappingURL=DatafastResultPage-Bvdpozq1.js.map
