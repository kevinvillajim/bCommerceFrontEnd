import{l as u,t as d,r as l,m as g,n as h}from"./index-DmNDOrWy.js";class P{async getCategories(t){try{console.log("üì§ CategoryService: Obteniendo categor√≠as:",t);const o=await u.get(d.CATEGORIES.LIST,t);return console.log("üì• CategoryService: Respuesta del servidor:",o),o}catch(o){return console.error("‚ùå Error en CategoryService.getCategories:",o),null}}async getCategoryById(t){try{console.log(`üì§ CategoryService: Obteniendo categor√≠a ${t}`);const o=await u.get(d.CATEGORIES.DETAILS(t));return console.log("‚úÖ CategoryService: Categor√≠a obtenida:",o),o}catch(o){return console.error("‚ùå Error en CategoryService.getCategoryById:",o),null}}async getCategoryBySlug(t){try{console.log(`üì§ CategoryService: Obteniendo categor√≠a por slug ${t}`);const o=await u.get(d.CATEGORIES.SLUG(t));return console.log("‚úÖ CategoryService: Categor√≠a obtenida por slug:",o),o}catch(o){return console.error("‚ùå Error en CategoryService.getCategoryBySlug:",o),null}}async getMainCategories(t=!0){try{console.log("üì§ CategoryService: Obteniendo categor√≠as principales");const o=await u.get(d.CATEGORIES.MAIN,{with_counts:t});return console.log("‚úÖ CategoryService: Categor√≠as principales obtenidas:",o),o||[]}catch(o){return console.error("‚ùå Error en CategoryService.getMainCategories:",o),[]}}async getFeaturedCategories(t=8){try{console.log("üì§ CategoryService: Obteniendo categor√≠as destacadas");const o=await u.get(d.CATEGORIES.FEATURED,{limit:t});return console.log("‚úÖ CategoryService: Categor√≠as destacadas obtenidas:",o),o||[]}catch(o){return console.error("‚ùå Error en CategoryService.getFeaturedCategories:",o),[]}}async getSubcategories(t){try{console.log(`üì§ CategoryService: Obteniendo subcategor√≠as de ${t}`);const o=await u.get(d.CATEGORIES.SUBCATEGORIES(t));return console.log("‚úÖ CategoryService: Subcategor√≠as obtenidas:",o),o||[]}catch(o){return console.error("‚ùå Error en CategoryService.getSubcategories:",o),[]}}async getCategoryProducts(t,o){try{console.log(`üì§ CategoryService: Obteniendo productos de categor√≠a ${t}`);const n=await u.get(d.CATEGORIES.PRODUCTS(t),o);return console.log("‚úÖ CategoryService: Productos de categor√≠a obtenidos:",n),n}catch(n){return console.error("‚ùå Error en CategoryService.getCategoryProducts:",n),null}}}const p=new P,G=()=>{const[b,t]=l.useState(!1),[o,n]=l.useState(null),[_,y]=l.useState([]),[v,f]=l.useState([]),[I,C]=l.useState([]),[A,S]=l.useState(null),[m,O]=l.useState(!1),i=l.useCallback(e=>!e||typeof e!="object"?(console.error("Categor√≠a inv√°lida para adaptar:",e),{}):{id:e.id,name:e.name||"",slug:e.slug||"",description:e.description||"",parent_id:e.parent_id,icon:e.icon,image:e.image,order:e.order,is_active:!!(e.is_active??!0),featured:!!(e.featured??!1),created_at:e.created_at,updated_at:e.updated_at,subcategories:Array.isArray(e.subcategories)?e.subcategories.map(c=>i(c)):void 0,product_count:e.product_count||0,full_path:e.full_path,has_children:!!e.has_children,url:e.url,parent:e.parent?i(e.parent):void 0,image_url:e.image_url,icon_url:e.icon_url},[]);l.useEffect(()=>{if(!m){const e=g.getItem("categories_all");e&&e.data&&y(e.data||[]);const c=g.getItem("categories_main");c&&f(c);const s=g.getItem("categories_featured");s&&C(s),O(!0)}},[m]);const R=l.useCallback(async(e=!0,c=!1)=>{t(!0),n(null);const s=`categories_all_${e?"with_counts":"no_counts"}`;try{if(!c){const a=g.getItem(s);if(a&&a.data)return console.log("Usando categor√≠as en cach√©"),y(a.data||[]),t(!1),a}console.log("Obteniendo categor√≠as desde API con withCounts:",e);const r=await p.getCategories({with_counts:e,is_active:!0});if(console.log("Respuesta de categor√≠as desde API:",r),r&&r.data&&Array.isArray(r.data)){const a=r.data.map(i),E={data:a,meta:r.meta||{total:a.length}};return g.setItem(s,E,h.cache.categoryCacheTime),y(a),E}else return console.warn("Respuesta de categor√≠as no tiene el formato esperado:",r),y([]),{data:[],meta:{total:0}}}catch(r){const a=r instanceof Error?r.message:"Error al obtener categor√≠as";return n(a),console.error("Error al obtener categor√≠as:",r),y([]),{data:[],meta:{total:0}}}finally{t(!1)}},[i]),w=l.useCallback(async(e=!0,c=!1)=>{t(!0),n(null);const s=`categories_main_${e?"with_counts":"no_counts"}`;try{if(!c){const a=g.getItem(s);if(a)return console.log("Usando categor√≠as principales en cach√©"),f(a),t(!1),a}console.log("Obteniendo categor√≠as principales desde API");const r=await p.getMainCategories(e);if(console.log("Respuesta de categor√≠as principales desde API:",r),r&&Array.isArray(r)){const a=r.map(i);return g.setItem(s,a,h.cache.categoryCacheTime),f(a),a}else return console.warn("Respuesta de categor√≠as principales no tiene el formato esperado:",r),f([]),[]}catch(r){const a=r instanceof Error?r.message:"Error al obtener categor√≠as principales";return n(a),console.error("Error al obtener categor√≠as principales:",r),f([]),[]}finally{t(!1)}},[i]),T=l.useCallback(async(e=8,c=!1)=>{t(!0),n(null);const s=`categories_featured_${e}`;try{if(!c){const a=g.getItem(s);if(a)return console.log("Usando categor√≠as destacadas en cach√©"),C(a),t(!1),a}console.log("Obteniendo categor√≠as destacadas desde API");const r=await p.getFeaturedCategories(e);if(console.log("Respuesta de categor√≠as destacadas desde API:",r),r&&Array.isArray(r)){const a=r.map(i);return g.setItem(s,a,h.cache.categoryCacheTime),C(a),a}else return console.warn("Respuesta de categor√≠as destacadas no tiene el formato esperado:",r),C([]),[]}catch(r){const a=r instanceof Error?r.message:"Error al obtener categor√≠as destacadas";return n(a),console.error("Error al obtener categor√≠as destacadas:",r),C([]),[]}finally{t(!1)}},[i]),$=l.useCallback(async e=>{t(!0),n(null);const c=`categories_subcats_${e}`;try{const s=g.getItem(c);if(s)return console.log(`Usando subcategor√≠as en cach√© para categor√≠a ${e}`),t(!1),s;const r=await p.getSubcategories(e);if(console.log(`Respuesta de subcategor√≠as para categor√≠a ${e}:`,r),r&&r.length>0){const a=r.map(i);return g.setItem(c,a,h.cache.categoryCacheTime),a}return[]}catch(s){const r=s instanceof Error?s.message:"Error al obtener subcategor√≠as";return n(r),console.error("Error al obtener subcategor√≠as:",s),[]}finally{t(!1)}},[i]),M=l.useCallback(async e=>{t(!0),n(null);const c=`category_slug_${e}`;try{const s=g.getItem(c);if(s)return console.log(`Usando categor√≠a en cach√© para slug ${e}`),S(s),t(!1),s;const r=await p.getCategoryBySlug(e);if(console.log(`Respuesta de categor√≠a con slug ${e}:`,r),r){const a=i(r);return g.setItem(c,a,h.cache.categoryCacheTime),S(a),a}return S(null),null}catch(s){const r=s instanceof Error?s.message:"Error al obtener categor√≠a por slug";return n(r),console.error("Error al obtener categor√≠a por slug:",s),S(null),null}finally{t(!1)}},[i]),D=l.useCallback(()=>{const c=Object.keys(localStorage).filter(s=>s.startsWith("category_")||s.startsWith("categories_"));c.forEach(s=>{g.removeItem(s)}),console.log(`${c.length} claves de cach√© de categor√≠as eliminadas`)},[]);return{loading:b,error:o,categories:_,mainCategories:v,featuredCategories:I,categoryDetail:A,fetchCategories:R,fetchMainCategories:w,fetchFeaturedCategories:T,fetchSubcategories:$,fetchCategoryBySlug:M,clearCategoryCache:D}};export{G as u};
//# sourceMappingURL=useCategories-B5xz5QTT.js.map
