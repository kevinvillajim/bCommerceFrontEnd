import{N as S,a as O,e as z,T as I,j as e,R as N,F as Ee,K as Re,h as L,l as M,X as te,ap as Se,ao as ke,aB as se,aa as ae,n as re,g as De,E as Ue,t as Ae,G as oe,H as k}from"./ui-vendor-DEBjJ4HS.js";import{u as Pe,r as n,L as ne}from"./react-vendor-Cy458wKG.js";import{c as v,b as ce,g as Fe,T as Te,N as x}from"./admin-chunk-bhOJ3jtA.js";import{S as Oe}from"./StatCardList-BC4AxJgi.js";class f{async getAllInvoices(o={}){try{const r=o,m=await v.get("/admin/invoices",r),D=m?.data||[],U=m?.meta||{current_page:1,last_page:1,per_page:20,total:0,from:0,to:0};return{status:"success",message:"Facturas obtenidas exitosamente",data:{data:D,meta:U,links:{first:"",last:"",prev:null,next:null}}}}catch(r){throw console.error("Error en HttpInvoiceRepository.getAllInvoices:",r),r}}async getInvoiceById(o){try{return(await v.get(`/admin/invoices/${o}`)).data}catch(r){throw console.error("Error en HttpInvoiceRepository.getInvoiceById:",r),r}}async retryInvoice(o){try{return(await v.post(`/admin/invoices/${o}/retry`,{})).data}catch(r){throw console.error("Error en HttpInvoiceRepository.retryInvoice:",r),r}}async checkInvoiceStatus(o){try{return(await v.get(`/admin/invoices/${o}/check-status`)).data}catch(r){throw console.error("Error en HttpInvoiceRepository.checkInvoiceStatus:",r),r}}async getInvoiceStats(){try{return(await v.get("/admin/invoices/stats/overview")).data}catch(o){throw console.error("Error en HttpInvoiceRepository.getInvoiceStats:",o),o}}async updateInvoice(o,r){try{return(await v.put(`/admin/invoices/${o}`,r)).data}catch(m){throw console.error("Error en HttpInvoiceRepository.updateInvoice:",m),m}}async downloadInvoicePdf(o){try{const r=await fetch(`${ce.api.baseUrl}/admin/invoices/${o}/download-pdf`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem(ce.storage.authTokenKey)}`,Accept:"application/pdf"}});if(!r.ok)throw new Error(`Error ${r.status}: ${r.statusText}`);return await r.blob()}catch(r){throw console.error("Error en HttpInvoiceRepository.downloadInvoicePdf:",r),r}}}class ze{constructor(o){this.invoiceRepository=o}async execute(o={}){try{return(await this.invoiceRepository.getAllInvoices(o)).data}catch(r){throw console.error("Error en GetAllInvoicesUseCase:",r),r}}}class Le{constructor(o){this.invoiceRepository=o}async execute(o){try{return await this.invoiceRepository.getInvoiceById(o)}catch(r){throw console.error("Error en GetInvoiceByIdUseCase:",r),r}}}class Me{constructor(o){this.invoiceRepository=o}async execute(o){try{return await this.invoiceRepository.retryInvoice(o)}catch(r){throw console.error("Error en RetryInvoiceUseCase:",r),r}}}class Ge{constructor(o){this.invoiceRepository=o}async execute(o){try{return await this.invoiceRepository.checkInvoiceStatus(o)}catch(r){throw console.error("Error en CheckInvoiceStatusUseCase:",r),r}}}class He{constructor(o){this.invoiceRepository=o}async execute(){try{return await this.invoiceRepository.getInvoiceStats()}catch(o){throw console.error("Error en GetInvoiceStatsUseCase:",o),o}}}class $e{constructor(o){this.invoiceRepository=o}async execute(o,r){try{return await this.invoiceRepository.updateInvoice(o,r)}catch(m){throw console.error("Error en UpdateInvoiceUseCase:",m),m}}}const Be=["DRAFT","SENT_TO_SRI","PENDING","PROCESSING","RECEIVED","AUTHORIZED","REJECTED","NOT_AUTHORIZED","RETURNED","SRI_ERROR","FAILED","DEFINITIVELY_FAILED"],Je=()=>{const{showToast:c}=Fe(),o=Pe(),[r]=n.useState(()=>{const t=new f;return new ze(t)}),[m]=n.useState(()=>{const t=new f;return new Le(t)}),[D]=n.useState(()=>{const t=new f;return new Me(t)}),[U]=n.useState(()=>{const t=new f;return new Ge(t)}),[ie]=n.useState(()=>{const t=new f;return new He(t)}),[le]=n.useState(()=>{const t=new f;return new $e(t)}),[de,G]=n.useState([]),[h,me]=n.useState(null),[A,H]=n.useState(!0),[$,B]=n.useState(null),[g,xe]=n.useState({page:1,per_page:20}),[E,ue]=n.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:20}),[a,V]=n.useState(null),[he,P]=n.useState(!1),[b,w]=n.useState(!1),[pe,Z]=n.useState(!1),[l,X]=n.useState(null),[i,y]=n.useState({}),[_,p]=n.useState({});n.useEffect(()=>{R()},[g]);const R=async()=>{try{H(!0),B(null);const[t,s]=await Promise.all([r.execute(g),ie.execute()]),d=Array.isArray(t.data)?t.data:[];G(d),ue({currentPage:t.meta?.current_page||1,totalPages:t.meta?.last_page||1,totalItems:t.meta?.total||0,itemsPerPage:t.meta?.per_page||20}),s&&me(s)}catch(t){console.error("Error cargando facturas:",t),B(t instanceof Error?t.message:"Error al cargar los datos"),G([])}finally{H(!1)}},j=(t,s)=>{xe(d=>({...d,[t]:s,page:t==="page"?s:1}))},ge=t=>{j("page",t)},ye=async t=>{try{P(!0);const s=await m.execute(t.id);V(s)}catch(s){console.error("Error cargando detalles:",s),c(x.ERROR,"Error al cargar los detalles de la factura"),P(!1)}},q=()=>{P(!1),V(null),w(!1)},fe=async t=>{try{p(s=>({...s,[t]:!0})),await D.execute(t),c(x.SUCCESS,"Reintento de factura iniciado correctamente"),R()}catch(s){const d=s?.response?.data?.error||"Error al reintentar la factura";c(x.ERROR,d)}finally{p(s=>({...s,[t]:!1}))}},je=async t=>{try{p(d=>({...d,[t]:!0}));const s=await U.execute(t);c(x.INFO,`Estado actual: ${s.current_status}
Estado SRI: ${JSON.stringify(s.sri_status,null,2)}`)}catch(s){console.error("Error consultando estado:",s),c(x.ERROR,s instanceof Error?s.message:"Error al consultar el estado")}finally{p(s=>({...s,[t]:!1}))}},J=t=>{if(!t)return"N/A";const s=new Date(t);return new Intl.DateTimeFormat("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(s)},u=t=>new Intl.NumberFormat("es-EC",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(t),F=async(t,s)=>{if(s==="xml"){c(x.INFO,"Funcionalidad de descarga XML en desarrollo"),b&&w(!1);return}try{p(Ie=>({...Ie,[t]:!0}));const Ce=await new f().downloadInvoicePdf(t),ee=window.URL.createObjectURL(Ce),C=document.createElement("a");C.href=ee,C.download=`factura_${t}.pdf`,document.body.appendChild(C),C.click(),document.body.removeChild(C),window.URL.revokeObjectURL(ee),c(x.SUCCESS,"PDF descargado correctamente")}catch(d){console.error("Error descargando PDF:",d),c(x.ERROR,d instanceof Error?d.message:"Error al descargar el PDF")}finally{p(d=>({...d,[t]:!1})),b&&w(!1)}},Ne=t=>{c(x.INFO,"Funcionalidad de envío por email en desarrollo"),b&&w(!1)},K=t=>{o("/admin/credit-notes",{state:{createFromInvoice:!0,invoiceData:{id:t.id,invoice_number:t.invoice_number,customer:t.customer,total_amount:t.total_amount,subtotal:t.subtotal,tax_amount:t.tax_amount}}})},ve=t=>{X(t),y({customer_name:t.customer?.name||"",customer_identification:t.customer?.identification||"",customer_email:t.customer?.email||"",customer_address:t.customer?.address||"",customer_phone:t.customer?.phone||""}),Z(!0)},T=()=>{Z(!1),X(null),y({})},be=async()=>{if(l)try{p(s=>({...s,[l.id]:!0}));const t={};if(i.customer_name&&i.customer_name!==l.customer?.name&&(t.customer_name=i.customer_name),i.customer_identification&&i.customer_identification!==l.customer?.identification&&(t.customer_identification=i.customer_identification),i.customer_email!==l.customer?.email&&(t.customer_email=i.customer_email||void 0),i.customer_address&&i.customer_address!==l.customer?.address&&(t.customer_address=i.customer_address),i.customer_phone!==l.customer?.phone&&(t.customer_phone=i.customer_phone||void 0),Object.keys(t).length===0){c(x.WARNING,"No se detectaron cambios para guardar");return}await le.execute(l.id,t),c(x.SUCCESS,"Factura actualizada correctamente"),T(),R()}catch(t){console.error("Error actualizando factura:",t),c(x.ERROR,t instanceof Error?t.message:"Error al actualizar la factura")}finally{p(t=>({...t,[l.id]:!1}))}},we=[{key:"invoice",header:"Factura",sortable:!0,render:t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(S,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.invoice_number}),e.jsx("div",{className:"text-xs text-gray-500",children:J(t.created_at)})]})]})},{key:"customer",header:"Cliente",sortable:!0,render:t=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden",children:e.jsx(L,{className:"h-4 w-4 text-gray-500"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.customer?.name||"N/A"}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),t.customer?.identification||"N/A"]})]})]})},{key:"order",header:"Pedido",sortable:!0,render:t=>e.jsxs("div",{children:[t.order?e.jsx(ne,{to:`/admin/orders/${t.order.id}`,className:"text-sm font-medium text-primary-600 hover:text-primary-700",children:t.order.order_number}):e.jsx("span",{className:"text-sm text-gray-500",children:"N/A"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[t.items_count," items"]})]})},{key:"amount",header:"Monto",sortable:!0,render:t=>e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[u(t.total_amount),e.jsxs("div",{className:"text-xs text-gray-500",children:["Subtotal: ",u(t.subtotal)]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["IVA: ",u(t.tax_amount)]})]})},{key:"status",header:"Estado",sortable:!0,render:t=>e.jsxs("div",{children:[e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:Y(t.status_color),color:W(t.status_color)},children:[Q(t.status),t.status_label]}),t.retry_count>0&&e.jsxs("div",{className:"text-xs text-orange-600 mt-1",children:["Reintentos: ",t.retry_count]})]})},{key:"actions",header:"Acciones",render:t=>{const s=_[t.id];return e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{onClick:()=>ye(t),className:"p-1 text-blue-600 hover:bg-blue-100 rounded-md",title:"Ver detalles",children:e.jsx(Ue,{size:18})}),t.status!=="AUTHORIZED"&&e.jsx("button",{onClick:()=>ve(t),disabled:s,className:"p-1 text-green-600 hover:bg-green-100 rounded-md disabled:opacity-50",title:"Editar datos de cliente",children:e.jsx(Ae,{size:18})}),t.status==="FAILED"&&t.retry_count<12&&e.jsx("button",{onClick:()=>fe(t.id),disabled:s,className:"p-1 text-orange-600 hover:bg-orange-100 rounded-md disabled:opacity-50",title:"Reintentar envío",children:s?e.jsx(N,{size:18,className:"animate-spin"}):e.jsx(oe,{size:18})}),t.sri_access_key&&e.jsx("button",{onClick:()=>je(t.id),disabled:s,className:"p-1 text-purple-600 hover:bg-purple-100 rounded-md disabled:opacity-50",title:"Consultar estado SRI",children:s?e.jsx(N,{size:18,className:"animate-spin"}):e.jsx(N,{size:18})}),e.jsx("button",{onClick:()=>F(t.id,"pdf"),className:"p-1 text-green-600 hover:bg-green-100 rounded-md",title:"Descargar PDF",children:e.jsx(ae,{size:18})}),t.status==="AUTHORIZED"&&e.jsx("button",{onClick:()=>K(t),className:"p-1 text-indigo-600 hover:bg-indigo-100 rounded-md",title:"Crear nota de crédito",children:e.jsx(se,{size:18})})]})}}],Y=t=>{const s={gray:"#f3f4f6",blue:"#dbeafe",yellow:"#fef3c7",indigo:"#e0e7ff",green:"#d1fae5",red:"#fee2e2",orange:"#fed7aa"};return s[t]||s.gray},W=t=>{const s={gray:"#374151",blue:"#1e40af",yellow:"#92400e",indigo:"#3730a3",green:"#059669",red:"#dc2626",orange:"#ea580c"};return s[t]||s.gray},Q=t=>({DRAFT:e.jsx(z,{className:"w-3 h-3 mr-1"}),SENT_TO_SRI:e.jsx(re,{className:"w-3 h-3 mr-1"}),PENDING:e.jsx(z,{className:"w-3 h-3 mr-1"}),PROCESSING:e.jsx(N,{className:"w-3 h-3 mr-1 animate-spin"}),RECEIVED:e.jsx(O,{className:"w-3 h-3 mr-1"}),AUTHORIZED:e.jsx(O,{className:"w-3 h-3 mr-1"}),REJECTED:e.jsx(k,{className:"w-3 h-3 mr-1"}),NOT_AUTHORIZED:e.jsx(k,{className:"w-3 h-3 mr-1"}),RETURNED:e.jsx(oe,{className:"w-3 h-3 mr-1"}),SRI_ERROR:e.jsx(I,{className:"w-3 h-3 mr-1"}),FAILED:e.jsx(k,{className:"w-3 h-3 mr-1"}),DEFINITIVELY_FAILED:e.jsx(k,{className:"w-3 h-3 mr-1"})})[t]||e.jsx(I,{className:"w-3 h-3 mr-1"}),_e=h?[{title:"Total",value:h.sri_stats.total_invoices,description:"Facturas",icon:S,bgColor:"bg-blue-50/20",textColor:"text-blue-800",valueColor:"text-blue-900",descriptionColor:"text-blue-700",iconColor:"text-blue-600"},{title:"Autorizadas",value:h.sri_stats.authorized,description:`${h.sri_stats.success_rate}% éxito`,icon:O,bgColor:"bg-green-50/20",textColor:"text-green-800",valueColor:"text-green-900",descriptionColor:"text-green-700",iconColor:"text-green-600"},{title:"Pendientes",value:h.sri_stats.pending,description:"En proceso",icon:z,bgColor:"bg-yellow-50",textColor:"text-yellow-800",valueColor:"text-yellow-900",descriptionColor:"text-yellow-700",iconColor:"text-yellow-600"},{title:"Fallidas",value:h.sri_stats.failed+h.sri_stats.definitively_failed,description:`${h.additional_stats.pending_retries} pueden reintentarse`,icon:I,bgColor:"bg-red-50/20",textColor:"text-red-800",valueColor:"text-red-900",descriptionColor:"text-red-700",iconColor:"text-red-600"}]:[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestión de Facturas SRI"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs("button",{onClick:R,disabled:A,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50",children:[e.jsx(N,{size:18,className:`inline mr-2 ${A?"animate-spin":""}`}),"Actualizar"]})})]}),$&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(I,{className:"h-5 w-5 text-red-400 mr-3"}),e.jsx("p",{className:"text-red-800",children:$})]})}),e.jsx(Oe,{items:_e}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-gray-500"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:g.status||"all",onChange:t=>j("status",t.target.value==="all"?void 0:t.target.value),children:[e.jsx("option",{value:"all",children:"Todos los Estados"}),Be.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Re,{className:"h-5 w-5 text-gray-500"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:g.start_date||"",onChange:t=>j("start_date",t.target.value||void 0),placeholder:"Desde"}),e.jsx("input",{type:"date",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:g.end_date||"",onChange:t=>j("end_date",t.target.value||void 0),placeholder:"Hasta"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{className:"h-5 w-5 text-gray-500"}),e.jsx("input",{type:"text",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:g.customer_name||"",onChange:t=>j("customer_name",t.target.value||void 0),placeholder:"Nombre cliente"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-5 w-5 text-gray-500"}),e.jsx("input",{type:"text",className:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-500",value:g.customer_identification||"",onChange:t=>j("customer_identification",t.target.value||void 0),placeholder:"Cédula/RUC"})]})]})}),e.jsx(Te,{data:de,columns:we,searchFields:["invoice_number","customer.name","customer.identification"],loading:A,emptyMessage:"No se encontraron facturas",pagination:{currentPage:E.currentPage,totalPages:E.totalPages,totalItems:E.totalItems,itemsPerPage:E.itemsPerPage,onPageChange:ge}}),pe&&l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Editar Factura ",l.invoice_number]}),e.jsx("button",{onClick:T,className:"text-gray-400 hover:text-gray-500",disabled:_[l.id],children:e.jsx(te,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del cliente"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:i.customer_name||"",onChange:t=>y(s=>({...s,customer_name:t.target.value})),placeholder:"Nombre completo del cliente"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cédula/RUC"}),e.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:i.customer_identification||"",onChange:t=>y(s=>({...s,customer_identification:t.target.value})),placeholder:"Cédula (10 dígitos) o RUC (13 dígitos)",maxLength:13}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Cédula: 10 dígitos | RUC: 13 dígitos terminado en 001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email (opcional)"}),e.jsx("input",{type:"email",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:i.customer_email||"",onChange:t=>y(s=>({...s,customer_email:t.target.value})),placeholder:"email@ejemplo.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dirección"}),e.jsx("textarea",{className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",rows:3,value:i.customer_address||"",onChange:t=>y(s=>({...s,customer_address:t.target.value})),placeholder:"Dirección completa del cliente"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teléfono (opcional)"}),e.jsx("input",{type:"tel",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",value:i.customer_phone||"",onChange:t=>y(s=>({...s,customer_phone:t.target.value})),placeholder:"0999999999"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-gray-200",children:[e.jsx("button",{onClick:T,disabled:_[l.id],className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:be,disabled:_[l.id],className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 flex items-center",children:_[l.id]?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-4 w-4 mr-2 animate-spin"}),"Guardando..."]}):"Guardar Cambios"})]})]})]})}),he&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Detalle de Factura ",a.invoice_number]}),e.jsx("button",{onClick:q,className:"text-gray-400 hover:text-gray-500",children:e.jsx(te,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Información General"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Número:"}),e.jsx("span",{className:"font-medium text-gray-900",children:a.invoice_number})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Fecha emisión:"}),e.jsx("span",{className:"font-medium text-gray-900",children:J(a.issue_date)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Estado:"}),e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:Y(a.status_color),color:W(a.status_color)},children:[Q(a.status),a.status_label]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Cliente"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"font-medium text-gray-900",children:a.customer.name})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsxs("span",{className:"text-gray-700",children:[a.customer.identification,e.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",a.customer.identification_type_label,")"]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"h-4 w-4 text-gray-400 mr-2"}),e.jsx("span",{className:"text-gray-700",children:a.customer.phone||"N/A"})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(ke,{className:"h-4 w-4 text-gray-400 mr-2 mt-0.5"}),e.jsx("span",{className:"text-gray-700 text-xs",children:a.customer.address})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"SRI"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[a.sri.access_key&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Clave de acceso:"}),e.jsx("p",{className:"text-xs text-gray-900 font-mono break-all mt-1",children:a.sri.access_key})]}),a.sri.authorization_number&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"N° autorización:"}),e.jsx("p",{className:"text-xs text-gray-900 font-mono break-all mt-1",children:a.sri.authorization_number})]}),a.retry_info.count>0&&e.jsx("div",{className:"text-orange-600",children:e.jsxs("span",{className:"text-xs",children:["Reintentos: ",a.retry_info.count]})})]})]})]}),a.sri.error_message&&e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg mb-6",children:[e.jsxs("h4",{className:"text-sm font-medium text-red-800 mb-2 flex items-center",children:[e.jsx(I,{className:"h-4 w-4 mr-1"}),"Error del SRI"]}),e.jsx("p",{className:"text-sm text-red-700",children:a.sri.error_message})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:["Artículos (",a.items.length,")"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cantidad"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Precio Unit."}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"IVA"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.items.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[t.product_name,e.jsxs("div",{className:"text-xs text-gray-500",children:["Código: ",t.product_code]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.quantity}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:u(t.unit_price)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:u(t.tax_amount)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:u(t.subtotal)})]},t.id))}),e.jsxs("tfoot",{className:"bg-gray-50",children:[e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"px-6 py-4 text-right text-sm font-medium text-gray-500",children:"Subtotal:"}),e.jsx("td",{colSpan:2,className:"px-6 py-4 text-sm text-gray-900",children:u(a.subtotal)})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"px-6 py-4 text-right text-sm font-medium text-gray-500",children:"IVA (15%):"}),e.jsx("td",{colSpan:2,className:"px-6 py-4 text-sm text-gray-900",children:u(a.tax_amount)})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"px-6 py-4 text-right text-sm font-medium text-gray-900",children:"Total:"}),e.jsx("td",{colSpan:2,className:"px-6 py-4 text-sm font-bold text-gray-900",children:u(a.total_amount)})]})]})]})})]}),e.jsxs("div",{className:"flex flex-wrap justify-end gap-2 mt-6",children:[a.status==="AUTHORIZED"&&e.jsxs("button",{onClick:()=>{const t={id:a.id,invoice_number:a.invoice_number,customer:a.customer,total_amount:a.total_amount,subtotal:a.subtotal,tax_amount:a.tax_amount,currency:a.currency||"USD",status:a.status,status_label:a.status_label,status_color:a.status_color,created_at:a.created_at,issue_date:a.issue_date,items_count:a.items.length,retry_count:a.retry_info.count,sri_access_key:a.sri.access_key,order:a.order};K(t),q()},className:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors flex items-center",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Crear Nota de Crédito"]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>w(!b),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Descargar"]}),b&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-10",children:e.jsxs("div",{className:"py-1",children:[e.jsxs("button",{onClick:()=>F(a.id,"pdf"),className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:[e.jsx(S,{className:"h-4 w-4 mr-2 text-gray-500"}),"Descargar PDF"]}),e.jsxs("button",{onClick:()=>F(a.id,"xml"),className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:[e.jsx(S,{className:"h-4 w-4 mr-2 text-gray-500"}),"Descargar XML"]}),e.jsxs("button",{onClick:()=>Ne(a.id),className:"flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left",children:[e.jsx(re,{className:"h-4 w-4 mr-2 text-gray-500"}),"Enviar por email"]})]})})]}),a.order&&e.jsxs(ne,{to:`/admin/orders/${a.order.id}`,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Ver Orden"]})]})]})]})})]})};export{Je as default};
//# sourceMappingURL=AdminInvoicesPage-C1LJS9M8.js.map
